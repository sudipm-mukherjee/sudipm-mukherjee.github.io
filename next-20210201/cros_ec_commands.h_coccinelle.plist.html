<!DOCTYPE html>
<html>
  <head>
    <title>Plist HTML Viewer</title>

    <meta charset="UTF-8">

    <style type="text/css">
      .CodeMirror{font-family:monospace;height:300px;color:#000;direction:ltr}.CodeMirror-lines{padding:4px 0}.CodeMirror pre{padding:0 4px}.CodeMirror-gutter-filler,.CodeMirror-scrollbar-filler{background-color:#fff}.CodeMirror-gutters{border-right:1px solid #ddd;background-color:#f7f7f7;white-space:nowrap}.CodeMirror-linenumber{padding:0 3px 0 5px;min-width:20px;text-align:right;color:#999;white-space:nowrap}.CodeMirror-guttermarker{color:#000}.CodeMirror-guttermarker-subtle{color:#999}.CodeMirror-cursor{border-left:1px solid #000;border-right:none;width:0}.CodeMirror div.CodeMirror-secondarycursor{border-left:1px solid silver}.cm-fat-cursor .CodeMirror-cursor{width:auto;border:0!important;background:#7e7}.cm-fat-cursor div.CodeMirror-cursors{z-index:1}.cm-animate-fat-cursor{width:auto;border:0;-webkit-animation:blink 1.06s steps(1) infinite;-moz-animation:blink 1.06s steps(1) infinite;animation:blink 1.06s steps(1) infinite;background-color:#7e7}@-moz-keyframes blink{50%{background-color:transparent}}@-webkit-keyframes blink{50%{background-color:transparent}}@keyframes blink{50%{background-color:transparent}}.cm-tab{display:inline-block;text-decoration:inherit}.CodeMirror-rulers{position:absolute;left:0;right:0;top:-50px;bottom:-20px;overflow:hidden}.CodeMirror-ruler{border-left:1px solid #ccc;top:0;bottom:0;position:absolute}.cm-s-default .cm-header{color:#00f}.cm-s-default .cm-quote{color:#090}.cm-negative{color:#d44}.cm-positive{color:#292}.cm-header,.cm-strong{font-weight:700}.cm-em{font-style:italic}.cm-link{text-decoration:underline}.cm-strikethrough{text-decoration:line-through}.cm-s-default .cm-keyword{color:#708}.cm-s-default .cm-atom{color:#219}.cm-s-default .cm-number{color:#164}.cm-s-default .cm-def{color:#00f}.cm-s-default .cm-variable-2{color:#05a}.cm-s-default .cm-type,.cm-s-default .cm-variable-3{color:#085}.cm-s-default .cm-comment{color:#a50}.cm-s-default .cm-string{color:#a11}.cm-s-default .cm-string-2{color:#f50}.cm-s-default .cm-meta{color:#555}.cm-s-default .cm-qualifier{color:#555}.cm-s-default .cm-builtin{color:#30a}.cm-s-default .cm-bracket{color:#997}.cm-s-default .cm-tag{color:#170}.cm-s-default .cm-attribute{color:#00c}.cm-s-default .cm-hr{color:#999}.cm-s-default .cm-link{color:#00c}.cm-s-default .cm-error{color:red}.cm-invalidchar{color:red}.CodeMirror-composing{border-bottom:2px solid}div.CodeMirror span.CodeMirror-matchingbracket{color:#0f0}div.CodeMirror span.CodeMirror-nonmatchingbracket{color:#f22}.CodeMirror-matchingtag{background:rgba(255,150,0,.3)}.CodeMirror-activeline-background{background:#e8f2ff}.CodeMirror{position:relative;overflow:hidden;background:#fff}.CodeMirror-scroll{overflow:scroll!important;margin-bottom:-30px;margin-right:-30px;padding-bottom:30px;height:100%;outline:0;position:relative}.CodeMirror-sizer{position:relative;border-right:30px solid transparent}.CodeMirror-gutter-filler,.CodeMirror-hscrollbar,.CodeMirror-scrollbar-filler,.CodeMirror-vscrollbar{position:absolute;z-index:6;display:none}.CodeMirror-vscrollbar{right:0;top:0;overflow-x:hidden;overflow-y:scroll}.CodeMirror-hscrollbar{bottom:0;left:0;overflow-y:hidden;overflow-x:scroll}.CodeMirror-scrollbar-filler{right:0;bottom:0}.CodeMirror-gutter-filler{left:0;bottom:0}.CodeMirror-gutters{position:absolute;left:0;top:0;min-height:100%;z-index:3}.CodeMirror-gutter{white-space:normal;height:100%;display:inline-block;vertical-align:top;margin-bottom:-30px}.CodeMirror-gutter-wrapper{position:absolute;z-index:4;background:0 0!important;border:none!important}.CodeMirror-gutter-background{position:absolute;top:0;bottom:0;z-index:4}.CodeMirror-gutter-elt{position:absolute;cursor:default;z-index:4}.CodeMirror-gutter-wrapper ::selection{background-color:transparent}.CodeMirror-gutter-wrapper ::-moz-selection{background-color:transparent}.CodeMirror-lines{cursor:text;min-height:1px}.CodeMirror pre{-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;border-width:0;background:0 0;font-family:inherit;font-size:inherit;margin:0;white-space:pre;word-wrap:normal;line-height:inherit;color:inherit;z-index:2;position:relative;overflow:visible;-webkit-tap-highlight-color:transparent;-webkit-font-variant-ligatures:contextual;font-variant-ligatures:contextual}.CodeMirror-wrap pre{word-wrap:break-word;white-space:pre-wrap;word-break:normal}.CodeMirror-linebackground{position:absolute;left:0;right:0;top:0;bottom:0;z-index:0}.CodeMirror-linewidget{position:relative;z-index:2;overflow:auto}.CodeMirror-rtl pre{direction:rtl}.CodeMirror-code{outline:0}.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber,.CodeMirror-scroll,.CodeMirror-sizer{-moz-box-sizing:content-box;box-sizing:content-box}.CodeMirror-measure{position:absolute;width:100%;height:0;overflow:hidden;visibility:hidden}.CodeMirror-cursor{position:absolute;pointer-events:none}.CodeMirror-measure pre{position:static}div.CodeMirror-cursors{visibility:hidden;position:relative;z-index:3}div.CodeMirror-dragcursors{visibility:visible}.CodeMirror-focused div.CodeMirror-cursors{visibility:visible}.CodeMirror-selected{background:#d9d9d9}.CodeMirror-focused .CodeMirror-selected{background:#d7d4f0}.CodeMirror-crosshair{cursor:crosshair}.CodeMirror-line::selection,.CodeMirror-line>span::selection,.CodeMirror-line>span>span::selection{background:#d7d4f0}.CodeMirror-line::-moz-selection,.CodeMirror-line>span::-moz-selection,.CodeMirror-line>span>span::-moz-selection{background:#d7d4f0}.cm-searching{background-color:#ffa;background-color:rgba(255,255,0,.4)}.cm-force-border{padding-right:.1px}@media print{.CodeMirror div.CodeMirror-cursors{visibility:hidden}}.cm-tab-wrap-hack:after{content:''}span.CodeMirror-selectedtext{background:0 0}
/*# sourceMappingURL=codemirror.min.css.map */

      .severity-low {
  background-color: #669603;
}

.severity-low:after {
  content : 'L';
}

.severity-unspecified {
  background-color: #666666;
}

.severity-unspecified:after {
  content : 'U';
}

.severity-style {
  background-color: #9932cc;
}

.severity-style:after {
  content : 'S';
}

.severity-medium {
  background-color: #a9d323;
  color: black;
}

.severity-medium:after {
  content : 'M';
}

.severity-high {
  background-color: #ffa800;
}

.severity-high:after {
  content : 'H';
}

.severity-critical {
  background-color: #e92625;
}

.severity-critical:after {
  content : 'C';
}

i[class*="severity-"] {
  line-height: normal;
  text-transform: capitalize;
  font-size: 0.8em;
  font-weight: bold;
  color: white;
  display: inline-block;
  width: 16px;
  height: 16px;
  text-align: center;
  font-family: sans-serif;
}

      html, body {
  width: 100%;
  height: 100%;
  padding: 0px;
  margin: 0px;
}

div.container {
  padding: 10px;
}

#content {
  height: 100%;
  display: block;
  overflow: hidden;
}

#content > div {
  margin: 10px;
  overflow: hidden;
  border: 1px solid #ddd;
  border-radius: 3px;
  overflow: hidden;
  height: 97%;
}

.button {
  background-color: #f1f1f1;
  text-decoration: none;
  display: inline-block;
  padding: 8px 16px;
  color: black;
  cursor: pointer;
}

.button:hover {
  background-color: #ddd;
  color: black;
}

.review-status {
  color: white;
  text-align: center;
}

.review-status-confirmed {
  background-color: #e92625;
}

.review-status-false-positive {
  background-color: grey;
}

.review-status-intentional {
  background-color: #669603;
}

      div.container {
  width: 100%;
  height: 100%;
  padding: 0px;
}

#editor-wrapper {
  margin: 10px;
}

#side-bar {
  float: left;
  width: 260px;
  margin: 0px;
}

#report-nav ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  overflow-y: auto;
  height: 100%;
}

#report-nav ul > li {
  padding: .4em;
  background-color: #fff;
  border-bottom: 1px solid rgba(0,0,0,.125);
  text-align: left;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

#report-nav ul > li.active {
  background-color: #427ea9;
  color: white;
}

#report-nav ul > li:hover {
  background-color: #427ea9;
  color: white;
  cursor: pointer;
}

#report-nav ul a {
  text-decoration: none;
}

#report-nav i[class*="severity-"] {
  margin-right: 5px;
}

.header {
  border-bottom: 1px solid lightgrey;
  font-family: monospace;
  padding: 10px;
  background-color: #fafbfc;
  border-bottom: 1px solid #e1e4e8;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}

#report-nav .header {
  font-weight: bold;
}

#editor-wrapper .header > div {
  padding-top: 2px;
}

#file-path,
#checker-name {
  color: #195ea2;
}

#review-status {
  padding: 0px 5px;
}

#file-path {
  font-family: monospace;
}

.check-msg {
  display: inline-block;
  padding: 3px 6px;
  margin: 1px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.check-msg.info {
  color: #00546f;
  background-color: #bfdfe9;
  border: 1px solid #87a8b3;
}

.check-msg.error {
  background-color: #f2dede;
  color: #a94442;
  border: 1px solid #ebcccc;
}

.check-msg.macro {
  background-color: #d7dac2;
  color: #4f5c6d;
  border: 1px solid #d7dac2;
}

.check-msg.note {
  background-color: #d7d7d7;
  color: #4f5c6d;
  border: 1px solid #bfbfbf;
}

.check-msg.current {
  border: 2px dashed #3692ff;
}

.check-msg .tag {
  padding: 1px 5px;
  text-align: center;
  border-radius: 2px;
  margin-right: 5px;
  text-decoration: inherit;
}

.check-msg .tag.macro {
  background-color: #83876a;
  color: white;
  text-transform: capitalize;
}

.check-msg .tag.note {
  background-color: #9299a1;
  color: white;
  text-transform: capitalize;
}

.checker-enum {
  color: white;
  padding: 1px 5px;
  text-align: center;
  border-radius: 25px;
  margin-right: 5px;
  text-decoration: inherit;
}

.checker-enum.info {
  background-color: #427ea9;
}

.checker-enum.error {
  background-color: #a94442;
}

.arrow {
  border: solid black;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 3px;
  cursor: pointer;
  margin: 0px 5px;
}

.arrow:hover {
  border: solid #437ea8;
  border-width: 0 3px 3px 0;
}

.left-arrow {
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
}

.right-arrow {
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
}

    </style>

    <script type="text/javascript">
      function setNonCompatibleBrowserMessage() {
  document.body.innerHTML =
    '<h2 style="margin-left: 20px;">Your browser is not compatible with CodeChecker Viewer!</h2> \
     <p style="margin-left: 20px;">The version required for the following browsers are:</p> \
     <ul style="margin-left: 20px;"> \
     <li>Internet Explorer: version 9 or newer</li> \
     <li>Firefox: version 22.0 or newer</li> \
     </ul>';
}

// http://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser
var browserVersion = (function(){
  var ua = navigator.userAgent, tem,
    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];

  if (/trident/i.test(M[1])) {
    tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
    return 'IE ' + (tem[1] || '');
  }

  if (M[1] === 'Chrome') {
    tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
    if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
  }

  M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
  if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
    return M.join(' ');
})();

var pos = browserVersion.indexOf(' ');
var browser = browserVersion.substr(0, pos);
var version = parseInt(browserVersion.substr(pos + 1));

var browserCompatible
  = browser === 'Firefox'
  ? version >= 22
  : browser === 'IE'
  ? version >= 9
  : true;


      /* MIT License

Copyright (C) 2017 by Marijn Haverbeke <marijnh@gmail.com> and others

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 */
      !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CodeMirror=t()}(this,function(){"use strict";function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function t(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function r(e,r){return t(e).appendChild(r)}function n(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),"string"==typeof t)i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function i(e,t,r,i){var o=n(e,t,r,i);return o.setAttribute("role","presentation"),o}function o(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function l(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function s(t,r){var n=t.className;e(r).test(n)||(t.className+=(n?" ":"")+r)}function a(t,r){for(var n=t.split(" "),i=0;i<n.length;i++)n[i]&&!e(n[i]).test(r)&&(r+=" "+n[i]);return r}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function c(e,t,r){t||(t={});for(var n in e)!e.hasOwnProperty(n)||!1===r&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function f(e,t,r,n,i){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,l=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t)return l+(t-o);l+=s-o,l+=r-l%r,o=s+1}}function h(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}function d(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var l=o-n;if(o==e.length||i+l>=t)return n+Math.min(l,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}function p(e){for(;Kl.length<=e;)Kl.push(g(Kl)+" ");return Kl[e]}function g(e){return e[e.length-1]}function v(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function m(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}function y(){}function b(e,t){var r;return Object.create?r=Object.create(e):(y.prototype=e,r=new y),t&&c(t,r),r}function w(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||jl.test(e))}function x(e,t){return t?!!(t.source.indexOf("\\w")>-1&&w(e))||t.test(e):w(e)}function C(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function S(e){return e.charCodeAt(0)>=768&&Xl.test(e)}function L(e,t,r){for(;(r<0?t>0:t<e.length)&&S(e.charAt(t));)t+=r;return t}function k(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}function T(e,t,r){var o=this;this.input=r,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=i("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=i("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var l=i("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[l],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Rl+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),gl&&vl<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),ml||fl&&Tl||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,r.init(o)}function M(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function N(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;i==r.line&&(o=o.slice(0,r.ch)),i==t.line&&(o=o.slice(t.ch)),n.push(o),++i}),n}function O(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function A(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function W(e){if(null==e.parent)return null;for(var t=e.parent,r=h(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function D(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var l=0;l<e.lines.length;++l){var s=e.lines[l].height;if(t<s)break;t-=s}return r+l}function H(e,t){return t>=e.first&&t<e.first+e.size}function F(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function E(e,t,r){if(void 0===r&&(r=null),!(this instanceof E))return new E(e,t,r);this.line=e,this.ch=t,this.sticky=r}function P(e,t){return e.line-t.line||e.ch-t.ch}function I(e,t){return e.sticky==t.sticky&&0==P(e,t)}function z(e){return E(e.line,e.ch)}function R(e,t){return P(e,t)<0?t:e}function B(e,t){return P(e,t)<0?e:t}function G(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function U(e,t){if(t.line<e.first)return E(e.first,0);var r=e.first+e.size-1;return t.line>r?E(r,M(e,r).text.length):V(t,M(e,t.line).text.length)}function V(e,t){var r=e.ch;return null==r||r>t?E(e.line,t):r<0?E(e.line,0):e}function K(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=U(e,t[n]);return r}function j(){Yl=!0}function X(){_l=!0}function Y(e,t,r){this.marker=e,this.from=t,this.to=r}function _(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function $(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function q(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Z(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==l.type&&(!r||!o.marker.insertLeft)){var s=null==o.to||(l.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new Y(l,o.from,s?null:o.to))}}return n}function Q(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.to||(l.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==l.type&&(!r||o.marker.insertLeft)){var s=null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new Y(l,s?null:o.from-t,null==o.to?null:o.to-t))}}return n}function J(e,t){if(t.full)return null;var r=H(e,t.from.line)&&M(e,t.from.line).markedSpans,n=H(e,t.to.line)&&M(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,l=0==P(t.from,t.to),s=Z(r,i,l),a=Q(n,o,l),u=1==t.text.length,c=g(t.text).length+(u?i:0);if(s)for(var f=0;f<s.length;++f){var h=s[f];if(null==h.to){var d=_(a,h.marker);d?u&&(h.to=null==d.to?null:d.to+c):h.to=i}}if(a)for(var p=0;p<a.length;++p){var v=a[p];null!=v.to&&(v.to+=c),null==v.from?_(s,v.marker)||(v.from=c,u&&(s||(s=[])).push(v)):(v.from+=c,u&&(s||(s=[])).push(v))}s&&(s=ee(s)),a&&a!=s&&(a=ee(a));var m=[s];if(!u){var y,b=t.text.length-2;if(b>0&&s)for(var w=0;w<s.length;++w)null==s[w].to&&(y||(y=[])).push(new Y(s[w].marker,null,null));for(var x=0;x<b;++x)m.push(y);m.push(a)}return m}function ee(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&!1!==r.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function te(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=h(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var l=n[o],s=l.find(0),a=0;a<i.length;++a){var u=i[a];if(!(P(u.to,s.from)<0||P(u.from,s.to)>0)){var c=[a,1],f=P(u.from,s.from),d=P(u.to,s.to);(f<0||!l.inclusiveLeft&&!f)&&c.push({from:u.from,to:s.from}),(d>0||!l.inclusiveRight&&!d)&&c.push({from:s.to,to:u.to}),i.splice.apply(i,c),a+=c.length-3}}return i}function re(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function ne(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function ie(e){return e.inclusiveLeft?-1:0}function oe(e){return e.inclusiveRight?1:0}function le(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),i=t.find(),o=P(n.from,i.from)||ie(e)-ie(t);if(o)return-o;var l=P(n.to,i.to)||oe(e)-oe(t);return l||t.id-e.id}function se(e,t){var r,n=_l&&e.markedSpans;if(n)for(var i=void 0,o=0;o<n.length;++o)(i=n[o]).marker.collapsed&&null==(t?i.from:i.to)&&(!r||le(r,i.marker)<0)&&(r=i.marker);return r}function ae(e){return se(e,!0)}function ue(e){return se(e,!1)}function ce(e,t,r,n,i){var o=M(e,t),l=_l&&o.markedSpans;if(l)for(var s=0;s<l.length;++s){var a=l[s];if(a.marker.collapsed){var u=a.marker.find(0),c=P(u.from,r)||ie(a.marker)-ie(i),f=P(u.to,n)||oe(a.marker)-oe(i);if(!(c>=0&&f<=0||c<=0&&f>=0)&&(c<=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.to,r)>=0:P(u.to,r)>0)||c>=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.from,n)<=0:P(u.from,n)<0)))return!0}}}function fe(e){for(var t;t=ae(e);)e=t.find(-1,!0).line;return e}function he(e){for(var t;t=ue(e);)e=t.find(1,!0).line;return e}function de(e){for(var t,r;t=ue(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function pe(e,t){var r=M(e,t),n=fe(r);return r==n?t:W(n)}function ge(e,t){if(t>e.lastLine())return t;var r,n=M(e,t);if(!ve(e,n))return t;for(;r=ue(n);)n=r.find(1,!0).line;return W(n)+1}function ve(e,t){var r=_l&&t.markedSpans;if(r)for(var n=void 0,i=0;i<r.length;++i)if((n=r[i]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&me(e,t,n))return!0}}function me(e,t,r){if(null==r.to){var n=r.marker.find(1,!0);return me(e,n.line,_(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if((i=t.markedSpans[o]).marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(null==i.to||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&me(e,t,i))return!0}function ye(e){for(var t=0,r=(e=fe(e)).parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var l=0;l<o.children.length;++l){var s=o.children[l];if(s==r)break;t+=s.height}return t}function be(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=ae(n);){var i=t.find(0,!0);n=i.from.line,r+=i.from.ch-i.to.ch}for(n=e;t=ue(n);){var o=t.find(0,!0);r-=n.text.length-o.from.ch,r+=(n=o.to.line).text.length-o.to.ch}return r}function we(e){var t=e.display,r=e.doc;t.maxLine=M(r,r.first),t.maxLineLength=be(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=be(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function xe(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var l=e[o];(l.from<r&&l.to>t||t==r&&l.to==t)&&(n(Math.max(l.from,t),Math.min(l.to,r),1==l.level?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}function Ce(e,t,r){var n;$l=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&"before"==r?n=i:$l=i),o.from==t&&(o.from!=o.to&&"before"!=r?n=i:$l=i)}return null!=n?n:$l}function Se(e,t){var r=e.order;return null==r&&(r=e.order=ql(e.text,t)),r}function Le(e,t){return e._handlers&&e._handlers[t]||Zl}function ke(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=h(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function Te(e,t){var r=Le(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function Me(e,t,r){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Te(e,r||t.type,e,t),He(t)||t.codemirrorIgnore}function Ne(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==h(r,t[n])&&r.push(t[n])}function Oe(e,t){return Le(e,t).length>0}function Ae(e){e.prototype.on=function(e,t){Ql(this,e,t)},e.prototype.off=function(e,t){ke(this,e,t)}}function We(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function De(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function He(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){We(e),De(e)}function Ee(e){return e.target||e.srcElement}function Pe(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Ml&&e.ctrlKey&&1==t&&(t=3),t}function Ie(e){if(null==Il){var t=n("span","​");r(e,n("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Il=t.offsetWidth<=1&&t.offsetHeight>2&&!(gl&&vl<8))}var i=Il?n("span","​"):n("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function ze(e){if(null!=zl)return zl;var n=r(e,document.createTextNode("AخA")),i=Wl(n,0,1).getBoundingClientRect(),o=Wl(n,1,2).getBoundingClientRect();return t(e),!(!i||i.left==i.right)&&(zl=o.right-i.right<3)}function Re(e){if(null!=ns)return ns;var t=r(e,n("span","x")),i=t.getBoundingClientRect(),o=Wl(t,0,1).getBoundingClientRect();return ns=Math.abs(i.left-o.left)>1}function Be(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),is[e]=t}function Ge(e){if("string"==typeof e&&os.hasOwnProperty(e))e=os[e];else if(e&&"string"==typeof e.name&&os.hasOwnProperty(e.name)){var t=os[e.name];"string"==typeof t&&(t={name:t}),(e=b(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ue(e,t){t=Ge(t);var r=is[t.name];if(!r)return Ue(e,"text/plain");var n=r(e,t);if(ls.hasOwnProperty(t.name)){var i=ls[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var l in t.modeProps)n[l]=t.modeProps[l];return n}function Ve(e,t){c(t,ls.hasOwnProperty(e)?ls[e]:ls[e]={})}function Ke(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function je(e,t){for(var r;e.innerMode&&(r=e.innerMode(t))&&r.mode!=e;)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Xe(e,t,r){return!e.startState||e.startState(t,r)}function Ye(e,t,r,n){var i=[e.state.modeGen],o={};tt(e,t.text,e.doc.mode,r,function(e,t){return i.push(e,t)},o,n);for(var l=r.state,s=0;s<e.state.overlays.length;++s)!function(n){var l=e.state.overlays[n],s=1,a=0;r.state=!0,tt(e,t.text,l.mode,r,function(e,t){for(var r=s;a<e;){var n=i[s];n>e&&i.splice(s,1,e,i[s+1],n),s+=2,a=Math.min(e,n)}if(t)if(l.opaque)i.splice(r,s-r,e,"overlay "+t),s=r+2;else for(;r<s;r+=2){var o=i[r+1];i[r+1]=(o?o+" ":"")+"overlay "+t}},o)}(s);return r.state=l,{styles:i,classes:o.bgClass||o.textClass?o:null}}function _e(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=$e(e,W(t)),i=t.text.length>e.options.maxHighlightLength&&Ke(e.doc.mode,n.state),o=Ye(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function $e(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new us(n,!0,t);var o=rt(e,t,r),l=o>n.first&&M(n,o-1).stateAfter,s=l?us.fromSaved(n,l,o):new us(n,Xe(n.mode),o);return n.iter(o,t,function(r){qe(e,r.text,s);var n=s.line;r.stateAfter=n==t-1||n%5==0||n>=i.viewFrom&&n<i.viewTo?s.save():null,s.nextLine()}),r&&(n.modeFrontier=s.line),s}function qe(e,t,r,n){var i=e.doc.mode,o=new ss(t,e.options.tabSize,r);for(o.start=o.pos=n||0,""==t&&Ze(i,r.state);!o.eol();)Qe(i,o,r.state),o.start=o.pos}function Ze(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=je(e,t);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function Qe(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=je(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function Je(e,t,r,n){var i,o,l=e.doc,s=l.mode,a=M(l,(t=U(l,t)).line),u=$e(e,t.line,r),c=new ss(a.text,e.options.tabSize,u);for(n&&(o=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,i=Qe(s,c,u.state),n&&o.push(new cs(c,i,Ke(l.mode,u.state)));return n?o:new cs(c,i,u.state)}function et(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}return e}function tt(e,t,r,n,i,o,l){var s=r.flattenSpans;null==s&&(s=e.options.flattenSpans);var a,u=0,c=null,f=new ss(t,e.options.tabSize,n),h=e.options.addModeClass&&[null];for(""==t&&et(Ze(r,n.state),o);!f.eol();){if(f.pos>e.options.maxHighlightLength?(s=!1,l&&qe(e,t,n,f.pos),f.pos=t.length,a=null):a=et(Qe(r,f,n.state,h),o),h){var d=h[0].name;d&&(a="m-"+(a?d+" "+a:d))}if(!s||c!=a){for(;u<f.start;)i(u=Math.min(f.start,u+5e3),c);c=a}f.start=f.pos}for(;u<f.pos;){var p=Math.min(f.pos,u+5e3);i(p,c),u=p}}function rt(e,t,r){for(var n,i,o=e.doc,l=r?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>l;--s){if(s<=o.first)return o.first;var a=M(o,s-1),u=a.stateAfter;if(u&&(!r||s+(u instanceof as?u.lookAhead:0)<=o.modeFrontier))return s;var c=f(a.text,null,e.options.tabSize);(null==i||n>c)&&(i=s-1,n=c)}return i}function nt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=M(e,n).stateAfter;if(i&&(!(i instanceof as)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}function it(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),re(e),ne(e,r);var i=n?n(e):1;i!=e.height&&A(e,i)}function ot(e){e.parent=null,re(e)}function lt(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?ps:ds;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function st(e,t){var r=i("span",null,null,ml?"padding-right: .1px":null),n={pre:i("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(gl||ml)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var l=o?t.rest[o-1]:t.line,s=void 0;n.pos=0,n.addToken=ut,ze(e.display.measure)&&(s=Se(l,e.doc.direction))&&(n.addToken=ft(n.addToken,s)),n.map=[],dt(l,n,_e(e,l,t!=e.display.externalMeasured&&W(l))),l.styleClasses&&(l.styleClasses.bgClass&&(n.bgClass=a(l.styleClasses.bgClass,n.bgClass||"")),l.styleClasses.textClass&&(n.textClass=a(l.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Ie(e.display.measure))),0==o?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(ml){var u=n.content.lastChild;(/\bcm-tab\b/.test(u.className)||u.querySelector&&u.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Te(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=a(n.pre.className,n.textClass||"")),n}function at(e){var t=n("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function ut(e,t,r,i,o,l,s){if(t){var a,u=e.splitSpaces?ct(t,e.trailingSpace):t,c=e.cm.state.specialChars,f=!1;if(c.test(t)){a=document.createDocumentFragment();for(var h=0;;){c.lastIndex=h;var d=c.exec(t),g=d?d.index-h:t.length-h;if(g){var v=document.createTextNode(u.slice(h,h+g));gl&&vl<9?a.appendChild(n("span",[v])):a.appendChild(v),e.map.push(e.pos,e.pos+g,v),e.col+=g,e.pos+=g}if(!d)break;h+=g+1;var m=void 0;if("\t"==d[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(m=a.appendChild(n("span",p(b),"cm-tab"))).setAttribute("role","presentation"),m.setAttribute("cm-text","\t"),e.col+=b}else"\r"==d[0]||"\n"==d[0]?((m=a.appendChild(n("span","\r"==d[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",d[0]),e.col+=1):((m=e.cm.options.specialCharPlaceholder(d[0])).setAttribute("cm-text",d[0]),gl&&vl<9?a.appendChild(n("span",[m])):a.appendChild(m),e.col+=1);e.map.push(e.pos,e.pos+1,m),e.pos++}}else e.col+=t.length,a=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,a),gl&&vl<9&&(f=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),r||i||o||f||s){var w=r||"";i&&(w+=i),o&&(w+=o);var x=n("span",[a],w,s);return l&&(x.title=l),e.content.appendChild(x)}e.content.appendChild(a)}}function ct(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);" "!=o||!r||i!=e.length-1&&32!=e.charCodeAt(i+1)||(o=" "),n+=o,r=" "==o}return n}function ft(e,t){return function(r,n,i,o,l,s,a){i=i?i+" cm-force-border":"cm-force-border";for(var u=r.pos,c=u+n.length;;){for(var f=void 0,h=0;h<t.length&&!((f=t[h]).to>u&&f.from<=u);h++);if(f.to>=c)return e(r,n,i,o,l,s,a);e(r,n.slice(0,f.to-u),i,o,null,s,a),o=null,n=n.slice(f.to-u),u=f.to}}}function ht(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function dt(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(n)for(var l,s,a,u,c,f,h,d=i.length,p=0,g=1,v="",m=0;;){if(m==p){a=u=c=f=s="",h=null,m=1/0;for(var y=[],b=void 0,w=0;w<n.length;++w){var x=n[w],C=x.marker;"bookmark"==C.type&&x.from==p&&C.widgetNode?y.push(C):x.from<=p&&(null==x.to||x.to>p||C.collapsed&&x.to==p&&x.from==p)?(null!=x.to&&x.to!=p&&m>x.to&&(m=x.to,u=""),C.className&&(a+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&x.from==p&&(c+=" "+C.startStyle),C.endStyle&&x.to==m&&(b||(b=[])).push(C.endStyle,x.to),C.title&&!f&&(f=C.title),C.collapsed&&(!h||le(h.marker,C)<0)&&(h=x)):x.from>p&&m>x.from&&(m=x.from)}if(b)for(var S=0;S<b.length;S+=2)b[S+1]==m&&(u+=" "+b[S]);if(!h||h.from==p)for(var L=0;L<y.length;++L)ht(t,0,y[L]);if(h&&(h.from||0)==p){if(ht(t,(null==h.to?d+1:h.to)-p,h.marker,null==h.from),null==h.to)return;h.to==p&&(h=!1)}}if(p>=d)break;for(var k=Math.min(d,m);;){if(v){var T=p+v.length;if(!h){var M=T>k?v.slice(0,k-p):v;t.addToken(t,M,l?l+a:a,c,p+M.length==m?u:"",f,s)}if(T>=k){v=v.slice(k-p),p=k;break}p=T,c=""}v=i.slice(o,o=r[g++]),l=lt(r[g++],t.cm.options)}}else for(var N=1;N<r.length;N+=2)t.addToken(t,i.slice(o,o=r[N]),lt(r[N+1],t.cm.options))}function pt(e,t,r){this.line=t,this.rest=de(t),this.size=this.rest?W(g(this.rest))-r+1:1,this.node=this.text=null,this.hidden=ve(e,t)}function gt(e,t,r){for(var n,i=[],o=t;o<r;o=n){var l=new pt(e.doc,M(e.doc,o),o);n=o+l.size,i.push(l)}return i}function vt(e){gs?gs.ops.push(e):e.ownsGroup=gs={ops:[e],delayedCallbacks:[]}}function mt(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function yt(e,t){var r=e.ownsGroup;if(r)try{mt(r)}finally{gs=null,t(r)}}function bt(e,t){var r=Le(e,t);if(r.length){var n,i=Array.prototype.slice.call(arguments,2);gs?n=gs.delayedCallbacks:vs?n=vs:(n=vs=[],setTimeout(wt,0));for(var o=0;o<r.length;++o)!function(e){n.push(function(){return r[e].apply(null,i)})}(o)}}function wt(){var e=vs;vs=null;for(var t=0;t<e.length;++t)e[t]()}function xt(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];"text"==o?kt(e,t):"gutter"==o?Mt(e,t,r,n):"class"==o?Tt(e,t):"widget"==o&&Nt(e,t,n)}t.changes=null}function Ct(e){return e.node==e.text&&(e.node=n("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),gl&&vl<8&&(e.node.style.zIndex=2)),e.node}function St(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var i=Ct(t);t.background=i.insertBefore(n("div",null,r),i.firstChild),e.display.input.setUneditable(t.background)}}function Lt(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):st(e,t)}function kt(e,t){var r=t.text.className,n=Lt(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,Tt(e,t)):r&&(t.text.className=r)}function Tt(e,t){St(e,t),t.line.wrapClass?Ct(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Mt(e,t,r,i){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var o=Ct(t);t.gutterBackground=n("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text)}var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var s=Ct(t),a=t.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||l&&l["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(n("div",F(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),l)for(var u=0;u<e.options.gutters.length;++u){var c=e.options.gutters[u],f=l.hasOwnProperty(c)&&l[c];f&&a.appendChild(n("div",[f],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function Nt(e,t,r){t.alignable&&(t.alignable=null);for(var n=t.node.firstChild,i=void 0;n;n=i)i=n.nextSibling,"CodeMirror-linewidget"==n.className&&t.node.removeChild(n);At(e,t,r)}function Ot(e,t,r,n){var i=Lt(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),Tt(e,t),Mt(e,t,r,n),At(e,t,n),t.node}function At(e,t,r){if(Wt(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)Wt(e,t.rest[n],t,r,!1)}function Wt(e,t,r,i,o){if(t.widgets)for(var l=Ct(r),s=0,a=t.widgets;s<a.length;++s){var u=a[s],c=n("div",[u.node],"CodeMirror-linewidget");u.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Dt(u,c,r,i),e.display.input.setUneditable(c),o&&u.above?l.insertBefore(c,r.gutter||r.text):l.appendChild(c),bt(u,"redraw")}}function Dt(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Ht(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!o(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),r(t.display.measure,n("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Ft(e,t){for(var r=Ee(t);r!=e.wrapper;r=r.parentNode)if(!r||1==r.nodeType&&"true"==r.getAttribute("cm-ignore-events")||r.parentNode==e.sizer&&r!=e.mover)return!0}function Et(e){return e.lineSpace.offsetTop}function Pt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function It(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=r(e.measure,n("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,o={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(e.cachedPaddingH=o),o}function zt(e){return Rl-e.display.nativeBarWidth}function Rt(e){return e.display.scroller.clientWidth-zt(e)-e.display.barWidth}function Bt(e){return e.display.scroller.clientHeight-zt(e)-e.display.barHeight}function Gt(e,t,r){var n=e.options.lineWrapping,i=n&&Rt(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var l=t.text.firstChild.getClientRects(),s=0;s<l.length-1;s++){var a=l[s],u=l[s+1];Math.abs(a.bottom-u.bottom)>2&&o.push((a.bottom+u.top)/2-r.top)}}o.push(r.bottom-r.top)}}function Ut(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(W(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}function Vt(e,t){var n=W(t=fe(t)),i=e.display.externalMeasured=new pt(e.doc,t,n);i.lineN=n;var o=i.built=st(e,i);return i.text=o.pre,r(e.display.lineMeasure,o.pre),i}function Kt(e,t,r,n){return Yt(e,Xt(e,t),r,n)}function jt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Lr(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function Xt(e,t){var r=W(t),n=jt(e,r);n&&!n.text?n=null:n&&n.changes&&(xt(e,n,r,br(e)),e.curOp.forceUpdate=!0),n||(n=Vt(e,t));var i=Ut(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function Yt(e,t,r,n,i){t.before&&(r=-1);var o,l=r+(n||"");return t.cache.hasOwnProperty(l)?o=t.cache[l]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Gt(e,t.view,t.rect),t.hasHeights=!0),(o=qt(e,t,r,n)).bogus||(t.cache[l]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}function _t(e,t,r){for(var n,i,o,l,s,a,u=0;u<e.length;u+=3)if(s=e[u],a=e[u+1],t<s?(i=0,o=1,l="left"):t<a?o=(i=t-s)+1:(u==e.length-3||t==a&&e[u+3]>t)&&(i=(o=a-s)-1,t>=a&&(l="right")),null!=i){if(n=e[u+2],s==a&&r==(n.insertLeft?"left":"right")&&(l=r),"left"==r&&0==i)for(;u&&e[u-2]==e[u-3]&&e[u-1].insertLeft;)n=e[2+(u-=3)],l="left";if("right"==r&&i==a-s)for(;u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft;)n=e[(u+=3)+2],l="right";break}return{node:n,start:i,end:o,collapse:l,coverStart:s,coverEnd:a}}function $t(e,t){var r=ms;if("left"==t)for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function qt(e,t,r,n){var i,o=_t(t.map,r,n),l=o.node,s=o.start,a=o.end,u=o.collapse;if(3==l.nodeType){for(var c=0;c<4;c++){for(;s&&S(t.line.text.charAt(o.coverStart+s));)--s;for(;o.coverStart+a<o.coverEnd&&S(t.line.text.charAt(o.coverStart+a));)++a;if((i=gl&&vl<9&&0==s&&a==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():$t(Wl(l,s,a).getClientRects(),n)).left||i.right||0==s)break;a=s,s-=1,u="right"}gl&&vl<11&&(i=Zt(e.display.measure,i))}else{s>0&&(u=n="right");var f;i=e.options.lineWrapping&&(f=l.getClientRects()).length>1?f["right"==n?f.length-1:0]:l.getBoundingClientRect()}if(gl&&vl<9&&!s&&(!i||!i.left&&!i.right)){var h=l.parentNode.getClientRects()[0];i=h?{left:h.left,right:h.left+yr(e.display),top:h.top,bottom:h.bottom}:ms}for(var d=i.top-t.rect.top,p=i.bottom-t.rect.top,g=(d+p)/2,v=t.view.measure.heights,m=0;m<v.length-1&&!(g<v[m]);m++);var y=m?v[m-1]:0,b=v[m],w={left:("right"==u?i.right:i.left)-t.rect.left,right:("left"==u?i.left:i.right)-t.rect.left,top:y,bottom:b};return i.left||i.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=d,w.rbottom=p),w}function Zt(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Re(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function Qt(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Jt(e){e.display.externalMeasure=null,t(e.display.lineMeasure);for(var r=0;r<e.display.view.length;r++)Qt(e.display.view[r])}function er(e){Jt(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function tr(){return bl&&kl?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function rr(){return bl&&kl?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function nr(e){var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;++r)e.widgets[r].above&&(t+=Ht(e.widgets[r]));return t}function ir(e,t,r,n,i){if(!i){var o=nr(t);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var l=ye(t);if("local"==n?l+=Et(e.display):l-=e.display.viewOffset,"page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();l+=s.top+("window"==n?0:rr());var a=s.left+("window"==n?0:tr());r.left+=a,r.right+=a}return r.top+=l,r.bottom+=l,r}function or(e,t,r){if("div"==r)return t;var n=t.left,i=t.top;if("page"==r)n-=tr(),i-=rr();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var l=e.display.lineSpace.getBoundingClientRect();return{left:n-l.left,top:i-l.top}}function lr(e,t,r,n,i){return n||(n=M(e.doc,t.line)),ir(e,n,Kt(e,n,t.ch,i),r)}function sr(e,t,r,n,i,o){function l(t,l){var s=Yt(e,i,t,l?"right":"left",o);return l?s.left=s.right:s.right=s.left,ir(e,n,s,r)}function s(e,t,r){var n=1==a[t].level;return l(r?e-1:e,n!=r)}n=n||M(e.doc,t.line),i||(i=Xt(e,n));var a=Se(n,e.doc.direction),u=t.ch,c=t.sticky;if(u>=n.text.length?(u=n.text.length,c="before"):u<=0&&(u=0,c="after"),!a)return l("before"==c?u-1:u,"before"==c);var f=Ce(a,u,c),h=$l,d=s(u,f,"before"==c);return null!=h&&(d.other=s(u,h,"before"!=c)),d}function ar(e,t){var r=0;t=U(e.doc,t),e.options.lineWrapping||(r=yr(e.display)*t.ch);var n=M(e.doc,t.line),i=ye(n)+Et(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function ur(e,t,r,n,i){var o=E(e,t,r);return o.xRel=i,n&&(o.outside=!0),o}function cr(e,t,r){var n=e.doc;if((r+=e.display.viewOffset)<0)return ur(n.first,0,null,!0,-1);var i=D(n,r),o=n.first+n.size-1;if(i>o)return ur(n.first+n.size-1,M(n,o).text.length,null,!0,1);t<0&&(t=0);for(var l=M(n,i);;){var s=pr(e,l,i,t,r),a=ue(l),u=a&&a.find(0,!0);if(!a||!(s.ch>u.from.ch||s.ch==u.from.ch&&s.xRel>0))return s;i=W(l=u.to.line)}}function fr(e,t,r,n){n-=nr(t);var i=t.text.length,o=k(function(t){return Yt(e,r,t-1).bottom<=n},i,0);return i=k(function(t){return Yt(e,r,t).top>n},o,i),{begin:o,end:i}}function hr(e,t,r,n){return r||(r=Xt(e,t)),fr(e,t,r,ir(e,t,Yt(e,r,n),"line").top)}function dr(e,t,r,n){return!(e.bottom<=r)&&(e.top>r||(n?e.left:e.right)>t)}function pr(e,t,r,n,i){i-=ye(t);var o=Xt(e,t),l=nr(t),s=0,a=t.text.length,u=!0,c=Se(t,e.doc.direction);if(c){var f=(e.options.lineWrapping?vr:gr)(e,t,r,o,c,n,i);s=(u=1!=f.level)?f.from:f.to-1,a=u?f.to:f.from-1}var h,d,p=null,g=null,v=k(function(t){var r=Yt(e,o,t);return r.top+=l,r.bottom+=l,!!dr(r,n,i,!1)&&(r.top<=i&&r.left<=n&&(p=t,g=r),!0)},s,a),m=!1;if(g){var y=n-g.left<g.right-n,b=y==u;v=p+(b?0:1),d=b?"after":"before",h=y?g.left:g.right}else{u||v!=a&&v!=s||v++,d=0==v?"after":v==t.text.length?"before":Yt(e,o,v-(u?1:0)).bottom+l<=i==u?"after":"before";var w=sr(e,E(r,v,d),"line",t,o);h=w.left,m=i<w.top||i>=w.bottom}return v=L(t.text,v,1),ur(r,v,d,m,n-h)}function gr(e,t,r,n,i,o,l){var s=k(function(s){var a=i[s],u=1!=a.level;return dr(sr(e,E(r,u?a.to:a.from,u?"before":"after"),"line",t,n),o,l,!0)},0,i.length-1),a=i[s];if(s>0){var u=1!=a.level,c=sr(e,E(r,u?a.from:a.to,u?"after":"before"),"line",t,n);dr(c,o,l,!0)&&c.top>l&&(a=i[s-1])}return a}function vr(e,t,r,n,i,o,l){for(var s=fr(e,t,n,l),a=s.begin,u=s.end,c=null,f=null,h=0;h<i.length;h++){var d=i[h];if(!(d.from>=u||d.to<=a)){var p=Yt(e,n,1!=d.level?Math.min(u,d.to)-1:Math.max(a,d.from)).right,g=p<o?o-p+1e9:p-o;(!c||f>g)&&(c=d,f=g)}}return c||(c=i[i.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>u&&(c={from:c.from,to:u,level:c.level}),c}function mr(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==hs){hs=n("pre");for(var i=0;i<49;++i)hs.appendChild(document.createTextNode("x")),hs.appendChild(n("br"));hs.appendChild(document.createTextNode("x"))}r(e.measure,hs);var o=hs.offsetHeight/50;return o>3&&(e.cachedTextHeight=o),t(e.measure),o||1}function yr(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=n("span","xxxxxxxxxx"),i=n("pre",[t]);r(e.measure,i);var o=t.getBoundingClientRect(),l=(o.right-o.left)/10;return l>2&&(e.cachedCharWidth=l),l||10}function br(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,l=0;o;o=o.nextSibling,++l)r[e.options.gutters[l]]=o.offsetLeft+o.clientLeft+i,n[e.options.gutters[l]]=o.clientWidth;return{fixedPos:wr(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function wr(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function xr(e){var t=mr(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/yr(e.display)-3);return function(i){if(ve(e.doc,i))return 0;var o=0;if(i.widgets)for(var l=0;l<i.widgets.length;l++)i.widgets[l].height&&(o+=i.widgets[l].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function Cr(e){var t=e.doc,r=xr(e);t.iter(function(e){var t=r(e);t!=e.height&&A(e,t)})}function Sr(e,t,r,n){var i=e.display;if(!r&&"true"==Ee(t).getAttribute("cm-not-content"))return null;var o,l,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left,l=t.clientY-s.top}catch(t){return null}var a,u=cr(e,o,l);if(n&&1==u.xRel&&(a=M(e.doc,u.line).text).length==u.ch){var c=f(a,a.length,e.options.tabSize)-a.length;u=E(u.line,Math.max(0,Math.round((o-It(e.display).left)/yr(e.display))-c))}return u}function Lr(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var r=e.display.view,n=0;n<r.length;n++)if((t-=r[n].size)<0)return n}function kr(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Tr(e,t){void 0===t&&(t=!0);for(var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),l=0;l<r.sel.ranges.length;l++)if(t||l!=r.sel.primIndex){var s=r.sel.ranges[l];if(!(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom)){var a=s.empty();(a||e.options.showCursorWhenSelecting)&&Mr(e,s.head,i),a||Or(e,s,o)}}return n}function Mr(e,t,r){var i=sr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),o=r.appendChild(n("div"," ","CodeMirror-cursor"));if(o.style.left=i.left+"px",o.style.top=i.top+"px",o.style.height=Math.max(0,i.bottom-i.top)*e.options.cursorHeight+"px",i.other){var l=r.appendChild(n("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=i.other.left+"px",l.style.top=i.other.top+"px",l.style.height=.85*(i.other.bottom-i.other.top)+"px"}}function Nr(e,t){return e.top-t.top||e.left-t.left}function Or(e,t,r){function i(e,t,r,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),a.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==r?f-e:r)+"px;\n                             height: "+(i-t)+"px"))}function o(t,r,n){function o(r,n){return lr(e,E(t,r),"div",u,n)}var l,a,u=M(s,t),h=u.text.length,d=Se(u,s.direction);return xe(d,r||0,null==n?h:n,function(t,s,p,g){var v=o(t,"ltr"==p?"left":"right"),m=o(s-1,"ltr"==p?"right":"left");if("ltr"==p){var y=null==r&&0==t?c:v.left,b=null==n&&s==h?f:m.right;m.top-v.top<=3?i(y,m.top,b-y,m.bottom):(i(y,v.top,null,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top),i(c,m.top,m.right,m.bottom))}else if(t<s){var w=null==r&&0==t?f:v.right,x=null==n&&s==h?c:m.left;if(m.top-v.top<=3)i(x,m.top,w-x,m.bottom);else{var C=c;if(g){var S=hr(e,u,null,t).end;C=o(S-(/\s/.test(u.text.charAt(S-1))?2:1),"left").left}i(C,v.top,w-C,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top);var L=null;d.length,L=o(hr(e,u,null,s).begin,"right").right-x,i(x,m.top,L,m.bottom)}}(!l||Nr(v,l)<0)&&(l=v),Nr(m,l)<0&&(l=m),(!a||Nr(v,a)<0)&&(a=v),Nr(m,a)<0&&(a=m)}),{start:l,end:a}}var l=e.display,s=e.doc,a=document.createDocumentFragment(),u=It(e.display),c=u.left,f=Math.max(l.sizerWidth,Rt(e)-l.sizer.offsetLeft)-u.right,h=t.from(),d=t.to();if(h.line==d.line)o(h.line,h.ch,d.ch);else{var p=M(s,h.line),g=M(s,d.line),v=fe(p)==fe(g),m=o(h.line,h.ch,v?p.text.length+1:null).end,y=o(d.line,v?0:null,d.ch).start;v&&(m.top<y.top-2?(i(m.right,m.top,null,m.bottom),i(c,y.top,y.left,y.bottom)):i(m.right,m.top,y.left-m.right,m.bottom)),m.bottom<y.top&&i(c,m.bottom,null,y.top)}r.appendChild(a)}function Ar(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Wr(e){e.state.focused||(e.display.input.focus(),Hr(e))}function Dr(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Fr(e))},100)}function Hr(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Te(e,"focus",e,t),e.state.focused=!0,s(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),ml&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),Ar(e))}function Fr(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Te(e,"blur",e,t),e.state.focused=!1,Fl(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Er(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var i=t.view[n],o=void 0;if(!i.hidden){if(gl&&vl<8){var l=i.node.offsetTop+i.node.offsetHeight;o=l-r,r=l}else{var s=i.node.getBoundingClientRect();o=s.bottom-s.top}var a=i.line.height-o;if(o<2&&(o=mr(t)),(a>.005||a<-.005)&&(A(i.line,o),Pr(i.line),i.rest))for(var u=0;u<i.rest.length;u++)Pr(i.rest[u])}}}function Pr(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Ir(e,t,r){var n=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Et(e));var i=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=D(t,n),l=D(t,i);if(r&&r.ensure){var s=r.ensure.from.line,a=r.ensure.to.line;s<o?(o=s,l=D(t,ye(M(t,s))+e.wrapper.clientHeight)):Math.min(a,t.lastLine())>=l&&(o=D(t,ye(M(t,a))-e.wrapper.clientHeight),l=a)}return{from:o,to:Math.max(l,o+1)}}function zr(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=wr(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",l=0;l<r.length;l++)if(!r[l].hidden){e.options.fixedGutter&&(r[l].gutter&&(r[l].gutter.style.left=o),r[l].gutterBackground&&(r[l].gutterBackground.style.left=o));var s=r[l].alignable;if(s)for(var a=0;a<s.length;a++)s[a].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function Rr(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=F(e.options,t.first+t.size-1),i=e.display;if(r.length!=i.lineNumChars){var o=i.measure.appendChild(n("div",[n("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),l=o.firstChild.offsetWidth,s=o.offsetWidth-l;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(l,i.lineGutter.offsetWidth-s)+1,i.lineNumWidth=i.lineNumInnerWidth+s,i.lineNumChars=i.lineNumInnerWidth?r.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",Wn(e),!0}return!1}function Br(e,t){if(!Me(e,"scrollCursorIntoView")){var r=e.display,i=r.sizer.getBoundingClientRect(),o=null;if(t.top+i.top<0?o=!0:t.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!Sl){var l=n("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-Et(e.display))+"px;\n                         height: "+(t.bottom-t.top+zt(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(l),l.scrollIntoView(o),e.display.lineSpace.removeChild(l)}}}function Gr(e,t,r,n){null==n&&(n=0);var i;e.options.lineWrapping||t!=r||(r="before"==(t=t.ch?E(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?E(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var l=!1,s=sr(e,t),a=r&&r!=t?sr(e,r):s,u=Vr(e,i={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n}),c=e.doc.scrollTop,f=e.doc.scrollLeft;if(null!=u.scrollTop&&(qr(e,u.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(l=!0)),null!=u.scrollLeft&&(Qr(e,u.scrollLeft),Math.abs(e.doc.scrollLeft-f)>1&&(l=!0)),!l)break}return i}function Ur(e,t){var r=Vr(e,t);null!=r.scrollTop&&qr(e,r.scrollTop),null!=r.scrollLeft&&Qr(e,r.scrollLeft)}function Vr(e,t){var r=e.display,n=mr(e.display);t.top<0&&(t.top=0);var i=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:r.scroller.scrollTop,o=Bt(e),l={};t.bottom-t.top>o&&(t.bottom=t.top+o);var s=e.doc.height+Pt(r),a=t.top<n,u=t.bottom>s-n;if(t.top<i)l.scrollTop=a?0:t.top;else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);c!=i&&(l.scrollTop=c)}var f=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:r.scroller.scrollLeft,h=Rt(e)-(e.options.fixedGutter?r.gutters.offsetWidth:0),d=t.right-t.left>h;return d&&(t.right=t.left+h),t.left<10?l.scrollLeft=0:t.left<f?l.scrollLeft=Math.max(0,t.left-(d?0:10)):t.right>h+f-3&&(l.scrollLeft=t.right+(d?0:10)-h),l}function Kr(e,t){null!=t&&(_r(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function jr(e){_r(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Xr(e,t,r){null==t&&null==r||_r(e),null!=t&&(e.curOp.scrollLeft=t),null!=r&&(e.curOp.scrollTop=r)}function Yr(e,t){_r(e),e.curOp.scrollToPos=t}function _r(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,$r(e,ar(e,t.from),ar(e,t.to),t.margin))}function $r(e,t,r,n){var i=Vr(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});Xr(e,i.scrollLeft,i.scrollTop)}function qr(e,t){Math.abs(e.doc.scrollTop-t)<2||(fl||On(e,{top:t}),Zr(e,t,!0),fl&&On(e),Cn(e,100))}function Zr(e,t,r){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Qr(e,t,r,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,zr(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Jr(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+Pt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+zt(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}function en(e,t){t||(t=Jr(e));var r=e.display.barWidth,n=e.display.barHeight;tn(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&Er(e),tn(e,Jr(e)),r=e.display.barWidth,n=e.display.barHeight}function tn(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}function rn(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Fl(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new ws[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Ql(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){"horizontal"==r?Qr(e,t):qr(e,t)},e),e.display.scrollbars.addClass&&s(e.display.wrapper,e.display.scrollbars.addClass)}function nn(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++xs},vt(e.curOp)}function on(e){yt(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;ln(e)})}function ln(e){for(var t=e.ops,r=0;r<t.length;r++)sn(t[r]);for(var n=0;n<t.length;n++)an(t[n]);for(var i=0;i<t.length;i++)un(t[i]);for(var o=0;o<t.length;o++)cn(t[o]);for(var l=0;l<t.length;l++)fn(t[l])}function sn(e){var t=e.cm,r=t.display;Ln(t),e.updateMaxLine&&we(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Cs(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function an(e){e.updatedDisplay=e.mustUpdate&&Mn(e.cm,e.update)}function un(e){var t=e.cm,r=t.display;e.updatedDisplay&&Er(t),e.barMeasure=Jr(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Kt(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+zt(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-Rt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function cn(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Qr(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==l();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&en(t,e.barMeasure),e.updatedDisplay&&Dn(t,e.barMeasure),e.selectionChanged&&Ar(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&Wr(e.cm)}function fn(e){var t=e.cm,r=t.display,n=t.doc;e.updatedDisplay&&Nn(t,e.update),null==r.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=e.scrollTop&&Zr(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Qr(t,e.scrollLeft,!0,!0),e.scrollToPos&&Br(t,Gr(t,U(n,e.scrollToPos.from),U(n,e.scrollToPos.to),e.scrollToPos.margin));var i=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(i)for(var l=0;l<i.length;++l)i[l].lines.length||Te(i[l],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&Te(o[s],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Te(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function hn(e,t){if(e.curOp)return t();nn(e);try{return t()}finally{on(e)}}function dn(e,t){return function(){if(e.curOp)return t.apply(e,arguments);nn(e);try{return t.apply(e,arguments)}finally{on(e)}}}function pn(e){return function(){if(this.curOp)return e.apply(this,arguments);nn(this);try{return e.apply(this,arguments)}finally{on(this)}}}function gn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);nn(t);try{return e.apply(this,arguments)}finally{on(t)}}}function vn(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)_l&&pe(e.doc,t)<i.viewTo&&yn(e);else if(r<=i.viewFrom)_l&&ge(e.doc,r+n)>i.viewFrom?yn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)yn(e);else if(t<=i.viewFrom){var o=bn(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):yn(e)}else if(r>=i.viewTo){var l=bn(e,t,t,-1);l?(i.view=i.view.slice(0,l.index),i.viewTo=l.lineN):yn(e)}else{var s=bn(e,t,t,-1),a=bn(e,r,r+n,1);s&&a?(i.view=i.view.slice(0,s.index).concat(gt(e,s.lineN,a.lineN)).concat(i.view.slice(a.index)),i.viewTo+=n):yn(e)}var u=i.externalMeasured;u&&(r<u.lineN?u.lineN+=n:t<u.lineN+u.size&&(i.externalMeasured=null))}function mn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Lr(e,t)];if(null!=o.node){var l=o.changes||(o.changes=[]);-1==h(l,r)&&l.push(r)}}}function yn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function bn(e,t,r,n){var i,o=Lr(e,t),l=e.display.view;if(!_l||r==e.doc.first+e.doc.size)return{index:o,lineN:r};for(var s=e.display.viewFrom,a=0;a<o;a++)s+=l[a].size;if(s!=t){if(n>0){if(o==l.length-1)return null;i=s+l[o].size-t,o++}else i=s-t;t+=i,r+=i}for(;pe(e.doc,r)!=r;){if(o==(n<0?0:l.length-1))return null;r+=n*l[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:r}}function wn(e,t,r){var n=e.display;0==n.view.length||t>=n.viewTo||r<=n.viewFrom?(n.view=gt(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=gt(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Lr(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(gt(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,Lr(e,r)))),n.viewTo=r}function xn(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];i.hidden||i.node&&!i.changes||++r}return r}function Cn(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,u(Sn,e))}function Sn(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=$e(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var l=o.styles,s=o.text.length>e.options.maxHighlightLength?Ke(t.mode,n.state):null,a=Ye(e,o,n,!0);s&&(n.state=s),o.styles=a.styles;var u=o.styleClasses,c=a.classes;c?o.styleClasses=c:u&&(o.styleClasses=null);for(var f=!l||l.length!=o.styles.length||u!=c&&(!u||!c||u.bgClass!=c.bgClass||u.textClass!=c.textClass),h=0;!f&&h<l.length;++h)f=l[h]!=o.styles[h];f&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&qe(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return Cn(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&hn(e,function(){for(var t=0;t<i.length;t++)mn(e,i[t],"text")})}}function Ln(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=zt(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=zt(e)+"px",t.scrollbarsClipped=!0)}function kn(e){if(e.hasFocus())return null;var t=l();if(!t||!o(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}function Tn(e){if(e&&e.activeElt&&e.activeElt!=l()&&(e.activeElt.focus(),e.anchorNode&&o(document.body,e.anchorNode)&&o(document.body,e.focusNode))){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset),r.collapse(!1),t.removeAllRanges(),t.addRange(r),t.extend(e.focusNode,e.focusOffset)}}function Mn(e,r){var n=e.display,i=e.doc;if(r.editorIsHidden)return yn(e),!1;if(!r.force&&r.visible.from>=n.viewFrom&&r.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==xn(e))return!1;Rr(e)&&(yn(e),r.dims=br(e));var o=i.first+i.size,l=Math.max(r.visible.from-e.options.viewportMargin,i.first),s=Math.min(o,r.visible.to+e.options.viewportMargin);n.viewFrom<l&&l-n.viewFrom<20&&(l=Math.max(i.first,n.viewFrom)),n.viewTo>s&&n.viewTo-s<20&&(s=Math.min(o,n.viewTo)),_l&&(l=pe(e.doc,l),s=ge(e.doc,s));var a=l!=n.viewFrom||s!=n.viewTo||n.lastWrapHeight!=r.wrapperHeight||n.lastWrapWidth!=r.wrapperWidth;wn(e,l,s),n.viewOffset=ye(M(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var u=xn(e);if(!a&&0==u&&!r.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var c=kn(e);return u>4&&(n.lineDiv.style.display="none"),An(e,n.updateLineNumbers,r.dims),u>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Tn(c),t(n.cursorDiv),t(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,a&&(n.lastWrapHeight=r.wrapperHeight,n.lastWrapWidth=r.wrapperWidth,Cn(e,400)),n.updateLineNumbers=null,!0}function Nn(e,t){for(var r=t.viewport,n=!0;(n&&e.options.lineWrapping&&t.oldDisplayWidth!=Rt(e)||(r&&null!=r.top&&(r={top:Math.min(e.doc.height+Pt(e.display)-Bt(e),r.top)}),t.visible=Ir(e.display,e.doc,r),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&Mn(e,t);n=!1){Er(e);var i=Jr(e);kr(e),en(e,i),Dn(e,i),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function On(e,t){var r=new Cs(e,t);if(Mn(e,r)){Er(e),Nn(e,r);var n=Jr(e);kr(e),en(e,n),Dn(e,n),r.finish()}}function An(e,r,n){function i(t){var r=t.nextSibling;return ml&&Ml&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var o=e.display,l=e.options.lineNumbers,s=o.lineDiv,a=s.firstChild,u=o.view,c=o.viewFrom,f=0;f<u.length;f++){var d=u[f];if(d.hidden);else if(d.node&&d.node.parentNode==s){for(;a!=d.node;)a=i(a);var p=l&&null!=r&&r<=c&&d.lineNumber;d.changes&&(h(d.changes,"gutter")>-1&&(p=!1),xt(e,d,c,n)),p&&(t(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(F(e.options,c)))),a=d.node.nextSibling}else{var g=Ot(e,d,c,n);s.insertBefore(g,a)}c+=d.size}for(;a;)a=i(a)}function Wn(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Dn(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+zt(e)+"px"}function Hn(e){var r=e.display.gutters,i=e.options.gutters;t(r);for(var o=0;o<i.length;++o){var l=i[o],s=r.appendChild(n("div",null,"CodeMirror-gutter "+l));"CodeMirror-linenumbers"==l&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}r.style.display=o?"":"none",Wn(e)}function Fn(e){var t=h(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function En(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==r&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:null==r&&(r=e.wheelDelta),{x:t,y:r}}function Pn(e){var t=En(e);return t.x*=Ls,t.y*=Ls,t}function In(e,t){var r=En(t),n=r.x,i=r.y,o=e.display,l=o.scroller,s=l.scrollWidth>l.clientWidth,a=l.scrollHeight>l.clientHeight;if(n&&s||i&&a){if(i&&Ml&&ml)e:for(var u=t.target,c=o.view;u!=l;u=u.parentNode)for(var f=0;f<c.length;f++)if(c[f].node==u){e.display.currentWheelTarget=u;break e}if(n&&!fl&&!wl&&null!=Ls)return i&&a&&qr(e,Math.max(0,l.scrollTop+i*Ls)),Qr(e,Math.max(0,l.scrollLeft+n*Ls)),(!i||i&&a)&&We(t),void(o.wheelStartX=null);if(i&&null!=Ls){var h=i*Ls,d=e.doc.scrollTop,p=d+o.wrapper.clientHeight;h<0?d=Math.max(0,d+h-50):p=Math.min(e.doc.height,p+h+50),On(e,{top:d,bottom:p})}Ss<20&&(null==o.wheelStartX?(o.wheelStartX=l.scrollLeft,o.wheelStartY=l.scrollTop,o.wheelDX=n,o.wheelDY=i,setTimeout(function(){if(null!=o.wheelStartX){var e=l.scrollLeft-o.wheelStartX,t=l.scrollTop-o.wheelStartY,r=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,r&&(Ls=(Ls*Ss+r)/(Ss+1),++Ss)}},200)):(o.wheelDX+=n,o.wheelDY+=i))}}function zn(e,t){var r=e[t];e.sort(function(e,t){return P(e.from(),t.from())}),t=h(e,r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(P(o.to(),i.from())>=0){var l=B(o.from(),i.from()),s=R(o.to(),i.to()),a=o.empty()?i.from()==i.head:o.from()==o.head;n<=t&&--t,e.splice(--n,2,new Ts(a?s:l,a?l:s))}}return new ks(e,t)}function Rn(e,t){return new ks([new Ts(e,t||e)],0)}function Bn(e){return e.text?E(e.from.line+e.text.length-1,g(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Gn(e,t){if(P(e,t.from)<0)return e;if(P(e,t.to)<=0)return Bn(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Bn(t).ch-t.to.ch),E(r,n)}function Un(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Ts(Gn(i.anchor,t),Gn(i.head,t)))}return zn(r,e.sel.primIndex)}function Vn(e,t,r){return e.line==t.line?E(r.line,e.ch-t.ch+r.ch):E(r.line+(e.line-t.line),e.ch)}function Kn(e,t,r){for(var n=[],i=E(e.first,0),o=i,l=0;l<t.length;l++){var s=t[l],a=Vn(s.from,i,o),u=Vn(Bn(s),i,o);if(i=s.to,o=u,"around"==r){var c=e.sel.ranges[l],f=P(c.head,c.anchor)<0;n[l]=new Ts(f?u:a,f?a:u)}else n[l]=new Ts(a,a)}return new ks(n,e.sel.primIndex)}function jn(e){e.doc.mode=Ue(e.options,e.doc.modeOption),Xn(e)}function Xn(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Cn(e,100),e.state.modeGen++,e.curOp&&vn(e)}function Yn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==g(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function _n(e,t,r,n){function i(e){return r?r[e]:null}function o(e,r,i){it(e,r,i,n),bt(e,"change",e,t)}function l(e,t){for(var r=[],o=e;o<t;++o)r.push(new fs(u[o],i(o),n));return r}var s=t.from,a=t.to,u=t.text,c=M(e,s.line),f=M(e,a.line),h=g(u),d=i(u.length-1),p=a.line-s.line;if(t.full)e.insert(0,l(0,u.length)),e.remove(u.length,e.size-u.length);else if(Yn(e,t)){var v=l(0,u.length-1);o(f,f.text,d),p&&e.remove(s.line,p),v.length&&e.insert(s.line,v)}else if(c==f)if(1==u.length)o(c,c.text.slice(0,s.ch)+h+c.text.slice(a.ch),d);else{var m=l(1,u.length-1);m.push(new fs(h+c.text.slice(a.ch),d,n)),o(c,c.text.slice(0,s.ch)+u[0],i(0)),e.insert(s.line+1,m)}else if(1==u.length)o(c,c.text.slice(0,s.ch)+u[0]+f.text.slice(a.ch),i(0)),e.remove(s.line+1,p);else{o(c,c.text.slice(0,s.ch)+u[0],i(0)),o(f,h+f.text.slice(a.ch),d);var y=l(1,u.length-1);p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,y)}bt(e,"change",e,t)}function $n(e,t,r){function n(e,i,o){if(e.linked)for(var l=0;l<e.linked.length;++l){var s=e.linked[l];if(s.doc!=i){var a=o&&s.sharedHist;r&&!a||(t(s.doc,a),n(s.doc,e,a))}}}n(e,null,!0)}function qn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Cr(e),jn(e),Zn(e),e.options.lineWrapping||we(e),e.options.mode=t.modeOption,vn(e)}function Zn(e){("rtl"==e.doc.direction?s:Fl)(e.display.lineDiv,"CodeMirror-rtl")}function Qn(e){hn(e,function(){Zn(e),vn(e)})}function Jn(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function ei(e,t){var r={from:z(t.from),to:Bn(t),text:N(e,t.from,t.to)};return si(e,r,t.from.line,t.to.line+1),$n(e,function(e){return si(e,r,t.from.line,t.to.line+1)},!0),r}function ti(e){for(;e.length&&g(e).ranges;)e.pop()}function ri(e,t){return t?(ti(e.done),g(e.done)):e.done.length&&!g(e.done).ranges?g(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),g(e.done)):void 0}function ni(e,t,r,n){var i=e.history;i.undone.length=0;var o,l,s=+new Date;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&i.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=ri(i,i.lastOp==n)))l=g(o.changes),0==P(t.from,t.to)&&0==P(t.from,l.to)?l.to=Bn(t):o.changes.push(ei(e,t));else{var a=g(i.done);for(a&&a.ranges||li(e.sel,i.done),o={changes:[ei(e,t)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=s,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||Te(e,"historyAdded")}function ii(e,t,r,n){var i=t.charAt(0);return"*"==i||"+"==i&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function oi(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||ii(e,o,g(i.done),t))?i.done[i.done.length-1]=t:li(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&!1!==n.clearRedo&&ti(i.undone)}function li(e,t){var r=g(t);r&&r.ranges&&r.equals(e)||t.push(e)}function si(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function ai(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function ui(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(ai(r[i]));return n}function ci(e,t){var r=ui(e,t),n=J(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],l=n[i];if(o&&l)e:for(var s=0;s<l.length;++s){for(var a=l[s],u=0;u<o.length;++u)if(o[u].marker==a.marker)continue e;o.push(a)}else l&&(r[i]=l)}return r}function fi(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges)n.push(r?ks.prototype.deepCopy.call(o):o);else{var l=o.changes,s=[];n.push({changes:s});for(var a=0;a<l.length;++a){var u=l[a],c=void 0;if(s.push({from:u.from,to:u.to,text:u.text}),t)for(var f in u)(c=f.match(/^spans_(\d+)$/))&&h(t,Number(c[1]))>-1&&(g(s)[f]=u[f],delete u[f])}}}return n}function hi(e,t,r,n){if(n){var i=e.anchor;if(r){var o=P(t,i)<0;o!=P(r,i)<0?(i=t,t=r):o!=P(t,r)<0&&(t=r)}return new Ts(i,t)}return new Ts(r||t,t)}function di(e,t,r,n,i){null==i&&(i=e.cm&&(e.cm.display.shift||e.extend)),bi(e,new ks([hi(e.sel.primary(),t,r,i)],0),n)}function pi(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=hi(e.sel.ranges[o],t[o],null,i);bi(e,zn(n,e.sel.primIndex),r)}function gi(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,bi(e,zn(i,e.sel.primIndex),n)}function vi(e,t,r,n){bi(e,Rn(t,r),n)}function mi(e,t,r){var n={ranges:t.ranges,update:function(t){var r=this;this.ranges=[];for(var n=0;n<t.length;n++)r.ranges[n]=new Ts(U(e,t[n].anchor),U(e,t[n].head))},origin:r&&r.origin};return Te(e,"beforeSelectionChange",e,n),e.cm&&Te(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?zn(n.ranges,n.ranges.length-1):t}function yi(e,t,r){var n=e.history.done,i=g(n);i&&i.ranges?(n[n.length-1]=t,wi(e,t,r)):bi(e,t,r)}function bi(e,t,r){wi(e,t,r),oi(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function wi(e,t,r){(Oe(e,"beforeSelectionChange")||e.cm&&Oe(e.cm,"beforeSelectionChange"))&&(t=mi(e,t,r)),xi(e,Si(e,t,r&&r.bias||(P(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),r&&!1===r.scroll||!e.cm||jr(e.cm)}function xi(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Ne(e.cm)),bt(e,"cursorActivity",e))}function Ci(e){xi(e,Si(e,e.sel,null,!1))}function Si(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var l=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],a=ki(e,l.anchor,s&&s.anchor,r,n),u=ki(e,l.head,s&&s.head,r,n);(i||a!=l.anchor||u!=l.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Ts(a,u))}return i?zn(i,t.primIndex):t}function Li(e,t,r,n,i){var o=M(e,t.line);if(o.markedSpans)for(var l=0;l<o.markedSpans.length;++l){var s=o.markedSpans[l],a=s.marker;if((null==s.from||(a.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(a.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(i&&(Te(a,"beforeCursorEnter"),a.explicitlyCleared)){if(o.markedSpans){--l;continue}break}if(!a.atomic)continue;if(r){var u=a.find(n<0?1:-1),c=void 0;if((n<0?a.inclusiveRight:a.inclusiveLeft)&&(u=Ti(e,u,-n,u&&u.line==t.line?o:null)),u&&u.line==t.line&&(c=P(u,r))&&(n<0?c<0:c>0))return Li(e,u,t,n,i)}var f=a.find(n<0?-1:1);return(n<0?a.inclusiveLeft:a.inclusiveRight)&&(f=Ti(e,f,n,f.line==t.line?o:null)),f?Li(e,f,t,n,i):null}}return t}function ki(e,t,r,n,i){var o=n||1,l=Li(e,t,r,o,i)||!i&&Li(e,t,r,o,!0)||Li(e,t,r,-o,i)||!i&&Li(e,t,r,-o,!0);return l||(e.cantEdit=!0,E(e.first,0))}function Ti(e,t,r,n){return r<0&&0==t.ch?t.line>e.first?U(e,E(t.line-1)):null:r>0&&t.ch==(n||M(e,t.line)).text.length?t.line<e.first+e.size-1?E(t.line+1,0):null:new E(t.line,t.ch+r)}function Mi(e){e.setSelection(E(e.firstLine(),0),E(e.lastLine()),Gl)}function Ni(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(t,r,i,o){t&&(n.from=U(e,t)),r&&(n.to=U(e,r)),i&&(n.text=i),void 0!==o&&(n.origin=o)}),Te(e,"beforeChange",e,n),e.cm&&Te(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Oi(e,t,r){if(e.cm){if(!e.cm.curOp)return dn(e.cm,Oi)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"))||(t=Ni(e,t,!0))){var n=Yl&&!r&&te(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Ai(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Ai(e,t)}}function Ai(e,t){if(1!=t.text.length||""!=t.text[0]||0!=P(t.from,t.to)){var r=Un(e,t);ni(e,t,r,e.cm?e.cm.curOp.id:NaN),Hi(e,t,r,J(e,t));var n=[];$n(e,function(e,r){r||-1!=h(n,e.history)||(zi(e.history,t),n.push(e.history)),Hi(e,t,null,J(e,t))})}}function Wi(e,t,r){if(!e.cm||!e.cm.state.suppressEdits||r){for(var n,i=e.history,o=e.sel,l="undo"==t?i.done:i.undone,s="undo"==t?i.undone:i.done,a=0;a<l.length&&(n=l[a],r?!n.ranges||n.equals(e.sel):n.ranges);a++);if(a!=l.length){for(i.lastOrigin=i.lastSelOrigin=null;(n=l.pop()).ranges;){if(li(n,s),r&&!n.equals(e.sel))return void bi(e,n,{clearRedo:!1});o=n}var u=[];li(o,s),s.push({changes:u,generation:i.generation}),i.generation=n.generation||++i.maxGeneration;for(var c=Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"),f=n.changes.length-1;f>=0;--f){var d=function(r){var i=n.changes[r];if(i.origin=t,c&&!Ni(e,i,!1))return l.length=0,{};u.push(ei(e,i));var o=r?Un(e,i):g(l);Hi(e,i,o,ci(e,i)),!r&&e.cm&&e.cm.scrollIntoView({from:i.from,to:Bn(i)});var s=[];$n(e,function(e,t){t||-1!=h(s,e.history)||(zi(e.history,i),s.push(e.history)),Hi(e,i,null,ci(e,i))})}(f);if(d)return d.v}}}}function Di(e,t){if(0!=t&&(e.first+=t,e.sel=new ks(v(e.sel.ranges,function(e){return new Ts(E(e.anchor.line+t,e.anchor.ch),E(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){vn(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)mn(e.cm,n,"gutter")}}function Hi(e,t,r,n){if(e.cm&&!e.cm.curOp)return dn(e.cm,Hi)(e,t,r,n);if(t.to.line<e.first)Di(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Di(e,i),t={from:E(e.first,0),to:E(t.to.line+i,t.to.ch),text:[g(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:E(o,M(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=N(e,t.from,t.to),r||(r=Un(e,t)),e.cm?Fi(e.cm,t,n):_n(e,t,n),wi(e,r,Gl)}}function Fi(e,t,r){var n=e.doc,i=e.display,o=t.from,l=t.to,s=!1,a=o.line;e.options.lineWrapping||(a=W(fe(M(n,o.line))),n.iter(a,l.line+1,function(e){if(e==i.maxLine)return s=!0,!0})),n.sel.contains(t.from,t.to)>-1&&Ne(e),_n(n,t,r,xr(e)),e.options.lineWrapping||(n.iter(a,o.line+t.text.length,function(e){var t=be(e);t>i.maxLineLength&&(i.maxLine=e,i.maxLineLength=t,i.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0)),nt(n,o.line),Cn(e,400);var u=t.text.length-(l.line-o.line)-1;t.full?vn(e):o.line!=l.line||1!=t.text.length||Yn(e.doc,t)?vn(e,o.line,l.line+1,u):mn(e,o.line,"text");var c=Oe(e,"changes"),f=Oe(e,"change");if(f||c){var h={from:o,to:l,text:t.text,removed:t.removed,origin:t.origin};f&&bt(e,"change",e,h),c&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function Ei(e,t,r,n,i){if(n||(n=r),P(n,r)<0){var o;r=(o=[n,r])[0],n=o[1]}"string"==typeof t&&(t=e.splitLines(t)),Oi(e,{from:r,to:n,text:t,origin:i})}function Pi(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Ii(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],l=!0;if(o.ranges){o.copied||((o=e[i]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)Pi(o.ranges[s].anchor,t,r,n),Pi(o.ranges[s].head,t,r,n)}else{for(var a=0;a<o.changes.length;++a){var u=o.changes[a];if(r<u.from.line)u.from=E(u.from.line+n,u.from.ch),u.to=E(u.to.line+n,u.to.ch);else if(t<=u.to.line){l=!1;break}}l||(e.splice(0,i+1),i=0)}}}function zi(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Ii(e.done,r,n,i),Ii(e.undone,r,n,i)}function Ri(e,t,r,n){var i=t,o=t;return"number"==typeof t?o=M(e,G(e,t)):i=W(t),null==i?null:(n(o,i)&&e.cm&&mn(e.cm,i,r),o)}function Bi(e){var t=this;this.lines=e,this.parent=null;for(var r=0,n=0;n<e.length;++n)e[n].parent=t,r+=e[n].height;this.height=r}function Gi(e){var t=this;this.children=e;for(var r=0,n=0,i=0;i<e.length;++i){var o=e[i];r+=o.chunkSize(),n+=o.height,o.parent=t}this.size=r,this.height=n,this.parent=null}function Ui(e,t,r){ye(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Kr(e,r)}function Vi(e,t,r,n){var i=new Ms(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),Ri(e,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==i.insertAt?r.push(i):r.splice(Math.min(r.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,o&&!ve(e,t)){var n=ye(t)<e.scrollTop;A(t,t.height+Ht(i)),n&&Kr(o,i.height),o.curOp.forceUpdate=!0}return!0}),bt(o,"lineWidgetAdded",o,i,"number"==typeof t?t:W(t)),i}function Ki(e,t,r,n,o){if(n&&n.shared)return ji(e,t,r,n,o);if(e.cm&&!e.cm.curOp)return dn(e.cm,Ki)(e,t,r,n,o);var l=new Os(e,o),s=P(t,r);if(n&&c(n,l,!1),s>0||0==s&&!1!==l.clearWhenEmpty)return l;if(l.replacedWith&&(l.collapsed=!0,l.widgetNode=i("span",[l.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||l.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(l.widgetNode.insertLeft=!0)),l.collapsed){if(ce(e,t.line,t,r,l)||t.line!=r.line&&ce(e,r.line,t,r,l))throw new Error("Inserting collapsed marker partially overlapping an existing one");X()}l.addToHistory&&ni(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var a,u=t.line,f=e.cm;if(e.iter(u,r.line+1,function(e){f&&l.collapsed&&!f.options.lineWrapping&&fe(e)==f.display.maxLine&&(a=!0),l.collapsed&&u!=t.line&&A(e,0),q(e,new Y(l,u==t.line?t.ch:null,u==r.line?r.ch:null)),++u}),l.collapsed&&e.iter(t.line,r.line+1,function(t){ve(e,t)&&A(t,0)}),l.clearOnEnter&&Ql(l,"beforeCursorEnter",function(){return l.clear()}),l.readOnly&&(j(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),l.collapsed&&(l.id=++Ns,l.atomic=!0),f){if(a&&(f.curOp.updateMaxLine=!0),l.collapsed)vn(f,t.line,r.line+1);else if(l.className||l.title||l.startStyle||l.endStyle||l.css)for(var h=t.line;h<=r.line;h++)mn(f,h,"text");l.atomic&&Ci(f.doc),bt(f,"markerAdded",f,l)}return l}function ji(e,t,r,n,i){(n=c(n)).shared=!1;var o=[Ki(e,t,r,n,i)],l=o[0],s=n.widgetNode;return $n(e,function(e){s&&(n.widgetNode=s.cloneNode(!0)),o.push(Ki(e,U(e,t),U(e,r),n,i));for(var a=0;a<e.linked.length;++a)if(e.linked[a].isParent)return;l=g(o)}),new As(o,l)}function Xi(e){return e.findMarks(E(e.first,0),e.clipPos(E(e.lastLine())),function(e){return e.parent})}function Yi(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),l=e.clipPos(i.to);if(P(o,l)){var s=Ki(e,o,l,n.primary,n.primary.type);n.markers.push(s),s.parent=n}}}function _i(e){for(var t=0;t<e.length;t++)!function(t){var r=e[t],n=[r.primary.doc];$n(r.primary.doc,function(e){return n.push(e)});for(var i=0;i<r.markers.length;i++){var o=r.markers[i];-1==h(n,o.doc)&&(o.parent=null,r.markers.splice(i--,1))}}(t)}function $i(e){var t=this;if(Qi(t),!Me(t,e)&&!Ft(t.display,e)){We(e),gl&&(Hs=+new Date);var r=Sr(t,e,!0),n=e.dataTransfer.files;if(r&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),l=0,s=0;s<i;++s)!function(e,n){if(!t.options.allowDropFileTypes||-1!=h(t.options.allowDropFileTypes,e.type)){var s=new FileReader;s.onload=dn(t,function(){var e=s.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),o[n]=e,++l==i){var a={from:r=U(t.doc,r),to:r,text:t.doc.splitLines(o.join(t.doc.lineSeparator())),origin:"paste"};Oi(t.doc,a),yi(t.doc,Rn(r,Bn(a)))}}),s.readAsText(e)}}(n[s],s);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var a=e.dataTransfer.getData("Text");if(a){var u;if(t.state.draggingText&&!t.state.draggingText.copy&&(u=t.listSelections()),wi(t.doc,Rn(r,r)),u)for(var c=0;c<u.length;++c)Ei(t.doc,"",u[c].anchor,u[c].head,"drag");t.replaceSelection(a,"around","paste"),t.display.input.focus()}}catch(e){}}}}function qi(e,t){if(gl&&(!e.state.draggingText||+new Date-Hs<100))Fe(t);else if(!Me(e,t)&&!Ft(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!xl)){var r=n("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",wl&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),wl&&r.parentNode.removeChild(r)}}function Zi(e,t){var i=Sr(e,t);if(i){var o=document.createDocumentFragment();Mr(e,i,o),e.display.dragCursor||(e.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),r(e.display.dragCursor,o)}}function Qi(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Ji(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),r=0;r<t.length;r++){var n=t[r].CodeMirror;n&&e(n)}}function eo(){Fs||(to(),Fs=!0)}function to(){var e;Ql(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Ji(ro)},100))}),Ql(window,"blur",function(){return Ji(Fr)})}function ro(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function no(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var r,n,i,o,l=0;l<t.length-1;l++){var s=t[l];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))r=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);i=!0}}return r&&(e="Alt-"+e),n&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function io(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if("..."==n){delete e[r];continue}for(var i=v(r.split(" "),no),o=0;o<i.length;o++){var l=void 0,s=void 0;o==i.length-1?(s=i.join(" "),l=n):(s=i.slice(0,o+1).join(" "),l="...");var a=t[s];if(a){if(a!=l)throw new Error("Inconsistent bindings for "+s)}else t[s]=l}delete e[r]}for(var u in t)e[u]=t[u];return e}function oo(e,t,r,n){var i=(t=uo(t)).call?t.call(e,n):t[e];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&r(i))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return oo(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var l=oo(e,t.fallthrough[o],r,n);if(l)return l}}}function lo(e){var t="string"==typeof e?e:Es[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function so(e,t,r){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(Dl?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(Dl?t.ctrlKey:t.metaKey)&&"Cmd"!=n&&(e="Cmd-"+e),!r&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function ao(e,t){if(wl&&34==e.keyCode&&e.char)return!1;var r=Es[e.keyCode];return null!=r&&!e.altGraphKey&&so(r,e,t)}function uo(e){return"string"==typeof e?Rs[e]:e}function co(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&P(o.from,g(n).to)<=0;){var l=n.pop();if(P(l.from,o.from)<0){o.from=l.from;break}}n.push(o)}hn(e,function(){for(var t=n.length-1;t>=0;t--)Ei(e.doc,"",n[t].from,n[t].to,"+delete");jr(e)})}function fo(e,t,r){var n=L(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ho(e,t,r){var n=fo(e,t.ch,r);return null==n?null:new E(t.line,n,r<0?"after":"before")}function po(e,t,r,n,i){if(e){var o=Se(r,t.doc.direction);if(o){var l,s=i<0?g(o):o[0],a=i<0==(1==s.level)?"after":"before";if(s.level>0){var u=Xt(t,r);l=i<0?r.text.length-1:0;var c=Yt(t,u,l).top;l=k(function(e){return Yt(t,u,e).top==c},i<0==(1==s.level)?s.from:s.to-1,l),"before"==a&&(l=fo(r,l,1))}else l=i<0?s.to:s.from;return new E(n,l,a)}}return new E(n,i<0?r.text.length:0,i<0?"before":"after")}function go(e,t,r,n){var i=Se(t,e.doc.direction);if(!i)return ho(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=Ce(i,r.ch,r.sticky),l=i[o];if("ltr"==e.doc.direction&&l.level%2==0&&(n>0?l.to>r.ch:l.from<r.ch))return ho(t,r,n);var s,a=function(e,r){return fo(t,e instanceof E?e.ch:e,r)},u=function(r){return e.options.lineWrapping?(s=s||Xt(e,t),hr(e,t,s,r)):{begin:0,end:t.text.length}},c=u("before"==r.sticky?a(r,-1):r.ch);if("rtl"==e.doc.direction||1==l.level){var f=1==l.level==n<0,h=a(r,f?1:-1);if(null!=h&&(f?h<=l.to&&h<=c.end:h>=l.from&&h>=c.begin)){var d=f?"before":"after";return new E(r.line,h,d)}}var p=function(e,t,n){for(var o=function(e,t){return t?new E(r.line,a(e,1),"before"):new E(r.line,e,"after")};e>=0&&e<i.length;e+=t){var l=i[e],s=t>0==(1!=l.level),u=s?n.begin:a(n.end,-1);if(l.from<=u&&u<l.to)return o(u,s);if(u=s?l.from:a(l.to,-1),n.begin<=u&&u<n.end)return o(u,s)}},g=p(o+n,n,c);if(g)return g;var v=n>0?c.end:a(c.begin,-1);return null==v||n>0&&v==t.text.length||!(g=p(n>0?0:i.length-1,n,u(v)))?null:g}function vo(e,t){var r=M(e.doc,t),n=fe(r);return n!=r&&(t=W(n)),po(!0,e,n,t,1)}function mo(e,t){var r=M(e.doc,t),n=he(r);return n!=r&&(t=W(n)),po(!0,e,r,t,-1)}function yo(e,t){var r=vo(e,t.line),n=M(e.doc,r.line),i=Se(n,e.doc.direction);if(!i||0==i[0].level){var o=Math.max(0,n.text.search(/\S/)),l=t.line==r.line&&t.ch<=o&&t.ch;return E(r.line,l?0:o,r.sticky)}return r}function bo(e,t,r){if("string"==typeof t&&!(t=Bs[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=Bl}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function wo(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=oo(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&oo(t,e.options.extraKeys,r,e)||oo(t,e.options.keyMap,r,e)}function xo(e,t,r,n){var i=e.state.keySeq;if(i){if(lo(t))return"handled";Gs.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),t=i+" "+t}var o=wo(e,t,n);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&bt(e,"keyHandled",e,t,r),"handled"!=o&&"multi"!=o||(We(r),Ar(e)),i&&!o&&/\'$/.test(t)?(We(r),!0):!!o}function Co(e,t){var r=ao(t,!0);return!!r&&(t.shiftKey&&!e.state.keySeq?xo(e,"Shift-"+r,t,function(t){return bo(e,t,!0)})||xo(e,r,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return bo(e,t)}):xo(e,r,t,function(t){return bo(e,t)}))}function So(e,t,r){return xo(e,"'"+r+"'",t,function(t){return bo(e,t,!0)})}function Lo(e){var t=this;if(t.curOp.focus=l(),!Me(t,e)){gl&&vl<11&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=Co(t,e);wl&&(Us=n?r:null,!n&&88==r&&!rs&&(Ml?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=r||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ko(t)}}function ko(e){function t(e){18!=e.keyCode&&e.altKey||(Fl(r,"CodeMirror-crosshair"),ke(document,"keyup",t),ke(document,"mouseover",t))}var r=e.display.lineDiv;s(r,"CodeMirror-crosshair"),Ql(document,"keyup",t),Ql(document,"mouseover",t)}function To(e){16==e.keyCode&&(this.doc.sel.shift=!1),Me(this,e)}function Mo(e){var t=this;if(!(Ft(t.display,e)||Me(t,e)||e.ctrlKey&&!e.altKey||Ml&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(wl&&r==Us)return Us=null,void We(e);if(!wl||e.which&&!(e.which<10)||!Co(t,e)){var i=String.fromCharCode(null==n?r:n);"\b"!=i&&(So(t,e,i)||t.display.input.onKeyPress(e))}}}function No(e,t){var r=+new Date;return js&&js.compare(r,e,t)?(Ks=js=null,"triple"):Ks&&Ks.compare(r,e,t)?(js=new Vs(r,e,t),Ks=null,"double"):(Ks=new Vs(r,e,t),js=null,"single")}function Oo(e){var t=this,r=t.display;if(!(Me(t,e)||r.activeTouch&&r.input.supportsTouch()))if(r.input.ensurePolled(),r.shift=e.shiftKey,Ft(r,e))ml||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));else if(!zo(t,e)){var n=Sr(t,e),i=Pe(e),o=n?No(n,i):"single";window.focus(),1==i&&t.state.selectingText&&t.state.selectingText(e),n&&Ao(t,i,n,o,e)||(1==i?n?Do(t,n,o,e):Ee(e)==r.scroller&&We(e):2==i?(n&&di(t.doc,n),setTimeout(function(){return r.input.focus()},20)):3==i&&(Hl?Ro(t,e):Dr(t)))}}function Ao(e,t,r,n,i){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),o=(1==t?"Left":2==t?"Middle":"Right")+o,xo(e,so(o,i),i,function(t){if("string"==typeof t&&(t=Bs[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,r)!=Bl}finally{e.state.suppressEdits=!1}return n})}function Wo(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(null==i.unit){var o=Nl?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==i.extend||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey),null==i.addNew&&(i.addNew=Ml?r.metaKey:r.ctrlKey),null==i.moveOnDrag&&(i.moveOnDrag=!(Ml?r.altKey:r.ctrlKey)),i}function Do(e,t,r,n){gl?setTimeout(u(Wr,e),0):e.curOp.focus=l();var i,o=Wo(e,r,n),s=e.doc.sel;e.options.dragDrop&&Jl&&!e.isReadOnly()&&"single"==r&&(i=s.contains(t))>-1&&(P((i=s.ranges[i]).from(),t)<0||t.xRel>0)&&(P(i.to(),t)>0||t.xRel<0)?Ho(e,n,t,o):Eo(e,n,t,o)}function Ho(e,t,r,n){var i=e.display,o=!1,l=dn(e,function(t){ml&&(i.scroller.draggable=!1),e.state.draggingText=!1,ke(document,"mouseup",l),ke(document,"mousemove",s),ke(i.scroller,"dragstart",a),ke(i.scroller,"drop",l),o||(We(t),n.addNew||di(e.doc,r,null,null,n.extend),ml||gl&&9==vl?setTimeout(function(){document.body.focus(),i.input.focus()},20):i.input.focus())}),s=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},a=function(){return o=!0};ml&&(i.scroller.draggable=!0),e.state.draggingText=l,l.copy=!n.moveOnDrag,i.scroller.dragDrop&&i.scroller.dragDrop(),Ql(document,"mouseup",l),Ql(document,"mousemove",s),Ql(i.scroller,"dragstart",a),Ql(i.scroller,"drop",l),Dr(e),setTimeout(function(){return i.input.focus()},20)}function Fo(e,t,r){if("char"==r)return new Ts(t,t);if("word"==r)return e.findWordAt(t);if("line"==r)return new Ts(E(t.line,0),U(e.doc,E(t.line+1,0)));var n=r(e,t);return new Ts(n.from,n.to)}function Eo(e,t,r,n){function i(t){if(0!=P(m,t))if(m=t,"rectangle"==n.unit){for(var i=[],o=e.options.tabSize,l=f(M(u,r.line).text,r.ch,o),s=f(M(u,t.line).text,t.ch,o),a=Math.min(l,s),g=Math.max(l,s),v=Math.min(r.line,t.line),y=Math.min(e.lastLine(),Math.max(r.line,t.line));v<=y;v++){var b=M(u,v).text,w=d(b,a,o);a==g?i.push(new Ts(E(v,w),E(v,w))):b.length>w&&i.push(new Ts(E(v,w),E(v,d(b,g,o))))}i.length||i.push(new Ts(r,r)),bi(u,zn(p.ranges.slice(0,h).concat(i),h),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var x,C=c,S=Fo(e,t,n.unit),L=C.anchor;P(S.anchor,L)>0?(x=S.head,L=B(C.from(),S.anchor)):(x=S.anchor,L=R(C.to(),S.head));var k=p.ranges.slice(0);k[h]=Po(e,new Ts(U(u,L),x)),bi(u,zn(k,h),Ul)}}function o(t){var r=++b,s=Sr(e,t,!0,"rectangle"==n.unit);if(s)if(0!=P(s,m)){e.curOp.focus=l(),i(s);var c=Ir(a,u);(s.line>=c.to||s.line<c.from)&&setTimeout(dn(e,function(){b==r&&o(t)}),150)}else{var f=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;f&&setTimeout(dn(e,function(){b==r&&(a.scroller.scrollTop+=f,o(t))}),50)}}function s(t){e.state.selectingText=!1,b=1/0,We(t),a.input.focus(),ke(document,"mousemove",w),ke(document,"mouseup",x),u.history.lastSelOrigin=null}var a=e.display,u=e.doc;We(t);var c,h,p=u.sel,g=p.ranges;if(n.addNew&&!n.extend?(h=u.sel.contains(r),c=h>-1?g[h]:new Ts(r,r)):(c=u.sel.primary(),h=u.sel.primIndex),"rectangle"==n.unit)n.addNew||(c=new Ts(r,r)),r=Sr(e,t,!0,!0),h=-1;else{var v=Fo(e,r,n.unit);c=n.extend?hi(c,v.anchor,v.head,n.extend):v}n.addNew?-1==h?(h=g.length,bi(u,zn(g.concat([c]),h),{scroll:!1,origin:"*mouse"})):g.length>1&&g[h].empty()&&"char"==n.unit&&!n.extend?(bi(u,zn(g.slice(0,h).concat(g.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),p=u.sel):gi(u,h,c,Ul):(h=0,bi(u,new ks([c],0),Ul),p=u.sel);var m=r,y=a.wrapper.getBoundingClientRect(),b=0,w=dn(e,function(e){Pe(e)?o(e):s(e)}),x=dn(e,s);e.state.selectingText=x,Ql(document,"mousemove",w),Ql(document,"mouseup",x)}function Po(e,t){var r=t.anchor,n=t.head,i=M(e.doc,r.line);if(0==P(r,n)&&r.sticky==n.sticky)return t;var o=Se(i);if(!o)return t;var l=Ce(o,r.ch,r.sticky),s=o[l];if(s.from!=r.ch&&s.to!=r.ch)return t;var a=l+(s.from==r.ch==(1!=s.level)?0:1);if(0==a||a==o.length)return t;var u;if(n.line!=r.line)u=(n.line-r.line)*("ltr"==e.doc.direction?1:-1)>0;else{var c=Ce(o,n.ch,n.sticky),f=c-l||(n.ch-r.ch)*(1==s.level?-1:1);u=c==a-1||c==a?f<0:f>0}var h=o[a+(u?-1:0)],d=u==(1==h.level),p=d?h.from:h.to,g=d?"after":"before";return r.ch==p&&r.sticky==g?t:new Ts(new E(r.line,p,g),n)}function Io(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&We(t);var l=e.display,s=l.lineDiv.getBoundingClientRect();if(o>s.bottom||!Oe(e,r))return He(t);o-=s.top-l.viewOffset;for(var a=0;a<e.options.gutters.length;++a){var u=l.gutters.childNodes[a];if(u&&u.getBoundingClientRect().right>=i)return Te(e,r,e,D(e.doc,o),e.options.gutters[a],t),He(t)}}function zo(e,t){return Io(e,t,"gutterClick",!0)}function Ro(e,t){Ft(e.display,t)||Bo(e,t)||Me(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Bo(e,t){return!!Oe(e,"gutterContextMenu")&&Io(e,t,"gutterContextMenu",!1)}function Go(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),er(e)}function Uo(e){Hn(e),vn(e),zr(e)}function Vo(e,t,r){if(!t!=!(r&&r!=Xs)){var n=e.display.dragFunctions,i=t?Ql:ke;i(e.display.scroller,"dragstart",n.start),i(e.display.scroller,"dragenter",n.enter),i(e.display.scroller,"dragover",n.over),i(e.display.scroller,"dragleave",n.leave),i(e.display.scroller,"drop",n.drop)}}function Ko(e){e.options.lineWrapping?(s(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Fl(e.display.wrapper,"CodeMirror-wrap"),we(e)),Cr(e),vn(e),er(e),setTimeout(function(){return en(e)},100)}function jo(e,t){var r=this;if(!(this instanceof jo))return new jo(e,t);this.options=t=t?c(t):{},c(Ys,t,!1),Fn(t);var n=t.value;"string"==typeof n&&(n=new Ds(n,t.mode,null,t.lineSeparator,t.direction)),this.doc=n;var i=new jo.inputStyles[t.inputStyle](this),o=this.display=new T(e,n,i);o.wrapper.CodeMirror=this,Hn(this),Go(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),rn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Pl,keySeq:null,specialChars:null},t.autofocus&&!Tl&&o.input.focus(),gl&&vl<11&&setTimeout(function(){return r.display.input.reset(!0)},20),Xo(this),eo(),nn(this),this.curOp.forceUpdate=!0,qn(this,n),t.autofocus&&!Tl||this.hasFocus()?setTimeout(u(Hr,this),20):Fr(this);for(var l in _s)_s.hasOwnProperty(l)&&_s[l](r,t[l],Xs);Rr(this),t.finishInit&&t.finishInit(this);for(var s=0;s<$s.length;++s)$s[s](r);on(this),ml&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Xo(e){function t(){i.activeTouch&&(o=setTimeout(function(){return i.activeTouch=null},1e3),(l=i.activeTouch).end=+new Date)}function r(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function n(e,t){if(null==t.left)return!0;var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>400}var i=e.display;Ql(i.scroller,"mousedown",dn(e,Oo)),gl&&vl<11?Ql(i.scroller,"dblclick",dn(e,function(t){if(!Me(e,t)){var r=Sr(e,t);if(r&&!zo(e,t)&&!Ft(e.display,t)){We(t);var n=e.findWordAt(r);di(e.doc,n.anchor,n.head)}}})):Ql(i.scroller,"dblclick",function(t){return Me(e,t)||We(t)}),Hl||Ql(i.scroller,"contextmenu",function(t){return Ro(e,t)});var o,l={end:0};Ql(i.scroller,"touchstart",function(t){if(!Me(e,t)&&!r(t)&&!zo(e,t)){i.input.ensurePolled(),clearTimeout(o);var n=+new Date;i.activeTouch={start:n,moved:!1,prev:n-l.end<=300?l:null},1==t.touches.length&&(i.activeTouch.left=t.touches[0].pageX,i.activeTouch.top=t.touches[0].pageY)}}),Ql(i.scroller,"touchmove",function(){i.activeTouch&&(i.activeTouch.moved=!0)}),Ql(i.scroller,"touchend",function(r){var o=i.activeTouch;if(o&&!Ft(i,r)&&null!=o.left&&!o.moved&&new Date-o.start<300){var l,s=e.coordsChar(i.activeTouch,"page");l=!o.prev||n(o,o.prev)?new Ts(s,s):!o.prev.prev||n(o,o.prev.prev)?e.findWordAt(s):new Ts(E(s.line,0),U(e.doc,E(s.line+1,0))),e.setSelection(l.anchor,l.head),e.focus(),We(r)}t()}),Ql(i.scroller,"touchcancel",t),Ql(i.scroller,"scroll",function(){i.scroller.clientHeight&&(qr(e,i.scroller.scrollTop),Qr(e,i.scroller.scrollLeft,!0),Te(e,"scroll",e))}),Ql(i.scroller,"mousewheel",function(t){return In(e,t)}),Ql(i.scroller,"DOMMouseScroll",function(t){return In(e,t)}),Ql(i.wrapper,"scroll",function(){return i.wrapper.scrollTop=i.wrapper.scrollLeft=0}),i.dragFunctions={enter:function(t){Me(e,t)||Fe(t)},over:function(t){Me(e,t)||(Zi(e,t),Fe(t))},start:function(t){return qi(e,t)},drop:dn(e,$i),leave:function(t){Me(e,t)||Qi(e)}};var s=i.input.getField();Ql(s,"keyup",function(t){return To.call(e,t)}),Ql(s,"keydown",dn(e,Lo)),Ql(s,"keypress",dn(e,Mo)),Ql(s,"focus",function(t){return Hr(e,t)}),Ql(s,"blur",function(t){return Fr(e,t)})}function Yo(e,t,r,n){var i,o=e.doc;null==r&&(r="add"),"smart"==r&&(o.mode.indent?i=$e(e,t).state:r="prev");var l=e.options.tabSize,s=M(o,t),a=f(s.text,null,l);s.stateAfter&&(s.stateAfter=null);var u,c=s.text.match(/^\s*/)[0];if(n||/\S/.test(s.text)){if("smart"==r&&((u=o.mode.indent(i,s.text.slice(c.length),s.text))==Bl||u>150)){if(!n)return;r="prev"}}else u=0,r="not";"prev"==r?u=t>o.first?f(M(o,t-1).text,null,l):0:"add"==r?u=a+e.options.indentUnit:"subtract"==r?u=a-e.options.indentUnit:"number"==typeof r&&(u=a+r),u=Math.max(0,u);var h="",d=0;if(e.options.indentWithTabs)for(var g=Math.floor(u/l);g;--g)d+=l,h+="\t";if(d<u&&(h+=p(u-d)),h!=c)return Ei(o,h,E(t,0),E(t,c.length),"+input"),s.stateAfter=null,!0;for(var v=0;v<o.sel.ranges.length;v++){var m=o.sel.ranges[v];if(m.head.line==t&&m.head.ch<c.length){var y=E(t,c.length);gi(o,v,new Ts(y,y));break}}}function _o(e){qs=e}function $o(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var l=e.state.pasteIncoming||"paste"==i,s=es(t),a=null;if(l&&n.ranges.length>1)if(qs&&qs.text.join("\n")==t){if(n.ranges.length%qs.text.length==0){a=[];for(var u=0;u<qs.text.length;u++)a.push(o.splitLines(qs.text[u]))}}else s.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(a=v(s,function(e){return[e]}));for(var c,f=n.ranges.length-1;f>=0;f--){var h=n.ranges[f],d=h.from(),p=h.to();h.empty()&&(r&&r>0?d=E(d.line,d.ch-r):e.state.overwrite&&!l?p=E(p.line,Math.min(M(o,p.line).text.length,p.ch+g(s).length)):qs&&qs.lineWise&&qs.text.join("\n")==t&&(d=p=E(d.line,0))),c=e.curOp.updateInput;var m={from:d,to:p,text:a?a[f%a.length]:s,origin:i||(l?"paste":e.state.cutIncoming?"cut":"+input")};Oi(e.doc,m),bt(e,"inputRead",e,m)}t&&!l&&Zo(e,t),jr(e),e.curOp.updateInput=c,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function qo(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||hn(t,function(){return $o(t,r,0,null,"paste")}),!0}function Zo(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),l=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(t.indexOf(o.electricChars.charAt(s))>-1){l=Yo(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(M(e.doc,i.head.line).text.slice(0,i.head.ch))&&(l=Yo(e,i.head.line,"smart"));l&&bt(e,"electricInput",e,i.head.line)}}}function Qo(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:E(i,0),head:E(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Jo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function el(){var e=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=n("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ml?e.style.width="1000px":e.setAttribute("wrap","off"),Ll&&(e.style.border="1px solid black"),Jo(e),t}function tl(e,t,r,n,i){function o(){var n=t.line+r;return!(n<e.first||n>=e.first+e.size)&&(t=new E(n,t.ch,t.sticky),u=M(e,n))}function l(n){var l;if(null==(l=i?go(e.cm,u,t,r):ho(u,t,r))){if(n||!o())return!1;t=po(i,e.cm,u,t.line,r)}else t=l;return!0}var s=t,a=r,u=M(e,t.line);if("char"==n)l();else if("column"==n)l(!0);else if("word"==n||"group"==n)for(var c=null,f="group"==n,h=e.cm&&e.cm.getHelper(t,"wordChars"),d=!0;!(r<0)||l(!d);d=!1){var p=u.text.charAt(t.ch)||"\n",g=x(p,h)?"w":f&&"\n"==p?"n":!f||/\s/.test(p)?null:"p";if(!f||d||g||(g="s"),c&&c!=g){r<0&&(r=1,l(),t.sticky="after");break}if(g&&(c=g),r>0&&!l(!d))break}var v=ki(e,t,s,a,!0);return I(s,v)&&(v.hitSide=!0),v}function rl(e,t,r,n){var i,o=e.doc,l=t.left;if("page"==n){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),a=Math.max(s-.5*mr(e.display),3);i=(r>0?t.bottom:t.top)+r*a}else"line"==n&&(i=r>0?t.bottom+3:t.top-3);for(var u;(u=cr(e,l,i)).outside;){if(r<0?i<=0:i>=o.height){u.hitSide=!0;break}i+=5*r}return u}function nl(e,t){var r=jt(e,t.line);if(!r||r.hidden)return null;var n=M(e.doc,t.line),i=Ut(r,n,t.line),o=Se(n,e.doc.direction),l="left";o&&(l=Ce(o,t.ch)%2?"right":"left");var s=_t(i.map,t.ch,l);return s.offset="right"==s.collapse?s.end:s.start,s}function il(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ol(e,t){return t&&(e.bad=!0),e}function ll(e,t,r,n,i){function o(e){return function(t){return t.id==e}}function l(){c&&(u+=f,c=!1)}function s(e){e&&(l(),u+=e)}function a(t){if(1==t.nodeType){var r=t.getAttribute("cm-text");if(null!=r)return void s(r||t.textContent.replace(/\u200b/g,""));var u,h=t.getAttribute("cm-marker");if(h){var d=e.findMarks(E(n,0),E(i+1,0),o(+h));return void(d.length&&(u=d[0].find(0))&&s(N(e.doc,u.from,u.to).join(f)))}if("false"==t.getAttribute("contenteditable"))return;var p=/^(pre|div|p)$/i.test(t.nodeName);p&&l();for(var g=0;g<t.childNodes.length;g++)a(t.childNodes[g]);p&&(c=!0)}else 3==t.nodeType&&s(t.nodeValue)}for(var u="",c=!1,f=e.doc.lineSeparator();a(t),t!=r;)t=t.nextSibling;return u}function sl(e,t,r){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[r]))return ol(e.clipPos(E(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return al(o,t,r)}}function al(e,t,r){function n(t,r,n){for(var i=-1;i<(f?f.length:0);i++)for(var o=i<0?c.map:f[i],l=0;l<o.length;l+=3){var s=o[l+2];if(s==t||s==r){var a=W(i<0?e.line:e.rest[i]),u=o[l]+n;return(n<0||s!=t)&&(u=o[l+(n?1:0)]),E(a,u)}}}var i=e.text.firstChild,l=!1;if(!t||!o(i,t))return ol(E(W(e.line),0),!0);if(t==i&&(l=!0,t=i.childNodes[r],r=0,!t)){var s=e.rest?g(e.rest):e.line;return ol(E(W(s),s.text.length),l)}var a=3==t.nodeType?t:null,u=t;for(a||1!=t.childNodes.length||3!=t.firstChild.nodeType||(a=t.firstChild,r&&(r=a.nodeValue.length));u.parentNode!=i;)u=u.parentNode;var c=e.measure,f=c.maps,h=n(a,u,r);if(h)return ol(h,l);for(var d=u.nextSibling,p=a?a.nodeValue.length-r:0;d;d=d.nextSibling){if(h=n(d,d.firstChild,0))return ol(E(h.line,h.ch-p),l);p+=d.textContent.length}for(var v=u.previousSibling,m=r;v;v=v.previousSibling){if(h=n(v,v.firstChild,-1))return ol(E(h.line,h.ch+m),l);m+=v.textContent.length}}var ul=navigator.userAgent,cl=navigator.platform,fl=/gecko\/\d/i.test(ul),hl=/MSIE \d/.test(ul),dl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ul),pl=/Edge\/(\d+)/.exec(ul),gl=hl||dl||pl,vl=gl&&(hl?document.documentMode||6:+(pl||dl)[1]),ml=!pl&&/WebKit\//.test(ul),yl=ml&&/Qt\/\d+\.\d+/.test(ul),bl=!pl&&/Chrome\//.test(ul),wl=/Opera\//.test(ul),xl=/Apple Computer/.test(navigator.vendor),Cl=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ul),Sl=/PhantomJS/.test(ul),Ll=!pl&&/AppleWebKit/.test(ul)&&/Mobile\/\w+/.test(ul),kl=/Android/.test(ul),Tl=Ll||kl||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ul),Ml=Ll||/Mac/.test(cl),Nl=/\bCrOS\b/.test(ul),Ol=/win/i.test(cl),Al=wl&&ul.match(/Version\/(\d*\.\d*)/);Al&&(Al=Number(Al[1])),Al&&Al>=15&&(wl=!1,ml=!0);var Wl,Dl=Ml&&(yl||wl&&(null==Al||Al<12.11)),Hl=fl||gl&&vl>=9,Fl=function(t,r){var n=t.className,i=e(r).exec(n);if(i){var o=n.slice(i.index+i[0].length);t.className=n.slice(0,i.index)+(o?i[1]+o:"")}};Wl=document.createRange?function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};var El=function(e){e.select()};Ll?El=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:gl&&(El=function(e){try{e.select()}catch(e){}});var Pl=function(){this.id=null};Pl.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Il,zl,Rl=30,Bl={toString:function(){return"CodeMirror.Pass"}},Gl={scroll:!1},Ul={origin:"*mouse"},Vl={origin:"+move"},Kl=[""],jl=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Xl=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Yl=!1,_l=!1,$l=null,ql=function(){function e(e){return e<=247?r.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?n.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function t(e,t,r){this.level=e,this.from=t,this.to=r}var r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,l=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;return function(r,n){var u="ltr"==n?"L":"R";if(0==r.length||"ltr"==n&&!i.test(r))return!1;for(var c=r.length,f=[],h=0;h<c;++h)f.push(e(r.charCodeAt(h)));for(var d=0,p=u;d<c;++d){var v=f[d];"m"==v?f[d]=p:p=v}for(var m=0,y=u;m<c;++m){var b=f[m];"1"==b&&"r"==y?f[m]="n":l.test(b)&&(y=b,"r"==b&&(f[m]="R"))}for(var w=1,x=f[0];w<c-1;++w){var C=f[w];"+"==C&&"1"==x&&"1"==f[w+1]?f[w]="1":","!=C||x!=f[w+1]||"1"!=x&&"n"!=x||(f[w]=x),x=C}for(var S=0;S<c;++S){var L=f[S];if(","==L)f[S]="N";else if("%"==L){var k=void 0;for(k=S+1;k<c&&"%"==f[k];++k);for(var T=S&&"!"==f[S-1]||k<c&&"1"==f[k]?"1":"N",M=S;M<k;++M)f[M]=T;S=k-1}}for(var N=0,O=u;N<c;++N){var A=f[N];"L"==O&&"1"==A?f[N]="L":l.test(A)&&(O=A)}for(var W=0;W<c;++W)if(o.test(f[W])){var D=void 0;for(D=W+1;D<c&&o.test(f[D]);++D);for(var H="L"==(W?f[W-1]:u),F=H==("L"==(D<c?f[D]:u))?H?"L":"R":u,E=W;E<D;++E)f[E]=F;W=D-1}for(var P,I=[],z=0;z<c;)if(s.test(f[z])){var R=z;for(++z;z<c&&s.test(f[z]);++z);I.push(new t(0,R,z))}else{var B=z,G=I.length;for(++z;z<c&&"L"!=f[z];++z);for(var U=B;U<z;)if(a.test(f[U])){B<U&&I.splice(G,0,new t(1,B,U));var V=U;for(++U;U<z&&a.test(f[U]);++U);I.splice(G,0,new t(2,V,U)),B=U}else++U;B<z&&I.splice(G,0,new t(1,B,z))}return 1==I[0].level&&(P=r.match(/^\s+/))&&(I[0].from=P[0].length,I.unshift(new t(0,0,P[0].length))),1==g(I).level&&(P=r.match(/\s+$/))&&(g(I).to-=P[0].length,I.push(new t(0,c-P[0].length,c))),"rtl"==n?I.reverse():I}}(),Zl=[],Ql=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Zl).concat(r)}},Jl=function(){if(gl&&vl<9)return!1;var e=n("div");return"draggable"in e||"dragDrop"in e}(),es=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),l=o.indexOf("\r");-1!=l?(r.push(o.slice(0,l)),t+=l+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},ts=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},rs=function(){var e=n("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),ns=null,is={},os={},ls={},ss=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};ss.prototype.eol=function(){return this.pos>=this.string.length},ss.prototype.sol=function(){return this.pos==this.lineStart},ss.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ss.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ss.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},ss.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},ss.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},ss.prototype.skipToEnd=function(){this.pos=this.string.length},ss.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},ss.prototype.backUp=function(e){this.pos-=e},ss.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=f(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.indentation=function(){return f(this.string,null,this.tabSize)-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.match=function(e,t,r){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var i=function(e){return r?e.toLowerCase():e};if(i(this.string.substr(this.pos,e.length))==i(e))return!1!==t&&(this.pos+=e.length),!0},ss.prototype.current=function(){return this.string.slice(this.start,this.pos)},ss.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},ss.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var as=function(e,t){this.state=e,this.lookAhead=t},us=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0};us.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},us.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},us.fromSaved=function(e,t,r){return t instanceof as?new us(e,Ke(e.mode,t.state),r,t.lookAhead):new us(e,Ke(e.mode,t),r)},us.prototype.save=function(e){var t=!1!==e?Ke(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new as(t,this.maxLookAhead):t};var cs=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r},fs=function(e,t,r){this.text=e,ne(this,t),this.height=r?r(this):1};fs.prototype.lineNo=function(){return W(this)},Ae(fs);var hs,ds={},ps={},gs=null,vs=null,ms={left:0,right:0,top:0,bottom:0},ys=function(e,t,r){this.cm=r;var i=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(i),e(o),Ql(i,"scroll",function(){i.clientHeight&&t(i.scrollTop,"vertical")}),Ql(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,gl&&vl<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};ys.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},ys.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},ys.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},ys.prototype.zeroWidthHack=function(){var e=Ml&&!Cl?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Pl,this.disableVert=new Pl},ys.prototype.enableZeroWidthBar=function(e,t,r){function n(){var i=e.getBoundingClientRect();("vert"==r?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}e.style.pointerEvents="auto",t.set(1e3,n)},ys.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var bs=function(){};bs.prototype.update=function(){return{bottom:0,right:0}},bs.prototype.setScrollLeft=function(){},bs.prototype.setScrollTop=function(){},bs.prototype.clear=function(){};var ws={native:ys,null:bs},xs=0,Cs=function(e,t,r){var n=e.display;this.viewport=t,this.visible=Ir(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Rt(e),this.force=r,this.dims=br(e),this.events=[]};Cs.prototype.signal=function(e,t){Oe(e,t)&&this.events.push(arguments)},Cs.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Te.apply(null,e.events[t])};var Ss=0,Ls=null;gl?Ls=-.53:fl?Ls=15:bl?Ls=-.7:xl&&(Ls=-1/3);var ks=function(e,t){this.ranges=e,this.primIndex=t};ks.prototype.primary=function(){return this.ranges[this.primIndex]},ks.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var r=0;r<this.ranges.length;r++){var n=t.ranges[r],i=e.ranges[r];if(!I(n.anchor,i.anchor)||!I(n.head,i.head))return!1}return!0},ks.prototype.deepCopy=function(){for(var e=this,t=[],r=0;r<this.ranges.length;r++)t[r]=new Ts(z(e.ranges[r].anchor),z(e.ranges[r].head));return new ks(t,this.primIndex)},ks.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},ks.prototype.contains=function(e,t){var r=this;t||(t=e);for(var n=0;n<this.ranges.length;n++){var i=r.ranges[n];if(P(t,i.from())>=0&&P(e,i.to())<=0)return n}return-1};var Ts=function(e,t){this.anchor=e,this.head=t};Ts.prototype.from=function(){return B(this.anchor,this.head)},Ts.prototype.to=function(){return R(this.anchor,this.head)},Ts.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Bi.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=this,n=e,i=e+t;n<i;++n){var o=r.lines[n];r.height-=o.height,ot(o),bt(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){var n=this;this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=n},iterN:function(e,t,r){for(var n=this,i=e+t;e<i;++e)if(r(n.lines[e]))return!0}},Gi.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var r=this;this.size-=t;for(var n=0;n<this.children.length;++n){var i=r.children[n],o=i.chunkSize();if(e<o){var l=Math.min(t,o-e),s=i.height;if(i.removeInner(e,l),r.height-=s-i.height,o==l&&(r.children.splice(n--,1),i.parent=null),0==(t-=l))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Bi))){var a=[];this.collapse(a),this.children=[new Bi(a)],this.children[0].parent=this}},collapse:function(e){for(var t=this,r=0;r<this.children.length;++r)t.children[r].collapse(e)},insertInner:function(e,t,r){var n=this;this.size+=t.length,this.height+=r;for(var i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<=l){if(o.insertInner(e,t,r),o.lines&&o.lines.length>50){for(var s=o.lines.length%25+25,a=s;a<o.lines.length;){var u=new Bi(o.lines.slice(a,a+=25));o.height-=u.height,n.children.splice(++i,0,u),u.parent=n}o.lines=o.lines.slice(0,s),n.maybeSpill()}break}e-=l}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Gi(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var r=h(e.parent.children,e);e.parent.children.splice(r+1,0,t)}else{var n=new Gi(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=this,i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<l){var s=Math.min(t,l-e);if(o.iterN(e,s,r))return!0;if(0==(t-=s))break;e=0}else e-=l}}};var Ms=function(e,t,r){var n=this;if(r)for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);this.doc=e,this.node=t};Ms.prototype.clear=function(){var e=this,t=this.doc.cm,r=this.line.widgets,n=this.line,i=W(n);if(null!=i&&r){for(var o=0;o<r.length;++o)r[o]==e&&r.splice(o--,1);r.length||(n.widgets=null);var l=Ht(this);A(n,Math.max(0,n.height-l)),t&&(hn(t,function(){Ui(t,n,-l),mn(t,i,"widget")}),bt(t,"lineWidgetCleared",t,this,i))}},Ms.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Ht(this)-t;i&&(A(n,n.height+i),r&&hn(r,function(){r.curOp.forceUpdate=!0,Ui(r,n,i),bt(r,"lineWidgetChanged",r,e,W(n))}))},Ae(Ms);var Ns=0,Os=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ns};Os.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,r=t&&!t.curOp;if(r&&nn(t),Oe(this,"clear")){var n=this.find();n&&bt(this,"clear",n.from,n.to)}for(var i=null,o=null,l=0;l<this.lines.length;++l){var s=e.lines[l],a=_(s.markedSpans,e);t&&!e.collapsed?mn(t,W(s),"text"):t&&(null!=a.to&&(o=W(s)),null!=a.from&&(i=W(s))),s.markedSpans=$(s.markedSpans,a),null==a.from&&e.collapsed&&!ve(e.doc,s)&&t&&A(s,mr(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var u=0;u<this.lines.length;++u){var c=fe(e.lines[u]),f=be(c);f>t.display.maxLineLength&&(t.display.maxLine=c,t.display.maxLineLength=f,t.display.maxLineChanged=!0)}null!=i&&t&&this.collapsed&&vn(t,i,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ci(t.doc)),t&&bt(t,"markerCleared",t,this,i,o),r&&on(t),this.parent&&this.parent.clear()}},Os.prototype.find=function(e,t){var r=this;null==e&&"bookmark"==this.type&&(e=1);for(var n,i,o=0;o<this.lines.length;++o){var l=r.lines[o],s=_(l.markedSpans,r);if(null!=s.from&&(n=E(t?l:W(l),s.from),-1==e))return n;if(null!=s.to&&(i=E(t?l:W(l),s.to),1==e))return i}return n&&{from:n,to:i}},Os.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;t&&n&&hn(n,function(){var i=t.line,o=W(t.line),l=jt(n,o);if(l&&(Qt(l),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ve(r.doc,i)&&null!=r.height){var s=r.height;r.height=null;var a=Ht(r)-s;a&&A(i,i.height+a)}bt(n,"markerChanged",n,e)})},Os.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=h(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Os.prototype.detachLine=function(e){if(this.lines.splice(h(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Ae(Os);var As=function(e,t){var r=this;this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=r};As.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();bt(this,"clear")}},As.prototype.find=function(e,t){return this.primary.find(e,t)},Ae(As);var Ws=0,Ds=function(e,t,r,n,i){if(!(this instanceof Ds))return new Ds(e,t,r,n,i);null==r&&(r=0),Gi.call(this,[new Bi([new fs("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=E(r,0);this.sel=Rn(o),this.history=new Jn(null),this.id=++Ws,this.modeOption=t,this.lineSep=n,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),_n(this,{from:o,to:o,text:e}),bi(this,Rn(o),Gl)};Ds.prototype=b(Gi.prototype,{constructor:Ds,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=O(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:gn(function(e){var t=E(this.first,0),r=this.first+this.size-1;Oi(this,{from:t,to:E(r,M(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Xr(this.cm,0,0),bi(this,Rn(t),Gl)}),replaceRange:function(e,t,r,n){Ei(this,e,t=U(this,t),r=r?U(this,r):t,n)},getRange:function(e,t,r){var n=N(this,U(this,e),U(this,t));return!1===r?n:n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(H(this,e))return M(this,e)},getLineNumber:function(e){return W(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=M(this,e)),fe(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return U(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:gn(function(e,t,r){vi(this,U(this,"number"==typeof e?E(e,t||0):e),null,r)}),setSelection:gn(function(e,t,r){vi(this,U(this,e),U(this,t||e),r)}),extendSelection:gn(function(e,t,r){di(this,U(this,e),t&&U(this,t),r)}),extendSelections:gn(function(e,t){pi(this,K(this,e),t)}),extendSelectionsBy:gn(function(e,t){pi(this,K(this,v(this.sel.ranges,e)),t)}),setSelections:gn(function(e,t,r){var n=this;if(e.length){for(var i=[],o=0;o<e.length;o++)i[o]=new Ts(U(n,e[o].anchor),U(n,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),bi(this,zn(i,t),r)}}),addSelection:gn(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Ts(U(this,e),U(this,t||e))),bi(this,zn(n,n.length-1),r)}),getSelection:function(e){for(var t,r=this,n=this.sel.ranges,i=0;i<n.length;i++){var o=N(r,n[i].from(),n[i].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,r=[],n=this.sel.ranges,i=0;i<n.length;i++){var o=N(t,n[i].from(),n[i].to());!1!==e&&(o=o.join(e||t.lineSeparator())),r[i]=o}return r},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:gn(function(e,t,r){for(var n=this,i=[],o=this.sel,l=0;l<o.ranges.length;l++){var s=o.ranges[l];i[l]={from:s.from(),to:s.to(),text:n.splitLines(e[l]),origin:r}}for(var a=t&&"end"!=t&&Kn(this,i,t),u=i.length-1;u>=0;u--)Oi(n,i[u]);a?yi(this,a):this.cm&&jr(this.cm)}),undo:gn(function(){Wi(this,"undo")}),redo:gn(function(){Wi(this,"redo")}),undoSelection:gn(function(){Wi(this,"undo",!0)}),redoSelection:gn(function(){Wi(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){this.history=new Jn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:fi(this.history.done),undone:fi(this.history.undone)}},setHistory:function(e){var t=this.history=new Jn(this.history.maxGeneration);t.done=fi(e.done.slice(0),null,!0),t.undone=fi(e.undone.slice(0),null,!0)},setGutterMarker:gn(function(e,t,r){return Ri(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&C(n)&&(e.gutterMarkers=null),!0})}),clearGutter:gn(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&Ri(t,r,"gutter",function(){return r.gutterMarkers[e]=null,C(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!H(this,e))return null;if(t=e,!(e=M(this,e)))return null}else if(null==(t=W(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass";if(t[i]){if(e(n).test(t[i]))return!1;t[i]+=" "+n}else t[i]=n;return!0})}),removeLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass",o=t[i];if(!o)return!1;if(null==n)t[i]=null;else{var l=o.match(e(n));if(!l)return!1;var s=l.index+l[0].length;t[i]=o.slice(0,l.index)+(l.index&&s!=o.length?" ":"")+o.slice(s)||null}return!0})}),addLineWidget:gn(function(e,t,r){return Vi(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return Ki(this,U(this,e),U(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=U(this,e),Ki(this,e,e,r,"bookmark")},findMarksAt:function(e){var t=[],r=M(this,(e=U(this,e)).line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=U(this,e),t=U(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var l=o.markedSpans;if(l)for(var s=0;s<l.length;s++){var a=l[s];null!=a.to&&i==e.line&&e.ch>=a.to||null==a.from&&i!=e.line||null!=a.from&&i==t.line&&a.from>=t.ch||r&&!r(a.marker)||n.push(a.marker.parent||a.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),U(this,E(r,t))},indexFromPos:function(e){var t=(e=U(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+r}),t},copy:function(e){var t=new Ds(O(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Ds(O(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Yi(n,Xi(this)),n},unlinkDoc:function(e){var t=this;if(e instanceof jo&&(e=e.doc),this.linked)for(var r=0;r<this.linked.length;++r)if(t.linked[r].doc==e){t.linked.splice(r,1),e.unlinkDoc(t),_i(Xi(t));break}if(e.history==this.history){var n=[e.id];$n(e,function(e){return n.push(e.id)},!0),e.history=new Jn(null),e.history.done=fi(this.history.done,n),e.history.undone=fi(this.history.undone,n)}},iterLinkedDocs:function(e){$n(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):es(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:gn(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Qn(this.cm))})}),Ds.prototype.eachLine=Ds.prototype.iter;for(var Hs=0,Fs=!1,Es={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ps=0;Ps<10;Ps++)Es[Ps+48]=Es[Ps+96]=String(Ps);for(var Is=65;Is<=90;Is++)Es[Is]=String.fromCharCode(Is);for(var zs=1;zs<=12;zs++)Es[zs+111]=Es[zs+63235]="F"+zs;var Rs={};Rs.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Rs.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Rs.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Rs.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Rs.default=Ml?Rs.macDefault:Rs.pcDefault;var Bs={selectAll:Mi,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Gl)},killLine:function(e){return co(e,function(t){if(t.empty()){var r=M(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:E(t.head.line+1,0)}:{from:t.head,to:E(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return co(e,function(t){return{from:E(t.from().line,0),to:U(e.doc,E(t.to().line+1,0))}})},delLineLeft:function(e){return co(e,function(e){return{from:E(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:r},"div"),to:t.from()}})},delWrappedLineRight:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(E(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(E(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return vo(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return yo(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return mo(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},Vl)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},Vl)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?yo(e,t.head):n},Vl)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),l=f(e.getLine(o.line),o.ch,n);t.push(p(n-l%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return hn(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=M(e.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new E(i.line,i.ch-1)),i.ch>0)i=new E(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),E(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var l=M(e.doc,i.line-1).text;l&&(i=new E(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+l.charAt(l.length-1),E(i.line-1,l.length-1),i,"+transpose"))}r.push(new Ts(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return hn(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);jr(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Gs=new Pl,Us=null,Vs=function(e,t,r){this.time=e,this.pos=t,this.button=r};Vs.prototype.compare=function(e,t,r){return this.time+400>e&&0==P(t,this.pos)&&r==this.button};var Ks,js,Xs={toString:function(){return"CodeMirror.Init"}},Ys={},_s={};jo.defaults=Ys,jo.optionHandlers=_s;var $s=[];jo.defineInitHook=function(e){return $s.push(e)};var qs=null,Zs=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Pl,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Zs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation(function(){i.setSelections(t.ranges,0,Gl),i.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var r=qs.text.join("\n");if(e.clipboardData.setData("Text",r),e.clipboardData.getData("Text")==r)return void e.preventDefault()}var l=el(),s=l.firstChild;i.display.lineSpace.insertBefore(l,i.display.lineSpace.firstChild),s.value=qs.text.join("\n");var a=document.activeElement;El(s),setTimeout(function(){i.display.lineSpace.removeChild(l),a.focus(),a==o&&n.showPrimarySelection()},50)}}var r=this,n=this,i=n.cm,o=n.div=e.lineDiv;Jo(o,i.options.spellcheck),Ql(o,"paste",function(e){Me(i,e)||qo(e,i)||vl<=11&&setTimeout(dn(i,function(){return r.updateFromDOM()}),20)}),Ql(o,"compositionstart",function(e){r.composing={data:e.data,done:!1}}),Ql(o,"compositionupdate",function(e){r.composing||(r.composing={data:e.data,done:!1})}),Ql(o,"compositionend",function(e){r.composing&&(e.data!=r.composing.data&&r.readFromDOMSoon(),r.composing.done=!0)}),Ql(o,"touchstart",function(){return n.forceCompositionEnd()}),Ql(o,"input",function(){r.composing||r.readFromDOMSoon()}),Ql(o,"copy",t),Ql(o,"cut",t)},Zs.prototype.prepareSelection=function(){var e=Tr(this.cm,!1);return e.focus=this.cm.state.focused,e},Zs.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Zs.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom)e.removeAllRanges();else{var o=sl(t,e.anchorNode,e.anchorOffset),l=sl(t,e.focusNode,e.focusOffset);if(!o||o.bad||!l||l.bad||0!=P(B(o,l),n)||0!=P(R(o,l),i)){var s=t.display.view,a=n.line>=t.display.viewFrom&&nl(t,n)||{node:s[0].measure.map[2],offset:0},u=i.line<t.display.viewTo&&nl(t,i);if(!u){var c=s[s.length-1].measure,f=c.maps?c.maps[c.maps.length-1]:c.map;u={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}}if(a&&u){var h,d=e.rangeCount&&e.getRangeAt(0);try{h=Wl(a.node,a.offset,u.offset,u.node)}catch(e){}h&&(!fl&&t.state.focused?(e.collapse(a.node,a.offset),h.collapsed||(e.removeAllRanges(),e.addRange(h))):(e.removeAllRanges(),e.addRange(h)),d&&null==e.anchorNode?e.addRange(d):fl&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Zs.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Zs.prototype.showMultipleSelections=function(e){r(this.cm.display.cursorDiv,e.cursors),r(this.cm.display.selectionDiv,e.selection)},Zs.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Zs.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return o(this.div,t)},Zs.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Zs.prototype.blur=function(){this.div.blur()},Zs.prototype.getField=function(){return this.div},Zs.prototype.supportsTouch=function(){return!0},Zs.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():hn(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Zs.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Zs.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(kl&&bl&&this.cm.options.gutters.length&&il(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var r=sl(t,e.anchorNode,e.anchorOffset),n=sl(t,e.focusNode,e.focusOffset);r&&n&&hn(t,function(){bi(t.doc,Rn(r,n),Gl),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},Zs.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,r=e.doc.sel.primary(),n=r.from(),i=r.to();if(0==n.ch&&n.line>e.firstLine()&&(n=E(n.line-1,M(e.doc,n.line-1).length)),i.ch==M(e.doc,i.line).text.length&&i.line<e.lastLine()&&(i=E(i.line+1,0)),n.line<t.viewFrom||i.line>t.viewTo-1)return!1;var o,l,s;n.line==t.viewFrom||0==(o=Lr(e,n.line))?(l=W(t.view[0].line),s=t.view[0].node):(l=W(t.view[o].line),s=t.view[o-1].node.nextSibling);var a,u,c=Lr(e,i.line);if(c==t.view.length-1?(a=t.viewTo-1,u=t.lineDiv.lastChild):(a=W(t.view[c+1].line)-1,u=t.view[c+1].node.previousSibling),!s)return!1;for(var f=e.doc.splitLines(ll(e,s,u,l,a)),h=N(e.doc,E(l,0),E(a,M(e.doc,a).text.length));f.length>1&&h.length>1;)if(g(f)==g(h))f.pop(),h.pop(),a--;else{if(f[0]!=h[0])break;f.shift(),h.shift(),l++}for(var d=0,p=0,v=f[0],m=h[0],y=Math.min(v.length,m.length);d<y&&v.charCodeAt(d)==m.charCodeAt(d);)++d;for(var b=g(f),w=g(h),x=Math.min(b.length-(1==f.length?d:0),w.length-(1==h.length?d:0));p<x&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)++p;if(1==f.length&&1==h.length&&l==n.line)for(;d&&d>n.ch&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)d--,p++;f[f.length-1]=b.slice(0,b.length-p).replace(/^\u200b+/,""),f[0]=f[0].slice(d).replace(/\u200b+$/,"");var C=E(l,d),S=E(a,h.length?g(h).length-p:0);return f.length>1||f[0]||P(C,S)?(Ei(e.doc,f,C,S,"+input"),!0):void 0},Zs.prototype.ensurePolled=function(){this.forceCompositionEnd()},Zs.prototype.reset=function(){this.forceCompositionEnd()},Zs.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Zs.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Zs.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||hn(this.cm,function(){return vn(e.cm)})},Zs.prototype.setUneditable=function(e){e.contentEditable="false"},Zs.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||dn(this.cm,$o)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Zs.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Zs.prototype.onContextMenu=function(){},Zs.prototype.resetPosition=function(){},Zs.prototype.needsContentAttribute=!0;var Qs=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Pl,this.hasSelection=!1,this.composing=null};Qs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type?i.setSelections(t.ranges,null,Gl):(n.prevInput="",l.value=t.text.join("\n"),El(l))}"cut"==e.type&&(i.state.cutIncoming=!0)}}var r=this,n=this,i=this.cm,o=this.wrapper=el(),l=this.textarea=o.firstChild;e.wrapper.insertBefore(o,e.wrapper.firstChild),Ll&&(l.style.width="0px"),Ql(l,"input",function(){gl&&vl>=9&&r.hasSelection&&(r.hasSelection=null),n.poll()}),Ql(l,"paste",function(e){Me(i,e)||qo(e,i)||(i.state.pasteIncoming=!0,n.fastPoll())}),Ql(l,"cut",t),Ql(l,"copy",t),Ql(e.scroller,"paste",function(t){Ft(e,t)||Me(i,t)||(i.state.pasteIncoming=!0,n.focus())}),Ql(e.lineSpace,"selectstart",function(t){Ft(e,t)||We(t)}),Ql(l,"compositionstart",function(){var e=i.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}}),Ql(l,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Qs.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=Tr(e);if(e.options.moveInputWithCursor){var i=sr(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),l=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+l.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+l.left-o.left))}return n},Qs.prototype.showSelection=function(e){var t=this.cm.display;r(t.cursorDiv,e.cursors),r(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Qs.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&El(this.textarea),gl&&vl>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",gl&&vl>=9&&(this.hasSelection=null))}},Qs.prototype.getField=function(){return this.textarea},Qs.prototype.supportsTouch=function(){return!1},Qs.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Tl||l()!=this.textarea))try{this.textarea.focus()}catch(e){}},Qs.prototype.blur=function(){this.textarea.blur()},Qs.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Qs.prototype.receivedFocus=function(){this.slowPoll()},Qs.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Qs.prototype.fastPoll=function(){function e(){r.poll()||t?(r.pollingFast=!1,r.slowPoll()):(t=!0,r.polling.set(60,e))}var t=!1,r=this;r.pollingFast=!0,r.polling.set(20,e)},Qs.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||ts(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(gl&&vl>=9&&this.hasSelection===i||Ml&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(8203!=o||n||(n="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,s=Math.min(n.length,i.length);l<s&&n.charCodeAt(l)==i.charCodeAt(l);)++l;return hn(t,function(){$o(t,i.slice(l),n.length-l,null,e.composing?"*compose":null),i.length>1e3||i.indexOf("\n")>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Qs.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Qs.prototype.onKeyPress=function(){gl&&vl>=9&&(this.hasSelection=null),this.fastPoll()},Qs.prototype.onContextMenu=function(e){function t(){if(null!=l.selectionStart){var e=i.somethingSelected(),t="​"+(e?l.value:"");l.value="⇚",l.value=t,n.prevInput=e?"":"​",l.selectionStart=1,l.selectionEnd=t.length,o.selForContextMenu=i.doc.sel}}function r(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=c,l.style.cssText=u,gl&&vl<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=a),null!=l.selectionStart){(!gl||gl&&vl<9)&&t();var e=0,r=function(){o.selForContextMenu==i.doc.sel&&0==l.selectionStart&&l.selectionEnd>0&&"​"==n.prevInput?dn(i,Mi)(i):e++<10?o.detectingSelectAll=setTimeout(r,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(r,200)}}var n=this,i=n.cm,o=i.display,l=n.textarea,s=Sr(i,e),a=o.scroller.scrollTop;if(s&&!wl){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(s)&&dn(i,bi)(i.doc,Rn(s),Gl);var u=l.style.cssText,c=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var f=n.wrapper.getBoundingClientRect();l.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(gl?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var h;if(ml&&(h=window.scrollY),o.input.focus(),ml&&window.scrollTo(null,h),o.input.reset(),i.somethingSelected()||(l.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=i.doc.sel,clearTimeout(o.detectingSelectAll),gl&&vl>=9&&t(),Hl){Fe(e);var d=function(){ke(window,"mouseup",d),setTimeout(r,20)};Ql(window,"mouseup",d)}else setTimeout(r,50)}},Qs.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Qs.prototype.setUneditable=function(){},Qs.prototype.needsContentAttribute=!1,function(e){function t(t,n,i,o){e.defaults[t]=n,i&&(r[t]=o?function(e,t,r){r!=Xs&&i(e,t,r)}:i)}var r=e.optionHandlers;e.defineOption=t,e.Init=Xs,t("value","",function(e,t){return e.setValue(t)},!0),t("mode",null,function(e,t){e.doc.modeOption=t,jn(e)},!0),t("indentUnit",2,jn,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(e){Xn(e),er(e),vn(e)},!0),t("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var r=[],n=e.doc.first;e.doc.iter(function(e){for(var i=0;;){var o=e.text.indexOf(t,i);if(-1==o)break;i=o+t.length,r.push(E(n,o))}n++});for(var i=r.length-1;i>=0;i--)Ei(e.doc,t,r[i],E(r[i].line,r[i].ch+t.length))}}),t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),r!=Xs&&e.refresh()}),t("specialCharPlaceholder",at,function(e){return e.refresh()},!0),t("electricChars",!0),t("inputStyle",Tl?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),t("rtlMoveVisually",!Ol),t("wholeLineUpdateBefore",!0),t("theme","default",function(e){Go(e),Uo(e)},!0),t("keyMap","default",function(e,t,r){var n=uo(t),i=r!=Xs&&uo(r);i&&i.detach&&i.detach(e,n),n.attach&&n.attach(e,i||null)}),t("extraKeys",null),t("configureMouse",null),t("lineWrapping",!1,Ko,!0),t("gutters",[],function(e){Fn(e.options),Uo(e)},!0),t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?wr(e.display)+"px":"0",e.refresh()},!0),t("coverGutterNextToScrollbar",!1,function(e){return en(e)},!0),t("scrollbarStyle","native",function(e){rn(e),en(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),t("lineNumbers",!1,function(e){Fn(e.options),Uo(e)},!0),t("firstLineNumber",1,Uo,!0),t("lineNumberFormatter",function(e){return e},Uo,!0),t("showCursorWhenSelecting",!1,kr,!0),t("resetSelectionOnContextMenu",!0),t("lineWiseCopyCut",!0),t("pasteLinesPerSelection",!0),t("readOnly",!1,function(e,t){"nocursor"==t&&(Fr(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),t("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),t("dragDrop",!0,Vo),t("allowDropFileTypes",null),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1,kr,!0),t("singleCursorHeightPerLine",!0,kr,!0),t("workTime",100),t("workDelay",100),t("flattenSpans",!0,Xn,!0),t("addModeClass",!1,Xn,!0),t("pollInterval",100),t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),t("historyEventDelay",1250),t("viewportMargin",10,function(e){return e.refresh()},!0),t("maxHighlightLength",1e4,Xn,!0),t("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),t("autofocus",null),t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}(jo),function(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,r){var n=this.options,i=n[e];n[e]==r&&"mode"!=e||(n[e]=r,t.hasOwnProperty(e)&&dn(this,t[e])(this,r,i),Te(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](uo(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||t[r].name==e)return t.splice(r,1),!0},addOverlay:pn(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");m(this.state.overlays,{mode:n,modeSpec:t,opaque:r&&r.opaque,priority:r&&r.priority||0},function(e){return e.priority}),this.state.modeGen++,vn(this)}),removeOverlay:pn(function(e){for(var t=this,r=this.state.overlays,n=0;n<r.length;++n){var i=r[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return r.splice(n,1),t.state.modeGen++,void vn(t)}}),indentLine:pn(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),H(this.doc,e)&&Yo(this,e,t,r)}),indentSelection:pn(function(e){for(var t=this,r=this.doc.sel.ranges,n=-1,i=0;i<r.length;i++){var o=r[i];if(o.empty())o.head.line>n&&(Yo(t,o.head.line,e,!0),n=o.head.line,i==t.doc.sel.primIndex&&jr(t));else{var l=o.from(),s=o.to(),a=Math.max(n,l.line);n=Math.min(t.lastLine(),s.line-(s.ch?0:1))+1;for(var u=a;u<n;++u)Yo(t,u,e);var c=t.doc.sel.ranges;0==l.ch&&r.length==c.length&&c[i].from().ch>0&&gi(t.doc,i,new Ts(l,c[i].to()),Gl)}}}),getTokenAt:function(e,t){return Je(this,e,t)},getLineTokens:function(e,t){return Je(this,E(e),t,!0)},getTokenTypeAt:function(e){e=U(this.doc,e);var t,r=_e(this,M(this.doc,e.line)),n=0,i=(r.length-1)/2,o=e.ch;if(0==o)t=r[2];else for(;;){var l=n+i>>1;if((l?r[2*l-1]:0)>=o)i=l;else{if(!(r[2*l+1]<o)){t=r[2*l+2];break}n=l+1}}var s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=this,i=[];if(!r.hasOwnProperty(t))return i;var o=r[t],l=this.getModeAt(e);if("string"==typeof l[t])o[l[t]]&&i.push(o[l[t]]);else if(l[t])for(var s=0;s<l[t].length;s++){var a=o[l[t][s]];a&&i.push(a)}else l.helperType&&o[l.helperType]?i.push(o[l.helperType]):o[l.name]&&i.push(o[l.name]);for(var u=0;u<o._global.length;u++){var c=o._global[u];c.pred(l,n)&&-1==h(i,c.val)&&i.push(c.val)}return i},getStateAfter:function(e,t){var r=this.doc;return e=G(r,null==e?r.first+r.size-1:e),$e(this,e+1,t).state},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();return r=null==e?n.head:"object"==typeof e?U(this.doc,e):e?n.from():n.to(),sr(this,r,t||"page")},charCoords:function(e,t){return lr(this,U(this.doc,e),t||"page")},coordsChar:function(e,t){return e=or(this,e,t||"page"),cr(this,e.left,e.top)},lineAtHeight:function(e,t){return e=or(this,{top:e,left:0},t||"page").top,D(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n,i=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,i=!0),n=M(this.doc,e)}else n=e;return ir(this,n,{top:0,left:0},t||"page",r||i).top+(i?this.doc.height-ye(n):0)},defaultTextHeight:function(){return mr(this.display)},defaultCharWidth:function(){return yr(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o=this.display,l=(e=sr(this,U(this.doc,e))).bottom,s=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)l=e.top;else if("above"==n||"near"==n){var a=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>a)&&e.top>t.offsetHeight?l=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=a&&(l=e.bottom),s+t.offsetWidth>u&&(s=u-t.offsetWidth)}t.style.top=l+"px",t.style.left=t.style.right="","right"==i?(s=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?s=0:"middle"==i&&(s=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),r&&Ur(this,{left:s,top:l,right:s+t.offsetWidth,bottom:l+t.offsetHeight})},triggerOnKeyDown:pn(Lo),triggerOnKeyPress:pn(Mo),triggerOnKeyUp:To,triggerOnMouseDown:pn(Oo),execCommand:function(e){if(Bs.hasOwnProperty(e))return Bs[e].call(null,this)},triggerElectric:pn(function(e){Zo(this,e)}),findPosH:function(e,t,r,n){var i=this,o=1;t<0&&(o=-1,t=-t);for(var l=U(this.doc,e),s=0;s<t&&!(l=tl(i.doc,l,o,r,n)).hitSide;++s);return l},moveH:pn(function(e,t){var r=this;this.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?tl(r.doc,n.head,e,t,r.options.rtlMoveVisually):e<0?n.from():n.to()},Vl)}),deleteH:pn(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):co(this,function(r){var i=tl(n,r.head,e,t,!1);return e<0?{from:i,to:r.head}:{from:r.head,to:i}})}),findPosV:function(e,t,r,n){var i=this,o=1,l=n;t<0&&(o=-1,t=-t);for(var s=U(this.doc,e),a=0;a<t;++a){var u=sr(i,s,"div");if(null==l?l=u.left:u.left=l,(s=rl(i,u,o,r)).hitSide)break}return s},moveV:pn(function(e,t){var r=this,n=this.doc,i=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(l){if(o)return e<0?l.from():l.to();var s=sr(r,l.head,"div");null!=l.goalColumn&&(s.left=l.goalColumn),i.push(s.left);var a=rl(r,s,e,t);return"page"==t&&l==n.sel.primary()&&Kr(r,lr(r,a,"div").top-s.top),a},Vl),i.length)for(var l=0;l<n.sel.ranges.length;l++)n.sel.ranges[l].goalColumn=i[l]}),findWordAt:function(e){var t=M(this.doc,e.line).text,r=e.ch,n=e.ch;if(t){var i=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!r?++n:--r;for(var o=t.charAt(r),l=x(o,i)?function(e){return x(e,i)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!x(e)};r>0&&l(t.charAt(r-1));)--r;for(;n<t.length&&l(t.charAt(n));)++n}return new Ts(E(e.line,r),E(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?s(this.display.cursorDiv,"CodeMirror-overwrite"):Fl(this.display.cursorDiv,"CodeMirror-overwrite"),Te(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==l()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pn(function(e,t){Xr(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-zt(this)-this.display.barHeight,width:e.scrollWidth-zt(this)-this.display.barWidth,clientHeight:Bt(this),clientWidth:Rt(this)}},scrollIntoView:pn(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:E(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Yr(this,e):$r(this,e.from,e.to,e.margin)}),setSize:pn(function(e,t){var r=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Jt(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){mn(r,i,"widget");break}++i}),this.curOp.forceUpdate=!0,Te(this,"refresh",this)}),operation:function(e){return hn(this,e)},startOperation:function(){return nn(this)},endOperation:function(){return on(this)},refresh:pn(function(){var e=this.display.cachedTextHeight;vn(this),this.curOp.forceUpdate=!0,er(this),Xr(this,this.doc.scrollLeft,this.doc.scrollTop),Wn(this),(null==e||Math.abs(e-mr(this.display))>.5)&&Cr(this),Te(this,"refresh",this)}),swapDoc:pn(function(e){var t=this.doc;return t.cm=null,qn(this,e),er(this),this.display.input.reset(),Xr(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,bt(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ae(e),e.registerHelper=function(t,n,i){r.hasOwnProperty(t)||(r[t]=e[t]={_global:[]}),r[t][n]=i},e.registerGlobalHelper=function(t,n,i,o){e.registerHelper(t,n,o),r[t]._global.push({pred:i,val:o})}}(jo);var Js="iter insert remove copy getEditor constructor".split(" ");for(var ea in Ds.prototype)Ds.prototype.hasOwnProperty(ea)&&h(Js,ea)<0&&(jo.prototype[ea]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ds.prototype[ea]));return Ae(Ds),jo.inputStyles={textarea:Qs,contenteditable:Zs},jo.defineMode=function(e){jo.defaults.mode||"null"==e||(jo.defaults.mode=e),Be.apply(this,arguments)},jo.defineMIME=function(e,t){os[e]=t},jo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),jo.defineMIME("text/plain","null"),jo.defineExtension=function(e,t){jo.prototype[e]=t},jo.defineDocExtension=function(e,t){Ds.prototype[e]=t},jo.fromTextArea=function(e,t){function r(){e.value=a.getValue()}if(t=t?c(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=l();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}var i;if(e.form&&(Ql(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var s=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=s}}catch(e){}}t.finishInit=function(t){t.save=r,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,r(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(ke(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=i))}},e.style.display="none";var a=jo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return a},function(e){e.off=ke,e.on=Ql,e.wheelEventPixels=Pn,e.Doc=Ds,e.splitLines=es,e.countColumn=f,e.findColumn=d,e.isWordChar=w,e.Pass=Bl,e.signal=Te,e.Line=fs,e.changeEnd=Bn,e.scrollbarModel=ws,e.Pos=E,e.cmpPos=P,e.modes=is,e.mimeModes=os,e.resolveMode=Ge,e.getMode=Ue,e.modeExtensions=ls,e.extendMode=Ve,e.copyState=Ke,e.startState=Xe,e.innerMode=je,e.commands=Bs,e.keyMap=Rs,e.keyName=ao,e.isModifierKey=lo,e.lookupKey=oo,e.normalizeKeyMap=io,e.StringStream=ss,e.SharedTextMarker=As,e.TextMarker=Os,e.LineWidget=Ms,e.e_preventDefault=We,e.e_stopPropagation=De,e.e_stop=Fe,e.addClass=s,e.contains=o,e.rmClass=Fl,e.keyNames=Es}(jo),jo.version="5.30.0",jo});
      !function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t,n,r,o,a){this.indented=e,this.column=t,this.type=n,this.info=r,this.align=o,this.prev=a}function n(e,n,r,o){var a=e.indented;return e.context&&"statement"==e.context.type&&"statement"!=r&&(a=e.context.indented),e.context=new t(a,n,r,o,null,e.context)}function r(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}function o(e,t,n){return"variable"==t.prevToken||"type"==t.prevToken||(!!/\S(?:[^- ]>|[*\]])\s*$|\*$/.test(e.string.slice(0,n))||(!(!t.typeAtEndOfLine||e.column()!=e.indentation())||void 0))}function a(e){for(;;){if(!e||"top"==e.type)return!0;if("}"==e.type&&"namespace"!=e.prev.info)return!1;e=e.prev}}function i(e){for(var t={},n=e.split(" "),r=0;r<n.length;++r)t[n[r]]=!0;return t}function l(e,t){return"function"==typeof e?e(t):e.propertyIsEnumerable(t)}function s(e,t){if(!t.startOfLine)return!1;for(var n,r=null;n=e.peek();){if("\\"==n&&e.match(/^.$/)){r=s;break}if("/"==n&&e.match(/^\/[\/\*]/,!1))break;e.next()}return t.tokenize=r,"meta"}function c(e,t){return"type"==t.prevToken&&"type"}function u(e){return e.eatWhile(/[\w\.']/),"number"}function d(e,t){if(e.backUp(1),e.match(/(R|u8R|uR|UR|LR)/)){var n=e.match(/"([^\s\\()]{0,16})\(/);return!!n&&(t.cpp11RawStringDelim=n[1],t.tokenize=m,m(e,t))}return e.match(/(u8|u|U|L)/)?!!e.match(/["']/,!1)&&"string":(e.next(),!1)}function f(e){var t=/(\w+)::~?(\w+)$/.exec(e);return t&&t[1]==t[2]}function p(e,t){for(var n;null!=(n=e.next());)if('"'==n&&!e.eat('"')){t.tokenize=null;break}return"string"}function m(e,t){var n=t.cpp11RawStringDelim.replace(/[^\w\s]/g,"\\$&");return e.match(new RegExp(".*?\\)"+n+'"'))?t.tokenize=null:e.skipToEnd(),"string"}function h(t,n){function r(e){if(e)for(var t in e)e.hasOwnProperty(t)&&o.push(t)}"string"==typeof t&&(t=[t]);var o=[];r(n.keywords),r(n.types),r(n.builtin),r(n.atoms),o.length&&(n.helperType=t[0],e.registerHelper("hintWords",t[0],o));for(var a=0;a<t.length;++a)e.defineMIME(t[a],n)}function g(e,t){for(var n=!1;!e.eol();){if(!n&&e.match('"""')){t.tokenize=null;break}n="\\"==e.next()&&!n}return"string"}function y(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!e&&!o&&t.match('"')){a=!0;break}if(e&&t.match('"""')){a=!0;break}r=t.next(),!o&&"$"==r&&t.match("{")&&t.skipTo("}"),o=!o&&"\\"==r&&!e}return!a&&e||(n.tokenize=null),"string"}}function x(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!o&&t.match('"')&&("single"==e||t.match('""'))){a=!0;break}if(!o&&t.match("``")){w=x(e),a=!0;break}r=t.next(),o="single"==e&&!o&&"\\"==r}return a&&(n.tokenize=null),"string"}}e.defineMode("clike",function(i,s){function c(e,t){var n=e.next();if(S[n]){var r=S[n](e,t);if(!1!==r)return r}if('"'==n||"'"==n)return t.tokenize=u(n),t.tokenize(e,t);if(D.test(n))return p=n,null;if(L.test(n)){if(e.backUp(1),e.match(I))return"number";e.next()}if("/"==n){if(e.eat("*"))return t.tokenize=d,d(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if(F.test(n)){for(;!e.match(/^\/[\/*]/,!1)&&e.eat(F););return"operator"}if(e.eatWhile(z),P)for(;e.match(P);)e.eatWhile(z);var o=e.current();return l(x,o)?(l(w,o)&&(p="newstatement"),l(v,o)&&(m=!0),"keyword"):l(b,o)?"type":l(k,o)?(l(w,o)&&(p="newstatement"),"builtin"):l(_,o)?"atom":"variable"}function u(e){return function(t,n){for(var r,o=!1,a=!1;null!=(r=t.next());){if(r==e&&!o){a=!0;break}o=!o&&"\\"==r}return(a||!o&&!C)&&(n.tokenize=null),"string"}}function d(e,t){for(var n,r=!1;n=e.next();){if("/"==n&&r){t.tokenize=null;break}r="*"==n}return"comment"}function f(e,t){s.typeFirstDefinitions&&e.eol()&&a(t.context)&&(t.typeAtEndOfLine=o(e,t,e.pos))}var p,m,h=i.indentUnit,g=s.statementIndentUnit||h,y=s.dontAlignCalls,x=s.keywords||{},b=s.types||{},k=s.builtin||{},w=s.blockKeywords||{},v=s.defKeywords||{},_=s.atoms||{},S=s.hooks||{},C=s.multiLineStrings,T=!1!==s.indentStatements,M=!1!==s.indentSwitch,P=s.namespaceSeparator,D=s.isPunctuationChar||/[\[\]{}\(\),;\:\.]/,L=s.numberStart||/[\d\.]/,I=s.number||/^(?:0x[a-f\d]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[-+]?\d+)?)(u|ll?|l|f)?/i,F=s.isOperatorChar||/[+\-*&%=<>!?|\/]/,z=s.isIdentifierChar||/[\w\$_\xa1-\uffff]/;return{startState:function(e){return{tokenize:null,context:new t((e||0)-h,0,"top",null,!1),indented:0,startOfLine:!0,prevToken:null}},token:function(e,t){var i=t.context;if(e.sol()&&(null==i.align&&(i.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return f(e,t),null;p=m=null;var l=(t.tokenize||c)(e,t);if("comment"==l||"meta"==l)return l;if(null==i.align&&(i.align=!0),";"==p||":"==p||","==p&&e.match(/^\s*(?:\/\/.*)?$/,!1))for(;"statement"==t.context.type;)r(t);else if("{"==p)n(t,e.column(),"}");else if("["==p)n(t,e.column(),"]");else if("("==p)n(t,e.column(),")");else if("}"==p){for(;"statement"==i.type;)i=r(t);for("}"==i.type&&(i=r(t));"statement"==i.type;)i=r(t)}else p==i.type?r(t):T&&(("}"==i.type||"top"==i.type)&&";"!=p||"statement"==i.type&&"newstatement"==p)&&n(t,e.column(),"statement",e.current());if("variable"==l&&("def"==t.prevToken||s.typeFirstDefinitions&&o(e,t,e.start)&&a(t.context)&&e.match(/^\s*\(/,!1))&&(l="def"),S.token){var u=S.token(e,t,l);void 0!==u&&(l=u)}return"def"==l&&!1===s.styleDefs&&(l="variable"),t.startOfLine=!1,t.prevToken=m?"def":l||p,f(e,t),l},indent:function(t,n){if(t.tokenize!=c&&null!=t.tokenize||t.typeAtEndOfLine)return e.Pass;var r=t.context,o=n&&n.charAt(0);if("statement"==r.type&&"}"==o&&(r=r.prev),s.dontIndentStatements)for(;"statement"==r.type&&s.dontIndentStatements.test(r.info);)r=r.prev;if(S.indent){var a=S.indent(t,r,n);if("number"==typeof a)return a}var i=o==r.type,l=r.prev&&"switch"==r.prev.info;if(s.allmanIndentation&&/[{(]/.test(o)){for(;"top"!=r.type&&"}"!=r.type;)r=r.prev;return r.indented}return"statement"==r.type?r.indented+("{"==o?0:g):!r.align||y&&")"==r.type?")"!=r.type||i?r.indented+(i?0:h)+(i||!l||/^(?:case|default)\b/.test(n)?0:h):r.indented+g:r.column+(i?0:1)},electricInput:M?/^\s*(?:case .*?:|default:|\{\}?|\})$/:/^\s*[{}]$/,blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//",fold:"brace"}});var b="auto if break case register continue return default do sizeof static else struct switch extern typedef union for goto while enum const volatile",k="int long char short double float unsigned signed void size_t ptrdiff_t";h(["text/x-csrc","text/x-c","text/x-chdr"],{name:"clike",keywords:i(b),types:i(k+" bool _Complex _Bool float_t double_t intptr_t intmax_t int8_t int16_t int32_t int64_t uintptr_t uintmax_t uint8_t uint16_t uint32_t uint64_t"),blockKeywords:i("case do else for if switch while struct"),defKeywords:i("struct"),typeFirstDefinitions:!0,atoms:i("null true false"),hooks:{"#":s,"*":c},modeProps:{fold:["brace","include"]}}),h(["text/x-c++src","text/x-c++hdr"],{name:"clike",keywords:i(b+" asm dynamic_cast namespace reinterpret_cast try explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected alignas alignof constexpr decltype nullptr noexcept thread_local final static_assert override"),types:i(k+" bool wchar_t"),blockKeywords:i("catch class do else finally for if struct switch try while"),defKeywords:i("class namespace struct enum union"),typeFirstDefinitions:!0,atoms:i("true false null"),dontIndentStatements:/^template$/,isIdentifierChar:/[\w\$_~\xa1-\uffff]/,hooks:{"#":s,"*":c,u:d,U:d,L:d,R:d,0:u,1:u,2:u,3:u,4:u,5:u,6:u,7:u,8:u,9:u,token:function(e,t,n){if("variable"==n&&"("==e.peek()&&(";"==t.prevToken||null==t.prevToken||"}"==t.prevToken)&&f(e.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),h("text/x-java",{name:"clike",keywords:i("abstract assert break case catch class const continue default do else enum extends final finally float for goto if implements import instanceof interface native new package private protected public return static strictfp super switch synchronized this throw throws transient try volatile while @interface"),types:i("byte short int long float double boolean char void Boolean Byte Character Double Float Integer Long Number Object Short String StringBuffer StringBuilder Void"),blockKeywords:i("catch class do else finally for if switch try while"),defKeywords:i("class interface package enum @interface"),typeFirstDefinitions:!0,atoms:i("true false null"),number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,hooks:{"@":function(e){return!e.match("interface",!1)&&(e.eatWhile(/[\w\$_]/),"meta")}},modeProps:{fold:["brace","import"]}}),h("text/x-csharp",{name:"clike",keywords:i("abstract as async await base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in interface internal is lock namespace new operator out override params private protected public readonly ref return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),types:i("Action Boolean Byte Char DateTime DateTimeOffset Decimal Double Func Guid Int16 Int32 Int64 Object SByte Single String Task TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),blockKeywords:i("catch class do else finally for foreach if struct switch try while"),defKeywords:i("class interface namespace struct var"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"@":function(e,t){return e.eat('"')?(t.tokenize=p,p(e,t)):(e.eatWhile(/[\w\$_]/),"meta")}}}),h("text/x-scala",{name:"clike",keywords:i("abstract case catch class def do else extends final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try type val var while with yield _ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble"),types:i("AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Int Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),multiLineStrings:!0,blockKeywords:i("catch class enum do else finally for forSome if match switch try while"),defKeywords:i("class enum def object package trait type val var"),atoms:i("true false null"),indentStatements:!1,indentSwitch:!1,isOperatorChar:/[+\-*&%=<>!?|\/#:@]/,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return!!e.match('""')&&(t.tokenize=g,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},"=":function(e,n){var r=n.context;return!("}"!=r.type||!r.align||!e.eat(">"))&&(n.context=new t(r.indented,r.column,r.type,r.info,null,r.prev),"operator")}},modeProps:{closeBrackets:{triples:'"'}}}),h("text/x-kotlin",{name:"clike",keywords:i("package as typealias class interface this super val var fun for is in This throw return break continue object if else while do try when !in !is as? file import where by get set abstract enum open inner override private public internal protected catch finally out final vararg reified dynamic companion constructor init sealed field property receiver param sparam lateinit data inline noinline tailrec external annotation crossinline const operator infix suspend"),types:i("Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),intendSwitch:!1,indentStatements:!1,multiLineStrings:!0,number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,blockKeywords:i("catch class do else finally for if where try while enum"),defKeywords:i("class val var object package interface fun"),atoms:i("true false null this"),hooks:{'"':function(e,t){return t.tokenize=y(e.match('""')),t.tokenize(e,t)}},modeProps:{closeBrackets:{triples:'"'}}}),h(["x-shader/x-vertex","x-shader/x-fragment"],{name:"clike",keywords:i("sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),types:i("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4"),blockKeywords:i("for while do if else struct"),builtin:i("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),atoms:i("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TexureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),indentSwitch:!1,hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-nesc",{name:"clike",keywords:i(b+"as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),types:i(k),blockKeywords:i("case do else for if switch while struct"),atoms:i("null true false"),hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-objectivec",{name:"clike",keywords:i(b+"inline restrict _Bool _Complex _Imaginary BOOL Class bycopy byref id IMP in inout nil oneway out Protocol SEL self super atomic nonatomic retain copy readwrite readonly"),types:i(k),atoms:i("YES NO NULL NILL ON OFF true false"),hooks:{"@":function(e){return e.eatWhile(/[\w\$]/),"keyword"},"#":s,indent:function(e,t,n){if("statement"==t.type&&/^@\w/.test(n))return t.indented}},modeProps:{fold:"brace"}}),h("text/x-squirrel",{name:"clike",keywords:i("base break clone continue const default delete enum extends function in class foreach local resume return this throw typeof yield constructor instanceof static"),types:i(k),blockKeywords:i("case catch class else for foreach if switch try while"),defKeywords:i("function local class"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"#":s},modeProps:{fold:["brace","include"]}});var w=null;h("text/x-ceylon",{name:"clike",keywords:i("abstracts alias assembly assert assign break case catch class continue dynamic else exists extends finally for function given if import in interface is let module new nonempty object of out outer package return satisfies super switch then this throw try value void while"),types:function(e){var t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()},blockKeywords:i("case catch class dynamic else finally for function if interface module new object switch try while"),defKeywords:i("class dynamic function interface module object package value"),builtin:i("abstract actual aliased annotation by default deprecated doc final formal late license native optional sealed see serializable shared suppressWarnings tagged throws variable"),isPunctuationChar:/[\[\]{}\(\),;\:\.`]/,isOperatorChar:/[+\-*&%=<>!?|^~:\/]/,numberStart:/[\d#$]/,number:/^(?:#[\da-fA-F_]+|\$[01_]+|[\d_]+[kMGTPmunpf]?|[\d_]+\.[\d_]+(?:[eE][-+]?\d+|[kMGTPmunpf]|)|)/i,multiLineStrings:!0,typeFirstDefinitions:!0,atoms:i("true false null larger smaller equal empty finished"),indentSwitch:!1,styleDefs:!1,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return t.tokenize=x(e.match('""')?"triple":"single"),t.tokenize(e,t)},"`":function(e,t){return!(!w||!e.match("`"))&&(t.tokenize=w,w=null,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},token:function(e,t,n){if(("variable"==n||"type"==n)&&"."==t.prevToken)return"variable-2"}},modeProps:{fold:["brace","import"],closeBrackets:{triples:'"'}}})});
      // -------------------------------------------------------------------------
//  Part of the CodeChecker project, under the Apache License v2.0 with
//  LLVM Exceptions. See LICENSE for license information.
//  SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
// -------------------------------------------------------------------------

var BugViewer = {
  _files : [],
  _reports : [],
  _lineWidgets : [],
  _navigationMenuItems : [],
  _sourceFileData : null,
  _currentReport : null,
  _lastBugEvent  : null,

  init : function (files, reports) {
    this._files = files;
    this._reports = reports;

    this.initEscapeChars();
  },

  initEscapeChars : function () {
    this.escapeChars = {
      ' ' : 'nbsp',
      '<' : 'lt',
      '>' : 'gt',
      '"' : 'quot',
      '&' : 'amp'
    };

    var regexString = '[';
    for (var key in this.escapeChars) {
      regexString += key;
    }
    regexString += ']';

    this.escapeRegExp = new RegExp( regexString, 'g');
  },

  escapeHTML : function (str) {
    var that = this;

    return str.replace(this.escapeRegExp, function (m) {
      return '&' + that.escapeChars[m] + ';';
    });
  },

  initByUrl : function () {
    if (!this._reports) return;

    var state = {};
    window.location.hash.substr(1).split('&').forEach(function (s) {
      var parts = s.split('=');
      state[parts[0]] = parts[1];
    });

    for (var key in this._reports) {
      var report = this._reports[key];
      if (report.reportHash === state['reportHash']) {
        this.navigate(report);
        return;
      }
    }

    this.navigate(this._reports[0]);
  },

  create : function () {
    this._content = document.getElementById('editor-wrapper');
    this._filepath = document.getElementById('file-path');
    this._checkerName = document.getElementById('checker-name');
    this._reviewStatusWrapper =
      document.getElementById('review-status-wrapper');
    this._reviewStatus = document.getElementById('review-status');
    this._editor = document.getElementById('editor');

    this._codeMirror = CodeMirror(this._editor, {
      mode: 'text/x-c++src',
      matchBrackets : true,
      lineNumbers : true,
      readOnly : true,
      foldGutter : true,
      extraKeys : {},
      viewportMargin : 100
    });

    this._createNavigationMenu();
  },

  navigate : function (report, item) {
    if (!item) {
      var items = this._navigationMenuItems.filter(function (navItem) {
        return navItem.report.reportHash === report.reportHash;
      });

      if (!items.length) return;

      item = items[0].widget;
    }

    this._selectedReport.classList.remove('active');
    this._selectedReport = item;
    this._selectedReport.classList.add('active');
    this.setReport(report);
  },

  _createNavigationMenu : function () {
    var that = this;

    var nav = document.getElementById('report-nav');
    var list = document.createElement('ul');
    this._reports.forEach(function (report) {
      var events = report['events'];
      var lastBugEvent = events[events.length - 1];
      var item = document.createElement('li');

      var severity = document.createElement('i');
      severity.className = 'severity-' + report.severity.toLowerCase();

      item.appendChild(severity);
      item.appendChild(document.createTextNode(lastBugEvent.message));

      item.addEventListener('click', function () {
        that.navigate(report, item);
      })
      list.appendChild(item);
      that._navigationMenuItems.push({ report : report, widget : item });
    });

    if (!this._selectedReport && list.childNodes.length) {
      this._selectedReport = list.childNodes[0];
      this._selectedReport.classList.add('active');
    }

    nav.appendChild(list);
  },

  setReport : function (report) {
    this._currentReport = report;
    var events = report['events'];
    var lastBugEvent = events[events.length - 1];
    this.setCurrentBugEvent(lastBugEvent, events.length - 1);
    this.setCheckerName(report.checkerName);
    this.setReviewStatus(report.reviewStatus);

    window.location.hash = '#reportHash=' + report.reportHash;
  },

  setCurrentBugEvent : function (event, idx) {
    this._currentBugEvent = event;
    this.setSourceFileData(this._files[event.location.file]);
    this.drawBugPath();

    this.jumpTo(event.location.line, 0);
    this.highlightBugEvent(event, idx);
  },

  highlightBugEvent : function (event, idx) {
    this._lineWidgets.forEach(function (widget) {
      var lineIdx = widget.node.getAttribute('idx');
      if (parseInt(lineIdx) === idx) {
        widget.node.classList.add('current');
      }
    });
  },

  setCheckerName : function (checkerName) {
    this._checkerName.innerHTML = checkerName;
  },

  setReviewStatus : function (status) {
    if (status) {
      var className =
        'review-status-' + status.toLowerCase().split(' ').join('-');
      this._reviewStatus.className = "review-status " + className;

      this._reviewStatus.innerHTML = status;
      this._reviewStatusWrapper.style.display = 'block';
    } else {
      this._reviewStatusWrapper.style.display = 'none';
    }
  },

  setSourceFileData : function (file) {
    if (this._sourceFileData && file.id === this._sourceFileData.id) {
      return;
    }

    this._sourceFileData = file;
    this._filepath.innerHTML = file.path;
    this._codeMirror.doc.setValue(file.content);
    this._refresh();
  },

  _refresh : function () {
    var that = this;
    setTimeout(function () {
      var fullHeight = parseInt(that._content.clientHeight);
      var headerHeight = that._filepath.clientHeight;

      that._codeMirror.setSize('auto', fullHeight - headerHeight);
      that._codeMirror.refresh();
    }, 200);
  },

  clearBubbles : function () {
    this._lineWidgets.forEach(function (widget) { widget.clear(); });
    this._lineWidgets = [];
  },

  getMessage : function (event, kind) {
    if (kind === 'macro') {
      var name = 'macro expansion' + (event.name ? ': ' + event.name : '');

      return '<span class="tag macro">' + name + '</span>'
        + this.escapeHTML(event.expansion).replace(/(?:\r\n|\r|\n)/g, '<br>');
    } else if (kind === 'note') {
      return '<span class="tag note">note</span>'
        +  this.escapeHTML(event.message).replace(/(?:\r\n|\r|\n)/g, '<br>');
    }
  },

  addExtraPathEvents : function (events, kind) {
    var that = this;

    if (!events) {
      return;
    }

    events.forEach(function (event) {
      if (event.location.file !== that._currentBugEvent.location.file) {
        return;
      }

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + kind);

      var msg = document.createElement('span');
      msg.innerHTML = that.getMessage(event, kind);
      element.appendChild(msg);

      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  drawBugPath : function () {
    var that = this;

    this.clearBubbles();

    this.addExtraPathEvents(this._currentReport.macros, 'macro');
    this.addExtraPathEvents(this._currentReport.notes, 'note');

    // Processing bug path events.
    var currentEvents = this._currentReport.events;
    currentEvents.forEach(function (event, step) {
      if (event.location.file !== that._currentBugEvent.location.file)
        return;

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';
      var type = step === currentEvents.length - 1 ? 'error' : 'info';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + type);
      element.setAttribute('idx', step);

      var enumeration = document.createElement('span');
      enumeration.setAttribute('class', 'checker-enum ' + type);
      enumeration.innerHTML = step + 1;

      if (currentEvents.length > 1)
        element.appendChild(enumeration);

      var prevBugEvent = step - 1;
      if (step > 0) {
        var prevBug = document.createElement('span');
        prevBug.setAttribute('class', 'arrow left-arrow');
        prevBug.addEventListener('click', function () {
          var event = currentEvents[prevBugEvent];
          that.setCurrentBugEvent(event, prevBugEvent);
        });
        element.appendChild(prevBug);
      }

      var msg = document.createElement('span');
      msg.innerHTML = that.escapeHTML(event.message)
        .replace(/(?:\r\n|\r|\n)/g, '<br>');

      element.appendChild(msg);

      var nextBugEvent = step + 1;
      if (nextBugEvent < currentEvents.length) {
        var nextBug = document.createElement('span');
        nextBug.setAttribute('class', 'arrow right-arrow');
        nextBug.addEventListener('click', function () {
          var event = currentEvents[nextBugEvent];
          that.setCurrentBugEvent(event, nextBugEvent);
        });
        element.appendChild(nextBug);
      }


      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  jumpTo : function (line, column) {
    var that = this;

    setTimeout(function () {
      var selPosPixel
        = that._codeMirror.charCoords({ line : line, ch : column }, 'local');
      var editorSize = {
        width  : that._editor.clientWidth,
        height : that._editor.clientHeight
      };

      that._codeMirror.scrollIntoView({
        top    : selPosPixel.top - 100,
        bottom : selPosPixel.top + editorSize.height - 150,
        left   : selPosPixel.left < editorSize.width - 100
               ? 0
               : selPosPixel.left - 50,
        right  : selPosPixel.left < editorSize.width - 100
               ? 10
               : selPosPixel.left + editorSize.width - 100
      });
    }, 0);
  }
}


      var data = {"files": {"0": {"id": 0, "path": "/src/include/linux/platform_data/cros_ec_commands.h", "content": "/* SPDX-License-Identifier: GPL-2.0-only */\n/*\n * Host communication command constants for ChromeOS EC\n *\n * Copyright (C) 2012 Google, Inc\n *\n * NOTE: This file is auto-generated from ChromeOS EC Open Source code from\n * https://chromium.googlesource.com/chromiumos/platform/ec/+/master/include/ec_commands.h\n */\n\n/* Host communication command constants for Chrome EC */\n\n#ifndef __CROS_EC_COMMANDS_H\n#define __CROS_EC_COMMANDS_H\n\n\n\n\n#define BUILD_ASSERT(_cond)\n\n/*\n * Current version of this protocol\n *\n * TODO(crosbug.com/p/11223): This is effectively useless; protocol is\n * determined in other ways.  Remove this once the kernel code no longer\n * depends on it.\n */\n#define EC_PROTO_VERSION          0x00000002\n\n/* Command version mask */\n#define EC_VER_MASK(version) BIT(version)\n\n/* I/O addresses for ACPI commands */\n#define EC_LPC_ADDR_ACPI_DATA  0x62\n#define EC_LPC_ADDR_ACPI_CMD   0x66\n\n/* I/O addresses for host command */\n#define EC_LPC_ADDR_HOST_DATA  0x200\n#define EC_LPC_ADDR_HOST_CMD   0x204\n\n/* I/O addresses for host command args and params */\n/* Protocol version 2 */\n#define EC_LPC_ADDR_HOST_ARGS    0x800  /* And 0x801, 0x802, 0x803 */\n#define EC_LPC_ADDR_HOST_PARAM   0x804  /* For version 2 params; size is\n\t\t\t\t\t * EC_PROTO2_MAX_PARAM_SIZE\n\t\t\t\t\t */\n/* Protocol version 3 */\n#define EC_LPC_ADDR_HOST_PACKET  0x800  /* Offset of version 3 packet */\n#define EC_LPC_HOST_PACKET_SIZE  0x100  /* Max size of version 3 packet */\n\n/*\n * The actual block is 0x800-0x8ff, but some BIOSes think it's 0x880-0x8ff\n * and they tell the kernel that so we have to think of it as two parts.\n */\n#define EC_HOST_CMD_REGION0    0x800\n#define EC_HOST_CMD_REGION1    0x880\n#define EC_HOST_CMD_REGION_SIZE 0x80\n\n/* EC command register bit functions */\n#define EC_LPC_CMDR_DATA\tBIT(0)  /* Data ready for host to read */\n#define EC_LPC_CMDR_PENDING\tBIT(1)  /* Write pending to EC */\n#define EC_LPC_CMDR_BUSY\tBIT(2)  /* EC is busy processing a command */\n#define EC_LPC_CMDR_CMD\t\tBIT(3)  /* Last host write was a command */\n#define EC_LPC_CMDR_ACPI_BRST\tBIT(4)  /* Burst mode (not used) */\n#define EC_LPC_CMDR_SCI\t\tBIT(5)  /* SCI event is pending */\n#define EC_LPC_CMDR_SMI\t\tBIT(6)  /* SMI event is pending */\n\n#define EC_LPC_ADDR_MEMMAP       0x900\n#define EC_MEMMAP_SIZE         255 /* ACPI IO buffer max is 255 bytes */\n#define EC_MEMMAP_TEXT_MAX     8   /* Size of a string in the memory map */\n\n/* The offset address of each type of data in mapped memory. */\n#define EC_MEMMAP_TEMP_SENSOR      0x00 /* Temp sensors 0x00 - 0x0f */\n#define EC_MEMMAP_FAN              0x10 /* Fan speeds 0x10 - 0x17 */\n#define EC_MEMMAP_TEMP_SENSOR_B    0x18 /* More temp sensors 0x18 - 0x1f */\n#define EC_MEMMAP_ID               0x20 /* 0x20 == 'E', 0x21 == 'C' */\n#define EC_MEMMAP_ID_VERSION       0x22 /* Version of data in 0x20 - 0x2f */\n#define EC_MEMMAP_THERMAL_VERSION  0x23 /* Version of data in 0x00 - 0x1f */\n#define EC_MEMMAP_BATTERY_VERSION  0x24 /* Version of data in 0x40 - 0x7f */\n#define EC_MEMMAP_SWITCHES_VERSION 0x25 /* Version of data in 0x30 - 0x33 */\n#define EC_MEMMAP_EVENTS_VERSION   0x26 /* Version of data in 0x34 - 0x3f */\n#define EC_MEMMAP_HOST_CMD_FLAGS   0x27 /* Host cmd interface flags (8 bits) */\n/* Unused 0x28 - 0x2f */\n#define EC_MEMMAP_SWITCHES         0x30\t/* 8 bits */\n/* Unused 0x31 - 0x33 */\n#define EC_MEMMAP_HOST_EVENTS      0x34 /* 64 bits */\n/* Battery values are all 32 bits, unless otherwise noted. */\n#define EC_MEMMAP_BATT_VOLT        0x40 /* Battery Present Voltage */\n#define EC_MEMMAP_BATT_RATE        0x44 /* Battery Present Rate */\n#define EC_MEMMAP_BATT_CAP         0x48 /* Battery Remaining Capacity */\n#define EC_MEMMAP_BATT_FLAG        0x4c /* Battery State, see below (8-bit) */\n#define EC_MEMMAP_BATT_COUNT       0x4d /* Battery Count (8-bit) */\n#define EC_MEMMAP_BATT_INDEX       0x4e /* Current Battery Data Index (8-bit) */\n/* Unused 0x4f */\n#define EC_MEMMAP_BATT_DCAP        0x50 /* Battery Design Capacity */\n#define EC_MEMMAP_BATT_DVLT        0x54 /* Battery Design Voltage */\n#define EC_MEMMAP_BATT_LFCC        0x58 /* Battery Last Full Charge Capacity */\n#define EC_MEMMAP_BATT_CCNT        0x5c /* Battery Cycle Count */\n/* Strings are all 8 bytes (EC_MEMMAP_TEXT_MAX) */\n#define EC_MEMMAP_BATT_MFGR        0x60 /* Battery Manufacturer String */\n#define EC_MEMMAP_BATT_MODEL       0x68 /* Battery Model Number String */\n#define EC_MEMMAP_BATT_SERIAL      0x70 /* Battery Serial Number String */\n#define EC_MEMMAP_BATT_TYPE        0x78 /* Battery Type String */\n#define EC_MEMMAP_ALS              0x80 /* ALS readings in lux (2 X 16 bits) */\n/* Unused 0x84 - 0x8f */\n#define EC_MEMMAP_ACC_STATUS       0x90 /* Accelerometer status (8 bits )*/\n/* Unused 0x91 */\n#define EC_MEMMAP_ACC_DATA         0x92 /* Accelerometers data 0x92 - 0x9f */\n/* 0x92: Lid Angle if available, LID_ANGLE_UNRELIABLE otherwise */\n/* 0x94 - 0x99: 1st Accelerometer */\n/* 0x9a - 0x9f: 2nd Accelerometer */\n#define EC_MEMMAP_GYRO_DATA        0xa0 /* Gyroscope data 0xa0 - 0xa5 */\n/* Unused 0xa6 - 0xdf */\n\n/*\n * ACPI is unable to access memory mapped data at or above this offset due to\n * limitations of the ACPI protocol. Do not place data in the range 0xe0 - 0xfe\n * which might be needed by ACPI.\n */\n#define EC_MEMMAP_NO_ACPI 0xe0\n\n/* Define the format of the accelerometer mapped memory status byte. */\n#define EC_MEMMAP_ACC_STATUS_SAMPLE_ID_MASK  0x0f\n#define EC_MEMMAP_ACC_STATUS_BUSY_BIT        BIT(4)\n#define EC_MEMMAP_ACC_STATUS_PRESENCE_BIT    BIT(7)\n\n/* Number of temp sensors at EC_MEMMAP_TEMP_SENSOR */\n#define EC_TEMP_SENSOR_ENTRIES     16\n/*\n * Number of temp sensors at EC_MEMMAP_TEMP_SENSOR_B.\n *\n * Valid only if EC_MEMMAP_THERMAL_VERSION returns >= 2.\n */\n#define EC_TEMP_SENSOR_B_ENTRIES      8\n\n/* Special values for mapped temperature sensors */\n#define EC_TEMP_SENSOR_NOT_PRESENT    0xff\n#define EC_TEMP_SENSOR_ERROR          0xfe\n#define EC_TEMP_SENSOR_NOT_POWERED    0xfd\n#define EC_TEMP_SENSOR_NOT_CALIBRATED 0xfc\n/*\n * The offset of temperature value stored in mapped memory.  This allows\n * reporting a temperature range of 200K to 454K = -73C to 181C.\n */\n#define EC_TEMP_SENSOR_OFFSET      200\n\n/*\n * Number of ALS readings at EC_MEMMAP_ALS\n */\n#define EC_ALS_ENTRIES             2\n\n/*\n * The default value a temperature sensor will return when it is present but\n * has not been read this boot.  This is a reasonable number to avoid\n * triggering alarms on the host.\n */\n#define EC_TEMP_SENSOR_DEFAULT     (296 - EC_TEMP_SENSOR_OFFSET)\n\n#define EC_FAN_SPEED_ENTRIES       4       /* Number of fans at EC_MEMMAP_FAN */\n#define EC_FAN_SPEED_NOT_PRESENT   0xffff  /* Entry not present */\n#define EC_FAN_SPEED_STALLED       0xfffe  /* Fan stalled */\n\n/* Battery bit flags at EC_MEMMAP_BATT_FLAG. */\n#define EC_BATT_FLAG_AC_PRESENT   0x01\n#define EC_BATT_FLAG_BATT_PRESENT 0x02\n#define EC_BATT_FLAG_DISCHARGING  0x04\n#define EC_BATT_FLAG_CHARGING     0x08\n#define EC_BATT_FLAG_LEVEL_CRITICAL 0x10\n/* Set if some of the static/dynamic data is invalid (or outdated). */\n#define EC_BATT_FLAG_INVALID_DATA 0x20\n\n/* Switch flags at EC_MEMMAP_SWITCHES */\n#define EC_SWITCH_LID_OPEN               0x01\n#define EC_SWITCH_POWER_BUTTON_PRESSED   0x02\n#define EC_SWITCH_WRITE_PROTECT_DISABLED 0x04\n/* Was recovery requested via keyboard; now unused. */\n#define EC_SWITCH_IGNORE1\t\t 0x08\n/* Recovery requested via dedicated signal (from servo board) */\n#define EC_SWITCH_DEDICATED_RECOVERY     0x10\n/* Was fake developer mode switch; now unused.  Remove in next refactor. */\n#define EC_SWITCH_IGNORE0                0x20\n\n/* Host command interface flags */\n/* Host command interface supports LPC args (LPC interface only) */\n#define EC_HOST_CMD_FLAG_LPC_ARGS_SUPPORTED  0x01\n/* Host command interface supports version 3 protocol */\n#define EC_HOST_CMD_FLAG_VERSION_3   0x02\n\n/* Wireless switch flags */\n#define EC_WIRELESS_SWITCH_ALL       ~0x00  /* All flags */\n#define EC_WIRELESS_SWITCH_WLAN       0x01  /* WLAN radio */\n#define EC_WIRELESS_SWITCH_BLUETOOTH  0x02  /* Bluetooth radio */\n#define EC_WIRELESS_SWITCH_WWAN       0x04  /* WWAN power */\n#define EC_WIRELESS_SWITCH_WLAN_POWER 0x08  /* WLAN power */\n\n/*****************************************************************************/\n/*\n * ACPI commands\n *\n * These are valid ONLY on the ACPI command/data port.\n */\n\n/*\n * ACPI Read Embedded Controller\n *\n * This reads from ACPI memory space on the EC (EC_ACPI_MEM_*).\n *\n * Use the following sequence:\n *\n *    - Write EC_CMD_ACPI_READ to EC_LPC_ADDR_ACPI_CMD\n *    - Wait for EC_LPC_CMDR_PENDING bit to clear\n *    - Write address to EC_LPC_ADDR_ACPI_DATA\n *    - Wait for EC_LPC_CMDR_DATA bit to set\n *    - Read value from EC_LPC_ADDR_ACPI_DATA\n */\n#define EC_CMD_ACPI_READ 0x0080\n\n/*\n * ACPI Write Embedded Controller\n *\n * This reads from ACPI memory space on the EC (EC_ACPI_MEM_*).\n *\n * Use the following sequence:\n *\n *    - Write EC_CMD_ACPI_WRITE to EC_LPC_ADDR_ACPI_CMD\n *    - Wait for EC_LPC_CMDR_PENDING bit to clear\n *    - Write address to EC_LPC_ADDR_ACPI_DATA\n *    - Wait for EC_LPC_CMDR_PENDING bit to clear\n *    - Write value to EC_LPC_ADDR_ACPI_DATA\n */\n#define EC_CMD_ACPI_WRITE 0x0081\n\n/*\n * ACPI Burst Enable Embedded Controller\n *\n * This enables burst mode on the EC to allow the host to issue several\n * commands back-to-back. While in this mode, writes to mapped multi-byte\n * data are locked out to ensure data consistency.\n */\n#define EC_CMD_ACPI_BURST_ENABLE 0x0082\n\n/*\n * ACPI Burst Disable Embedded Controller\n *\n * This disables burst mode on the EC and stops preventing EC writes to mapped\n * multi-byte data.\n */\n#define EC_CMD_ACPI_BURST_DISABLE 0x0083\n\n/*\n * ACPI Query Embedded Controller\n *\n * This clears the lowest-order bit in the currently pending host events, and\n * sets the result code to the 1-based index of the bit (event 0x00000001 = 1,\n * event 0x80000000 = 32), or 0 if no event was pending.\n */\n#define EC_CMD_ACPI_QUERY_EVENT 0x0084\n\n/* Valid addresses in ACPI memory space, for read/write commands */\n\n/* Memory space version; set to EC_ACPI_MEM_VERSION_CURRENT */\n#define EC_ACPI_MEM_VERSION            0x00\n/*\n * Test location; writing value here updates test compliment byte to (0xff -\n * value).\n */\n#define EC_ACPI_MEM_TEST               0x01\n/* Test compliment; writes here are ignored. */\n#define EC_ACPI_MEM_TEST_COMPLIMENT    0x02\n\n/* Keyboard backlight brightness percent (0 - 100) */\n#define EC_ACPI_MEM_KEYBOARD_BACKLIGHT 0x03\n/* DPTF Target Fan Duty (0-100, 0xff for auto/none) */\n#define EC_ACPI_MEM_FAN_DUTY           0x04\n\n/*\n * DPTF temp thresholds. Any of the EC's temp sensors can have up to two\n * independent thresholds attached to them. The current value of the ID\n * register determines which sensor is affected by the THRESHOLD and COMMIT\n * registers. The THRESHOLD register uses the same EC_TEMP_SENSOR_OFFSET scheme\n * as the memory-mapped sensors. The COMMIT register applies those settings.\n *\n * The spec does not mandate any way to read back the threshold settings\n * themselves, but when a threshold is crossed the AP needs a way to determine\n * which sensor(s) are responsible. Each reading of the ID register clears and\n * returns one sensor ID that has crossed one of its threshold (in either\n * direction) since the last read. A value of 0xFF means \"no new thresholds\n * have tripped\". Setting or enabling the thresholds for a sensor will clear\n * the unread event count for that sensor.\n */\n#define EC_ACPI_MEM_TEMP_ID            0x05\n#define EC_ACPI_MEM_TEMP_THRESHOLD     0x06\n#define EC_ACPI_MEM_TEMP_COMMIT        0x07\n/*\n * Here are the bits for the COMMIT register:\n *   bit 0 selects the threshold index for the chosen sensor (0/1)\n *   bit 1 enables/disables the selected threshold (0 = off, 1 = on)\n * Each write to the commit register affects one threshold.\n */\n#define EC_ACPI_MEM_TEMP_COMMIT_SELECT_MASK BIT(0)\n#define EC_ACPI_MEM_TEMP_COMMIT_ENABLE_MASK BIT(1)\n/*\n * Example:\n *\n * Set the thresholds for sensor 2 to 50 C and 60 C:\n *   write 2 to [0x05]      --  select temp sensor 2\n *   write 0x7b to [0x06]   --  C_TO_K(50) - EC_TEMP_SENSOR_OFFSET\n *   write 0x2 to [0x07]    --  enable threshold 0 with this value\n *   write 0x85 to [0x06]   --  C_TO_K(60) - EC_TEMP_SENSOR_OFFSET\n *   write 0x3 to [0x07]    --  enable threshold 1 with this value\n *\n * Disable the 60 C threshold, leaving the 50 C threshold unchanged:\n *   write 2 to [0x05]      --  select temp sensor 2\n *   write 0x1 to [0x07]    --  disable threshold 1\n */\n\n/* DPTF battery charging current limit */\n#define EC_ACPI_MEM_CHARGING_LIMIT     0x08\n\n/* Charging limit is specified in 64 mA steps */\n#define EC_ACPI_MEM_CHARGING_LIMIT_STEP_MA   64\n/* Value to disable DPTF battery charging limit */\n#define EC_ACPI_MEM_CHARGING_LIMIT_DISABLED  0xff\n\n/*\n * Report device orientation\n *  Bits       Definition\n *  3:1        Device DPTF Profile Number (DDPN)\n *               0   = Reserved for backward compatibility (indicates no valid\n *                     profile number. Host should fall back to using TBMD).\n *              1..7 = DPTF Profile number to indicate to host which table needs\n *                     to be loaded.\n *   0         Tablet Mode Device Indicator (TBMD)\n */\n#define EC_ACPI_MEM_DEVICE_ORIENTATION 0x09\n#define EC_ACPI_MEM_TBMD_SHIFT         0\n#define EC_ACPI_MEM_TBMD_MASK          0x1\n#define EC_ACPI_MEM_DDPN_SHIFT         1\n#define EC_ACPI_MEM_DDPN_MASK          0x7\n\n/*\n * Report device features. Uses the same format as the host command, except:\n *\n * bit 0 (EC_FEATURE_LIMITED) changes meaning from \"EC code has a limited set\n * of features\", which is of limited interest when the system is already\n * interpreting ACPI bytecode, to \"EC_FEATURES[0-7] is not supported\". Since\n * these are supported, it defaults to 0.\n * This allows detecting the presence of this field since older versions of\n * the EC codebase would simply return 0xff to that unknown address. Check\n * FEATURES0 != 0xff (or FEATURES0[0] == 0) to make sure that the other bits\n * are valid.\n */\n#define EC_ACPI_MEM_DEVICE_FEATURES0 0x0a\n#define EC_ACPI_MEM_DEVICE_FEATURES1 0x0b\n#define EC_ACPI_MEM_DEVICE_FEATURES2 0x0c\n#define EC_ACPI_MEM_DEVICE_FEATURES3 0x0d\n#define EC_ACPI_MEM_DEVICE_FEATURES4 0x0e\n#define EC_ACPI_MEM_DEVICE_FEATURES5 0x0f\n#define EC_ACPI_MEM_DEVICE_FEATURES6 0x10\n#define EC_ACPI_MEM_DEVICE_FEATURES7 0x11\n\n#define EC_ACPI_MEM_BATTERY_INDEX    0x12\n\n/*\n * USB Port Power. Each bit indicates whether the corresponding USB ports' power\n * is enabled (1) or disabled (0).\n *   bit 0 USB port ID 0\n *   ...\n *   bit 7 USB port ID 7\n */\n#define EC_ACPI_MEM_USB_PORT_POWER 0x13\n\n/*\n * ACPI addresses 0x20 - 0xff map to EC_MEMMAP offset 0x00 - 0xdf.  This data\n * is read-only from the AP.  Added in EC_ACPI_MEM_VERSION 2.\n */\n#define EC_ACPI_MEM_MAPPED_BEGIN   0x20\n#define EC_ACPI_MEM_MAPPED_SIZE    0xe0\n\n/* Current version of ACPI memory address space */\n#define EC_ACPI_MEM_VERSION_CURRENT 2\n\n\n/*\n * This header file is used in coreboot both in C and ACPI code.  The ACPI code\n * is pre-processed to handle constants but the ASL compiler is unable to\n * handle actual C code so keep it separate.\n */\n\n\n/*\n * Attributes for EC request and response packets.  Just defining __packed\n * results in inefficient assembly code on ARM, if the structure is actually\n * 32-bit aligned, as it should be for all buffers.\n *\n * Be very careful when adding these to existing structures.  They will round\n * up the structure size to the specified boundary.\n *\n * Also be very careful to make that if a structure is included in some other\n * parent structure that the alignment will still be true given the packing of\n * the parent structure.  This is particularly important if the sub-structure\n * will be passed as a pointer to another function, since that function will\n * not know about the misaligment caused by the parent structure's packing.\n *\n * Also be very careful using __packed - particularly when nesting non-packed\n * structures inside packed ones.  In fact, DO NOT use __packed directly;\n * always use one of these attributes.\n *\n * Once everything is annotated properly, the following search strings should\n * not return ANY matches in this file other than right here:\n *\n * \"__packed\" - generates inefficient code; all sub-structs must also be packed\n *\n * \"struct [^_]\" - all structs should be annotated, except for structs that are\n * members of other structs/unions (and their original declarations should be\n * annotated).\n */\n\n/*\n * Packed structures make no assumption about alignment, so they do inefficient\n * byte-wise reads.\n */\n#define __ec_align1 __packed\n#define __ec_align2 __packed\n#define __ec_align4 __packed\n#define __ec_align_size1 __packed\n#define __ec_align_offset1 __packed\n#define __ec_align_offset2 __packed\n#define __ec_todo_packed __packed\n#define __ec_todo_unpacked\n\n\n/* LPC command status byte masks */\n/* EC has written a byte in the data register and host hasn't read it yet */\n#define EC_LPC_STATUS_TO_HOST     0x01\n/* Host has written a command/data byte and the EC hasn't read it yet */\n#define EC_LPC_STATUS_FROM_HOST   0x02\n/* EC is processing a command */\n#define EC_LPC_STATUS_PROCESSING  0x04\n/* Last write to EC was a command, not data */\n#define EC_LPC_STATUS_LAST_CMD    0x08\n/* EC is in burst mode */\n#define EC_LPC_STATUS_BURST_MODE  0x10\n/* SCI event is pending (requesting SCI query) */\n#define EC_LPC_STATUS_SCI_PENDING 0x20\n/* SMI event is pending (requesting SMI query) */\n#define EC_LPC_STATUS_SMI_PENDING 0x40\n/* (reserved) */\n#define EC_LPC_STATUS_RESERVED    0x80\n\n/*\n * EC is busy.  This covers both the EC processing a command, and the host has\n * written a new command but the EC hasn't picked it up yet.\n */\n#define EC_LPC_STATUS_BUSY_MASK \\\n\t(EC_LPC_STATUS_FROM_HOST | EC_LPC_STATUS_PROCESSING)\n\n/*\n * Host command response codes (16-bit).  Note that response codes should be\n * stored in a uint16_t rather than directly in a value of this type.\n */\nenum ec_status {\n\tEC_RES_SUCCESS = 0,\n\tEC_RES_INVALID_COMMAND = 1,\n\tEC_RES_ERROR = 2,\n\tEC_RES_INVALID_PARAM = 3,\n\tEC_RES_ACCESS_DENIED = 4,\n\tEC_RES_INVALID_RESPONSE = 5,\n\tEC_RES_INVALID_VERSION = 6,\n\tEC_RES_INVALID_CHECKSUM = 7,\n\tEC_RES_IN_PROGRESS = 8,\t\t/* Accepted, command in progress */\n\tEC_RES_UNAVAILABLE = 9,\t\t/* No response available */\n\tEC_RES_TIMEOUT = 10,\t\t/* We got a timeout */\n\tEC_RES_OVERFLOW = 11,\t\t/* Table / data overflow */\n\tEC_RES_INVALID_HEADER = 12,     /* Header contains invalid data */\n\tEC_RES_REQUEST_TRUNCATED = 13,  /* Didn't get the entire request */\n\tEC_RES_RESPONSE_TOO_BIG = 14,   /* Response was too big to handle */\n\tEC_RES_BUS_ERROR = 15,\t\t/* Communications bus error */\n\tEC_RES_BUSY = 16,\t\t/* Up but too busy.  Should retry */\n\tEC_RES_INVALID_HEADER_VERSION = 17,  /* Header version invalid */\n\tEC_RES_INVALID_HEADER_CRC = 18,      /* Header CRC invalid */\n\tEC_RES_INVALID_DATA_CRC = 19,        /* Data CRC invalid */\n\tEC_RES_DUP_UNAVAILABLE = 20,         /* Can't resend response */\n};\n\n/*\n * Host event codes.  Note these are 1-based, not 0-based, because ACPI query\n * EC command uses code 0 to mean \"no event pending\".  We explicitly specify\n * each value in the enum listing so they won't change if we delete/insert an\n * item or rearrange the list (it needs to be stable across platforms, not\n * just within a single compiled instance).\n */\nenum host_event_code {\n\tEC_HOST_EVENT_LID_CLOSED = 1,\n\tEC_HOST_EVENT_LID_OPEN = 2,\n\tEC_HOST_EVENT_POWER_BUTTON = 3,\n\tEC_HOST_EVENT_AC_CONNECTED = 4,\n\tEC_HOST_EVENT_AC_DISCONNECTED = 5,\n\tEC_HOST_EVENT_BATTERY_LOW = 6,\n\tEC_HOST_EVENT_BATTERY_CRITICAL = 7,\n\tEC_HOST_EVENT_BATTERY = 8,\n\tEC_HOST_EVENT_THERMAL_THRESHOLD = 9,\n\t/* Event generated by a device attached to the EC */\n\tEC_HOST_EVENT_DEVICE = 10,\n\tEC_HOST_EVENT_THERMAL = 11,\n\tEC_HOST_EVENT_USB_CHARGER = 12,\n\tEC_HOST_EVENT_KEY_PRESSED = 13,\n\t/*\n\t * EC has finished initializing the host interface.  The host can check\n\t * for this event following sending a EC_CMD_REBOOT_EC command to\n\t * determine when the EC is ready to accept subsequent commands.\n\t */\n\tEC_HOST_EVENT_INTERFACE_READY = 14,\n\t/* Keyboard recovery combo has been pressed */\n\tEC_HOST_EVENT_KEYBOARD_RECOVERY = 15,\n\n\t/* Shutdown due to thermal overload */\n\tEC_HOST_EVENT_THERMAL_SHUTDOWN = 16,\n\t/* Shutdown due to battery level too low */\n\tEC_HOST_EVENT_BATTERY_SHUTDOWN = 17,\n\n\t/* Suggest that the AP throttle itself */\n\tEC_HOST_EVENT_THROTTLE_START = 18,\n\t/* Suggest that the AP resume normal speed */\n\tEC_HOST_EVENT_THROTTLE_STOP = 19,\n\n\t/* Hang detect logic detected a hang and host event timeout expired */\n\tEC_HOST_EVENT_HANG_DETECT = 20,\n\t/* Hang detect logic detected a hang and warm rebooted the AP */\n\tEC_HOST_EVENT_HANG_REBOOT = 21,\n\n\t/* PD MCU triggering host event */\n\tEC_HOST_EVENT_PD_MCU = 22,\n\n\t/* Battery Status flags have changed */\n\tEC_HOST_EVENT_BATTERY_STATUS = 23,\n\n\t/* EC encountered a panic, triggering a reset */\n\tEC_HOST_EVENT_PANIC = 24,\n\n\t/* Keyboard fastboot combo has been pressed */\n\tEC_HOST_EVENT_KEYBOARD_FASTBOOT = 25,\n\n\t/* EC RTC event occurred */\n\tEC_HOST_EVENT_RTC = 26,\n\n\t/* Emulate MKBP event */\n\tEC_HOST_EVENT_MKBP = 27,\n\n\t/* EC desires to change state of host-controlled USB mux */\n\tEC_HOST_EVENT_USB_MUX = 28,\n\n\t/* TABLET/LAPTOP mode or detachable base attach/detach event */\n\tEC_HOST_EVENT_MODE_CHANGE = 29,\n\n\t/* Keyboard recovery combo with hardware reinitialization */\n\tEC_HOST_EVENT_KEYBOARD_RECOVERY_HW_REINIT = 30,\n\n\t/* WoV */\n\tEC_HOST_EVENT_WOV = 31,\n\n\t/*\n\t * The high bit of the event mask is not used as a host event code.  If\n\t * it reads back as set, then the entire event mask should be\n\t * considered invalid by the host.  This can happen when reading the\n\t * raw event status via EC_MEMMAP_HOST_EVENTS but the LPC interface is\n\t * not initialized on the EC, or improperly configured on the host.\n\t */\n\tEC_HOST_EVENT_INVALID = 32\n};\n/* Host event mask */\n#define EC_HOST_EVENT_MASK(event_code) BIT_ULL((event_code) - 1)\n\n/**\n * struct ec_lpc_host_args - Arguments at EC_LPC_ADDR_HOST_ARGS\n * @flags: The host argument flags.\n * @command_version: Command version.\n * @data_size: The length of data.\n * @checksum: Checksum; sum of command + flags + command_version + data_size +\n *            all params/response data bytes.\n */\nstruct ec_lpc_host_args {\n\tuint8_t flags;\n\tuint8_t command_version;\n\tuint8_t data_size;\n\tuint8_t checksum;\n} __ec_align4;\n\n/* Flags for ec_lpc_host_args.flags */\n/*\n * Args are from host.  Data area at EC_LPC_ADDR_HOST_PARAM contains command\n * params.\n *\n * If EC gets a command and this flag is not set, this is an old-style command.\n * Command version is 0 and params from host are at EC_LPC_ADDR_OLD_PARAM with\n * unknown length.  EC must respond with an old-style response (that is,\n * without setting EC_HOST_ARGS_FLAG_TO_HOST).\n */\n#define EC_HOST_ARGS_FLAG_FROM_HOST 0x01\n/*\n * Args are from EC.  Data area at EC_LPC_ADDR_HOST_PARAM contains response.\n *\n * If EC responds to a command and this flag is not set, this is an old-style\n * response.  Command version is 0 and response data from EC is at\n * EC_LPC_ADDR_OLD_PARAM with unknown length.\n */\n#define EC_HOST_ARGS_FLAG_TO_HOST   0x02\n\n/*****************************************************************************/\n/*\n * Byte codes returned by EC over SPI interface.\n *\n * These can be used by the AP to debug the EC interface, and to determine\n * when the EC is not in a state where it will ever get around to responding\n * to the AP.\n *\n * Example of sequence of bytes read from EC for a current good transfer:\n *   1. -                  - AP asserts chip select (CS#)\n *   2. EC_SPI_OLD_READY   - AP sends first byte(s) of request\n *   3. -                  - EC starts handling CS# interrupt\n *   4. EC_SPI_RECEIVING   - AP sends remaining byte(s) of request\n *   5. EC_SPI_PROCESSING  - EC starts processing request; AP is clocking in\n *                           bytes looking for EC_SPI_FRAME_START\n *   6. -                  - EC finishes processing and sets up response\n *   7. EC_SPI_FRAME_START - AP reads frame byte\n *   8. (response packet)  - AP reads response packet\n *   9. EC_SPI_PAST_END    - Any additional bytes read by AP\n *   10 -                  - AP deasserts chip select\n *   11 -                  - EC processes CS# interrupt and sets up DMA for\n *                           next request\n *\n * If the AP is waiting for EC_SPI_FRAME_START and sees any value other than\n * the following byte values:\n *   EC_SPI_OLD_READY\n *   EC_SPI_RX_READY\n *   EC_SPI_RECEIVING\n *   EC_SPI_PROCESSING\n *\n * Then the EC found an error in the request, or was not ready for the request\n * and lost data.  The AP should give up waiting for EC_SPI_FRAME_START,\n * because the EC is unable to tell when the AP is done sending its request.\n */\n\n/*\n * Framing byte which precedes a response packet from the EC.  After sending a\n * request, the AP will clock in bytes until it sees the framing byte, then\n * clock in the response packet.\n */\n#define EC_SPI_FRAME_START    0xec\n\n/*\n * Padding bytes which are clocked out after the end of a response packet.\n */\n#define EC_SPI_PAST_END       0xed\n\n/*\n * EC is ready to receive, and has ignored the byte sent by the AP.  EC expects\n * that the AP will send a valid packet header (starting with\n * EC_COMMAND_PROTOCOL_3) in the next 32 bytes.\n */\n#define EC_SPI_RX_READY       0xf8\n\n/*\n * EC has started receiving the request from the AP, but hasn't started\n * processing it yet.\n */\n#define EC_SPI_RECEIVING      0xf9\n\n/* EC has received the entire request from the AP and is processing it. */\n#define EC_SPI_PROCESSING     0xfa\n\n/*\n * EC received bad data from the AP, such as a packet header with an invalid\n * length.  EC will ignore all data until chip select deasserts.\n */\n#define EC_SPI_RX_BAD_DATA    0xfb\n\n/*\n * EC received data from the AP before it was ready.  That is, the AP asserted\n * chip select and started clocking data before the EC was ready to receive it.\n * EC will ignore all data until chip select deasserts.\n */\n#define EC_SPI_NOT_READY      0xfc\n\n/*\n * EC was ready to receive a request from the AP.  EC has treated the byte sent\n * by the AP as part of a request packet, or (for old-style ECs) is processing\n * a fully received packet but is not ready to respond yet.\n */\n#define EC_SPI_OLD_READY      0xfd\n\n/*****************************************************************************/\n\n/*\n * Protocol version 2 for I2C and SPI send a request this way:\n *\n *\t0\tEC_CMD_VERSION0 + (command version)\n *\t1\tCommand number\n *\t2\tLength of params = N\n *\t3..N+2\tParams, if any\n *\tN+3\t8-bit checksum of bytes 0..N+2\n *\n * The corresponding response is:\n *\n *\t0\tResult code (EC_RES_*)\n *\t1\tLength of params = M\n *\t2..M+1\tParams, if any\n *\tM+2\t8-bit checksum of bytes 0..M+1\n */\n#define EC_PROTO2_REQUEST_HEADER_BYTES 3\n#define EC_PROTO2_REQUEST_TRAILER_BYTES 1\n#define EC_PROTO2_REQUEST_OVERHEAD (EC_PROTO2_REQUEST_HEADER_BYTES +\t\\\n\t\t\t\t    EC_PROTO2_REQUEST_TRAILER_BYTES)\n\n#define EC_PROTO2_RESPONSE_HEADER_BYTES 2\n#define EC_PROTO2_RESPONSE_TRAILER_BYTES 1\n#define EC_PROTO2_RESPONSE_OVERHEAD (EC_PROTO2_RESPONSE_HEADER_BYTES +\t\\\n\t\t\t\t     EC_PROTO2_RESPONSE_TRAILER_BYTES)\n\n/* Parameter length was limited by the LPC interface */\n#define EC_PROTO2_MAX_PARAM_SIZE 0xfc\n\n/* Maximum request and response packet sizes for protocol version 2 */\n#define EC_PROTO2_MAX_REQUEST_SIZE (EC_PROTO2_REQUEST_OVERHEAD +\t\\\n\t\t\t\t    EC_PROTO2_MAX_PARAM_SIZE)\n#define EC_PROTO2_MAX_RESPONSE_SIZE (EC_PROTO2_RESPONSE_OVERHEAD +\t\\\n\t\t\t\t     EC_PROTO2_MAX_PARAM_SIZE)\n\n/*****************************************************************************/\n\n/*\n * Value written to legacy command port / prefix byte to indicate protocol\n * 3+ structs are being used.  Usage is bus-dependent.\n */\n#define EC_COMMAND_PROTOCOL_3 0xda\n\n#define EC_HOST_REQUEST_VERSION 3\n\n/**\n * struct ec_host_request - Version 3 request from host.\n * @struct_version: Should be 3. The EC will return EC_RES_INVALID_HEADER if it\n *                  receives a header with a version it doesn't know how to\n *                  parse.\n * @checksum: Checksum of request and data; sum of all bytes including checksum\n *            should total to 0.\n * @command: Command to send (EC_CMD_...)\n * @command_version: Command version.\n * @reserved: Unused byte in current protocol version; set to 0.\n * @data_len: Length of data which follows this header.\n */\nstruct ec_host_request {\n\tuint8_t struct_version;\n\tuint8_t checksum;\n\tuint16_t command;\n\tuint8_t command_version;\n\tuint8_t reserved;\n\tuint16_t data_len;\n} __ec_align4;\n\n#define EC_HOST_RESPONSE_VERSION 3\n\n/**\n * struct ec_host_response - Version 3 response from EC.\n * @struct_version: Struct version (=3).\n * @checksum: Checksum of response and data; sum of all bytes including\n *            checksum should total to 0.\n * @result: EC's response to the command (separate from communication failure)\n * @data_len: Length of data which follows this header.\n * @reserved: Unused bytes in current protocol version; set to 0.\n */\nstruct ec_host_response {\n\tuint8_t struct_version;\n\tuint8_t checksum;\n\tuint16_t result;\n\tuint16_t data_len;\n\tuint16_t reserved;\n} __ec_align4;\n\n/*****************************************************************************/\n\n/*\n * Host command protocol V4.\n *\n * Packets always start with a request or response header.  They are followed\n * by data_len bytes of data.  If the data_crc_present flag is set, the data\n * bytes are followed by a CRC-8 of that data, using using x^8 + x^2 + x + 1\n * polynomial.\n *\n * Host algorithm when sending a request q:\n *\n * 101) tries_left=(some value, e.g. 3);\n * 102) q.seq_num++\n * 103) q.seq_dup=0\n * 104) Calculate q.header_crc.\n * 105) Send request q to EC.\n * 106) Wait for response r.  Go to 201 if received or 301 if timeout.\n *\n * 201) If r.struct_version != 4, go to 301.\n * 202) If r.header_crc mismatches calculated CRC for r header, go to 301.\n * 203) If r.data_crc_present and r.data_crc mismatches, go to 301.\n * 204) If r.seq_num != q.seq_num, go to 301.\n * 205) If r.seq_dup == q.seq_dup, return success.\n * 207) If r.seq_dup == 1, go to 301.\n * 208) Return error.\n *\n * 301) If --tries_left <= 0, return error.\n * 302) If q.seq_dup == 1, go to 105.\n * 303) q.seq_dup = 1\n * 304) Go to 104.\n *\n * EC algorithm when receiving a request q.\n * EC has response buffer r, error buffer e.\n *\n * 101) If q.struct_version != 4, set e.result = EC_RES_INVALID_HEADER_VERSION\n *      and go to 301\n * 102) If q.header_crc mismatches calculated CRC, set e.result =\n *      EC_RES_INVALID_HEADER_CRC and go to 301\n * 103) If q.data_crc_present, calculate data CRC.  If that mismatches the CRC\n *      byte at the end of the packet, set e.result = EC_RES_INVALID_DATA_CRC\n *      and go to 301.\n * 104) If q.seq_dup == 0, go to 201.\n * 105) If q.seq_num != r.seq_num, go to 201.\n * 106) If q.seq_dup == r.seq_dup, go to 205, else go to 203.\n *\n * 201) Process request q into response r.\n * 202) r.seq_num = q.seq_num\n * 203) r.seq_dup = q.seq_dup\n * 204) Calculate r.header_crc\n * 205) If r.data_len > 0 and data is no longer available, set e.result =\n *      EC_RES_DUP_UNAVAILABLE and go to 301.\n * 206) Send response r.\n *\n * 301) e.seq_num = q.seq_num\n * 302) e.seq_dup = q.seq_dup\n * 303) Calculate e.header_crc.\n * 304) Send error response e.\n */\n\n/* Version 4 request from host */\nstruct ec_host_request4 {\n\t/*\n\t * bits 0-3: struct_version: Structure version (=4)\n\t * bit    4: is_response: Is response (=0)\n\t * bits 5-6: seq_num: Sequence number\n\t * bit    7: seq_dup: Sequence duplicate flag\n\t */\n\tuint8_t fields0;\n\n\t/*\n\t * bits 0-4: command_version: Command version\n\t * bits 5-6: Reserved (set 0, ignore on read)\n\t * bit    7: data_crc_present: Is data CRC present after data\n\t */\n\tuint8_t fields1;\n\n\t/* Command code (EC_CMD_*) */\n\tuint16_t command;\n\n\t/* Length of data which follows this header (not including data CRC) */\n\tuint16_t data_len;\n\n\t/* Reserved (set 0, ignore on read) */\n\tuint8_t reserved;\n\n\t/* CRC-8 of above fields, using x^8 + x^2 + x + 1 polynomial */\n\tuint8_t header_crc;\n} __ec_align4;\n\n/* Version 4 response from EC */\nstruct ec_host_response4 {\n\t/*\n\t * bits 0-3: struct_version: Structure version (=4)\n\t * bit    4: is_response: Is response (=1)\n\t * bits 5-6: seq_num: Sequence number\n\t * bit    7: seq_dup: Sequence duplicate flag\n\t */\n\tuint8_t fields0;\n\n\t/*\n\t * bits 0-6: Reserved (set 0, ignore on read)\n\t * bit    7: data_crc_present: Is data CRC present after data\n\t */\n\tuint8_t fields1;\n\n\t/* Result code (EC_RES_*) */\n\tuint16_t result;\n\n\t/* Length of data which follows this header (not including data CRC) */\n\tuint16_t data_len;\n\n\t/* Reserved (set 0, ignore on read) */\n\tuint8_t reserved;\n\n\t/* CRC-8 of above fields, using x^8 + x^2 + x + 1 polynomial */\n\tuint8_t header_crc;\n} __ec_align4;\n\n/* Fields in fields0 byte */\n#define EC_PACKET4_0_STRUCT_VERSION_MASK\t0x0f\n#define EC_PACKET4_0_IS_RESPONSE_MASK\t\t0x10\n#define EC_PACKET4_0_SEQ_NUM_SHIFT\t\t5\n#define EC_PACKET4_0_SEQ_NUM_MASK\t\t0x60\n#define EC_PACKET4_0_SEQ_DUP_MASK\t\t0x80\n\n/* Fields in fields1 byte */\n#define EC_PACKET4_1_COMMAND_VERSION_MASK\t0x1f  /* (request only) */\n#define EC_PACKET4_1_DATA_CRC_PRESENT_MASK\t0x80\n\n/*****************************************************************************/\n/*\n * Notes on commands:\n *\n * Each command is an 16-bit command value.  Commands which take params or\n * return response data specify structures for that data.  If no structure is\n * specified, the command does not input or output data, respectively.\n * Parameter/response length is implicit in the structs.  Some underlying\n * communication protocols (I2C, SPI) may add length or checksum headers, but\n * those are implementation-dependent and not defined here.\n *\n * All commands MUST be #defined to be 4-digit UPPER CASE hex values\n * (e.g., 0x00AB, not 0xab) for CONFIG_HOSTCMD_SECTION_SORTED to work.\n */\n\n/*****************************************************************************/\n/* General / test commands */\n\n/*\n * Get protocol version, used to deal with non-backward compatible protocol\n * changes.\n */\n#define EC_CMD_PROTO_VERSION 0x0000\n\n/**\n * struct ec_response_proto_version - Response to the proto version command.\n * @version: The protocol version.\n */\nstruct ec_response_proto_version {\n\tuint32_t version;\n} __ec_align4;\n\n/*\n * Hello.  This is a simple command to test the EC is responsive to\n * commands.\n */\n#define EC_CMD_HELLO 0x0001\n\n/**\n * struct ec_params_hello - Parameters to the hello command.\n * @in_data: Pass anything here.\n */\nstruct ec_params_hello {\n\tuint32_t in_data;\n} __ec_align4;\n\n/**\n * struct ec_response_hello - Response to the hello command.\n * @out_data: Output will be in_data + 0x01020304.\n */\nstruct ec_response_hello {\n\tuint32_t out_data;\n} __ec_align4;\n\n/* Get version number */\n#define EC_CMD_GET_VERSION 0x0002\n\nenum ec_current_image {\n\tEC_IMAGE_UNKNOWN = 0,\n\tEC_IMAGE_RO,\n\tEC_IMAGE_RW\n};\n\n/**\n * struct ec_response_get_version - Response to the get version command.\n * @version_string_ro: Null-terminated RO firmware version string.\n * @version_string_rw: Null-terminated RW firmware version string.\n * @reserved: Unused bytes; was previously RW-B firmware version string.\n * @current_image: One of ec_current_image.\n */\nstruct ec_response_get_version {\n\tchar version_string_ro[32];\n\tchar version_string_rw[32];\n\tchar reserved[32];\n\tuint32_t current_image;\n} __ec_align4;\n\n/* Read test */\n#define EC_CMD_READ_TEST 0x0003\n\n/**\n * struct ec_params_read_test - Parameters for the read test command.\n * @offset: Starting value for read buffer.\n * @size: Size to read in bytes.\n */\nstruct ec_params_read_test {\n\tuint32_t offset;\n\tuint32_t size;\n} __ec_align4;\n\n/**\n * struct ec_response_read_test - Response to the read test command.\n * @data: Data returned by the read test command.\n */\nstruct ec_response_read_test {\n\tuint32_t data[32];\n} __ec_align4;\n\n/*\n * Get build information\n *\n * Response is null-terminated string.\n */\n#define EC_CMD_GET_BUILD_INFO 0x0004\n\n/* Get chip info */\n#define EC_CMD_GET_CHIP_INFO 0x0005\n\n/**\n * struct ec_response_get_chip_info - Response to the get chip info command.\n * @vendor: Null-terminated string for chip vendor.\n * @name: Null-terminated string for chip name.\n * @revision: Null-terminated string for chip mask version.\n */\nstruct ec_response_get_chip_info {\n\tchar vendor[32];\n\tchar name[32];\n\tchar revision[32];\n} __ec_align4;\n\n/* Get board HW version */\n#define EC_CMD_GET_BOARD_VERSION 0x0006\n\n/**\n * struct ec_response_board_version - Response to the board version command.\n * @board_version: A monotonously incrementing number.\n */\nstruct ec_response_board_version {\n\tuint16_t board_version;\n} __ec_align2;\n\n/*\n * Read memory-mapped data.\n *\n * This is an alternate interface to memory-mapped data for bus protocols\n * which don't support direct-mapped memory - I2C, SPI, etc.\n *\n * Response is params.size bytes of data.\n */\n#define EC_CMD_READ_MEMMAP 0x0007\n\n/**\n * struct ec_params_read_memmap - Parameters for the read memory map command.\n * @offset: Offset in memmap (EC_MEMMAP_*).\n * @size: Size to read in bytes.\n */\nstruct ec_params_read_memmap {\n\tuint8_t offset;\n\tuint8_t size;\n} __ec_align1;\n\n/* Read versions supported for a command */\n#define EC_CMD_GET_CMD_VERSIONS 0x0008\n\n/**\n * struct ec_params_get_cmd_versions - Parameters for the get command versions.\n * @cmd: Command to check.\n */\nstruct ec_params_get_cmd_versions {\n\tuint8_t cmd;\n} __ec_align1;\n\n/**\n * struct ec_params_get_cmd_versions_v1 - Parameters for the get command\n *         versions (v1)\n * @cmd: Command to check.\n */\nstruct ec_params_get_cmd_versions_v1 {\n\tuint16_t cmd;\n} __ec_align2;\n\n/**\n * struct ec_response_get_cmd_version - Response to the get command versions.\n * @version_mask: Mask of supported versions; use EC_VER_MASK() to compare with\n *                a desired version.\n */\nstruct ec_response_get_cmd_versions {\n\tuint32_t version_mask;\n} __ec_align4;\n\n/*\n * Check EC communications status (busy). This is needed on i2c/spi but not\n * on lpc since it has its own out-of-band busy indicator.\n *\n * lpc must read the status from the command register. Attempting this on\n * lpc will overwrite the args/parameter space and corrupt its data.\n */\n#define EC_CMD_GET_COMMS_STATUS\t\t0x0009\n\n/* Avoid using ec_status which is for return values */\nenum ec_comms_status {\n\tEC_COMMS_STATUS_PROCESSING\t= BIT(0),\t/* Processing cmd */\n};\n\n/**\n * struct ec_response_get_comms_status - Response to the get comms status\n *         command.\n * @flags: Mask of enum ec_comms_status.\n */\nstruct ec_response_get_comms_status {\n\tuint32_t flags;\t\t/* Mask of enum ec_comms_status */\n} __ec_align4;\n\n/* Fake a variety of responses, purely for testing purposes. */\n#define EC_CMD_TEST_PROTOCOL\t\t0x000A\n\n/* Tell the EC what to send back to us. */\nstruct ec_params_test_protocol {\n\tuint32_t ec_result;\n\tuint32_t ret_len;\n\tuint8_t buf[32];\n} __ec_align4;\n\n/* Here it comes... */\nstruct ec_response_test_protocol {\n\tuint8_t buf[32];\n} __ec_align4;\n\n/* Get protocol information */\n#define EC_CMD_GET_PROTOCOL_INFO\t0x000B\n\n/* Flags for ec_response_get_protocol_info.flags */\n/* EC_RES_IN_PROGRESS may be returned if a command is slow */\n#define EC_PROTOCOL_INFO_IN_PROGRESS_SUPPORTED BIT(0)\n\n/**\n * struct ec_response_get_protocol_info - Response to the get protocol info.\n * @protocol_versions: Bitmask of protocol versions supported (1 << n means\n *                     version n).\n * @max_request_packet_size: Maximum request packet size in bytes.\n * @max_response_packet_size: Maximum response packet size in bytes.\n * @flags: see EC_PROTOCOL_INFO_*\n */\nstruct ec_response_get_protocol_info {\n\t/* Fields which exist if at least protocol version 3 supported */\n\tuint32_t protocol_versions;\n\tuint16_t max_request_packet_size;\n\tuint16_t max_response_packet_size;\n\tuint32_t flags;\n} __ec_align4;\n\n\n/*****************************************************************************/\n/* Get/Set miscellaneous values */\n\n/* The upper byte of .flags tells what to do (nothing means \"get\") */\n#define EC_GSV_SET        0x80000000\n\n/*\n * The lower three bytes of .flags identifies the parameter, if that has\n * meaning for an individual command.\n */\n#define EC_GSV_PARAM_MASK 0x00ffffff\n\nstruct ec_params_get_set_value {\n\tuint32_t flags;\n\tuint32_t value;\n} __ec_align4;\n\nstruct ec_response_get_set_value {\n\tuint32_t flags;\n\tuint32_t value;\n} __ec_align4;\n\n/* More than one command can use these structs to get/set parameters. */\n#define EC_CMD_GSV_PAUSE_IN_S5\t0x000C\n\n/*****************************************************************************/\n/* List the features supported by the firmware */\n#define EC_CMD_GET_FEATURES  0x000D\n\n/* Supported features */\nenum ec_feature_code {\n\t/*\n\t * This image contains a limited set of features. Another image\n\t * in RW partition may support more features.\n\t */\n\tEC_FEATURE_LIMITED = 0,\n\t/*\n\t * Commands for probing/reading/writing/erasing the flash in the\n\t * EC are present.\n\t */\n\tEC_FEATURE_FLASH = 1,\n\t/*\n\t * Can control the fan speed directly.\n\t */\n\tEC_FEATURE_PWM_FAN = 2,\n\t/*\n\t * Can control the intensity of the keyboard backlight.\n\t */\n\tEC_FEATURE_PWM_KEYB = 3,\n\t/*\n\t * Support Google lightbar, introduced on Pixel.\n\t */\n\tEC_FEATURE_LIGHTBAR = 4,\n\t/* Control of LEDs  */\n\tEC_FEATURE_LED = 5,\n\t/* Exposes an interface to control gyro and sensors.\n\t * The host goes through the EC to access these sensors.\n\t * In addition, the EC may provide composite sensors, like lid angle.\n\t */\n\tEC_FEATURE_MOTION_SENSE = 6,\n\t/* The keyboard is controlled by the EC */\n\tEC_FEATURE_KEYB = 7,\n\t/* The AP can use part of the EC flash as persistent storage. */\n\tEC_FEATURE_PSTORE = 8,\n\t/* The EC monitors BIOS port 80h, and can return POST codes. */\n\tEC_FEATURE_PORT80 = 9,\n\t/*\n\t * Thermal management: include TMP specific commands.\n\t * Higher level than direct fan control.\n\t */\n\tEC_FEATURE_THERMAL = 10,\n\t/* Can switch the screen backlight on/off */\n\tEC_FEATURE_BKLIGHT_SWITCH = 11,\n\t/* Can switch the wifi module on/off */\n\tEC_FEATURE_WIFI_SWITCH = 12,\n\t/* Monitor host events, through for example SMI or SCI */\n\tEC_FEATURE_HOST_EVENTS = 13,\n\t/* The EC exposes GPIO commands to control/monitor connected devices. */\n\tEC_FEATURE_GPIO = 14,\n\t/* The EC can send i2c messages to downstream devices. */\n\tEC_FEATURE_I2C = 15,\n\t/* Command to control charger are included */\n\tEC_FEATURE_CHARGER = 16,\n\t/* Simple battery support. */\n\tEC_FEATURE_BATTERY = 17,\n\t/*\n\t * Support Smart battery protocol\n\t * (Common Smart Battery System Interface Specification)\n\t */\n\tEC_FEATURE_SMART_BATTERY = 18,\n\t/* EC can detect when the host hangs. */\n\tEC_FEATURE_HANG_DETECT = 19,\n\t/* Report power information, for pit only */\n\tEC_FEATURE_PMU = 20,\n\t/* Another Cros EC device is present downstream of this one */\n\tEC_FEATURE_SUB_MCU = 21,\n\t/* Support USB Power delivery (PD) commands */\n\tEC_FEATURE_USB_PD = 22,\n\t/* Control USB multiplexer, for audio through USB port for instance. */\n\tEC_FEATURE_USB_MUX = 23,\n\t/* Motion Sensor code has an internal software FIFO */\n\tEC_FEATURE_MOTION_SENSE_FIFO = 24,\n\t/* Support temporary secure vstore */\n\tEC_FEATURE_VSTORE = 25,\n\t/* EC decides on USB-C SS mux state, muxes configured by host */\n\tEC_FEATURE_USBC_SS_MUX_VIRTUAL = 26,\n\t/* EC has RTC feature that can be controlled by host commands */\n\tEC_FEATURE_RTC = 27,\n\t/* The MCU exposes a Fingerprint sensor */\n\tEC_FEATURE_FINGERPRINT = 28,\n\t/* The MCU exposes a Touchpad */\n\tEC_FEATURE_TOUCHPAD = 29,\n\t/* The MCU has RWSIG task enabled */\n\tEC_FEATURE_RWSIG = 30,\n\t/* EC has device events support */\n\tEC_FEATURE_DEVICE_EVENT = 31,\n\t/* EC supports the unified wake masks for LPC/eSPI systems */\n\tEC_FEATURE_UNIFIED_WAKE_MASKS = 32,\n\t/* EC supports 64-bit host events */\n\tEC_FEATURE_HOST_EVENT64 = 33,\n\t/* EC runs code in RAM (not in place, a.k.a. XIP) */\n\tEC_FEATURE_EXEC_IN_RAM = 34,\n\t/* EC supports CEC commands */\n\tEC_FEATURE_CEC = 35,\n\t/* EC supports tight sensor timestamping. */\n\tEC_FEATURE_MOTION_SENSE_TIGHT_TIMESTAMPS = 36,\n\t/*\n\t * EC supports tablet mode detection aligned to Chrome and allows\n\t * setting of threshold by host command using\n\t * MOTIONSENSE_CMD_TABLET_MODE_LID_ANGLE.\n\t */\n\tEC_FEATURE_REFINED_TABLET_MODE_HYSTERESIS = 37,\n\t/* The MCU is a System Companion Processor (SCP). */\n\tEC_FEATURE_SCP = 39,\n\t/* The MCU is an Integrated Sensor Hub */\n\tEC_FEATURE_ISH = 40,\n\t/* New TCPMv2 TYPEC_ prefaced commands supported */\n\tEC_FEATURE_TYPEC_CMD = 41,\n\t/*\n\t * The EC will wait for direction from the AP to enter Type-C alternate\n\t * modes or USB4.\n\t */\n\tEC_FEATURE_TYPEC_REQUIRE_AP_MODE_ENTRY = 42,\n\t/*\n\t * The EC will wait for an acknowledge from the AP after setting the\n\t * mux.\n\t */\n\tEC_FEATURE_TYPEC_MUX_REQUIRE_AP_ACK = 43,\n};\n\n#define EC_FEATURE_MASK_0(event_code) BIT(event_code % 32)\n#define EC_FEATURE_MASK_1(event_code) BIT(event_code - 32)\n\nstruct ec_response_get_features {\n\tuint32_t flags[2];\n} __ec_align4;\n\n/*****************************************************************************/\n/* Get the board's SKU ID from EC */\n#define EC_CMD_GET_SKU_ID 0x000E\n\n/* Set SKU ID from AP */\n#define EC_CMD_SET_SKU_ID 0x000F\n\nstruct ec_sku_id_info {\n\tuint32_t sku_id;\n} __ec_align4;\n\n/*****************************************************************************/\n/* Flash commands */\n\n/* Get flash info */\n#define EC_CMD_FLASH_INFO 0x0010\n#define EC_VER_FLASH_INFO 2\n\n/**\n * struct ec_response_flash_info - Response to the flash info command.\n * @flash_size: Usable flash size in bytes.\n * @write_block_size: Write block size. Write offset and size must be a\n *                    multiple of this.\n * @erase_block_size: Erase block size. Erase offset and size must be a\n *                    multiple of this.\n * @protect_block_size: Protection block size. Protection offset and size\n *                      must be a multiple of this.\n *\n * Version 0 returns these fields.\n */\nstruct ec_response_flash_info {\n\tuint32_t flash_size;\n\tuint32_t write_block_size;\n\tuint32_t erase_block_size;\n\tuint32_t protect_block_size;\n} __ec_align4;\n\n/*\n * Flags for version 1+ flash info command\n * EC flash erases bits to 0 instead of 1.\n */\n#define EC_FLASH_INFO_ERASE_TO_0 BIT(0)\n\n/*\n * Flash must be selected for read/write/erase operations to succeed.  This may\n * be necessary on a chip where write/erase can be corrupted by other board\n * activity, or where the chip needs to enable some sort of programming voltage,\n * or where the read/write/erase operations require cleanly suspending other\n * chip functionality.\n */\n#define EC_FLASH_INFO_SELECT_REQUIRED BIT(1)\n\n/**\n * struct ec_response_flash_info_1 - Response to the flash info v1 command.\n * @flash_size: Usable flash size in bytes.\n * @write_block_size: Write block size. Write offset and size must be a\n *                    multiple of this.\n * @erase_block_size: Erase block size. Erase offset and size must be a\n *                    multiple of this.\n * @protect_block_size: Protection block size. Protection offset and size\n *                      must be a multiple of this.\n * @write_ideal_size: Ideal write size in bytes.  Writes will be fastest if\n *                    size is exactly this and offset is a multiple of this.\n *                    For example, an EC may have a write buffer which can do\n *                    half-page operations if data is aligned, and a slower\n *                    word-at-a-time write mode.\n * @flags: Flags; see EC_FLASH_INFO_*\n *\n * Version 1 returns the same initial fields as version 0, with additional\n * fields following.\n *\n * gcc anonymous structs don't seem to get along with the __packed directive;\n * if they did we'd define the version 0 structure as a sub-structure of this\n * one.\n *\n * Version 2 supports flash banks of different sizes:\n * The caller specified the number of banks it has preallocated\n * (num_banks_desc)\n * The EC returns the number of banks describing the flash memory.\n * It adds banks descriptions up to num_banks_desc.\n */\nstruct ec_response_flash_info_1 {\n\t/* Version 0 fields; see above for description */\n\tuint32_t flash_size;\n\tuint32_t write_block_size;\n\tuint32_t erase_block_size;\n\tuint32_t protect_block_size;\n\n\t/* Version 1 adds these fields: */\n\tuint32_t write_ideal_size;\n\tuint32_t flags;\n} __ec_align4;\n\nstruct ec_params_flash_info_2 {\n\t/* Number of banks to describe */\n\tuint16_t num_banks_desc;\n\t/* Reserved; set 0; ignore on read */\n\tuint8_t reserved[2];\n} __ec_align4;\n\nstruct ec_flash_bank {\n\t/* Number of sector is in this bank. */\n\tuint16_t count;\n\t/* Size in power of 2 of each sector (8 --> 256 bytes) */\n\tuint8_t size_exp;\n\t/* Minimal write size for the sectors in this bank */\n\tuint8_t write_size_exp;\n\t/* Erase size for the sectors in this bank */\n\tuint8_t erase_size_exp;\n\t/* Size for write protection, usually identical to erase size. */\n\tuint8_t protect_size_exp;\n\t/* Reserved; set 0; ignore on read */\n\tuint8_t reserved[2];\n};\n\nstruct ec_response_flash_info_2 {\n\t/* Total flash in the EC. */\n\tuint32_t flash_size;\n\t/* Flags; see EC_FLASH_INFO_* */\n\tuint32_t flags;\n\t/* Maximum size to use to send data to write to the EC. */\n\tuint32_t write_ideal_size;\n\t/* Number of banks present in the EC. */\n\tuint16_t num_banks_total;\n\t/* Number of banks described in banks array. */\n\tuint16_t num_banks_desc;\n\tstruct ec_flash_bank banks[];\n} __ec_align4;\n\n/*\n * Read flash\n *\n * Response is params.size bytes of data.\n */\n#define EC_CMD_FLASH_READ 0x0011\n\n/**\n * struct ec_params_flash_read - Parameters for the flash read command.\n * @offset: Byte offset to read.\n * @size: Size to read in bytes.\n */\nstruct ec_params_flash_read {\n\tuint32_t offset;\n\tuint32_t size;\n} __ec_align4;\n\n/* Write flash */\n#define EC_CMD_FLASH_WRITE 0x0012\n#define EC_VER_FLASH_WRITE 1\n\n/* Version 0 of the flash command supported only 64 bytes of data */\n#define EC_FLASH_WRITE_VER0_SIZE 64\n\n/**\n * struct ec_params_flash_write - Parameters for the flash write command.\n * @offset: Byte offset to write.\n * @size: Size to write in bytes.\n */\nstruct ec_params_flash_write {\n\tuint32_t offset;\n\tuint32_t size;\n\t/* Followed by data to write */\n} __ec_align4;\n\n/* Erase flash */\n#define EC_CMD_FLASH_ERASE 0x0013\n\n/**\n * struct ec_params_flash_erase - Parameters for the flash erase command, v0.\n * @offset: Byte offset to erase.\n * @size: Size to erase in bytes.\n */\nstruct ec_params_flash_erase {\n\tuint32_t offset;\n\tuint32_t size;\n} __ec_align4;\n\n/*\n * v1 add async erase:\n * subcommands can returns:\n * EC_RES_SUCCESS : erased (see ERASE_SECTOR_ASYNC case below).\n * EC_RES_INVALID_PARAM : offset/size are not aligned on a erase boundary.\n * EC_RES_ERROR : other errors.\n * EC_RES_BUSY : an existing erase operation is in progress.\n * EC_RES_ACCESS_DENIED: Trying to erase running image.\n *\n * When ERASE_SECTOR_ASYNC returns EC_RES_SUCCESS, the operation is just\n * properly queued. The user must call ERASE_GET_RESULT subcommand to get\n * the proper result.\n * When ERASE_GET_RESULT returns EC_RES_BUSY, the caller must wait and send\n * ERASE_GET_RESULT again to get the result of ERASE_SECTOR_ASYNC.\n * ERASE_GET_RESULT command may timeout on EC where flash access is not\n * permitted while erasing. (For instance, STM32F4).\n */\nenum ec_flash_erase_cmd {\n\tFLASH_ERASE_SECTOR,     /* Erase and wait for result */\n\tFLASH_ERASE_SECTOR_ASYNC,  /* Erase and return immediately. */\n\tFLASH_ERASE_GET_RESULT,  /* Ask for last erase result */\n};\n\n/**\n * struct ec_params_flash_erase_v1 - Parameters for the flash erase command, v1.\n * @cmd: One of ec_flash_erase_cmd.\n * @reserved: Pad byte; currently always contains 0.\n * @flag: No flags defined yet; set to 0.\n * @params: Same as v0 parameters.\n */\nstruct ec_params_flash_erase_v1 {\n\tuint8_t  cmd;\n\tuint8_t  reserved;\n\tuint16_t flag;\n\tstruct ec_params_flash_erase params;\n} __ec_align4;\n\n/*\n * Get/set flash protection.\n *\n * If mask!=0, sets/clear the requested bits of flags.  Depending on the\n * firmware write protect GPIO, not all flags will take effect immediately;\n * some flags require a subsequent hard reset to take effect.  Check the\n * returned flags bits to see what actually happened.\n *\n * If mask=0, simply returns the current flags state.\n */\n#define EC_CMD_FLASH_PROTECT 0x0015\n#define EC_VER_FLASH_PROTECT 1  /* Command version 1 */\n\n/* Flags for flash protection */\n/* RO flash code protected when the EC boots */\n#define EC_FLASH_PROTECT_RO_AT_BOOT         BIT(0)\n/*\n * RO flash code protected now.  If this bit is set, at-boot status cannot\n * be changed.\n */\n#define EC_FLASH_PROTECT_RO_NOW             BIT(1)\n/* Entire flash code protected now, until reboot. */\n#define EC_FLASH_PROTECT_ALL_NOW            BIT(2)\n/* Flash write protect GPIO is asserted now */\n#define EC_FLASH_PROTECT_GPIO_ASSERTED      BIT(3)\n/* Error - at least one bank of flash is stuck locked, and cannot be unlocked */\n#define EC_FLASH_PROTECT_ERROR_STUCK        BIT(4)\n/*\n * Error - flash protection is in inconsistent state.  At least one bank of\n * flash which should be protected is not protected.  Usually fixed by\n * re-requesting the desired flags, or by a hard reset if that fails.\n */\n#define EC_FLASH_PROTECT_ERROR_INCONSISTENT BIT(5)\n/* Entire flash code protected when the EC boots */\n#define EC_FLASH_PROTECT_ALL_AT_BOOT        BIT(6)\n/* RW flash code protected when the EC boots */\n#define EC_FLASH_PROTECT_RW_AT_BOOT         BIT(7)\n/* RW flash code protected now. */\n#define EC_FLASH_PROTECT_RW_NOW             BIT(8)\n/* Rollback information flash region protected when the EC boots */\n#define EC_FLASH_PROTECT_ROLLBACK_AT_BOOT   BIT(9)\n/* Rollback information flash region protected now */\n#define EC_FLASH_PROTECT_ROLLBACK_NOW       BIT(10)\n\n\n/**\n * struct ec_params_flash_protect - Parameters for the flash protect command.\n * @mask: Bits in flags to apply.\n * @flags: New flags to apply.\n */\nstruct ec_params_flash_protect {\n\tuint32_t mask;\n\tuint32_t flags;\n} __ec_align4;\n\n/**\n * struct ec_response_flash_protect - Response to the flash protect command.\n * @flags: Current value of flash protect flags.\n * @valid_flags: Flags which are valid on this platform. This allows the\n *               caller to distinguish between flags which aren't set vs. flags\n *               which can't be set on this platform.\n * @writable_flags: Flags which can be changed given the current protection\n *                  state.\n */\nstruct ec_response_flash_protect {\n\tuint32_t flags;\n\tuint32_t valid_flags;\n\tuint32_t writable_flags;\n} __ec_align4;\n\n/*\n * Note: commands 0x14 - 0x19 version 0 were old commands to get/set flash\n * write protect.  These commands may be reused with version > 0.\n */\n\n/* Get the region offset/size */\n#define EC_CMD_FLASH_REGION_INFO 0x0016\n#define EC_VER_FLASH_REGION_INFO 1\n\nenum ec_flash_region {\n\t/* Region which holds read-only EC image */\n\tEC_FLASH_REGION_RO = 0,\n\t/*\n\t * Region which holds active RW image. 'Active' is different from\n\t * 'running'. Active means 'scheduled-to-run'. Since RO image always\n\t * scheduled to run, active/non-active applies only to RW images (for\n\t * the same reason 'update' applies only to RW images. It's a state of\n\t * an image on a flash. Running image can be RO, RW_A, RW_B but active\n\t * image can only be RW_A or RW_B. In recovery mode, an active RW image\n\t * doesn't enter 'running' state but it's still active on a flash.\n\t */\n\tEC_FLASH_REGION_ACTIVE,\n\t/*\n\t * Region which should be write-protected in the factory (a superset of\n\t * EC_FLASH_REGION_RO)\n\t */\n\tEC_FLASH_REGION_WP_RO,\n\t/* Region which holds updatable (non-active) RW image */\n\tEC_FLASH_REGION_UPDATE,\n\t/* Number of regions */\n\tEC_FLASH_REGION_COUNT,\n};\n/*\n * 'RW' is vague if there are multiple RW images; we mean the active one,\n * so the old constant is deprecated.\n */\n#define EC_FLASH_REGION_RW EC_FLASH_REGION_ACTIVE\n\n/**\n * struct ec_params_flash_region_info - Parameters for the flash region info\n *         command.\n * @region: Flash region; see EC_FLASH_REGION_*\n */\nstruct ec_params_flash_region_info {\n\tuint32_t region;\n} __ec_align4;\n\nstruct ec_response_flash_region_info {\n\tuint32_t offset;\n\tuint32_t size;\n} __ec_align4;\n\n/* Read/write VbNvContext */\n#define EC_CMD_VBNV_CONTEXT 0x0017\n#define EC_VER_VBNV_CONTEXT 1\n#define EC_VBNV_BLOCK_SIZE 16\n\nenum ec_vbnvcontext_op {\n\tEC_VBNV_CONTEXT_OP_READ,\n\tEC_VBNV_CONTEXT_OP_WRITE,\n};\n\nstruct ec_params_vbnvcontext {\n\tuint32_t op;\n\tuint8_t block[EC_VBNV_BLOCK_SIZE];\n} __ec_align4;\n\nstruct ec_response_vbnvcontext {\n\tuint8_t block[EC_VBNV_BLOCK_SIZE];\n} __ec_align4;\n\n\n/* Get SPI flash information */\n#define EC_CMD_FLASH_SPI_INFO 0x0018\n\nstruct ec_response_flash_spi_info {\n\t/* JEDEC info from command 0x9F (manufacturer, memory type, size) */\n\tuint8_t jedec[3];\n\n\t/* Pad byte; currently always contains 0 */\n\tuint8_t reserved0;\n\n\t/* Manufacturer / device ID from command 0x90 */\n\tuint8_t mfr_dev_id[2];\n\n\t/* Status registers from command 0x05 and 0x35 */\n\tuint8_t sr1, sr2;\n} __ec_align1;\n\n\n/* Select flash during flash operations */\n#define EC_CMD_FLASH_SELECT 0x0019\n\n/**\n * struct ec_params_flash_select - Parameters for the flash select command.\n * @select: 1 to select flash, 0 to deselect flash\n */\nstruct ec_params_flash_select {\n\tuint8_t select;\n} __ec_align4;\n\n\n/*****************************************************************************/\n/* PWM commands */\n\n/* Get fan target RPM */\n#define EC_CMD_PWM_GET_FAN_TARGET_RPM 0x0020\n\nstruct ec_response_pwm_get_fan_rpm {\n\tuint32_t rpm;\n} __ec_align4;\n\n/* Set target fan RPM */\n#define EC_CMD_PWM_SET_FAN_TARGET_RPM 0x0021\n\n/* Version 0 of input params */\nstruct ec_params_pwm_set_fan_target_rpm_v0 {\n\tuint32_t rpm;\n} __ec_align4;\n\n/* Version 1 of input params */\nstruct ec_params_pwm_set_fan_target_rpm_v1 {\n\tuint32_t rpm;\n\tuint8_t fan_idx;\n} __ec_align_size1;\n\n/* Get keyboard backlight */\n/* OBSOLETE - Use EC_CMD_PWM_SET_DUTY */\n#define EC_CMD_PWM_GET_KEYBOARD_BACKLIGHT 0x0022\n\nstruct ec_response_pwm_get_keyboard_backlight {\n\tuint8_t percent;\n\tuint8_t enabled;\n} __ec_align1;\n\n/* Set keyboard backlight */\n/* OBSOLETE - Use EC_CMD_PWM_SET_DUTY */\n#define EC_CMD_PWM_SET_KEYBOARD_BACKLIGHT 0x0023\n\nstruct ec_params_pwm_set_keyboard_backlight {\n\tuint8_t percent;\n} __ec_align1;\n\n/* Set target fan PWM duty cycle */\n#define EC_CMD_PWM_SET_FAN_DUTY 0x0024\n\n/* Version 0 of input params */\nstruct ec_params_pwm_set_fan_duty_v0 {\n\tuint32_t percent;\n} __ec_align4;\n\n/* Version 1 of input params */\nstruct ec_params_pwm_set_fan_duty_v1 {\n\tuint32_t percent;\n\tuint8_t fan_idx;\n} __ec_align_size1;\n\n#define EC_CMD_PWM_SET_DUTY 0x0025\n/* 16 bit duty cycle, 0xffff = 100% */\n#define EC_PWM_MAX_DUTY 0xffff\n\nenum ec_pwm_type {\n\t/* All types, indexed by board-specific enum pwm_channel */\n\tEC_PWM_TYPE_GENERIC = 0,\n\t/* Keyboard backlight */\n\tEC_PWM_TYPE_KB_LIGHT,\n\t/* Display backlight */\n\tEC_PWM_TYPE_DISPLAY_LIGHT,\n\tEC_PWM_TYPE_COUNT,\n};\n\nstruct ec_params_pwm_set_duty {\n\tuint16_t duty;     /* Duty cycle, EC_PWM_MAX_DUTY = 100% */\n\tuint8_t pwm_type;  /* ec_pwm_type */\n\tuint8_t index;     /* Type-specific index, or 0 if unique */\n} __ec_align4;\n\n#define EC_CMD_PWM_GET_DUTY 0x0026\n\nstruct ec_params_pwm_get_duty {\n\tuint8_t pwm_type;  /* ec_pwm_type */\n\tuint8_t index;     /* Type-specific index, or 0 if unique */\n} __ec_align1;\n\nstruct ec_response_pwm_get_duty {\n\tuint16_t duty;     /* Duty cycle, EC_PWM_MAX_DUTY = 100% */\n} __ec_align2;\n\n/*****************************************************************************/\n/*\n * Lightbar commands. This looks worse than it is. Since we only use one HOST\n * command to say \"talk to the lightbar\", we put the \"and tell it to do X\" part\n * into a subcommand. We'll make separate structs for subcommands with\n * different input args, so that we know how much to expect.\n */\n#define EC_CMD_LIGHTBAR_CMD 0x0028\n\nstruct rgb_s {\n\tuint8_t r, g, b;\n} __ec_todo_unpacked;\n\n#define LB_BATTERY_LEVELS 4\n\n/*\n * List of tweakable parameters. NOTE: It's __packed so it can be sent in a\n * host command, but the alignment is the same regardless. Keep it that way.\n */\nstruct lightbar_params_v0 {\n\t/* Timing */\n\tint32_t google_ramp_up;\n\tint32_t google_ramp_down;\n\tint32_t s3s0_ramp_up;\n\tint32_t s0_tick_delay[2];\t\t/* AC=0/1 */\n\tint32_t s0a_tick_delay[2];\t\t/* AC=0/1 */\n\tint32_t s0s3_ramp_down;\n\tint32_t s3_sleep_for;\n\tint32_t s3_ramp_up;\n\tint32_t s3_ramp_down;\n\n\t/* Oscillation */\n\tuint8_t new_s0;\n\tuint8_t osc_min[2];\t\t\t/* AC=0/1 */\n\tuint8_t osc_max[2];\t\t\t/* AC=0/1 */\n\tuint8_t w_ofs[2];\t\t\t/* AC=0/1 */\n\n\t/* Brightness limits based on the backlight and AC. */\n\tuint8_t bright_bl_off_fixed[2];\t\t/* AC=0/1 */\n\tuint8_t bright_bl_on_min[2];\t\t/* AC=0/1 */\n\tuint8_t bright_bl_on_max[2];\t\t/* AC=0/1 */\n\n\t/* Battery level thresholds */\n\tuint8_t battery_threshold[LB_BATTERY_LEVELS - 1];\n\n\t/* Map [AC][battery_level] to color index */\n\tuint8_t s0_idx[2][LB_BATTERY_LEVELS];\t/* AP is running */\n\tuint8_t s3_idx[2][LB_BATTERY_LEVELS];\t/* AP is sleeping */\n\n\t/* Color palette */\n\tstruct rgb_s color[8];\t\t\t/* 0-3 are Google colors */\n} __ec_todo_packed;\n\nstruct lightbar_params_v1 {\n\t/* Timing */\n\tint32_t google_ramp_up;\n\tint32_t google_ramp_down;\n\tint32_t s3s0_ramp_up;\n\tint32_t s0_tick_delay[2];\t\t/* AC=0/1 */\n\tint32_t s0a_tick_delay[2];\t\t/* AC=0/1 */\n\tint32_t s0s3_ramp_down;\n\tint32_t s3_sleep_for;\n\tint32_t s3_ramp_up;\n\tint32_t s3_ramp_down;\n\tint32_t s5_ramp_up;\n\tint32_t s5_ramp_down;\n\tint32_t tap_tick_delay;\n\tint32_t tap_gate_delay;\n\tint32_t tap_display_time;\n\n\t/* Tap-for-battery params */\n\tuint8_t tap_pct_red;\n\tuint8_t tap_pct_green;\n\tuint8_t tap_seg_min_on;\n\tuint8_t tap_seg_max_on;\n\tuint8_t tap_seg_osc;\n\tuint8_t tap_idx[3];\n\n\t/* Oscillation */\n\tuint8_t osc_min[2];\t\t\t/* AC=0/1 */\n\tuint8_t osc_max[2];\t\t\t/* AC=0/1 */\n\tuint8_t w_ofs[2];\t\t\t/* AC=0/1 */\n\n\t/* Brightness limits based on the backlight and AC. */\n\tuint8_t bright_bl_off_fixed[2];\t\t/* AC=0/1 */\n\tuint8_t bright_bl_on_min[2];\t\t/* AC=0/1 */\n\tuint8_t bright_bl_on_max[2];\t\t/* AC=0/1 */\n\n\t/* Battery level thresholds */\n\tuint8_t battery_threshold[LB_BATTERY_LEVELS - 1];\n\n\t/* Map [AC][battery_level] to color index */\n\tuint8_t s0_idx[2][LB_BATTERY_LEVELS];\t/* AP is running */\n\tuint8_t s3_idx[2][LB_BATTERY_LEVELS];\t/* AP is sleeping */\n\n\t/* s5: single color pulse on inhibited power-up */\n\tuint8_t s5_idx;\n\n\t/* Color palette */\n\tstruct rgb_s color[8];\t\t\t/* 0-3 are Google colors */\n} __ec_todo_packed;\n\n/* Lightbar command params v2\n * crbug.com/467716\n *\n * lightbar_parms_v1 was too big for i2c, therefore in v2, we split them up by\n * logical groups to make it more manageable ( < 120 bytes).\n *\n * NOTE: Each of these groups must be less than 120 bytes.\n */\n\nstruct lightbar_params_v2_timing {\n\t/* Timing */\n\tint32_t google_ramp_up;\n\tint32_t google_ramp_down;\n\tint32_t s3s0_ramp_up;\n\tint32_t s0_tick_delay[2];\t\t/* AC=0/1 */\n\tint32_t s0a_tick_delay[2];\t\t/* AC=0/1 */\n\tint32_t s0s3_ramp_down;\n\tint32_t s3_sleep_for;\n\tint32_t s3_ramp_up;\n\tint32_t s3_ramp_down;\n\tint32_t s5_ramp_up;\n\tint32_t s5_ramp_down;\n\tint32_t tap_tick_delay;\n\tint32_t tap_gate_delay;\n\tint32_t tap_display_time;\n} __ec_todo_packed;\n\nstruct lightbar_params_v2_tap {\n\t/* Tap-for-battery params */\n\tuint8_t tap_pct_red;\n\tuint8_t tap_pct_green;\n\tuint8_t tap_seg_min_on;\n\tuint8_t tap_seg_max_on;\n\tuint8_t tap_seg_osc;\n\tuint8_t tap_idx[3];\n} __ec_todo_packed;\n\nstruct lightbar_params_v2_oscillation {\n\t/* Oscillation */\n\tuint8_t osc_min[2];\t\t\t/* AC=0/1 */\n\tuint8_t osc_max[2];\t\t\t/* AC=0/1 */\n\tuint8_t w_ofs[2];\t\t\t/* AC=0/1 */\n} __ec_todo_packed;\n\nstruct lightbar_params_v2_brightness {\n\t/* Brightness limits based on the backlight and AC. */\n\tuint8_t bright_bl_off_fixed[2];\t\t/* AC=0/1 */\n\tuint8_t bright_bl_on_min[2];\t\t/* AC=0/1 */\n\tuint8_t bright_bl_on_max[2];\t\t/* AC=0/1 */\n} __ec_todo_packed;\n\nstruct lightbar_params_v2_thresholds {\n\t/* Battery level thresholds */\n\tuint8_t battery_threshold[LB_BATTERY_LEVELS - 1];\n} __ec_todo_packed;\n\nstruct lightbar_params_v2_colors {\n\t/* Map [AC][battery_level] to color index */\n\tuint8_t s0_idx[2][LB_BATTERY_LEVELS];\t/* AP is running */\n\tuint8_t s3_idx[2][LB_BATTERY_LEVELS];\t/* AP is sleeping */\n\n\t/* s5: single color pulse on inhibited power-up */\n\tuint8_t s5_idx;\n\n\t/* Color palette */\n\tstruct rgb_s color[8];\t\t\t/* 0-3 are Google colors */\n} __ec_todo_packed;\n\n/* Lightbar program. */\n#define EC_LB_PROG_LEN 192\nstruct lightbar_program {\n\tuint8_t size;\n\tuint8_t data[EC_LB_PROG_LEN];\n} __ec_todo_unpacked;\n\nstruct ec_params_lightbar {\n\tuint8_t cmd;\t\t      /* Command (see enum lightbar_command) */\n\tunion {\n\t\t/*\n\t\t * The following commands have no args:\n\t\t *\n\t\t * dump, off, on, init, get_seq, get_params_v0, get_params_v1,\n\t\t * version, get_brightness, get_demo, suspend, resume,\n\t\t * get_params_v2_timing, get_params_v2_tap, get_params_v2_osc,\n\t\t * get_params_v2_bright, get_params_v2_thlds,\n\t\t * get_params_v2_colors\n\t\t *\n\t\t * Don't use an empty struct, because C++ hates that.\n\t\t */\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t num;\n\t\t} set_brightness, seq, demo;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t ctrl, reg, value;\n\t\t} reg;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t led, red, green, blue;\n\t\t} set_rgb;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t led;\n\t\t} get_rgb;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t enable;\n\t\t} manual_suspend_ctrl;\n\n\t\tstruct lightbar_params_v0 set_params_v0;\n\t\tstruct lightbar_params_v1 set_params_v1;\n\n\t\tstruct lightbar_params_v2_timing set_v2par_timing;\n\t\tstruct lightbar_params_v2_tap set_v2par_tap;\n\t\tstruct lightbar_params_v2_oscillation set_v2par_osc;\n\t\tstruct lightbar_params_v2_brightness set_v2par_bright;\n\t\tstruct lightbar_params_v2_thresholds set_v2par_thlds;\n\t\tstruct lightbar_params_v2_colors set_v2par_colors;\n\n\t\tstruct lightbar_program set_program;\n\t};\n} __ec_todo_packed;\n\nstruct ec_response_lightbar {\n\tunion {\n\t\tstruct __ec_todo_unpacked {\n\t\t\tstruct __ec_todo_unpacked {\n\t\t\t\tuint8_t reg;\n\t\t\t\tuint8_t ic0;\n\t\t\t\tuint8_t ic1;\n\t\t\t} vals[23];\n\t\t} dump;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t num;\n\t\t} get_seq, get_brightness, get_demo;\n\n\t\tstruct lightbar_params_v0 get_params_v0;\n\t\tstruct lightbar_params_v1 get_params_v1;\n\n\n\t\tstruct lightbar_params_v2_timing get_params_v2_timing;\n\t\tstruct lightbar_params_v2_tap get_params_v2_tap;\n\t\tstruct lightbar_params_v2_oscillation get_params_v2_osc;\n\t\tstruct lightbar_params_v2_brightness get_params_v2_bright;\n\t\tstruct lightbar_params_v2_thresholds get_params_v2_thlds;\n\t\tstruct lightbar_params_v2_colors get_params_v2_colors;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint32_t num;\n\t\t\tuint32_t flags;\n\t\t} version;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t red, green, blue;\n\t\t} get_rgb;\n\n\t\t/*\n\t\t * The following commands have no response:\n\t\t *\n\t\t * off, on, init, set_brightness, seq, reg, set_rgb, demo,\n\t\t * set_params_v0, set_params_v1, set_program,\n\t\t * manual_suspend_ctrl, suspend, resume, set_v2par_timing,\n\t\t * set_v2par_tap, set_v2par_osc, set_v2par_bright,\n\t\t * set_v2par_thlds, set_v2par_colors\n\t\t */\n\t};\n} __ec_todo_packed;\n\n/* Lightbar commands */\nenum lightbar_command {\n\tLIGHTBAR_CMD_DUMP = 0,\n\tLIGHTBAR_CMD_OFF = 1,\n\tLIGHTBAR_CMD_ON = 2,\n\tLIGHTBAR_CMD_INIT = 3,\n\tLIGHTBAR_CMD_SET_BRIGHTNESS = 4,\n\tLIGHTBAR_CMD_SEQ = 5,\n\tLIGHTBAR_CMD_REG = 6,\n\tLIGHTBAR_CMD_SET_RGB = 7,\n\tLIGHTBAR_CMD_GET_SEQ = 8,\n\tLIGHTBAR_CMD_DEMO = 9,\n\tLIGHTBAR_CMD_GET_PARAMS_V0 = 10,\n\tLIGHTBAR_CMD_SET_PARAMS_V0 = 11,\n\tLIGHTBAR_CMD_VERSION = 12,\n\tLIGHTBAR_CMD_GET_BRIGHTNESS = 13,\n\tLIGHTBAR_CMD_GET_RGB = 14,\n\tLIGHTBAR_CMD_GET_DEMO = 15,\n\tLIGHTBAR_CMD_GET_PARAMS_V1 = 16,\n\tLIGHTBAR_CMD_SET_PARAMS_V1 = 17,\n\tLIGHTBAR_CMD_SET_PROGRAM = 18,\n\tLIGHTBAR_CMD_MANUAL_SUSPEND_CTRL = 19,\n\tLIGHTBAR_CMD_SUSPEND = 20,\n\tLIGHTBAR_CMD_RESUME = 21,\n\tLIGHTBAR_CMD_GET_PARAMS_V2_TIMING = 22,\n\tLIGHTBAR_CMD_SET_PARAMS_V2_TIMING = 23,\n\tLIGHTBAR_CMD_GET_PARAMS_V2_TAP = 24,\n\tLIGHTBAR_CMD_SET_PARAMS_V2_TAP = 25,\n\tLIGHTBAR_CMD_GET_PARAMS_V2_OSCILLATION = 26,\n\tLIGHTBAR_CMD_SET_PARAMS_V2_OSCILLATION = 27,\n\tLIGHTBAR_CMD_GET_PARAMS_V2_BRIGHTNESS = 28,\n\tLIGHTBAR_CMD_SET_PARAMS_V2_BRIGHTNESS = 29,\n\tLIGHTBAR_CMD_GET_PARAMS_V2_THRESHOLDS = 30,\n\tLIGHTBAR_CMD_SET_PARAMS_V2_THRESHOLDS = 31,\n\tLIGHTBAR_CMD_GET_PARAMS_V2_COLORS = 32,\n\tLIGHTBAR_CMD_SET_PARAMS_V2_COLORS = 33,\n\tLIGHTBAR_NUM_CMDS\n};\n\n/*****************************************************************************/\n/* LED control commands */\n\n#define EC_CMD_LED_CONTROL 0x0029\n\nenum ec_led_id {\n\t/* LED to indicate battery state of charge */\n\tEC_LED_ID_BATTERY_LED = 0,\n\t/*\n\t * LED to indicate system power state (on or in suspend).\n\t * May be on power button or on C-panel.\n\t */\n\tEC_LED_ID_POWER_LED,\n\t/* LED on power adapter or its plug */\n\tEC_LED_ID_ADAPTER_LED,\n\t/* LED to indicate left side */\n\tEC_LED_ID_LEFT_LED,\n\t/* LED to indicate right side */\n\tEC_LED_ID_RIGHT_LED,\n\t/* LED to indicate recovery mode with HW_REINIT */\n\tEC_LED_ID_RECOVERY_HW_REINIT_LED,\n\t/* LED to indicate sysrq debug mode. */\n\tEC_LED_ID_SYSRQ_DEBUG_LED,\n\n\tEC_LED_ID_COUNT\n};\n\n/* LED control flags */\n#define EC_LED_FLAGS_QUERY BIT(0) /* Query LED capability only */\n#define EC_LED_FLAGS_AUTO  BIT(1) /* Switch LED back to automatic control */\n\nenum ec_led_colors {\n\tEC_LED_COLOR_RED = 0,\n\tEC_LED_COLOR_GREEN,\n\tEC_LED_COLOR_BLUE,\n\tEC_LED_COLOR_YELLOW,\n\tEC_LED_COLOR_WHITE,\n\tEC_LED_COLOR_AMBER,\n\n\tEC_LED_COLOR_COUNT\n};\n\nstruct ec_params_led_control {\n\tuint8_t led_id;     /* Which LED to control */\n\tuint8_t flags;      /* Control flags */\n\n\tuint8_t brightness[EC_LED_COLOR_COUNT];\n} __ec_align1;\n\nstruct ec_response_led_control {\n\t/*\n\t * Available brightness value range.\n\t *\n\t * Range 0 means color channel not present.\n\t * Range 1 means on/off control.\n\t * Other values means the LED is control by PWM.\n\t */\n\tuint8_t brightness_range[EC_LED_COLOR_COUNT];\n} __ec_align1;\n\n/*****************************************************************************/\n/* Verified boot commands */\n\n/*\n * Note: command code 0x29 version 0 was VBOOT_CMD in Link EVT; it may be\n * reused for other purposes with version > 0.\n */\n\n/* Verified boot hash command */\n#define EC_CMD_VBOOT_HASH 0x002A\n\nstruct ec_params_vboot_hash {\n\tuint8_t cmd;             /* enum ec_vboot_hash_cmd */\n\tuint8_t hash_type;       /* enum ec_vboot_hash_type */\n\tuint8_t nonce_size;      /* Nonce size; may be 0 */\n\tuint8_t reserved0;       /* Reserved; set 0 */\n\tuint32_t offset;         /* Offset in flash to hash */\n\tuint32_t size;           /* Number of bytes to hash */\n\tuint8_t nonce_data[64];  /* Nonce data; ignored if nonce_size=0 */\n} __ec_align4;\n\nstruct ec_response_vboot_hash {\n\tuint8_t status;          /* enum ec_vboot_hash_status */\n\tuint8_t hash_type;       /* enum ec_vboot_hash_type */\n\tuint8_t digest_size;     /* Size of hash digest in bytes */\n\tuint8_t reserved0;       /* Ignore; will be 0 */\n\tuint32_t offset;         /* Offset in flash which was hashed */\n\tuint32_t size;           /* Number of bytes hashed */\n\tuint8_t hash_digest[64]; /* Hash digest data */\n} __ec_align4;\n\nenum ec_vboot_hash_cmd {\n\tEC_VBOOT_HASH_GET = 0,       /* Get current hash status */\n\tEC_VBOOT_HASH_ABORT = 1,     /* Abort calculating current hash */\n\tEC_VBOOT_HASH_START = 2,     /* Start computing a new hash */\n\tEC_VBOOT_HASH_RECALC = 3,    /* Synchronously compute a new hash */\n};\n\nenum ec_vboot_hash_type {\n\tEC_VBOOT_HASH_TYPE_SHA256 = 0, /* SHA-256 */\n};\n\nenum ec_vboot_hash_status {\n\tEC_VBOOT_HASH_STATUS_NONE = 0, /* No hash (not started, or aborted) */\n\tEC_VBOOT_HASH_STATUS_DONE = 1, /* Finished computing a hash */\n\tEC_VBOOT_HASH_STATUS_BUSY = 2, /* Busy computing a hash */\n};\n\n/*\n * Special values for offset for EC_VBOOT_HASH_START and EC_VBOOT_HASH_RECALC.\n * If one of these is specified, the EC will automatically update offset and\n * size to the correct values for the specified image (RO or RW).\n */\n#define EC_VBOOT_HASH_OFFSET_RO\t\t0xfffffffe\n#define EC_VBOOT_HASH_OFFSET_ACTIVE\t0xfffffffd\n#define EC_VBOOT_HASH_OFFSET_UPDATE\t0xfffffffc\n\n/*\n * 'RW' is vague if there are multiple RW images; we mean the active one,\n * so the old constant is deprecated.\n */\n#define EC_VBOOT_HASH_OFFSET_RW EC_VBOOT_HASH_OFFSET_ACTIVE\n\n/*****************************************************************************/\n/*\n * Motion sense commands. We'll make separate structs for sub-commands with\n * different input args, so that we know how much to expect.\n */\n#define EC_CMD_MOTION_SENSE_CMD 0x002B\n\n/* Motion sense commands */\nenum motionsense_command {\n\t/*\n\t * Dump command returns all motion sensor data including motion sense\n\t * module flags and individual sensor flags.\n\t */\n\tMOTIONSENSE_CMD_DUMP = 0,\n\n\t/*\n\t * Info command returns data describing the details of a given sensor,\n\t * including enum motionsensor_type, enum motionsensor_location, and\n\t * enum motionsensor_chip.\n\t */\n\tMOTIONSENSE_CMD_INFO = 1,\n\n\t/*\n\t * EC Rate command is a setter/getter command for the EC sampling rate\n\t * in milliseconds.\n\t * It is per sensor, the EC run sample task  at the minimum of all\n\t * sensors EC_RATE.\n\t * For sensors without hardware FIFO, EC_RATE should be equals to 1/ODR\n\t * to collect all the sensor samples.\n\t * For sensor with hardware FIFO, EC_RATE is used as the maximal delay\n\t * to process of all motion sensors in milliseconds.\n\t */\n\tMOTIONSENSE_CMD_EC_RATE = 2,\n\n\t/*\n\t * Sensor ODR command is a setter/getter command for the output data\n\t * rate of a specific motion sensor in millihertz.\n\t */\n\tMOTIONSENSE_CMD_SENSOR_ODR = 3,\n\n\t/*\n\t * Sensor range command is a setter/getter command for the range of\n\t * a specified motion sensor in +/-G's or +/- deg/s.\n\t */\n\tMOTIONSENSE_CMD_SENSOR_RANGE = 4,\n\n\t/*\n\t * Setter/getter command for the keyboard wake angle. When the lid\n\t * angle is greater than this value, keyboard wake is disabled in S3,\n\t * and when the lid angle goes less than this value, keyboard wake is\n\t * enabled. Note, the lid angle measurement is an approximate,\n\t * un-calibrated value, hence the wake angle isn't exact.\n\t */\n\tMOTIONSENSE_CMD_KB_WAKE_ANGLE = 5,\n\n\t/*\n\t * Returns a single sensor data.\n\t */\n\tMOTIONSENSE_CMD_DATA = 6,\n\n\t/*\n\t * Return sensor fifo info.\n\t */\n\tMOTIONSENSE_CMD_FIFO_INFO = 7,\n\n\t/*\n\t * Insert a flush element in the fifo and return sensor fifo info.\n\t * The host can use that element to synchronize its operation.\n\t */\n\tMOTIONSENSE_CMD_FIFO_FLUSH = 8,\n\n\t/*\n\t * Return a portion of the fifo.\n\t */\n\tMOTIONSENSE_CMD_FIFO_READ = 9,\n\n\t/*\n\t * Perform low level calibration.\n\t * On sensors that support it, ask to do offset calibration.\n\t */\n\tMOTIONSENSE_CMD_PERFORM_CALIB = 10,\n\n\t/*\n\t * Sensor Offset command is a setter/getter command for the offset\n\t * used for calibration.\n\t * The offsets can be calculated by the host, or via\n\t * PERFORM_CALIB command.\n\t */\n\tMOTIONSENSE_CMD_SENSOR_OFFSET = 11,\n\n\t/*\n\t * List available activities for a MOTION sensor.\n\t * Indicates if they are enabled or disabled.\n\t */\n\tMOTIONSENSE_CMD_LIST_ACTIVITIES = 12,\n\n\t/*\n\t * Activity management\n\t * Enable/Disable activity recognition.\n\t */\n\tMOTIONSENSE_CMD_SET_ACTIVITY = 13,\n\n\t/*\n\t * Lid Angle\n\t */\n\tMOTIONSENSE_CMD_LID_ANGLE = 14,\n\n\t/*\n\t * Allow the FIFO to trigger interrupt via MKBP events.\n\t * By default the FIFO does not send interrupt to process the FIFO\n\t * until the AP is ready or it is coming from a wakeup sensor.\n\t */\n\tMOTIONSENSE_CMD_FIFO_INT_ENABLE = 15,\n\n\t/*\n\t * Spoof the readings of the sensors.  The spoofed readings can be set\n\t * to arbitrary values, or will lock to the last read actual values.\n\t */\n\tMOTIONSENSE_CMD_SPOOF = 16,\n\n\t/* Set lid angle for tablet mode detection. */\n\tMOTIONSENSE_CMD_TABLET_MODE_LID_ANGLE = 17,\n\n\t/*\n\t * Sensor Scale command is a setter/getter command for the calibration\n\t * scale.\n\t */\n\tMOTIONSENSE_CMD_SENSOR_SCALE = 18,\n\n\t/* Number of motionsense sub-commands. */\n\tMOTIONSENSE_NUM_CMDS\n};\n\n/* List of motion sensor types. */\nenum motionsensor_type {\n\tMOTIONSENSE_TYPE_ACCEL = 0,\n\tMOTIONSENSE_TYPE_GYRO = 1,\n\tMOTIONSENSE_TYPE_MAG = 2,\n\tMOTIONSENSE_TYPE_PROX = 3,\n\tMOTIONSENSE_TYPE_LIGHT = 4,\n\tMOTIONSENSE_TYPE_ACTIVITY = 5,\n\tMOTIONSENSE_TYPE_BARO = 6,\n\tMOTIONSENSE_TYPE_SYNC = 7,\n\tMOTIONSENSE_TYPE_MAX,\n};\n\n/* List of motion sensor locations. */\nenum motionsensor_location {\n\tMOTIONSENSE_LOC_BASE = 0,\n\tMOTIONSENSE_LOC_LID = 1,\n\tMOTIONSENSE_LOC_CAMERA = 2,\n\tMOTIONSENSE_LOC_MAX,\n};\n\n/* List of motion sensor chips. */\nenum motionsensor_chip {\n\tMOTIONSENSE_CHIP_KXCJ9 = 0,\n\tMOTIONSENSE_CHIP_LSM6DS0 = 1,\n\tMOTIONSENSE_CHIP_BMI160 = 2,\n\tMOTIONSENSE_CHIP_SI1141 = 3,\n\tMOTIONSENSE_CHIP_SI1142 = 4,\n\tMOTIONSENSE_CHIP_SI1143 = 5,\n\tMOTIONSENSE_CHIP_KX022 = 6,\n\tMOTIONSENSE_CHIP_L3GD20H = 7,\n\tMOTIONSENSE_CHIP_BMA255 = 8,\n\tMOTIONSENSE_CHIP_BMP280 = 9,\n\tMOTIONSENSE_CHIP_OPT3001 = 10,\n\tMOTIONSENSE_CHIP_BH1730 = 11,\n\tMOTIONSENSE_CHIP_GPIO = 12,\n\tMOTIONSENSE_CHIP_LIS2DH = 13,\n\tMOTIONSENSE_CHIP_LSM6DSM = 14,\n\tMOTIONSENSE_CHIP_LIS2DE = 15,\n\tMOTIONSENSE_CHIP_LIS2MDL = 16,\n\tMOTIONSENSE_CHIP_LSM6DS3 = 17,\n\tMOTIONSENSE_CHIP_LSM6DSO = 18,\n\tMOTIONSENSE_CHIP_LNG2DM = 19,\n\tMOTIONSENSE_CHIP_MAX,\n};\n\n/* List of orientation positions */\nenum motionsensor_orientation {\n\tMOTIONSENSE_ORIENTATION_LANDSCAPE = 0,\n\tMOTIONSENSE_ORIENTATION_PORTRAIT = 1,\n\tMOTIONSENSE_ORIENTATION_UPSIDE_DOWN_PORTRAIT = 2,\n\tMOTIONSENSE_ORIENTATION_UPSIDE_DOWN_LANDSCAPE = 3,\n\tMOTIONSENSE_ORIENTATION_UNKNOWN = 4,\n};\n\nstruct ec_response_motion_sensor_data {\n\t/* Flags for each sensor. */\n\tuint8_t flags;\n\t/* Sensor number the data comes from. */\n\tuint8_t sensor_num;\n\t/* Each sensor is up to 3-axis. */\n\tunion {\n\t\tint16_t             data[3];\n\t\tstruct __ec_todo_packed {\n\t\t\tuint16_t    reserved;\n\t\t\tuint32_t    timestamp;\n\t\t};\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t     activity; /* motionsensor_activity */\n\t\t\tuint8_t     state;\n\t\t\tint16_t     add_info[2];\n\t\t};\n\t};\n} __ec_todo_packed;\n\n/* Note: used in ec_response_get_next_data */\nstruct ec_response_motion_sense_fifo_info {\n\t/* Size of the fifo */\n\tuint16_t size;\n\t/* Amount of space used in the fifo */\n\tuint16_t count;\n\t/* Timestamp recorded in us.\n\t * aka accurate timestamp when host event was triggered.\n\t */\n\tuint32_t timestamp;\n\t/* Total amount of vector lost */\n\tuint16_t total_lost;\n\t/* Lost events since the last fifo_info, per sensors */\n\tuint16_t lost[];\n} __ec_todo_packed;\n\nstruct ec_response_motion_sense_fifo_data {\n\tuint32_t number_data;\n\tstruct ec_response_motion_sensor_data data[];\n} __ec_todo_packed;\n\n/* List supported activity recognition */\nenum motionsensor_activity {\n\tMOTIONSENSE_ACTIVITY_RESERVED = 0,\n\tMOTIONSENSE_ACTIVITY_SIG_MOTION = 1,\n\tMOTIONSENSE_ACTIVITY_DOUBLE_TAP = 2,\n\tMOTIONSENSE_ACTIVITY_ORIENTATION = 3,\n};\n\nstruct ec_motion_sense_activity {\n\tuint8_t sensor_num;\n\tuint8_t activity; /* one of enum motionsensor_activity */\n\tuint8_t enable;   /* 1: enable, 0: disable */\n\tuint8_t reserved;\n\tuint16_t parameters[3]; /* activity dependent parameters */\n} __ec_todo_unpacked;\n\n/* Module flag masks used for the dump sub-command. */\n#define MOTIONSENSE_MODULE_FLAG_ACTIVE BIT(0)\n\n/* Sensor flag masks used for the dump sub-command. */\n#define MOTIONSENSE_SENSOR_FLAG_PRESENT BIT(0)\n\n/*\n * Flush entry for synchronization.\n * data contains time stamp\n */\n#define MOTIONSENSE_SENSOR_FLAG_FLUSH BIT(0)\n#define MOTIONSENSE_SENSOR_FLAG_TIMESTAMP BIT(1)\n#define MOTIONSENSE_SENSOR_FLAG_WAKEUP BIT(2)\n#define MOTIONSENSE_SENSOR_FLAG_TABLET_MODE BIT(3)\n#define MOTIONSENSE_SENSOR_FLAG_ODR BIT(4)\n\n/*\n * Send this value for the data element to only perform a read. If you\n * send any other value, the EC will interpret it as data to set and will\n * return the actual value set.\n */\n#define EC_MOTION_SENSE_NO_VALUE -1\n\n#define EC_MOTION_SENSE_INVALID_CALIB_TEMP 0x8000\n\n/* MOTIONSENSE_CMD_SENSOR_OFFSET subcommand flag */\n/* Set Calibration information */\n#define MOTION_SENSE_SET_OFFSET BIT(0)\n\n/* Default Scale value, factor 1. */\n#define MOTION_SENSE_DEFAULT_SCALE BIT(15)\n\n#define LID_ANGLE_UNRELIABLE 500\n\nenum motionsense_spoof_mode {\n\t/* Disable spoof mode. */\n\tMOTIONSENSE_SPOOF_MODE_DISABLE = 0,\n\n\t/* Enable spoof mode, but use provided component values. */\n\tMOTIONSENSE_SPOOF_MODE_CUSTOM,\n\n\t/* Enable spoof mode, but use the current sensor values. */\n\tMOTIONSENSE_SPOOF_MODE_LOCK_CURRENT,\n\n\t/* Query the current spoof mode status for the sensor. */\n\tMOTIONSENSE_SPOOF_MODE_QUERY,\n};\n\nstruct ec_params_motion_sense {\n\tuint8_t cmd;\n\tunion {\n\t\t/* Used for MOTIONSENSE_CMD_DUMP. */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * Maximal number of sensor the host is expecting.\n\t\t\t * 0 means the host is only interested in the number\n\t\t\t * of sensors controlled by the EC.\n\t\t\t */\n\t\t\tuint8_t max_sensor_count;\n\t\t} dump;\n\n\t\t/*\n\t\t * Used for MOTIONSENSE_CMD_KB_WAKE_ANGLE.\n\t\t */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/* Data to set or EC_MOTION_SENSE_NO_VALUE to read.\n\t\t\t * kb_wake_angle: angle to wakup AP.\n\t\t\t */\n\t\t\tint16_t data;\n\t\t} kb_wake_angle;\n\n\t\t/*\n\t\t * Used for MOTIONSENSE_CMD_INFO, MOTIONSENSE_CMD_DATA\n\t\t * and MOTIONSENSE_CMD_PERFORM_CALIB.\n\t\t */\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t sensor_num;\n\t\t} info, info_3, data, fifo_flush, perform_calib,\n\t\t\t\tlist_activities;\n\n\t\t/*\n\t\t * Used for MOTIONSENSE_CMD_EC_RATE, MOTIONSENSE_CMD_SENSOR_ODR\n\t\t * and MOTIONSENSE_CMD_SENSOR_RANGE.\n\t\t */\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t sensor_num;\n\n\t\t\t/* Rounding flag, true for round-up, false for down. */\n\t\t\tuint8_t roundup;\n\n\t\t\tuint16_t reserved;\n\n\t\t\t/* Data to set or EC_MOTION_SENSE_NO_VALUE to read. */\n\t\t\tint32_t data;\n\t\t} ec_rate, sensor_odr, sensor_range;\n\n\t\t/* Used for MOTIONSENSE_CMD_SENSOR_OFFSET */\n\t\tstruct __ec_todo_packed {\n\t\t\tuint8_t sensor_num;\n\n\t\t\t/*\n\t\t\t * bit 0: If set (MOTION_SENSE_SET_OFFSET), set\n\t\t\t * the calibration information in the EC.\n\t\t\t * If unset, just retrieve calibration information.\n\t\t\t */\n\t\t\tuint16_t flags;\n\n\t\t\t/*\n\t\t\t * Temperature at calibration, in units of 0.01 C\n\t\t\t * 0x8000: invalid / unknown.\n\t\t\t * 0x0: 0C\n\t\t\t * 0x7fff: +327.67C\n\t\t\t */\n\t\t\tint16_t temp;\n\n\t\t\t/*\n\t\t\t * Offset for calibration.\n\t\t\t * Unit:\n\t\t\t * Accelerometer: 1/1024 g\n\t\t\t * Gyro:          1/1024 deg/s\n\t\t\t * Compass:       1/16 uT\n\t\t\t */\n\t\t\tint16_t offset[3];\n\t\t} sensor_offset;\n\n\t\t/* Used for MOTIONSENSE_CMD_SENSOR_SCALE */\n\t\tstruct __ec_todo_packed {\n\t\t\tuint8_t sensor_num;\n\n\t\t\t/*\n\t\t\t * bit 0: If set (MOTION_SENSE_SET_OFFSET), set\n\t\t\t * the calibration information in the EC.\n\t\t\t * If unset, just retrieve calibration information.\n\t\t\t */\n\t\t\tuint16_t flags;\n\n\t\t\t/*\n\t\t\t * Temperature at calibration, in units of 0.01 C\n\t\t\t * 0x8000: invalid / unknown.\n\t\t\t * 0x0: 0C\n\t\t\t * 0x7fff: +327.67C\n\t\t\t */\n\t\t\tint16_t temp;\n\n\t\t\t/*\n\t\t\t * Scale for calibration:\n\t\t\t * By default scale is 1, it is encoded on 16bits:\n\t\t\t * 1 = BIT(15)\n\t\t\t * ~2 = 0xFFFF\n\t\t\t * ~0 = 0.\n\t\t\t */\n\t\t\tuint16_t scale[3];\n\t\t} sensor_scale;\n\n\n\t\t/* Used for MOTIONSENSE_CMD_FIFO_INFO */\n\t\t/* (no params) */\n\n\t\t/* Used for MOTIONSENSE_CMD_FIFO_READ */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * Number of expected vector to return.\n\t\t\t * EC may return less or 0 if none available.\n\t\t\t */\n\t\t\tuint32_t max_data_vector;\n\t\t} fifo_read;\n\n\t\tstruct ec_motion_sense_activity set_activity;\n\n\t\t/* Used for MOTIONSENSE_CMD_LID_ANGLE */\n\t\t/* (no params) */\n\n\t\t/* Used for MOTIONSENSE_CMD_FIFO_INT_ENABLE */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * 1: enable, 0 disable fifo,\n\t\t\t * EC_MOTION_SENSE_NO_VALUE return value.\n\t\t\t */\n\t\t\tint8_t enable;\n\t\t} fifo_int_enable;\n\n\t\t/* Used for MOTIONSENSE_CMD_SPOOF */\n\t\tstruct __ec_todo_packed {\n\t\t\tuint8_t sensor_id;\n\n\t\t\t/* See enum motionsense_spoof_mode. */\n\t\t\tuint8_t spoof_enable;\n\n\t\t\t/* Ignored, used for alignment. */\n\t\t\tuint8_t reserved;\n\n\t\t\t/* Individual component values to spoof. */\n\t\t\tint16_t components[3];\n\t\t} spoof;\n\n\t\t/* Used for MOTIONSENSE_CMD_TABLET_MODE_LID_ANGLE. */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * Lid angle threshold for switching between tablet and\n\t\t\t * clamshell mode.\n\t\t\t */\n\t\t\tint16_t lid_angle;\n\n\t\t\t/*\n\t\t\t * Hysteresis degree to prevent fluctuations between\n\t\t\t * clamshell and tablet mode if lid angle keeps\n\t\t\t * changing around the threshold. Lid motion driver will\n\t\t\t * use lid_angle + hys_degree to trigger tablet mode and\n\t\t\t * lid_angle - hys_degree to trigger clamshell mode.\n\t\t\t */\n\t\t\tint16_t hys_degree;\n\t\t} tablet_mode_threshold;\n\t};\n} __ec_todo_packed;\n\nstruct ec_response_motion_sense {\n\tunion {\n\t\t/* Used for MOTIONSENSE_CMD_DUMP */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/* Flags representing the motion sensor module. */\n\t\t\tuint8_t module_flags;\n\n\t\t\t/* Number of sensors managed directly by the EC. */\n\t\t\tuint8_t sensor_count;\n\n\t\t\t/*\n\t\t\t * Sensor data is truncated if response_max is too small\n\t\t\t * for holding all the data.\n\t\t\t */\n\t\t\tstruct ec_response_motion_sensor_data sensor[0];\n\t\t} dump;\n\n\t\t/* Used for MOTIONSENSE_CMD_INFO. */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/* Should be element of enum motionsensor_type. */\n\t\t\tuint8_t type;\n\n\t\t\t/* Should be element of enum motionsensor_location. */\n\t\t\tuint8_t location;\n\n\t\t\t/* Should be element of enum motionsensor_chip. */\n\t\t\tuint8_t chip;\n\t\t} info;\n\n\t\t/* Used for MOTIONSENSE_CMD_INFO version 3 */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/* Should be element of enum motionsensor_type. */\n\t\t\tuint8_t type;\n\n\t\t\t/* Should be element of enum motionsensor_location. */\n\t\t\tuint8_t location;\n\n\t\t\t/* Should be element of enum motionsensor_chip. */\n\t\t\tuint8_t chip;\n\n\t\t\t/* Minimum sensor sampling frequency */\n\t\t\tuint32_t min_frequency;\n\n\t\t\t/* Maximum sensor sampling frequency */\n\t\t\tuint32_t max_frequency;\n\n\t\t\t/* Max number of sensor events that could be in fifo */\n\t\t\tuint32_t fifo_max_event_count;\n\t\t} info_3;\n\n\t\t/* Used for MOTIONSENSE_CMD_DATA */\n\t\tstruct ec_response_motion_sensor_data data;\n\n\t\t/*\n\t\t * Used for MOTIONSENSE_CMD_EC_RATE, MOTIONSENSE_CMD_SENSOR_ODR,\n\t\t * MOTIONSENSE_CMD_SENSOR_RANGE,\n\t\t * MOTIONSENSE_CMD_KB_WAKE_ANGLE,\n\t\t * MOTIONSENSE_CMD_FIFO_INT_ENABLE and\n\t\t * MOTIONSENSE_CMD_SPOOF.\n\t\t */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/* Current value of the parameter queried. */\n\t\t\tint32_t ret;\n\t\t} ec_rate, sensor_odr, sensor_range, kb_wake_angle,\n\t\t  fifo_int_enable, spoof;\n\n\t\t/*\n\t\t * Used for MOTIONSENSE_CMD_SENSOR_OFFSET,\n\t\t * PERFORM_CALIB.\n\t\t */\n\t\tstruct __ec_todo_unpacked  {\n\t\t\tint16_t temp;\n\t\t\tint16_t offset[3];\n\t\t} sensor_offset, perform_calib;\n\n\t\t/* Used for MOTIONSENSE_CMD_SENSOR_SCALE */\n\t\tstruct __ec_todo_unpacked  {\n\t\t\tint16_t temp;\n\t\t\tuint16_t scale[3];\n\t\t} sensor_scale;\n\n\t\tstruct ec_response_motion_sense_fifo_info fifo_info, fifo_flush;\n\n\t\tstruct ec_response_motion_sense_fifo_data fifo_read;\n\n\t\tstruct __ec_todo_packed {\n\t\t\tuint16_t reserved;\n\t\t\tuint32_t enabled;\n\t\t\tuint32_t disabled;\n\t\t} list_activities;\n\n\t\t/* No params for set activity */\n\n\t\t/* Used for MOTIONSENSE_CMD_LID_ANGLE */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * Angle between 0 and 360 degree if available,\n\t\t\t * LID_ANGLE_UNRELIABLE otherwise.\n\t\t\t */\n\t\t\tuint16_t value;\n\t\t} lid_angle;\n\n\t\t/* Used for MOTIONSENSE_CMD_TABLET_MODE_LID_ANGLE. */\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * Lid angle threshold for switching between tablet and\n\t\t\t * clamshell mode.\n\t\t\t */\n\t\t\tuint16_t lid_angle;\n\n\t\t\t/* Hysteresis degree. */\n\t\t\tuint16_t hys_degree;\n\t\t} tablet_mode_threshold;\n\n\t};\n} __ec_todo_packed;\n\n/*****************************************************************************/\n/* Force lid open command */\n\n/* Make lid event always open */\n#define EC_CMD_FORCE_LID_OPEN 0x002C\n\nstruct ec_params_force_lid_open {\n\tuint8_t enabled;\n} __ec_align1;\n\n/*****************************************************************************/\n/* Configure the behavior of the power button */\n#define EC_CMD_CONFIG_POWER_BUTTON 0x002D\n\nenum ec_config_power_button_flags {\n\t/* Enable/Disable power button pulses for x86 devices */\n\tEC_POWER_BUTTON_ENABLE_PULSE = BIT(0),\n};\n\nstruct ec_params_config_power_button {\n\t/* See enum ec_config_power_button_flags */\n\tuint8_t flags;\n} __ec_align1;\n\n/*****************************************************************************/\n/* USB charging control commands */\n\n/* Set USB port charging mode */\n#define EC_CMD_USB_CHARGE_SET_MODE 0x0030\n\nstruct ec_params_usb_charge_set_mode {\n\tuint8_t usb_port_id;\n\tuint8_t mode:7;\n\tuint8_t inhibit_charge:1;\n} __ec_align1;\n\n/*****************************************************************************/\n/* Persistent storage for host */\n\n/* Maximum bytes that can be read/written in a single command */\n#define EC_PSTORE_SIZE_MAX 64\n\n/* Get persistent storage info */\n#define EC_CMD_PSTORE_INFO 0x0040\n\nstruct ec_response_pstore_info {\n\t/* Persistent storage size, in bytes */\n\tuint32_t pstore_size;\n\t/* Access size; read/write offset and size must be a multiple of this */\n\tuint32_t access_size;\n} __ec_align4;\n\n/*\n * Read persistent storage\n *\n * Response is params.size bytes of data.\n */\n#define EC_CMD_PSTORE_READ 0x0041\n\nstruct ec_params_pstore_read {\n\tuint32_t offset;   /* Byte offset to read */\n\tuint32_t size;     /* Size to read in bytes */\n} __ec_align4;\n\n/* Write persistent storage */\n#define EC_CMD_PSTORE_WRITE 0x0042\n\nstruct ec_params_pstore_write {\n\tuint32_t offset;   /* Byte offset to write */\n\tuint32_t size;     /* Size to write in bytes */\n\tuint8_t data[EC_PSTORE_SIZE_MAX];\n} __ec_align4;\n\n/*****************************************************************************/\n/* Real-time clock */\n\n/* RTC params and response structures */\nstruct ec_params_rtc {\n\tuint32_t time;\n} __ec_align4;\n\nstruct ec_response_rtc {\n\tuint32_t time;\n} __ec_align4;\n\n/* These use ec_response_rtc */\n#define EC_CMD_RTC_GET_VALUE 0x0044\n#define EC_CMD_RTC_GET_ALARM 0x0045\n\n/* These all use ec_params_rtc */\n#define EC_CMD_RTC_SET_VALUE 0x0046\n#define EC_CMD_RTC_SET_ALARM 0x0047\n\n/* Pass as time param to SET_ALARM to clear the current alarm */\n#define EC_RTC_ALARM_CLEAR 0\n\n/*****************************************************************************/\n/* Port80 log access */\n\n/* Maximum entries that can be read/written in a single command */\n#define EC_PORT80_SIZE_MAX 32\n\n/* Get last port80 code from previous boot */\n#define EC_CMD_PORT80_LAST_BOOT 0x0048\n#define EC_CMD_PORT80_READ 0x0048\n\nenum ec_port80_subcmd {\n\tEC_PORT80_GET_INFO = 0,\n\tEC_PORT80_READ_BUFFER,\n};\n\nstruct ec_params_port80_read {\n\tuint16_t subcmd;\n\tunion {\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint32_t offset;\n\t\t\tuint32_t num_entries;\n\t\t} read_buffer;\n\t};\n} __ec_todo_packed;\n\nstruct ec_response_port80_read {\n\tunion {\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint32_t writes;\n\t\t\tuint32_t history_size;\n\t\t\tuint32_t last_boot;\n\t\t} get_info;\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint16_t codes[EC_PORT80_SIZE_MAX];\n\t\t} data;\n\t};\n} __ec_todo_packed;\n\nstruct ec_response_port80_last_boot {\n\tuint16_t code;\n} __ec_align2;\n\n/*****************************************************************************/\n/* Temporary secure storage for host verified boot use */\n\n/* Number of bytes in a vstore slot */\n#define EC_VSTORE_SLOT_SIZE 64\n\n/* Maximum number of vstore slots */\n#define EC_VSTORE_SLOT_MAX 32\n\n/* Get persistent storage info */\n#define EC_CMD_VSTORE_INFO 0x0049\nstruct ec_response_vstore_info {\n\t/* Indicates which slots are locked */\n\tuint32_t slot_locked;\n\t/* Total number of slots available */\n\tuint8_t slot_count;\n} __ec_align_size1;\n\n/*\n * Read temporary secure storage\n *\n * Response is EC_VSTORE_SLOT_SIZE bytes of data.\n */\n#define EC_CMD_VSTORE_READ 0x004A\n\nstruct ec_params_vstore_read {\n\tuint8_t slot; /* Slot to read from */\n} __ec_align1;\n\nstruct ec_response_vstore_read {\n\tuint8_t data[EC_VSTORE_SLOT_SIZE];\n} __ec_align1;\n\n/*\n * Write temporary secure storage and lock it.\n */\n#define EC_CMD_VSTORE_WRITE 0x004B\n\nstruct ec_params_vstore_write {\n\tuint8_t slot; /* Slot to write to */\n\tuint8_t data[EC_VSTORE_SLOT_SIZE];\n} __ec_align1;\n\n/*****************************************************************************/\n/* Thermal engine commands. Note that there are two implementations. We'll\n * reuse the command number, but the data and behavior is incompatible.\n * Version 0 is what originally shipped on Link.\n * Version 1 separates the CPU thermal limits from the fan control.\n */\n\n#define EC_CMD_THERMAL_SET_THRESHOLD 0x0050\n#define EC_CMD_THERMAL_GET_THRESHOLD 0x0051\n\n/* The version 0 structs are opaque. You have to know what they are for\n * the get/set commands to make any sense.\n */\n\n/* Version 0 - set */\nstruct ec_params_thermal_set_threshold {\n\tuint8_t sensor_type;\n\tuint8_t threshold_id;\n\tuint16_t value;\n} __ec_align2;\n\n/* Version 0 - get */\nstruct ec_params_thermal_get_threshold {\n\tuint8_t sensor_type;\n\tuint8_t threshold_id;\n} __ec_align1;\n\nstruct ec_response_thermal_get_threshold {\n\tuint16_t value;\n} __ec_align2;\n\n\n/* The version 1 structs are visible. */\nenum ec_temp_thresholds {\n\tEC_TEMP_THRESH_WARN = 0,\n\tEC_TEMP_THRESH_HIGH,\n\tEC_TEMP_THRESH_HALT,\n\n\tEC_TEMP_THRESH_COUNT\n};\n\n/*\n * Thermal configuration for one temperature sensor. Temps are in degrees K.\n * Zero values will be silently ignored by the thermal task.\n *\n * Set 'temp_host' value allows thermal task to trigger some event with 1 degree\n * hysteresis.\n * For example,\n *\ttemp_host[EC_TEMP_THRESH_HIGH] = 300 K\n *\ttemp_host_release[EC_TEMP_THRESH_HIGH] = 0 K\n * EC will throttle ap when temperature >= 301 K, and release throttling when\n * temperature <= 299 K.\n *\n * Set 'temp_host_release' value allows thermal task has a custom hysteresis.\n * For example,\n *\ttemp_host[EC_TEMP_THRESH_HIGH] = 300 K\n *\ttemp_host_release[EC_TEMP_THRESH_HIGH] = 295 K\n * EC will throttle ap when temperature >= 301 K, and release throttling when\n * temperature <= 294 K.\n *\n * Note that this structure is a sub-structure of\n * ec_params_thermal_set_threshold_v1, but maintains its alignment there.\n */\nstruct ec_thermal_config {\n\tuint32_t temp_host[EC_TEMP_THRESH_COUNT]; /* levels of hotness */\n\tuint32_t temp_host_release[EC_TEMP_THRESH_COUNT]; /* release levels */\n\tuint32_t temp_fan_off;\t\t/* no active cooling needed */\n\tuint32_t temp_fan_max;\t\t/* max active cooling needed */\n} __ec_align4;\n\n/* Version 1 - get config for one sensor. */\nstruct ec_params_thermal_get_threshold_v1 {\n\tuint32_t sensor_num;\n} __ec_align4;\n/* This returns a struct ec_thermal_config */\n\n/*\n * Version 1 - set config for one sensor.\n * Use read-modify-write for best results!\n */\nstruct ec_params_thermal_set_threshold_v1 {\n\tuint32_t sensor_num;\n\tstruct ec_thermal_config cfg;\n} __ec_align4;\n/* This returns no data */\n\n/****************************************************************************/\n\n/* Toggle automatic fan control */\n#define EC_CMD_THERMAL_AUTO_FAN_CTRL 0x0052\n\n/* Version 1 of input params */\nstruct ec_params_auto_fan_ctrl_v1 {\n\tuint8_t fan_idx;\n} __ec_align1;\n\n/* Get/Set TMP006 calibration data */\n#define EC_CMD_TMP006_GET_CALIBRATION 0x0053\n#define EC_CMD_TMP006_SET_CALIBRATION 0x0054\n\n/*\n * The original TMP006 calibration only needed four params, but now we need\n * more. Since the algorithm is nothing but magic numbers anyway, we'll leave\n * the params opaque. The v1 \"get\" response will include the algorithm number\n * and how many params it requires. That way we can change the EC code without\n * needing to update this file. We can also use a different algorithm on each\n * sensor.\n */\n\n/* This is the same struct for both v0 and v1. */\nstruct ec_params_tmp006_get_calibration {\n\tuint8_t index;\n} __ec_align1;\n\n/* Version 0 */\nstruct ec_response_tmp006_get_calibration_v0 {\n\tfloat s0;\n\tfloat b0;\n\tfloat b1;\n\tfloat b2;\n} __ec_align4;\n\nstruct ec_params_tmp006_set_calibration_v0 {\n\tuint8_t index;\n\tuint8_t reserved[3];\n\tfloat s0;\n\tfloat b0;\n\tfloat b1;\n\tfloat b2;\n} __ec_align4;\n\n/* Version 1 */\nstruct ec_response_tmp006_get_calibration_v1 {\n\tuint8_t algorithm;\n\tuint8_t num_params;\n\tuint8_t reserved[2];\n\tfloat val[];\n} __ec_align4;\n\nstruct ec_params_tmp006_set_calibration_v1 {\n\tuint8_t index;\n\tuint8_t algorithm;\n\tuint8_t num_params;\n\tuint8_t reserved;\n\tfloat val[];\n} __ec_align4;\n\n\n/* Read raw TMP006 data */\n#define EC_CMD_TMP006_GET_RAW 0x0055\n\nstruct ec_params_tmp006_get_raw {\n\tuint8_t index;\n} __ec_align1;\n\nstruct ec_response_tmp006_get_raw {\n\tint32_t t;  /* In 1/100 K */\n\tint32_t v;  /* In nV */\n} __ec_align4;\n\n/*****************************************************************************/\n/* MKBP - Matrix KeyBoard Protocol */\n\n/*\n * Read key state\n *\n * Returns raw data for keyboard cols; see ec_response_mkbp_info.cols for\n * expected response size.\n *\n * NOTE: This has been superseded by EC_CMD_MKBP_GET_NEXT_EVENT.  If you wish\n * to obtain the instantaneous state, use EC_CMD_MKBP_INFO with the type\n * EC_MKBP_INFO_CURRENT and event EC_MKBP_EVENT_KEY_MATRIX.\n */\n#define EC_CMD_MKBP_STATE 0x0060\n\n/*\n * Provide information about various MKBP things.  See enum ec_mkbp_info_type.\n */\n#define EC_CMD_MKBP_INFO 0x0061\n\nstruct ec_response_mkbp_info {\n\tuint32_t rows;\n\tuint32_t cols;\n\t/* Formerly \"switches\", which was 0. */\n\tuint8_t reserved;\n} __ec_align_size1;\n\nstruct ec_params_mkbp_info {\n\tuint8_t info_type;\n\tuint8_t event_type;\n} __ec_align1;\n\nenum ec_mkbp_info_type {\n\t/*\n\t * Info about the keyboard matrix: number of rows and columns.\n\t *\n\t * Returns struct ec_response_mkbp_info.\n\t */\n\tEC_MKBP_INFO_KBD = 0,\n\n\t/*\n\t * For buttons and switches, info about which specifically are\n\t * supported.  event_type must be set to one of the values in enum\n\t * ec_mkbp_event.\n\t *\n\t * For EC_MKBP_EVENT_BUTTON and EC_MKBP_EVENT_SWITCH, returns a 4 byte\n\t * bitmask indicating which buttons or switches are present.  See the\n\t * bit inidices below.\n\t */\n\tEC_MKBP_INFO_SUPPORTED = 1,\n\n\t/*\n\t * Instantaneous state of buttons and switches.\n\t *\n\t * event_type must be set to one of the values in enum ec_mkbp_event.\n\t *\n\t * For EC_MKBP_EVENT_KEY_MATRIX, returns uint8_t key_matrix[13]\n\t * indicating the current state of the keyboard matrix.\n\t *\n\t * For EC_MKBP_EVENT_HOST_EVENT, return uint32_t host_event, the raw\n\t * event state.\n\t *\n\t * For EC_MKBP_EVENT_BUTTON, returns uint32_t buttons, indicating the\n\t * state of supported buttons.\n\t *\n\t * For EC_MKBP_EVENT_SWITCH, returns uint32_t switches, indicating the\n\t * state of supported switches.\n\t */\n\tEC_MKBP_INFO_CURRENT = 2,\n};\n\n/* Simulate key press */\n#define EC_CMD_MKBP_SIMULATE_KEY 0x0062\n\nstruct ec_params_mkbp_simulate_key {\n\tuint8_t col;\n\tuint8_t row;\n\tuint8_t pressed;\n} __ec_align1;\n\n#define EC_CMD_GET_KEYBOARD_ID 0x0063\n\nstruct ec_response_keyboard_id {\n\tuint32_t keyboard_id;\n} __ec_align4;\n\nenum keyboard_id {\n\tKEYBOARD_ID_UNSUPPORTED = 0,\n\tKEYBOARD_ID_UNREADABLE = 0xffffffff,\n};\n\n/* Configure keyboard scanning */\n#define EC_CMD_MKBP_SET_CONFIG 0x0064\n#define EC_CMD_MKBP_GET_CONFIG 0x0065\n\n/* flags */\nenum mkbp_config_flags {\n\tEC_MKBP_FLAGS_ENABLE = 1,\t/* Enable keyboard scanning */\n};\n\nenum mkbp_config_valid {\n\tEC_MKBP_VALID_SCAN_PERIOD\t\t= BIT(0),\n\tEC_MKBP_VALID_POLL_TIMEOUT\t\t= BIT(1),\n\tEC_MKBP_VALID_MIN_POST_SCAN_DELAY\t= BIT(3),\n\tEC_MKBP_VALID_OUTPUT_SETTLE\t\t= BIT(4),\n\tEC_MKBP_VALID_DEBOUNCE_DOWN\t\t= BIT(5),\n\tEC_MKBP_VALID_DEBOUNCE_UP\t\t= BIT(6),\n\tEC_MKBP_VALID_FIFO_MAX_DEPTH\t\t= BIT(7),\n};\n\n/*\n * Configuration for our key scanning algorithm.\n *\n * Note that this is used as a sub-structure of\n * ec_{params/response}_mkbp_get_config.\n */\nstruct ec_mkbp_config {\n\tuint32_t valid_mask;\t\t/* valid fields */\n\tuint8_t flags;\t\t/* some flags (enum mkbp_config_flags) */\n\tuint8_t valid_flags;\t\t/* which flags are valid */\n\tuint16_t scan_period_us;\t/* period between start of scans */\n\t/* revert to interrupt mode after no activity for this long */\n\tuint32_t poll_timeout_us;\n\t/*\n\t * minimum post-scan relax time. Once we finish a scan we check\n\t * the time until we are due to start the next one. If this time is\n\t * shorter this field, we use this instead.\n\t */\n\tuint16_t min_post_scan_delay_us;\n\t/* delay between setting up output and waiting for it to settle */\n\tuint16_t output_settle_us;\n\tuint16_t debounce_down_us;\t/* time for debounce on key down */\n\tuint16_t debounce_up_us;\t/* time for debounce on key up */\n\t/* maximum depth to allow for fifo (0 = no keyscan output) */\n\tuint8_t fifo_max_depth;\n} __ec_align_size1;\n\nstruct ec_params_mkbp_set_config {\n\tstruct ec_mkbp_config config;\n} __ec_align_size1;\n\nstruct ec_response_mkbp_get_config {\n\tstruct ec_mkbp_config config;\n} __ec_align_size1;\n\n/* Run the key scan emulation */\n#define EC_CMD_KEYSCAN_SEQ_CTRL 0x0066\n\nenum ec_keyscan_seq_cmd {\n\tEC_KEYSCAN_SEQ_STATUS = 0,\t/* Get status information */\n\tEC_KEYSCAN_SEQ_CLEAR = 1,\t/* Clear sequence */\n\tEC_KEYSCAN_SEQ_ADD = 2,\t\t/* Add item to sequence */\n\tEC_KEYSCAN_SEQ_START = 3,\t/* Start running sequence */\n\tEC_KEYSCAN_SEQ_COLLECT = 4,\t/* Collect sequence summary data */\n};\n\nenum ec_collect_flags {\n\t/*\n\t * Indicates this scan was processed by the EC. Due to timing, some\n\t * scans may be skipped.\n\t */\n\tEC_KEYSCAN_SEQ_FLAG_DONE\t= BIT(0),\n};\n\nstruct ec_collect_item {\n\tuint8_t flags;\t\t/* some flags (enum ec_collect_flags) */\n} __ec_align1;\n\nstruct ec_params_keyscan_seq_ctrl {\n\tuint8_t cmd;\t/* Command to send (enum ec_keyscan_seq_cmd) */\n\tunion {\n\t\tstruct __ec_align1 {\n\t\t\tuint8_t active;\t\t/* still active */\n\t\t\tuint8_t num_items;\t/* number of items */\n\t\t\t/* Current item being presented */\n\t\t\tuint8_t cur_item;\n\t\t} status;\n\t\tstruct __ec_todo_unpacked {\n\t\t\t/*\n\t\t\t * Absolute time for this scan, measured from the\n\t\t\t * start of the sequence.\n\t\t\t */\n\t\t\tuint32_t time_us;\n\t\t\tuint8_t scan[0];\t/* keyscan data */\n\t\t} add;\n\t\tstruct __ec_align1 {\n\t\t\tuint8_t start_item;\t/* First item to return */\n\t\t\tuint8_t num_items;\t/* Number of items to return */\n\t\t} collect;\n\t};\n} __ec_todo_packed;\n\nstruct ec_result_keyscan_seq_ctrl {\n\tunion {\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t num_items;\t/* Number of items */\n\t\t\t/* Data for each item */\n\t\t\tstruct ec_collect_item item[0];\n\t\t} collect;\n\t};\n} __ec_todo_packed;\n\n/*\n * Get the next pending MKBP event.\n *\n * Returns EC_RES_UNAVAILABLE if there is no event pending.\n */\n#define EC_CMD_GET_NEXT_EVENT 0x0067\n\n#define EC_MKBP_HAS_MORE_EVENTS_SHIFT 7\n\n/*\n * We use the most significant bit of the event type to indicate to the host\n * that the EC has more MKBP events available to provide.\n */\n#define EC_MKBP_HAS_MORE_EVENTS BIT(EC_MKBP_HAS_MORE_EVENTS_SHIFT)\n\n/* The mask to apply to get the raw event type */\n#define EC_MKBP_EVENT_TYPE_MASK (BIT(EC_MKBP_HAS_MORE_EVENTS_SHIFT) - 1)\n\nenum ec_mkbp_event {\n\t/* Keyboard matrix changed. The event data is the new matrix state. */\n\tEC_MKBP_EVENT_KEY_MATRIX = 0,\n\n\t/* New host event. The event data is 4 bytes of host event flags. */\n\tEC_MKBP_EVENT_HOST_EVENT = 1,\n\n\t/* New Sensor FIFO data. The event data is fifo_info structure. */\n\tEC_MKBP_EVENT_SENSOR_FIFO = 2,\n\n\t/* The state of the non-matrixed buttons have changed. */\n\tEC_MKBP_EVENT_BUTTON = 3,\n\n\t/* The state of the switches have changed. */\n\tEC_MKBP_EVENT_SWITCH = 4,\n\n\t/* New Fingerprint sensor event, the event data is fp_events bitmap. */\n\tEC_MKBP_EVENT_FINGERPRINT = 5,\n\n\t/*\n\t * Sysrq event: send emulated sysrq. The event data is sysrq,\n\t * corresponding to the key to be pressed.\n\t */\n\tEC_MKBP_EVENT_SYSRQ = 6,\n\n\t/*\n\t * New 64-bit host event.\n\t * The event data is 8 bytes of host event flags.\n\t */\n\tEC_MKBP_EVENT_HOST_EVENT64 = 7,\n\n\t/* Notify the AP that something happened on CEC */\n\tEC_MKBP_EVENT_CEC_EVENT = 8,\n\n\t/* Send an incoming CEC message to the AP */\n\tEC_MKBP_EVENT_CEC_MESSAGE = 9,\n\n\t/* Number of MKBP events */\n\tEC_MKBP_EVENT_COUNT,\n};\nBUILD_ASSERT(EC_MKBP_EVENT_COUNT <= EC_MKBP_EVENT_TYPE_MASK);\n\nunion __ec_align_offset1 ec_response_get_next_data {\n\tuint8_t key_matrix[13];\n\n\t/* Unaligned */\n\tuint32_t host_event;\n\tuint64_t host_event64;\n\n\tstruct __ec_todo_unpacked {\n\t\t/* For aligning the fifo_info */\n\t\tuint8_t reserved[3];\n\t\tstruct ec_response_motion_sense_fifo_info info;\n\t} sensor_fifo;\n\n\tuint32_t buttons;\n\n\tuint32_t switches;\n\n\tuint32_t fp_events;\n\n\tuint32_t sysrq;\n\n\t/* CEC events from enum mkbp_cec_event */\n\tuint32_t cec_events;\n};\n\nunion __ec_align_offset1 ec_response_get_next_data_v1 {\n\tuint8_t key_matrix[16];\n\n\t/* Unaligned */\n\tuint32_t host_event;\n\tuint64_t host_event64;\n\n\tstruct __ec_todo_unpacked {\n\t\t/* For aligning the fifo_info */\n\t\tuint8_t reserved[3];\n\t\tstruct ec_response_motion_sense_fifo_info info;\n\t} sensor_fifo;\n\n\tuint32_t buttons;\n\n\tuint32_t switches;\n\n\tuint32_t fp_events;\n\n\tuint32_t sysrq;\n\n\t/* CEC events from enum mkbp_cec_event */\n\tuint32_t cec_events;\n\n\tuint8_t cec_message[16];\n};\nBUILD_ASSERT(sizeof(union ec_response_get_next_data_v1) == 16);\n\nstruct ec_response_get_next_event {\n\tuint8_t event_type;\n\t/* Followed by event data if any */\n\tunion ec_response_get_next_data data;\n} __ec_align1;\n\nstruct ec_response_get_next_event_v1 {\n\tuint8_t event_type;\n\t/* Followed by event data if any */\n\tunion ec_response_get_next_data_v1 data;\n} __ec_align1;\n\n/* Bit indices for buttons and switches.*/\n/* Buttons */\n#define EC_MKBP_POWER_BUTTON\t0\n#define EC_MKBP_VOL_UP\t\t1\n#define EC_MKBP_VOL_DOWN\t2\n#define EC_MKBP_RECOVERY\t3\n\n/* Switches */\n#define EC_MKBP_LID_OPEN\t0\n#define EC_MKBP_TABLET_MODE\t1\n#define EC_MKBP_BASE_ATTACHED\t2\n\n/* Run keyboard factory test scanning */\n#define EC_CMD_KEYBOARD_FACTORY_TEST 0x0068\n\nstruct ec_response_keyboard_factory_test {\n\tuint16_t shorted;\t/* Keyboard pins are shorted */\n} __ec_align2;\n\n/* Fingerprint events in 'fp_events' for EC_MKBP_EVENT_FINGERPRINT */\n#define EC_MKBP_FP_RAW_EVENT(fp_events) ((fp_events) & 0x00FFFFFF)\n#define EC_MKBP_FP_ERRCODE(fp_events)   ((fp_events) & 0x0000000F)\n#define EC_MKBP_FP_ENROLL_PROGRESS_OFFSET 4\n#define EC_MKBP_FP_ENROLL_PROGRESS(fpe) (((fpe) & 0x00000FF0) \\\n\t\t\t\t\t >> EC_MKBP_FP_ENROLL_PROGRESS_OFFSET)\n#define EC_MKBP_FP_MATCH_IDX_OFFSET 12\n#define EC_MKBP_FP_MATCH_IDX_MASK 0x0000F000\n#define EC_MKBP_FP_MATCH_IDX(fpe) (((fpe) & EC_MKBP_FP_MATCH_IDX_MASK) \\\n\t\t\t\t\t >> EC_MKBP_FP_MATCH_IDX_OFFSET)\n#define EC_MKBP_FP_ENROLL               BIT(27)\n#define EC_MKBP_FP_MATCH                BIT(28)\n#define EC_MKBP_FP_FINGER_DOWN          BIT(29)\n#define EC_MKBP_FP_FINGER_UP            BIT(30)\n#define EC_MKBP_FP_IMAGE_READY          BIT(31)\n/* code given by EC_MKBP_FP_ERRCODE() when EC_MKBP_FP_ENROLL is set */\n#define EC_MKBP_FP_ERR_ENROLL_OK               0\n#define EC_MKBP_FP_ERR_ENROLL_LOW_QUALITY      1\n#define EC_MKBP_FP_ERR_ENROLL_IMMOBILE         2\n#define EC_MKBP_FP_ERR_ENROLL_LOW_COVERAGE     3\n#define EC_MKBP_FP_ERR_ENROLL_INTERNAL         5\n/* Can be used to detect if image was usable for enrollment or not. */\n#define EC_MKBP_FP_ERR_ENROLL_PROBLEM_MASK     1\n/* code given by EC_MKBP_FP_ERRCODE() when EC_MKBP_FP_MATCH is set */\n#define EC_MKBP_FP_ERR_MATCH_NO                0\n#define EC_MKBP_FP_ERR_MATCH_NO_INTERNAL       6\n#define EC_MKBP_FP_ERR_MATCH_NO_TEMPLATES      7\n#define EC_MKBP_FP_ERR_MATCH_NO_LOW_QUALITY    2\n#define EC_MKBP_FP_ERR_MATCH_NO_LOW_COVERAGE   4\n#define EC_MKBP_FP_ERR_MATCH_YES               1\n#define EC_MKBP_FP_ERR_MATCH_YES_UPDATED       3\n#define EC_MKBP_FP_ERR_MATCH_YES_UPDATE_FAILED 5\n\n\n/*****************************************************************************/\n/* Temperature sensor commands */\n\n/* Read temperature sensor info */\n#define EC_CMD_TEMP_SENSOR_GET_INFO 0x0070\n\nstruct ec_params_temp_sensor_get_info {\n\tuint8_t id;\n} __ec_align1;\n\nstruct ec_response_temp_sensor_get_info {\n\tchar sensor_name[32];\n\tuint8_t sensor_type;\n} __ec_align1;\n\n/*****************************************************************************/\n\n/*\n * Note: host commands 0x80 - 0x87 are reserved to avoid conflict with ACPI\n * commands accidentally sent to the wrong interface.  See the ACPI section\n * below.\n */\n\n/*****************************************************************************/\n/* Host event commands */\n\n\n/* Obsolete. New implementation should use EC_CMD_HOST_EVENT instead */\n/*\n * Host event mask params and response structures, shared by all of the host\n * event commands below.\n */\nstruct ec_params_host_event_mask {\n\tuint32_t mask;\n} __ec_align4;\n\nstruct ec_response_host_event_mask {\n\tuint32_t mask;\n} __ec_align4;\n\n/* These all use ec_response_host_event_mask */\n#define EC_CMD_HOST_EVENT_GET_B         0x0087\n#define EC_CMD_HOST_EVENT_GET_SMI_MASK  0x0088\n#define EC_CMD_HOST_EVENT_GET_SCI_MASK  0x0089\n#define EC_CMD_HOST_EVENT_GET_WAKE_MASK 0x008D\n\n/* These all use ec_params_host_event_mask */\n#define EC_CMD_HOST_EVENT_SET_SMI_MASK  0x008A\n#define EC_CMD_HOST_EVENT_SET_SCI_MASK  0x008B\n#define EC_CMD_HOST_EVENT_CLEAR         0x008C\n#define EC_CMD_HOST_EVENT_SET_WAKE_MASK 0x008E\n#define EC_CMD_HOST_EVENT_CLEAR_B       0x008F\n\n/*\n * Unified host event programming interface - Should be used by newer versions\n * of BIOS/OS to program host events and masks\n */\n\nstruct ec_params_host_event {\n\n\t/* Action requested by host - one of enum ec_host_event_action. */\n\tuint8_t action;\n\n\t/*\n\t * Mask type that the host requested the action on - one of\n\t * enum ec_host_event_mask_type.\n\t */\n\tuint8_t mask_type;\n\n\t/* Set to 0, ignore on read */\n\tuint16_t reserved;\n\n\t/* Value to be used in case of set operations. */\n\tuint64_t value;\n} __ec_align4;\n\n/*\n * Response structure returned by EC_CMD_HOST_EVENT.\n * Update the value on a GET request. Set to 0 on GET/CLEAR\n */\n\nstruct ec_response_host_event {\n\n\t/* Mask value in case of get operation */\n\tuint64_t value;\n} __ec_align4;\n\nenum ec_host_event_action {\n\t/*\n\t * params.value is ignored. Value of mask_type populated\n\t * in response.value\n\t */\n\tEC_HOST_EVENT_GET,\n\n\t/* Bits in params.value are set */\n\tEC_HOST_EVENT_SET,\n\n\t/* Bits in params.value are cleared */\n\tEC_HOST_EVENT_CLEAR,\n};\n\nenum ec_host_event_mask_type {\n\n\t/* Main host event copy */\n\tEC_HOST_EVENT_MAIN,\n\n\t/* Copy B of host events */\n\tEC_HOST_EVENT_B,\n\n\t/* SCI Mask */\n\tEC_HOST_EVENT_SCI_MASK,\n\n\t/* SMI Mask */\n\tEC_HOST_EVENT_SMI_MASK,\n\n\t/* Mask of events that should be always reported in hostevents */\n\tEC_HOST_EVENT_ALWAYS_REPORT_MASK,\n\n\t/* Active wake mask */\n\tEC_HOST_EVENT_ACTIVE_WAKE_MASK,\n\n\t/* Lazy wake mask for S0ix */\n\tEC_HOST_EVENT_LAZY_WAKE_MASK_S0IX,\n\n\t/* Lazy wake mask for S3 */\n\tEC_HOST_EVENT_LAZY_WAKE_MASK_S3,\n\n\t/* Lazy wake mask for S5 */\n\tEC_HOST_EVENT_LAZY_WAKE_MASK_S5,\n};\n\n#define EC_CMD_HOST_EVENT       0x00A4\n\n/*****************************************************************************/\n/* Switch commands */\n\n/* Enable/disable LCD backlight */\n#define EC_CMD_SWITCH_ENABLE_BKLIGHT 0x0090\n\nstruct ec_params_switch_enable_backlight {\n\tuint8_t enabled;\n} __ec_align1;\n\n/* Enable/disable WLAN/Bluetooth */\n#define EC_CMD_SWITCH_ENABLE_WIRELESS 0x0091\n#define EC_VER_SWITCH_ENABLE_WIRELESS 1\n\n/* Version 0 params; no response */\nstruct ec_params_switch_enable_wireless_v0 {\n\tuint8_t enabled;\n} __ec_align1;\n\n/* Version 1 params */\nstruct ec_params_switch_enable_wireless_v1 {\n\t/* Flags to enable now */\n\tuint8_t now_flags;\n\n\t/* Which flags to copy from now_flags */\n\tuint8_t now_mask;\n\n\t/*\n\t * Flags to leave enabled in S3, if they're on at the S0->S3\n\t * transition.  (Other flags will be disabled by the S0->S3\n\t * transition.)\n\t */\n\tuint8_t suspend_flags;\n\n\t/* Which flags to copy from suspend_flags */\n\tuint8_t suspend_mask;\n} __ec_align1;\n\n/* Version 1 response */\nstruct ec_response_switch_enable_wireless_v1 {\n\t/* Flags to enable now */\n\tuint8_t now_flags;\n\n\t/* Flags to leave enabled in S3 */\n\tuint8_t suspend_flags;\n} __ec_align1;\n\n/*****************************************************************************/\n/* GPIO commands. Only available on EC if write protect has been disabled. */\n\n/* Set GPIO output value */\n#define EC_CMD_GPIO_SET 0x0092\n\nstruct ec_params_gpio_set {\n\tchar name[32];\n\tuint8_t val;\n} __ec_align1;\n\n/* Get GPIO value */\n#define EC_CMD_GPIO_GET 0x0093\n\n/* Version 0 of input params and response */\nstruct ec_params_gpio_get {\n\tchar name[32];\n} __ec_align1;\n\nstruct ec_response_gpio_get {\n\tuint8_t val;\n} __ec_align1;\n\n/* Version 1 of input params and response */\nstruct ec_params_gpio_get_v1 {\n\tuint8_t subcmd;\n\tunion {\n\t\tstruct __ec_align1 {\n\t\t\tchar name[32];\n\t\t} get_value_by_name;\n\t\tstruct __ec_align1 {\n\t\t\tuint8_t index;\n\t\t} get_info;\n\t};\n} __ec_align1;\n\nstruct ec_response_gpio_get_v1 {\n\tunion {\n\t\tstruct __ec_align1 {\n\t\t\tuint8_t val;\n\t\t} get_value_by_name, get_count;\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint8_t val;\n\t\t\tchar name[32];\n\t\t\tuint32_t flags;\n\t\t} get_info;\n\t};\n} __ec_todo_packed;\n\nenum gpio_get_subcmd {\n\tEC_GPIO_GET_BY_NAME = 0,\n\tEC_GPIO_GET_COUNT = 1,\n\tEC_GPIO_GET_INFO = 2,\n};\n\n/*****************************************************************************/\n/* I2C commands. Only available when flash write protect is unlocked. */\n\n/*\n * CAUTION: These commands are deprecated, and are not supported anymore in EC\n * builds >= 8398.0.0 (see crosbug.com/p/23570).\n *\n * Use EC_CMD_I2C_PASSTHRU instead.\n */\n\n/* Read I2C bus */\n#define EC_CMD_I2C_READ 0x0094\n\nstruct ec_params_i2c_read {\n\tuint16_t addr; /* 8-bit address (7-bit shifted << 1) */\n\tuint8_t read_size; /* Either 8 or 16. */\n\tuint8_t port;\n\tuint8_t offset;\n} __ec_align_size1;\n\nstruct ec_response_i2c_read {\n\tuint16_t data;\n} __ec_align2;\n\n/* Write I2C bus */\n#define EC_CMD_I2C_WRITE 0x0095\n\nstruct ec_params_i2c_write {\n\tuint16_t data;\n\tuint16_t addr; /* 8-bit address (7-bit shifted << 1) */\n\tuint8_t write_size; /* Either 8 or 16. */\n\tuint8_t port;\n\tuint8_t offset;\n} __ec_align_size1;\n\n/*****************************************************************************/\n/* Charge state commands. Only available when flash write protect unlocked. */\n\n/* Force charge state machine to stop charging the battery or force it to\n * discharge the battery.\n */\n#define EC_CMD_CHARGE_CONTROL 0x0096\n#define EC_VER_CHARGE_CONTROL 1\n\nenum ec_charge_control_mode {\n\tCHARGE_CONTROL_NORMAL = 0,\n\tCHARGE_CONTROL_IDLE,\n\tCHARGE_CONTROL_DISCHARGE,\n};\n\nstruct ec_params_charge_control {\n\tuint32_t mode;  /* enum charge_control_mode */\n} __ec_align4;\n\n/*****************************************************************************/\n\n/* Snapshot console output buffer for use by EC_CMD_CONSOLE_READ. */\n#define EC_CMD_CONSOLE_SNAPSHOT 0x0097\n\n/*\n * Read data from the saved snapshot. If the subcmd parameter is\n * CONSOLE_READ_NEXT, this will return data starting from the beginning of\n * the latest snapshot. If it is CONSOLE_READ_RECENT, it will start from the\n * end of the previous snapshot.\n *\n * The params are only looked at in version >= 1 of this command. Prior\n * versions will just default to CONSOLE_READ_NEXT behavior.\n *\n * Response is null-terminated string.  Empty string, if there is no more\n * remaining output.\n */\n#define EC_CMD_CONSOLE_READ 0x0098\n\nenum ec_console_read_subcmd {\n\tCONSOLE_READ_NEXT = 0,\n\tCONSOLE_READ_RECENT\n};\n\nstruct ec_params_console_read_v1 {\n\tuint8_t subcmd; /* enum ec_console_read_subcmd */\n} __ec_align1;\n\n/*****************************************************************************/\n\n/*\n * Cut off battery power immediately or after the host has shut down.\n *\n * return EC_RES_INVALID_COMMAND if unsupported by a board/battery.\n *\t  EC_RES_SUCCESS if the command was successful.\n *\t  EC_RES_ERROR if the cut off command failed.\n */\n#define EC_CMD_BATTERY_CUT_OFF 0x0099\n\n#define EC_BATTERY_CUTOFF_FLAG_AT_SHUTDOWN\tBIT(0)\n\nstruct ec_params_battery_cutoff {\n\tuint8_t flags;\n} __ec_align1;\n\n/*****************************************************************************/\n/* USB port mux control. */\n\n/*\n * Switch USB mux or return to automatic switching.\n */\n#define EC_CMD_USB_MUX 0x009A\n\nstruct ec_params_usb_mux {\n\tuint8_t mux;\n} __ec_align1;\n\n/*****************************************************************************/\n/* LDOs / FETs control. */\n\nenum ec_ldo_state {\n\tEC_LDO_STATE_OFF = 0,\t/* the LDO / FET is shut down */\n\tEC_LDO_STATE_ON = 1,\t/* the LDO / FET is ON / providing power */\n};\n\n/*\n * Switch on/off a LDO.\n */\n#define EC_CMD_LDO_SET 0x009B\n\nstruct ec_params_ldo_set {\n\tuint8_t index;\n\tuint8_t state;\n} __ec_align1;\n\n/*\n * Get LDO state.\n */\n#define EC_CMD_LDO_GET 0x009C\n\nstruct ec_params_ldo_get {\n\tuint8_t index;\n} __ec_align1;\n\nstruct ec_response_ldo_get {\n\tuint8_t state;\n} __ec_align1;\n\n/*****************************************************************************/\n/* Power info. */\n\n/*\n * Get power info.\n */\n#define EC_CMD_POWER_INFO 0x009D\n\nstruct ec_response_power_info {\n\tuint32_t usb_dev_type;\n\tuint16_t voltage_ac;\n\tuint16_t voltage_system;\n\tuint16_t current_system;\n\tuint16_t usb_current_limit;\n} __ec_align4;\n\n/*****************************************************************************/\n/* I2C passthru command */\n\n#define EC_CMD_I2C_PASSTHRU 0x009E\n\n/* Read data; if not present, message is a write */\n#define EC_I2C_FLAG_READ\tBIT(15)\n\n/* Mask for address */\n#define EC_I2C_ADDR_MASK\t0x3ff\n\n#define EC_I2C_STATUS_NAK\tBIT(0) /* Transfer was not acknowledged */\n#define EC_I2C_STATUS_TIMEOUT\tBIT(1) /* Timeout during transfer */\n\n/* Any error */\n#define EC_I2C_STATUS_ERROR\t(EC_I2C_STATUS_NAK | EC_I2C_STATUS_TIMEOUT)\n\nstruct ec_params_i2c_passthru_msg {\n\tuint16_t addr_flags;\t/* I2C slave address (7 or 10 bits) and flags */\n\tuint16_t len;\t\t/* Number of bytes to read or write */\n} __ec_align2;\n\nstruct ec_params_i2c_passthru {\n\tuint8_t port;\t\t/* I2C port number */\n\tuint8_t num_msgs;\t/* Number of messages */\n\tstruct ec_params_i2c_passthru_msg msg[];\n\t/* Data to write for all messages is concatenated here */\n} __ec_align2;\n\nstruct ec_response_i2c_passthru {\n\tuint8_t i2c_status;\t/* Status flags (EC_I2C_STATUS_...) */\n\tuint8_t num_msgs;\t/* Number of messages processed */\n\tuint8_t data[];\t\t/* Data read by messages concatenated here */\n} __ec_align1;\n\n/*****************************************************************************/\n/* Power button hang detect */\n\n#define EC_CMD_HANG_DETECT 0x009F\n\n/* Reasons to start hang detection timer */\n/* Power button pressed */\n#define EC_HANG_START_ON_POWER_PRESS  BIT(0)\n\n/* Lid closed */\n#define EC_HANG_START_ON_LID_CLOSE    BIT(1)\n\n /* Lid opened */\n#define EC_HANG_START_ON_LID_OPEN     BIT(2)\n\n/* Start of AP S3->S0 transition (booting or resuming from suspend) */\n#define EC_HANG_START_ON_RESUME       BIT(3)\n\n/* Reasons to cancel hang detection */\n\n/* Power button released */\n#define EC_HANG_STOP_ON_POWER_RELEASE BIT(8)\n\n/* Any host command from AP received */\n#define EC_HANG_STOP_ON_HOST_COMMAND  BIT(9)\n\n/* Stop on end of AP S0->S3 transition (suspending or shutting down) */\n#define EC_HANG_STOP_ON_SUSPEND       BIT(10)\n\n/*\n * If this flag is set, all the other fields are ignored, and the hang detect\n * timer is started.  This provides the AP a way to start the hang timer\n * without reconfiguring any of the other hang detect settings.  Note that\n * you must previously have configured the timeouts.\n */\n#define EC_HANG_START_NOW             BIT(30)\n\n/*\n * If this flag is set, all the other fields are ignored (including\n * EC_HANG_START_NOW).  This provides the AP a way to stop the hang timer\n * without reconfiguring any of the other hang detect settings.\n */\n#define EC_HANG_STOP_NOW              BIT(31)\n\nstruct ec_params_hang_detect {\n\t/* Flags; see EC_HANG_* */\n\tuint32_t flags;\n\n\t/* Timeout in msec before generating host event, if enabled */\n\tuint16_t host_event_timeout_msec;\n\n\t/* Timeout in msec before generating warm reboot, if enabled */\n\tuint16_t warm_reboot_timeout_msec;\n} __ec_align4;\n\n/*****************************************************************************/\n/* Commands for battery charging */\n\n/*\n * This is the single catch-all host command to exchange data regarding the\n * charge state machine (v2 and up).\n */\n#define EC_CMD_CHARGE_STATE 0x00A0\n\n/* Subcommands for this host command */\nenum charge_state_command {\n\tCHARGE_STATE_CMD_GET_STATE,\n\tCHARGE_STATE_CMD_GET_PARAM,\n\tCHARGE_STATE_CMD_SET_PARAM,\n\tCHARGE_STATE_NUM_CMDS\n};\n\n/*\n * Known param numbers are defined here. Ranges are reserved for board-specific\n * params, which are handled by the particular implementations.\n */\nenum charge_state_params {\n\tCS_PARAM_CHG_VOLTAGE,\t      /* charger voltage limit */\n\tCS_PARAM_CHG_CURRENT,\t      /* charger current limit */\n\tCS_PARAM_CHG_INPUT_CURRENT,   /* charger input current limit */\n\tCS_PARAM_CHG_STATUS,\t      /* charger-specific status */\n\tCS_PARAM_CHG_OPTION,\t      /* charger-specific options */\n\tCS_PARAM_LIMIT_POWER,\t      /*\n\t\t\t\t       * Check if power is limited due to\n\t\t\t\t       * low battery and / or a weak external\n\t\t\t\t       * charger. READ ONLY.\n\t\t\t\t       */\n\t/* How many so far? */\n\tCS_NUM_BASE_PARAMS,\n\n\t/* Range for CONFIG_CHARGER_PROFILE_OVERRIDE params */\n\tCS_PARAM_CUSTOM_PROFILE_MIN = 0x10000,\n\tCS_PARAM_CUSTOM_PROFILE_MAX = 0x1ffff,\n\n\t/* Range for CONFIG_CHARGE_STATE_DEBUG params */\n\tCS_PARAM_DEBUG_MIN = 0x20000,\n\tCS_PARAM_DEBUG_CTL_MODE = 0x20000,\n\tCS_PARAM_DEBUG_MANUAL_MODE,\n\tCS_PARAM_DEBUG_SEEMS_DEAD,\n\tCS_PARAM_DEBUG_SEEMS_DISCONNECTED,\n\tCS_PARAM_DEBUG_BATT_REMOVED,\n\tCS_PARAM_DEBUG_MANUAL_CURRENT,\n\tCS_PARAM_DEBUG_MANUAL_VOLTAGE,\n\tCS_PARAM_DEBUG_MAX = 0x2ffff,\n\n\t/* Other custom param ranges go here... */\n};\n\nstruct ec_params_charge_state {\n\tuint8_t cmd;\t\t\t\t/* enum charge_state_command */\n\tunion {\n\t\t/* get_state has no args */\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint32_t param;\t\t/* enum charge_state_param */\n\t\t} get_param;\n\n\t\tstruct __ec_todo_unpacked {\n\t\t\tuint32_t param;\t\t/* param to set */\n\t\t\tuint32_t value;\t\t/* value to set */\n\t\t} set_param;\n\t};\n} __ec_todo_packed;\n\nstruct ec_response_charge_state {\n\tunion {\n\t\tstruct __ec_align4 {\n\t\t\tint ac;\n\t\t\tint chg_voltage;\n\t\t\tint chg_current;\n\t\t\tint chg_input_current;\n\t\t\tint batt_state_of_charge;\n\t\t} get_state;\n\n\t\tstruct __ec_align4 {\n\t\t\tuint32_t value;\n\t\t} get_param;\n\n\t\t/* set_param returns no args */\n\t};\n} __ec_align4;\n\n\n/*\n * Set maximum battery charging current.\n */\n#define EC_CMD_CHARGE_CURRENT_LIMIT 0x00A1\n\nstruct ec_params_current_limit {\n\tuint32_t limit; /* in mA */\n} __ec_align4;\n\n/*\n * Set maximum external voltage / current.\n */\n#define EC_CMD_EXTERNAL_POWER_LIMIT 0x00A2\n\n/* Command v0 is used only on Spring and is obsolete + unsupported */\nstruct ec_params_external_power_limit_v1 {\n\tuint16_t current_lim; /* in mA, or EC_POWER_LIMIT_NONE to clear limit */\n\tuint16_t voltage_lim; /* in mV, or EC_POWER_LIMIT_NONE to clear limit */\n} __ec_align2;\n\n#define EC_POWER_LIMIT_NONE 0xffff\n\n/*\n * Set maximum voltage & current of a dedicated charge port\n */\n#define EC_CMD_OVERRIDE_DEDICATED_CHARGER_LIMIT 0x00A3\n\nstruct ec_params_dedicated_charger_limit {\n\tuint16_t current_lim; /* in mA */\n\tuint16_t voltage_lim; /* in mV */\n} __ec_align2;\n\n/*****************************************************************************/\n/* Hibernate/Deep Sleep Commands */\n\n/* Set the delay before going into hibernation. */\n#define EC_CMD_HIBERNATION_DELAY 0x00A8\n\nstruct ec_params_hibernation_delay {\n\t/*\n\t * Seconds to wait in G3 before hibernate.  Pass in 0 to read the\n\t * current settings without changing them.\n\t */\n\tuint32_t seconds;\n} __ec_align4;\n\nstruct ec_response_hibernation_delay {\n\t/*\n\t * The current time in seconds in which the system has been in the G3\n\t * state.  This value is reset if the EC transitions out of G3.\n\t */\n\tuint32_t time_g3;\n\n\t/*\n\t * The current time remaining in seconds until the EC should hibernate.\n\t * This value is also reset if the EC transitions out of G3.\n\t */\n\tuint32_t time_remaining;\n\n\t/*\n\t * The current time in seconds that the EC should wait in G3 before\n\t * hibernating.\n\t */\n\tuint32_t hibernate_delay;\n} __ec_align4;\n\n/* Inform the EC when entering a sleep state */\n#define EC_CMD_HOST_SLEEP_EVENT 0x00A9\n\nenum host_sleep_event {\n\tHOST_SLEEP_EVENT_S3_SUSPEND   = 1,\n\tHOST_SLEEP_EVENT_S3_RESUME    = 2,\n\tHOST_SLEEP_EVENT_S0IX_SUSPEND = 3,\n\tHOST_SLEEP_EVENT_S0IX_RESUME  = 4,\n\t/* S3 suspend with additional enabled wake sources */\n\tHOST_SLEEP_EVENT_S3_WAKEABLE_SUSPEND = 5,\n};\n\nstruct ec_params_host_sleep_event {\n\tuint8_t sleep_event;\n} __ec_align1;\n\n/*\n * Use a default timeout value (CONFIG_SLEEP_TIMEOUT_MS) for detecting sleep\n * transition failures\n */\n#define EC_HOST_SLEEP_TIMEOUT_DEFAULT 0\n\n/* Disable timeout detection for this sleep transition */\n#define EC_HOST_SLEEP_TIMEOUT_INFINITE 0xFFFF\n\nstruct ec_params_host_sleep_event_v1 {\n\t/* The type of sleep being entered or exited. */\n\tuint8_t sleep_event;\n\n\t/* Padding */\n\tuint8_t reserved;\n\tunion {\n\t\t/* Parameters that apply for suspend messages. */\n\t\tstruct {\n\t\t\t/*\n\t\t\t * The timeout in milliseconds between when this message\n\t\t\t * is received and when the EC will declare sleep\n\t\t\t * transition failure if the sleep signal is not\n\t\t\t * asserted.\n\t\t\t */\n\t\t\tuint16_t sleep_timeout_ms;\n\t\t} suspend_params;\n\n\t\t/* No parameters for non-suspend messages. */\n\t};\n} __ec_align2;\n\n/* A timeout occurred when this bit is set */\n#define EC_HOST_RESUME_SLEEP_TIMEOUT 0x80000000\n\n/*\n * The mask defining which bits correspond to the number of sleep transitions,\n * as well as the maximum number of suspend line transitions that will be\n * reported back to the host.\n */\n#define EC_HOST_RESUME_SLEEP_TRANSITIONS_MASK 0x7FFFFFFF\n\nstruct ec_response_host_sleep_event_v1 {\n\tunion {\n\t\t/* Response fields that apply for resume messages. */\n\t\tstruct {\n\t\t\t/*\n\t\t\t * The number of sleep power signal transitions that\n\t\t\t * occurred since the suspend message. The high bit\n\t\t\t * indicates a timeout occurred.\n\t\t\t */\n\t\t\tuint32_t sleep_transitions;\n\t\t} resume_response;\n\n\t\t/* No response fields for non-resume messages. */\n\t};\n} __ec_align4;\n\n/*****************************************************************************/\n/* Device events */\n#define EC_CMD_DEVICE_EVENT 0x00AA\n\nenum ec_device_event {\n\tEC_DEVICE_EVENT_TRACKPAD,\n\tEC_DEVICE_EVENT_DSP,\n\tEC_DEVICE_EVENT_WIFI,\n};\n\nenum ec_device_event_param {\n\t/* Get and clear pending device events */\n\tEC_DEVICE_EVENT_PARAM_GET_CURRENT_EVENTS,\n\t/* Get device event mask */\n\tEC_DEVICE_EVENT_PARAM_GET_ENABLED_EVENTS,\n\t/* Set device event mask */\n\tEC_DEVICE_EVENT_PARAM_SET_ENABLED_EVENTS,\n};\n\n#define EC_DEVICE_EVENT_MASK(event_code) BIT(event_code % 32)\n\nstruct ec_params_device_event {\n\tuint32_t event_mask;\n\tuint8_t param;\n} __ec_align_size1;\n\nstruct ec_response_device_event {\n\tuint32_t event_mask;\n} __ec_align4;\n\n/*****************************************************************************/\n/* Smart battery pass-through */\n\n/* Get / Set 16-bit smart battery registers */\n#define EC_CMD_SB_READ_WORD   0x00B0\n#define EC_CMD_SB_WRITE_WORD  0x00B1\n\n/* Get / Set string smart battery parameters\n * formatted as SMBUS \"block\".\n */\n#define EC_CMD_SB_READ_BLOCK  0x00B2\n#define EC_CMD_SB_WRITE_BLOCK 0x00B3\n\nstruct ec_params_sb_rd {\n\tuint8_t reg;\n} __ec_align1;\n\nstruct ec_response_sb_rd_word {\n\tuint16_t value;\n} __ec_align2;\n\nstruct ec_params_sb_wr_word {\n\tuint8_t reg;\n\tuint16_t value;\n} __ec_align1;\n\nstruct ec_response_sb_rd_block {\n\tuint8_t data[32];\n} __ec_align1;\n\nstruct ec_params_sb_wr_block {\n\tuint8_t reg;\n\tuint16_t data[32];\n} __ec_align1;\n\n/*****************************************************************************/\n/* Battery vendor parameters\n *\n * Get or set vendor-specific parameters in the battery. Implementations may\n * differ between boards or batteries. On a set operation, the response\n * contains the actual value set, which may be rounded or clipped from the\n * requested value.\n */\n\n#define EC_CMD_BATTERY_VENDOR_PARAM 0x00B4\n\nenum ec_battery_vendor_param_mode {\n\tBATTERY_VENDOR_PARAM_MODE_GET = 0,\n\tBATTERY_VENDOR_PARAM_MODE_SET,\n};\n\nstruct ec_params_battery_vendor_param {\n\tuint32_t param;\n\tuint32_t value;\n\tuint8_t mode;\n} __ec_align_size1;\n\nstruct ec_response_battery_vendor_param {\n\tuint32_t value;\n} __ec_align4;\n\n/*****************************************************************************/\n/*\n * Smart Battery Firmware Update Commands\n */\n#define EC_CMD_SB_FW_UPDATE 0x00B5\n\nenum ec_sb_fw_update_subcmd {\n\tEC_SB_FW_UPDATE_PREPARE  = 0x0,\n\tEC_SB_FW_UPDATE_INFO     = 0x1, /*query sb info */\n\tEC_SB_FW_UPDATE_BEGIN    = 0x2, /*check if protected */\n\tEC_SB_FW_UPDATE_WRITE    = 0x3, /*check if protected */\n\tEC_SB_FW_UPDATE_END      = 0x4,\n\tEC_SB_FW_UPDATE_STATUS   = 0x5,\n\tEC_SB_FW_UPDATE_PROTECT  = 0x6,\n\tEC_SB_FW_UPDATE_MAX      = 0x7,\n};\n\n#define SB_FW_UPDATE_CMD_WRITE_BLOCK_SIZE 32\n#define SB_FW_UPDATE_CMD_STATUS_SIZE 2\n#define SB_FW_UPDATE_CMD_INFO_SIZE 8\n\nstruct ec_sb_fw_update_header {\n\tuint16_t subcmd;  /* enum ec_sb_fw_update_subcmd */\n\tuint16_t fw_id;   /* firmware id */\n} __ec_align4;\n\nstruct ec_params_sb_fw_update {\n\tstruct ec_sb_fw_update_header hdr;\n\tunion {\n\t\t/* EC_SB_FW_UPDATE_PREPARE  = 0x0 */\n\t\t/* EC_SB_FW_UPDATE_INFO     = 0x1 */\n\t\t/* EC_SB_FW_UPDATE_BEGIN    = 0x2 */\n\t\t/* EC_SB_FW_UPDATE_END      = 0x4 */\n\t\t/* EC_SB_FW_UPDATE_STATUS   = 0x5 */\n\t\t/* EC_SB_FW_UPDATE_PROTECT  = 0x6 */\n\t\t/* Those have no args */\n\n\t\t/* EC_SB_FW_UPDATE_WRITE    = 0x3 */\n\t\tstruct __ec_align4 {\n\t\t\tuint8_t  data[SB_FW_UPDATE_CMD_WRITE_BLOCK_SIZE];\n\t\t} write;\n\t};\n} __ec_align4;\n\nstruct ec_response_sb_fw_update {\n\tunion {\n\t\t/* EC_SB_FW_UPDATE_INFO     = 0x1 */\n\t\tstruct __ec_align1 {\n\t\t\tuint8_t data[SB_FW_UPDATE_CMD_INFO_SIZE];\n\t\t} info;\n\n\t\t/* EC_SB_FW_UPDATE_STATUS   = 0x5 */\n\t\tstruct __ec_align1 {\n\t\t\tuint8_t data[SB_FW_UPDATE_CMD_STATUS_SIZE];\n\t\t} status;\n\t};\n} __ec_align1;\n\n/*\n * Entering Verified Boot Mode Command\n * Default mode is VBOOT_MODE_NORMAL if EC did not receive this command.\n * Valid Modes are: normal, developer, and recovery.\n */\n#define EC_CMD_ENTERING_MODE 0x00B6\n\nstruct ec_params_entering_mode {\n\tint vboot_mode;\n} __ec_align4;\n\n#define VBOOT_MODE_NORMAL    0\n#define VBOOT_MODE_DEVELOPER 1\n#define VBOOT_MODE_RECOVERY  2\n\n/*****************************************************************************/\n/*\n * I2C passthru protection command: Protects I2C tunnels against access on\n * certain addresses (board-specific).\n */\n#define EC_CMD_I2C_PASSTHRU_PROTECT 0x00B7\n\nenum ec_i2c_passthru_protect_subcmd {\n\tEC_CMD_I2C_PASSTHRU_PROTECT_STATUS = 0x0,\n\tEC_CMD_I2C_PASSTHRU_PROTECT_ENABLE = 0x1,\n};\n\nstruct ec_params_i2c_passthru_protect {\n\tuint8_t subcmd;\n\tuint8_t port;\t\t/* I2C port number */\n} __ec_align1;\n\nstruct ec_response_i2c_passthru_protect {\n\tuint8_t status;\t\t/* Status flags (0: unlocked, 1: locked) */\n} __ec_align1;\n\n\n/*****************************************************************************/\n/*\n * HDMI CEC commands\n *\n * These commands are for sending and receiving message via HDMI CEC\n */\n\n#define MAX_CEC_MSG_LEN 16\n\n/* CEC message from the AP to be written on the CEC bus */\n#define EC_CMD_CEC_WRITE_MSG 0x00B8\n\n/**\n * struct ec_params_cec_write - Message to write to the CEC bus\n * @msg: message content to write to the CEC bus\n */\nstruct ec_params_cec_write {\n\tuint8_t msg[MAX_CEC_MSG_LEN];\n} __ec_align1;\n\n/* Set various CEC parameters */\n#define EC_CMD_CEC_SET 0x00BA\n\n/**\n * struct ec_params_cec_set - CEC parameters set\n * @cmd: parameter type, can be CEC_CMD_ENABLE or CEC_CMD_LOGICAL_ADDRESS\n * @val: in case cmd is CEC_CMD_ENABLE, this field can be 0 to disable CEC\n *\tor 1 to enable CEC functionality, in case cmd is\n *\tCEC_CMD_LOGICAL_ADDRESS, this field encodes the requested logical\n *\taddress between 0 and 15 or 0xff to unregister\n */\nstruct ec_params_cec_set {\n\tuint8_t cmd; /* enum cec_command */\n\tuint8_t val;\n} __ec_align1;\n\n/* Read various CEC parameters */\n#define EC_CMD_CEC_GET 0x00BB\n\n/**\n * struct ec_params_cec_get - CEC parameters get\n * @cmd: parameter type, can be CEC_CMD_ENABLE or CEC_CMD_LOGICAL_ADDRESS\n */\nstruct ec_params_cec_get {\n\tuint8_t cmd; /* enum cec_command */\n} __ec_align1;\n\n/**\n * struct ec_response_cec_get - CEC parameters get response\n * @val: in case cmd was CEC_CMD_ENABLE, this field will 0 if CEC is\n *\tdisabled or 1 if CEC functionality is enabled,\n *\tin case cmd was CEC_CMD_LOGICAL_ADDRESS, this will encode the\n *\tconfigured logical address between 0 and 15 or 0xff if unregistered\n */\nstruct ec_response_cec_get {\n\tuint8_t val;\n} __ec_align1;\n\n/* CEC parameters command */\nenum cec_command {\n\t/* CEC reading, writing and events enable */\n\tCEC_CMD_ENABLE,\n\t/* CEC logical address  */\n\tCEC_CMD_LOGICAL_ADDRESS,\n};\n\n/* Events from CEC to AP */\nenum mkbp_cec_event {\n\t/* Outgoing message was acknowledged by a follower */\n\tEC_MKBP_CEC_SEND_OK\t\t\t= BIT(0),\n\t/* Outgoing message was not acknowledged */\n\tEC_MKBP_CEC_SEND_FAILED\t\t\t= BIT(1),\n};\n\n/*****************************************************************************/\n\n/* Commands for audio codec. */\n#define EC_CMD_EC_CODEC 0x00BC\n\nenum ec_codec_subcmd {\n\tEC_CODEC_GET_CAPABILITIES = 0x0,\n\tEC_CODEC_GET_SHM_ADDR = 0x1,\n\tEC_CODEC_SET_SHM_ADDR = 0x2,\n\tEC_CODEC_SUBCMD_COUNT,\n};\n\nenum ec_codec_cap {\n\tEC_CODEC_CAP_WOV_AUDIO_SHM = 0,\n\tEC_CODEC_CAP_WOV_LANG_SHM = 1,\n\tEC_CODEC_CAP_LAST = 32,\n};\n\nenum ec_codec_shm_id {\n\tEC_CODEC_SHM_ID_WOV_AUDIO = 0x0,\n\tEC_CODEC_SHM_ID_WOV_LANG = 0x1,\n\tEC_CODEC_SHM_ID_LAST,\n};\n\nenum ec_codec_shm_type {\n\tEC_CODEC_SHM_TYPE_EC_RAM = 0x0,\n\tEC_CODEC_SHM_TYPE_SYSTEM_RAM = 0x1,\n};\n\nstruct __ec_align1 ec_param_ec_codec_get_shm_addr {\n\tuint8_t shm_id;\n\tuint8_t reserved[3];\n};\n\nstruct __ec_align4 ec_param_ec_codec_set_shm_addr {\n\tuint64_t phys_addr;\n\tuint32_t len;\n\tuint8_t shm_id;\n\tuint8_t reserved[3];\n};\n\nstruct __ec_align4 ec_param_ec_codec {\n\tuint8_t cmd; /* enum ec_codec_subcmd */\n\tuint8_t reserved[3];\n\n\tunion {\n\t\tstruct ec_param_ec_codec_get_shm_addr\n\t\t\t\tget_shm_addr_param;\n\t\tstruct ec_param_ec_codec_set_shm_addr\n\t\t\t\tset_shm_addr_param;\n\t};\n};\n\nstruct __ec_align4 ec_response_ec_codec_get_capabilities {\n\tuint32_t capabilities;\n};\n\nstruct __ec_align4 ec_response_ec_codec_get_shm_addr {\n\tuint64_t phys_addr;\n\tuint32_t len;\n\tuint8_t type;\n\tuint8_t reserved[3];\n};\n\n/*****************************************************************************/\n\n/* Commands for DMIC on audio codec. */\n#define EC_CMD_EC_CODEC_DMIC 0x00BD\n\nenum ec_codec_dmic_subcmd {\n\tEC_CODEC_DMIC_GET_MAX_GAIN = 0x0,\n\tEC_CODEC_DMIC_SET_GAIN_IDX = 0x1,\n\tEC_CODEC_DMIC_GET_GAIN_IDX = 0x2,\n\tEC_CODEC_DMIC_SUBCMD_COUNT,\n};\n\nenum ec_codec_dmic_channel {\n\tEC_CODEC_DMIC_CHANNEL_0 = 0x0,\n\tEC_CODEC_DMIC_CHANNEL_1 = 0x1,\n\tEC_CODEC_DMIC_CHANNEL_2 = 0x2,\n\tEC_CODEC_DMIC_CHANNEL_3 = 0x3,\n\tEC_CODEC_DMIC_CHANNEL_4 = 0x4,\n\tEC_CODEC_DMIC_CHANNEL_5 = 0x5,\n\tEC_CODEC_DMIC_CHANNEL_6 = 0x6,\n\tEC_CODEC_DMIC_CHANNEL_7 = 0x7,\n\tEC_CODEC_DMIC_CHANNEL_COUNT,\n};\n\nstruct __ec_align1 ec_param_ec_codec_dmic_set_gain_idx {\n\tuint8_t channel; /* enum ec_codec_dmic_channel */\n\tuint8_t gain;\n\tuint8_t reserved[2];\n};\n\nstruct __ec_align1 ec_param_ec_codec_dmic_get_gain_idx {\n\tuint8_t channel; /* enum ec_codec_dmic_channel */\n\tuint8_t reserved[3];\n};\n\nstruct __ec_align4 ec_param_ec_codec_dmic {\n\tuint8_t cmd; /* enum ec_codec_dmic_subcmd */\n\tuint8_t reserved[3];\n\n\tunion {\n\t\tstruct ec_param_ec_codec_dmic_set_gain_idx\n\t\t\t\tset_gain_idx_param;\n\t\tstruct ec_param_ec_codec_dmic_get_gain_idx\n\t\t\t\tget_gain_idx_param;\n\t};\n};\n\nstruct __ec_align1 ec_response_ec_codec_dmic_get_max_gain {\n\tuint8_t max_gain;\n};\n\nstruct __ec_align1 ec_response_ec_codec_dmic_get_gain_idx {\n\tuint8_t gain;\n};\n\n/*****************************************************************************/\n\n/* Commands for I2S RX on audio codec. */\n\n#define EC_CMD_EC_CODEC_I2S_RX 0x00BE\n\nenum ec_codec_i2s_rx_subcmd {\n\tEC_CODEC_I2S_RX_ENABLE = 0x0,\n\tEC_CODEC_I2S_RX_DISABLE = 0x1,\n\tEC_CODEC_I2S_RX_SET_SAMPLE_DEPTH = 0x2,\n\tEC_CODEC_I2S_RX_SET_DAIFMT = 0x3,\n\tEC_CODEC_I2S_RX_SET_BCLK = 0x4,\n\tEC_CODEC_I2S_RX_RESET = 0x5,\n\tEC_CODEC_I2S_RX_SUBCMD_COUNT,\n};\n\nenum ec_codec_i2s_rx_sample_depth {\n\tEC_CODEC_I2S_RX_SAMPLE_DEPTH_16 = 0x0,\n\tEC_CODEC_I2S_RX_SAMPLE_DEPTH_24 = 0x1,\n\tEC_CODEC_I2S_RX_SAMPLE_DEPTH_COUNT,\n};\n\nenum ec_codec_i2s_rx_daifmt {\n\tEC_CODEC_I2S_RX_DAIFMT_I2S = 0x0,\n\tEC_CODEC_I2S_RX_DAIFMT_RIGHT_J = 0x1,\n\tEC_CODEC_I2S_RX_DAIFMT_LEFT_J = 0x2,\n\tEC_CODEC_I2S_RX_DAIFMT_COUNT,\n};\n\nstruct __ec_align1 ec_param_ec_codec_i2s_rx_set_sample_depth {\n\tuint8_t depth;\n\tuint8_t reserved[3];\n};\n\nstruct __ec_align1 ec_param_ec_codec_i2s_rx_set_gain {\n\tuint8_t left;\n\tuint8_t right;\n\tuint8_t reserved[2];\n};\n\nstruct __ec_align1 ec_param_ec_codec_i2s_rx_set_daifmt {\n\tuint8_t daifmt;\n\tuint8_t reserved[3];\n};\n\nstruct __ec_align4 ec_param_ec_codec_i2s_rx_set_bclk {\n\tuint32_t bclk;\n};\n\nstruct __ec_align4 ec_param_ec_codec_i2s_rx {\n\tuint8_t cmd; /* enum ec_codec_i2s_rx_subcmd */\n\tuint8_t reserved[3];\n\n\tunion {\n\t\tstruct ec_param_ec_codec_i2s_rx_set_sample_depth\n\t\t\t\tset_sample_depth_param;\n\t\tstruct ec_param_ec_codec_i2s_rx_set_daifmt\n\t\t\t\tset_daifmt_param;\n\t\tstruct ec_param_ec_codec_i2s_rx_set_bclk\n\t\t\t\tset_bclk_param;\n\t};\n};\n\n/*****************************************************************************/\n/* Commands for WoV on audio codec. */\n\n#define EC_CMD_EC_CODEC_WOV 0x00BF\n\nenum ec_codec_wov_subcmd {\n\tEC_CODEC_WOV_SET_LANG = 0x0,\n\tEC_CODEC_WOV_SET_LANG_SHM = 0x1,\n\tEC_CODEC_WOV_GET_LANG = 0x2,\n\tEC_CODEC_WOV_ENABLE = 0x3,\n\tEC_CODEC_WOV_DISABLE = 0x4,\n\tEC_CODEC_WOV_READ_AUDIO = 0x5,\n\tEC_CODEC_WOV_READ_AUDIO_SHM = 0x6,\n\tEC_CODEC_WOV_SUBCMD_COUNT,\n};\n\n/*\n * @hash is SHA256 of the whole language model.\n * @total_len indicates the length of whole language model.\n * @offset is the cursor from the beginning of the model.\n * @buf is the packet buffer.\n * @len denotes how many bytes in the buf.\n */\nstruct __ec_align4 ec_param_ec_codec_wov_set_lang {\n\tuint8_t hash[32];\n\tuint32_t total_len;\n\tuint32_t offset;\n\tuint8_t buf[128];\n\tuint32_t len;\n};\n\nstruct __ec_align4 ec_param_ec_codec_wov_set_lang_shm {\n\tuint8_t hash[32];\n\tuint32_t total_len;\n};\n\nstruct __ec_align4 ec_param_ec_codec_wov {\n\tuint8_t cmd; /* enum ec_codec_wov_subcmd */\n\tuint8_t reserved[3];\n\n\tunion {\n\t\tstruct ec_param_ec_codec_wov_set_lang\n\t\t\t\tset_lang_param;\n\t\tstruct ec_param_ec_codec_wov_set_lang_shm\n\t\t\t\tset_lang_shm_param;\n\t};\n};\n\nstruct __ec_align4 ec_response_ec_codec_wov_get_lang {\n\tuint8_t hash[32];\n};\n\nstruct __ec_align4 ec_response_ec_codec_wov_read_audio {\n\tuint8_t buf[128];\n\tuint32_t len;\n};\n\nstruct __ec_align4 ec_response_ec_codec_wov_read_audio_shm {\n\tuint32_t offset;\n\tuint32_t len;\n};\n\n/*****************************************************************************/\n/* System commands */\n\n/*\n * TODO(crosbug.com/p/23747): This is a confusing name, since it doesn't\n * necessarily reboot the EC.  Rename to \"image\" or something similar?\n */\n#define EC_CMD_REBOOT_EC 0x00D2\n\n/* Command */\nenum ec_reboot_cmd {\n\tEC_REBOOT_CANCEL = 0,        /* Cancel a pending reboot */\n\tEC_REBOOT_JUMP_RO = 1,       /* Jump to RO without rebooting */\n\tEC_REBOOT_JUMP_RW = 2,       /* Jump to active RW without rebooting */\n\t/* (command 3 was jump to RW-B) */\n\tEC_REBOOT_COLD = 4,          /* Cold-reboot */\n\tEC_REBOOT_DISABLE_JUMP = 5,  /* Disable jump until next reboot */\n\tEC_REBOOT_HIBERNATE = 6,     /* Hibernate EC */\n\tEC_REBOOT_HIBERNATE_CLEAR_AP_OFF = 7, /* and clears AP_OFF flag */\n\tEC_REBOOT_COLD_AP_OFF = 8,   /* Cold-reboot and don't boot AP */\n};\n\n/* Flags for ec_params_reboot_ec.reboot_flags */\n#define EC_REBOOT_FLAG_RESERVED0      BIT(0)  /* Was recovery request */\n#define EC_REBOOT_FLAG_ON_AP_SHUTDOWN BIT(1)  /* Reboot after AP shutdown */\n#define EC_REBOOT_FLAG_SWITCH_RW_SLOT BIT(2)  /* Switch RW slot */\n\nstruct ec_params_reboot_ec {\n\tuint8_t cmd;           /* enum ec_reboot_cmd */\n\tuint8_t flags;         /* See EC_REBOOT_FLAG_* */\n} __ec_align1;\n\n/*\n * Get information on last EC panic.\n *\n * Returns variable-length platform-dependent panic information.  See panic.h\n * for details.\n */\n#define EC_CMD_GET_PANIC_INFO 0x00D3\n\n/*****************************************************************************/\n/*\n * Special commands\n *\n * These do not follow the normal rules for commands.  See each command for\n * details.\n */\n\n/*\n * Reboot NOW\n *\n * This command will work even when the EC LPC interface is busy, because the\n * reboot command is processed at interrupt level.  Note that when the EC\n * reboots, the host will reboot too, so there is no response to this command.\n *\n * Use EC_CMD_REBOOT_EC to reboot the EC more politely.\n */\n#define EC_CMD_REBOOT 0x00D1  /* Think \"die\" */\n\n/*\n * Resend last response (not supported on LPC).\n *\n * Returns EC_RES_UNAVAILABLE if there is no response available - for example,\n * there was no previous command, or the previous command's response was too\n * big to save.\n */\n#define EC_CMD_RESEND_RESPONSE 0x00DB\n\n/*\n * This header byte on a command indicate version 0. Any header byte less\n * than this means that we are talking to an old EC which doesn't support\n * versioning. In that case, we assume version 0.\n *\n * Header bytes greater than this indicate a later version. For example,\n * EC_CMD_VERSION0 + 1 means we are using version 1.\n *\n * The old EC interface must not use commands 0xdc or higher.\n */\n#define EC_CMD_VERSION0 0x00DC\n\n/*****************************************************************************/\n/*\n * PD commands\n *\n * These commands are for PD MCU communication.\n */\n\n/* EC to PD MCU exchange status command */\n#define EC_CMD_PD_EXCHANGE_STATUS 0x0100\n#define EC_VER_PD_EXCHANGE_STATUS 2\n\nenum pd_charge_state {\n\tPD_CHARGE_NO_CHANGE = 0, /* Don't change charge state */\n\tPD_CHARGE_NONE,          /* No charging allowed */\n\tPD_CHARGE_5V,            /* 5V charging only */\n\tPD_CHARGE_MAX            /* Charge at max voltage */\n};\n\n/* Status of EC being sent to PD */\n#define EC_STATUS_HIBERNATING\tBIT(0)\n\nstruct ec_params_pd_status {\n\tuint8_t status;       /* EC status */\n\tint8_t batt_soc;      /* battery state of charge */\n\tuint8_t charge_state; /* charging state (from enum pd_charge_state) */\n} __ec_align1;\n\n/* Status of PD being sent back to EC */\n#define PD_STATUS_HOST_EVENT      BIT(0) /* Forward host event to AP */\n#define PD_STATUS_IN_RW           BIT(1) /* Running RW image */\n#define PD_STATUS_JUMPED_TO_IMAGE BIT(2) /* Current image was jumped to */\n#define PD_STATUS_TCPC_ALERT_0    BIT(3) /* Alert active in port 0 TCPC */\n#define PD_STATUS_TCPC_ALERT_1    BIT(4) /* Alert active in port 1 TCPC */\n#define PD_STATUS_TCPC_ALERT_2    BIT(5) /* Alert active in port 2 TCPC */\n#define PD_STATUS_TCPC_ALERT_3    BIT(6) /* Alert active in port 3 TCPC */\n#define PD_STATUS_EC_INT_ACTIVE  (PD_STATUS_TCPC_ALERT_0 | \\\n\t\t\t\t      PD_STATUS_TCPC_ALERT_1 | \\\n\t\t\t\t      PD_STATUS_HOST_EVENT)\nstruct ec_response_pd_status {\n\tuint32_t curr_lim_ma;       /* input current limit */\n\tuint16_t status;            /* PD MCU status */\n\tint8_t active_charge_port;  /* active charging port */\n} __ec_align_size1;\n\n/* AP to PD MCU host event status command, cleared on read */\n#define EC_CMD_PD_HOST_EVENT_STATUS 0x0104\n\n/* PD MCU host event status bits */\n#define PD_EVENT_UPDATE_DEVICE     BIT(0)\n#define PD_EVENT_POWER_CHANGE      BIT(1)\n#define PD_EVENT_IDENTITY_RECEIVED BIT(2)\n#define PD_EVENT_DATA_SWAP         BIT(3)\nstruct ec_response_host_event_status {\n\tuint32_t status;      /* PD MCU host event status */\n} __ec_align4;\n\n/* Set USB type-C port role and muxes */\n#define EC_CMD_USB_PD_CONTROL 0x0101\n\nenum usb_pd_control_role {\n\tUSB_PD_CTRL_ROLE_NO_CHANGE = 0,\n\tUSB_PD_CTRL_ROLE_TOGGLE_ON = 1, /* == AUTO */\n\tUSB_PD_CTRL_ROLE_TOGGLE_OFF = 2,\n\tUSB_PD_CTRL_ROLE_FORCE_SINK = 3,\n\tUSB_PD_CTRL_ROLE_FORCE_SOURCE = 4,\n\tUSB_PD_CTRL_ROLE_FREEZE = 5,\n\tUSB_PD_CTRL_ROLE_COUNT\n};\n\nenum usb_pd_control_mux {\n\tUSB_PD_CTRL_MUX_NO_CHANGE = 0,\n\tUSB_PD_CTRL_MUX_NONE = 1,\n\tUSB_PD_CTRL_MUX_USB = 2,\n\tUSB_PD_CTRL_MUX_DP = 3,\n\tUSB_PD_CTRL_MUX_DOCK = 4,\n\tUSB_PD_CTRL_MUX_AUTO = 5,\n\tUSB_PD_CTRL_MUX_COUNT\n};\n\nenum usb_pd_control_swap {\n\tUSB_PD_CTRL_SWAP_NONE = 0,\n\tUSB_PD_CTRL_SWAP_DATA = 1,\n\tUSB_PD_CTRL_SWAP_POWER = 2,\n\tUSB_PD_CTRL_SWAP_VCONN = 3,\n\tUSB_PD_CTRL_SWAP_COUNT\n};\n\nstruct ec_params_usb_pd_control {\n\tuint8_t port;\n\tuint8_t role;\n\tuint8_t mux;\n\tuint8_t swap;\n} __ec_align1;\n\n#define PD_CTRL_RESP_ENABLED_COMMS      BIT(0) /* Communication enabled */\n#define PD_CTRL_RESP_ENABLED_CONNECTED  BIT(1) /* Device connected */\n#define PD_CTRL_RESP_ENABLED_PD_CAPABLE BIT(2) /* Partner is PD capable */\n\n#define PD_CTRL_RESP_ROLE_POWER         BIT(0) /* 0=SNK/1=SRC */\n#define PD_CTRL_RESP_ROLE_DATA          BIT(1) /* 0=UFP/1=DFP */\n#define PD_CTRL_RESP_ROLE_VCONN         BIT(2) /* Vconn status */\n#define PD_CTRL_RESP_ROLE_DR_POWER      BIT(3) /* Partner is dualrole power */\n#define PD_CTRL_RESP_ROLE_DR_DATA       BIT(4) /* Partner is dualrole data */\n#define PD_CTRL_RESP_ROLE_USB_COMM      BIT(5) /* Partner USB comm capable */\n#define PD_CTRL_RESP_ROLE_EXT_POWERED   BIT(6) /* Partner externally powerd */\n\nstruct ec_response_usb_pd_control {\n\tuint8_t enabled;\n\tuint8_t role;\n\tuint8_t polarity;\n\tuint8_t state;\n} __ec_align1;\n\nstruct ec_response_usb_pd_control_v1 {\n\tuint8_t enabled;\n\tuint8_t role;\n\tuint8_t polarity;\n\tchar state[32];\n} __ec_align1;\n\n/* Values representing usbc PD CC state */\n#define USBC_PD_CC_NONE\t\t0 /* No accessory connected */\n#define USBC_PD_CC_NO_UFP\t1 /* No UFP accessory connected */\n#define USBC_PD_CC_AUDIO_ACC\t2 /* Audio accessory connected */\n#define USBC_PD_CC_DEBUG_ACC\t3 /* Debug accessory connected */\n#define USBC_PD_CC_UFP_ATTACHED\t4 /* UFP attached to usbc */\n#define USBC_PD_CC_DFP_ATTACHED\t5 /* DPF attached to usbc */\n\n/* Active/Passive Cable */\n#define USB_PD_CTRL_ACTIVE_CABLE        BIT(0)\n/* Optical/Non-optical cable */\n#define USB_PD_CTRL_OPTICAL_CABLE       BIT(1)\n/* 3rd Gen TBT device (or AMA)/2nd gen tbt Adapter */\n#define USB_PD_CTRL_TBT_LEGACY_ADAPTER  BIT(2)\n/* Active Link Uni-Direction */\n#define USB_PD_CTRL_ACTIVE_LINK_UNIDIR  BIT(3)\n\nstruct ec_response_usb_pd_control_v2 {\n\tuint8_t enabled;\n\tuint8_t role;\n\tuint8_t polarity;\n\tchar state[32];\n\tuint8_t cc_state;\t/* enum pd_cc_states representing cc state */\n\tuint8_t dp_mode;\t/* Current DP pin mode (MODE_DP_PIN_[A-E]) */\n\tuint8_t reserved;\t/* Reserved for future use */\n\tuint8_t control_flags;\t/* USB_PD_CTRL_*flags */\n\tuint8_t cable_speed;\t/* TBT_SS_* cable speed */\n\tuint8_t cable_gen;\t/* TBT_GEN3_* cable rounded support */\n} __ec_align1;\n\n#define EC_CMD_USB_PD_PORTS 0x0102\n\n/* Maximum number of PD ports on a device, num_ports will be <= this */\n#define EC_USB_PD_MAX_PORTS 8\n\nstruct ec_response_usb_pd_ports {\n\tuint8_t num_ports;\n} __ec_align1;\n\n#define EC_CMD_USB_PD_POWER_INFO 0x0103\n\n#define PD_POWER_CHARGING_PORT 0xff\nstruct ec_params_usb_pd_power_info {\n\tuint8_t port;\n} __ec_align1;\n\nenum usb_chg_type {\n\tUSB_CHG_TYPE_NONE,\n\tUSB_CHG_TYPE_PD,\n\tUSB_CHG_TYPE_C,\n\tUSB_CHG_TYPE_PROPRIETARY,\n\tUSB_CHG_TYPE_BC12_DCP,\n\tUSB_CHG_TYPE_BC12_CDP,\n\tUSB_CHG_TYPE_BC12_SDP,\n\tUSB_CHG_TYPE_OTHER,\n\tUSB_CHG_TYPE_VBUS,\n\tUSB_CHG_TYPE_UNKNOWN,\n\tUSB_CHG_TYPE_DEDICATED,\n};\nenum usb_power_roles {\n\tUSB_PD_PORT_POWER_DISCONNECTED,\n\tUSB_PD_PORT_POWER_SOURCE,\n\tUSB_PD_PORT_POWER_SINK,\n\tUSB_PD_PORT_POWER_SINK_NOT_CHARGING,\n};\n\nstruct usb_chg_measures {\n\tuint16_t voltage_max;\n\tuint16_t voltage_now;\n\tuint16_t current_max;\n\tuint16_t current_lim;\n} __ec_align2;\n\nstruct ec_response_usb_pd_power_info {\n\tuint8_t role;\n\tuint8_t type;\n\tuint8_t dualrole;\n\tuint8_t reserved1;\n\tstruct usb_chg_measures meas;\n\tuint32_t max_power;\n} __ec_align4;\n\n\n/*\n * This command will return the number of USB PD charge port + the number\n * of dedicated port present.\n * EC_CMD_USB_PD_PORTS does NOT include the dedicated ports\n */\n#define EC_CMD_CHARGE_PORT_COUNT 0x0105\nstruct ec_response_charge_port_count {\n\tuint8_t port_count;\n} __ec_align1;\n\n/* Write USB-PD device FW */\n#define EC_CMD_USB_PD_FW_UPDATE 0x0110\n\nenum usb_pd_fw_update_cmds {\n\tUSB_PD_FW_REBOOT,\n\tUSB_PD_FW_FLASH_ERASE,\n\tUSB_PD_FW_FLASH_WRITE,\n\tUSB_PD_FW_ERASE_SIG,\n};\n\nstruct ec_params_usb_pd_fw_update {\n\tuint16_t dev_id;\n\tuint8_t cmd;\n\tuint8_t port;\n\tuint32_t size;     /* Size to write in bytes */\n\t/* Followed by data to write */\n} __ec_align4;\n\n/* Write USB-PD Accessory RW_HASH table entry */\n#define EC_CMD_USB_PD_RW_HASH_ENTRY 0x0111\n/* RW hash is first 20 bytes of SHA-256 of RW section */\n#define PD_RW_HASH_SIZE 20\nstruct ec_params_usb_pd_rw_hash_entry {\n\tuint16_t dev_id;\n\tuint8_t dev_rw_hash[PD_RW_HASH_SIZE];\n\tuint8_t reserved;        /*\n\t\t\t\t  * For alignment of current_image\n\t\t\t\t  * TODO(rspangler) but it's not aligned!\n\t\t\t\t  * Should have been reserved[2].\n\t\t\t\t  */\n\tuint32_t current_image;  /* One of ec_current_image */\n} __ec_align1;\n\n/* Read USB-PD Accessory info */\n#define EC_CMD_USB_PD_DEV_INFO 0x0112\n\nstruct ec_params_usb_pd_info_request {\n\tuint8_t port;\n} __ec_align1;\n\n/* Read USB-PD Device discovery info */\n#define EC_CMD_USB_PD_DISCOVERY 0x0113\nstruct ec_params_usb_pd_discovery_entry {\n\tuint16_t vid;  /* USB-IF VID */\n\tuint16_t pid;  /* USB-IF PID */\n\tuint8_t ptype; /* product type (hub,periph,cable,ama) */\n} __ec_align_size1;\n\n/* Override default charge behavior */\n#define EC_CMD_PD_CHARGE_PORT_OVERRIDE 0x0114\n\n/* Negative port parameters have special meaning */\nenum usb_pd_override_ports {\n\tOVERRIDE_DONT_CHARGE = -2,\n\tOVERRIDE_OFF = -1,\n\t/* [0, CONFIG_USB_PD_PORT_COUNT): Port# */\n};\n\nstruct ec_params_charge_port_override {\n\tint16_t override_port; /* Override port# */\n} __ec_align2;\n\n/*\n * Read (and delete) one entry of PD event log.\n * TODO(crbug.com/751742): Make this host command more generic to accommodate\n * future non-PD logs that use the same internal EC event_log.\n */\n#define EC_CMD_PD_GET_LOG_ENTRY 0x0115\n\nstruct ec_response_pd_log {\n\tuint32_t timestamp; /* relative timestamp in milliseconds */\n\tuint8_t type;       /* event type : see PD_EVENT_xx below */\n\tuint8_t size_port;  /* [7:5] port number [4:0] payload size in bytes */\n\tuint16_t data;      /* type-defined data payload */\n\tuint8_t payload[];  /* optional additional data payload: 0..16 bytes */\n} __ec_align4;\n\n/* The timestamp is the microsecond counter shifted to get about a ms. */\n#define PD_LOG_TIMESTAMP_SHIFT 10 /* 1 LSB = 1024us */\n\n#define PD_LOG_SIZE_MASK  0x1f\n#define PD_LOG_PORT_MASK  0xe0\n#define PD_LOG_PORT_SHIFT    5\n#define PD_LOG_PORT_SIZE(port, size) (((port) << PD_LOG_PORT_SHIFT) | \\\n\t\t\t\t      ((size) & PD_LOG_SIZE_MASK))\n#define PD_LOG_PORT(size_port) ((size_port) >> PD_LOG_PORT_SHIFT)\n#define PD_LOG_SIZE(size_port) ((size_port) & PD_LOG_SIZE_MASK)\n\n/* PD event log : entry types */\n/* PD MCU events */\n#define PD_EVENT_MCU_BASE       0x00\n#define PD_EVENT_MCU_CHARGE             (PD_EVENT_MCU_BASE+0)\n#define PD_EVENT_MCU_CONNECT            (PD_EVENT_MCU_BASE+1)\n/* Reserved for custom board event */\n#define PD_EVENT_MCU_BOARD_CUSTOM       (PD_EVENT_MCU_BASE+2)\n/* PD generic accessory events */\n#define PD_EVENT_ACC_BASE       0x20\n#define PD_EVENT_ACC_RW_FAIL   (PD_EVENT_ACC_BASE+0)\n#define PD_EVENT_ACC_RW_ERASE  (PD_EVENT_ACC_BASE+1)\n/* PD power supply events */\n#define PD_EVENT_PS_BASE        0x40\n#define PD_EVENT_PS_FAULT      (PD_EVENT_PS_BASE+0)\n/* PD video dongles events */\n#define PD_EVENT_VIDEO_BASE     0x60\n#define PD_EVENT_VIDEO_DP_MODE (PD_EVENT_VIDEO_BASE+0)\n#define PD_EVENT_VIDEO_CODEC   (PD_EVENT_VIDEO_BASE+1)\n/* Returned in the \"type\" field, when there is no entry available */\n#define PD_EVENT_NO_ENTRY       0xff\n\n/*\n * PD_EVENT_MCU_CHARGE event definition :\n * the payload is \"struct usb_chg_measures\"\n * the data field contains the port state flags as defined below :\n */\n/* Port partner is a dual role device */\n#define CHARGE_FLAGS_DUAL_ROLE         BIT(15)\n/* Port is the pending override port */\n#define CHARGE_FLAGS_DELAYED_OVERRIDE  BIT(14)\n/* Port is the override port */\n#define CHARGE_FLAGS_OVERRIDE          BIT(13)\n/* Charger type */\n#define CHARGE_FLAGS_TYPE_SHIFT               3\n#define CHARGE_FLAGS_TYPE_MASK       (0xf << CHARGE_FLAGS_TYPE_SHIFT)\n/* Power delivery role */\n#define CHARGE_FLAGS_ROLE_MASK         (7 <<  0)\n\n/*\n * PD_EVENT_PS_FAULT data field flags definition :\n */\n#define PS_FAULT_OCP                          1\n#define PS_FAULT_FAST_OCP                     2\n#define PS_FAULT_OVP                          3\n#define PS_FAULT_DISCH                        4\n\n/*\n * PD_EVENT_VIDEO_CODEC payload is \"struct mcdp_info\".\n */\nstruct mcdp_version {\n\tuint8_t major;\n\tuint8_t minor;\n\tuint16_t build;\n} __ec_align4;\n\nstruct mcdp_info {\n\tuint8_t family[2];\n\tuint8_t chipid[2];\n\tstruct mcdp_version irom;\n\tstruct mcdp_version fw;\n} __ec_align4;\n\n/* struct mcdp_info field decoding */\n#define MCDP_CHIPID(chipid) ((chipid[0] << 8) | chipid[1])\n#define MCDP_FAMILY(family) ((family[0] << 8) | family[1])\n\n/* Get/Set USB-PD Alternate mode info */\n#define EC_CMD_USB_PD_GET_AMODE 0x0116\nstruct ec_params_usb_pd_get_mode_request {\n\tuint16_t svid_idx; /* SVID index to get */\n\tuint8_t port;      /* port */\n} __ec_align_size1;\n\nstruct ec_params_usb_pd_get_mode_response {\n\tuint16_t svid;   /* SVID */\n\tuint16_t opos;    /* Object Position */\n\tuint32_t vdo[6]; /* Mode VDOs */\n} __ec_align4;\n\n#define EC_CMD_USB_PD_SET_AMODE 0x0117\n\nenum pd_mode_cmd {\n\tPD_EXIT_MODE = 0,\n\tPD_ENTER_MODE = 1,\n\t/* Not a command.  Do NOT remove. */\n\tPD_MODE_CMD_COUNT,\n};\n\nstruct ec_params_usb_pd_set_mode_request {\n\tuint32_t cmd;  /* enum pd_mode_cmd */\n\tuint16_t svid; /* SVID to set */\n\tuint8_t opos;  /* Object Position */\n\tuint8_t port;  /* port */\n} __ec_align4;\n\n/* Ask the PD MCU to record a log of a requested type */\n#define EC_CMD_PD_WRITE_LOG_ENTRY 0x0118\n\nstruct ec_params_pd_write_log_entry {\n\tuint8_t type; /* event type : see PD_EVENT_xx above */\n\tuint8_t port; /* port#, or 0 for events unrelated to a given port */\n} __ec_align1;\n\n\n/* Control USB-PD chip */\n#define EC_CMD_PD_CONTROL 0x0119\n\nenum ec_pd_control_cmd {\n\tPD_SUSPEND = 0,      /* Suspend the PD chip (EC: stop talking to PD) */\n\tPD_RESUME,           /* Resume the PD chip (EC: start talking to PD) */\n\tPD_RESET,            /* Force reset the PD chip */\n\tPD_CONTROL_DISABLE,  /* Disable further calls to this command */\n\tPD_CHIP_ON,          /* Power on the PD chip */\n};\n\nstruct ec_params_pd_control {\n\tuint8_t chip;         /* chip id */\n\tuint8_t subcmd;\n} __ec_align1;\n\n/* Get info about USB-C SS muxes */\n#define EC_CMD_USB_PD_MUX_INFO 0x011A\n\nstruct ec_params_usb_pd_mux_info {\n\tuint8_t port; /* USB-C port number */\n} __ec_align1;\n\n/* Flags representing mux state */\n#define USB_PD_MUX_NONE               0      /* Open switch */\n#define USB_PD_MUX_USB_ENABLED        BIT(0) /* USB connected */\n#define USB_PD_MUX_DP_ENABLED         BIT(1) /* DP connected */\n#define USB_PD_MUX_POLARITY_INVERTED  BIT(2) /* CC line Polarity inverted */\n#define USB_PD_MUX_HPD_IRQ            BIT(3) /* HPD IRQ is asserted */\n#define USB_PD_MUX_HPD_LVL            BIT(4) /* HPD level is asserted */\n#define USB_PD_MUX_SAFE_MODE          BIT(5) /* DP is in safe mode */\n#define USB_PD_MUX_TBT_COMPAT_ENABLED BIT(6) /* TBT compat enabled */\n#define USB_PD_MUX_USB4_ENABLED       BIT(7) /* USB4 enabled */\n\nstruct ec_response_usb_pd_mux_info {\n\tuint8_t flags; /* USB_PD_MUX_*-encoded USB mux state */\n} __ec_align1;\n\n#define EC_CMD_PD_CHIP_INFO\t\t0x011B\n\nstruct ec_params_pd_chip_info {\n\tuint8_t port;\t/* USB-C port number */\n\tuint8_t renew;\t/* Force renewal */\n} __ec_align1;\n\nstruct ec_response_pd_chip_info {\n\tuint16_t vendor_id;\n\tuint16_t product_id;\n\tuint16_t device_id;\n\tunion {\n\t\tuint8_t fw_version_string[8];\n\t\tuint64_t fw_version_number;\n\t};\n} __ec_align2;\n\nstruct ec_response_pd_chip_info_v1 {\n\tuint16_t vendor_id;\n\tuint16_t product_id;\n\tuint16_t device_id;\n\tunion {\n\t\tuint8_t fw_version_string[8];\n\t\tuint64_t fw_version_number;\n\t};\n\tunion {\n\t\tuint8_t min_req_fw_version_string[8];\n\t\tuint64_t min_req_fw_version_number;\n\t};\n} __ec_align2;\n\n/* Run RW signature verification and get status */\n#define EC_CMD_RWSIG_CHECK_STATUS\t0x011C\n\nstruct ec_response_rwsig_check_status {\n\tuint32_t status;\n} __ec_align4;\n\n/* For controlling RWSIG task */\n#define EC_CMD_RWSIG_ACTION\t0x011D\n\nenum rwsig_action {\n\tRWSIG_ACTION_ABORT = 0,\t\t/* Abort RWSIG and prevent jumping */\n\tRWSIG_ACTION_CONTINUE = 1,\t/* Jump to RW immediately */\n};\n\nstruct ec_params_rwsig_action {\n\tuint32_t action;\n} __ec_align4;\n\n/* Run verification on a slot */\n#define EC_CMD_EFS_VERIFY\t0x011E\n\nstruct ec_params_efs_verify {\n\tuint8_t region;\t\t/* enum ec_flash_region */\n} __ec_align1;\n\n/*\n * Retrieve info from Cros Board Info store. Response is based on the data\n * type. Integers return a uint32. Strings return a string, using the response\n * size to determine how big it is.\n */\n#define EC_CMD_GET_CROS_BOARD_INFO\t0x011F\n/*\n * Write info into Cros Board Info on EEPROM. Write fails if the board has\n * hardware write-protect enabled.\n */\n#define EC_CMD_SET_CROS_BOARD_INFO\t0x0120\n\nenum cbi_data_tag {\n\tCBI_TAG_BOARD_VERSION = 0, /* uint32_t or smaller */\n\tCBI_TAG_OEM_ID = 1,        /* uint32_t or smaller */\n\tCBI_TAG_SKU_ID = 2,        /* uint32_t or smaller */\n\tCBI_TAG_DRAM_PART_NUM = 3, /* variable length ascii, nul terminated. */\n\tCBI_TAG_OEM_NAME = 4,      /* variable length ascii, nul terminated. */\n\tCBI_TAG_MODEL_ID = 5,      /* uint32_t or smaller */\n\tCBI_TAG_COUNT,\n};\n\n/*\n * Flags to control read operation\n *\n * RELOAD:  Invalidate cache and read data from EEPROM. Useful to verify\n *          write was successful without reboot.\n */\n#define CBI_GET_RELOAD\t\tBIT(0)\n\nstruct ec_params_get_cbi {\n\tuint32_t tag;\t\t/* enum cbi_data_tag */\n\tuint32_t flag;\t\t/* CBI_GET_* */\n} __ec_align4;\n\n/*\n * Flags to control write behavior.\n *\n * NO_SYNC: Makes EC update data in RAM but skip writing to EEPROM. It's\n *          useful when writing multiple fields in a row.\n * INIT:    Need to be set when creating a new CBI from scratch. All fields\n *          will be initialized to zero first.\n */\n#define CBI_SET_NO_SYNC\t\tBIT(0)\n#define CBI_SET_INIT\t\tBIT(1)\n\nstruct ec_params_set_cbi {\n\tuint32_t tag;\t\t/* enum cbi_data_tag */\n\tuint32_t flag;\t\t/* CBI_SET_* */\n\tuint32_t size;\t\t/* Data size */\n\tuint8_t data[];\t\t/* For string and raw data */\n} __ec_align1;\n\n/*\n * Information about resets of the AP by the EC and the EC's own uptime.\n */\n#define EC_CMD_GET_UPTIME_INFO 0x0121\n\nstruct ec_response_uptime_info {\n\t/*\n\t * Number of milliseconds since the last EC boot. Sysjump resets\n\t * typically do not restart the EC's time_since_boot epoch.\n\t *\n\t * WARNING: The EC's sense of time is much less accurate than the AP's\n\t * sense of time, in both phase and frequency.  This timebase is similar\n\t * to CLOCK_MONOTONIC_RAW, but with 1% or more frequency error.\n\t */\n\tuint32_t time_since_ec_boot_ms;\n\n\t/*\n\t * Number of times the AP was reset by the EC since the last EC boot.\n\t * Note that the AP may be held in reset by the EC during the initial\n\t * boot sequence, such that the very first AP boot may count as more\n\t * than one here.\n\t */\n\tuint32_t ap_resets_since_ec_boot;\n\n\t/*\n\t * The set of flags which describe the EC's most recent reset.  See\n\t * include/system.h RESET_FLAG_* for details.\n\t */\n\tuint32_t ec_reset_flags;\n\n\t/* Empty log entries have both the cause and timestamp set to zero. */\n\tstruct ap_reset_log_entry {\n\t\t/*\n\t\t * See include/chipset.h: enum chipset_{reset,shutdown}_reason\n\t\t * for details.\n\t\t */\n\t\tuint16_t reset_cause;\n\n\t\t/* Reserved for protocol growth. */\n\t\tuint16_t reserved;\n\n\t\t/*\n\t\t * The time of the reset's assertion, in milliseconds since the\n\t\t * last EC boot, in the same epoch as time_since_ec_boot_ms.\n\t\t * Set to zero if the log entry is empty.\n\t\t */\n\t\tuint32_t reset_time_ms;\n\t} recent_ap_reset[4];\n} __ec_align4;\n\n/*\n * Add entropy to the device secret (stored in the rollback region).\n *\n * Depending on the chip, the operation may take a long time (e.g. to erase\n * flash), so the commands are asynchronous.\n */\n#define EC_CMD_ADD_ENTROPY\t0x0122\n\nenum add_entropy_action {\n\t/* Add entropy to the current secret. */\n\tADD_ENTROPY_ASYNC = 0,\n\t/*\n\t * Add entropy, and also make sure that the previous secret is erased.\n\t * (this can be implemented by adding entropy multiple times until\n\t * all rolback blocks have been overwritten).\n\t */\n\tADD_ENTROPY_RESET_ASYNC = 1,\n\t/* Read back result from the previous operation. */\n\tADD_ENTROPY_GET_RESULT = 2,\n};\n\nstruct ec_params_rollback_add_entropy {\n\tuint8_t action;\n} __ec_align1;\n\n/*\n * Perform a single read of a given ADC channel.\n */\n#define EC_CMD_ADC_READ\t\t0x0123\n\nstruct ec_params_adc_read {\n\tuint8_t adc_channel;\n} __ec_align1;\n\nstruct ec_response_adc_read {\n\tint32_t adc_value;\n} __ec_align4;\n\n/*\n * Read back rollback info\n */\n#define EC_CMD_ROLLBACK_INFO\t\t0x0124\n\nstruct ec_response_rollback_info {\n\tint32_t id; /* Incrementing number to indicate which region to use. */\n\tint32_t rollback_min_version;\n\tint32_t rw_rollback_version;\n} __ec_align4;\n\n\n/* Issue AP reset */\n#define EC_CMD_AP_RESET 0x0125\n\n/*****************************************************************************/\n/* Voltage regulator controls */\n\n/*\n * Get basic info of voltage regulator for given index.\n *\n * Returns the regulator name and supported voltage list in mV.\n */\n#define EC_CMD_REGULATOR_GET_INFO 0x012C\n\n/* Maximum length of regulator name */\n#define EC_REGULATOR_NAME_MAX_LEN 16\n\n/* Maximum length of the supported voltage list. */\n#define EC_REGULATOR_VOLTAGE_MAX_COUNT 16\n\nstruct ec_params_regulator_get_info {\n\tuint32_t index;\n} __ec_align4;\n\nstruct ec_response_regulator_get_info {\n\tchar name[EC_REGULATOR_NAME_MAX_LEN];\n\tuint16_t num_voltages;\n\tuint16_t voltages_mv[EC_REGULATOR_VOLTAGE_MAX_COUNT];\n} __ec_align2;\n\n/*\n * Configure the regulator as enabled / disabled.\n */\n#define EC_CMD_REGULATOR_ENABLE 0x012D\n\nstruct ec_params_regulator_enable {\n\tuint32_t index;\n\tuint8_t enable;\n} __ec_align4;\n\n/*\n * Query if the regulator is enabled.\n *\n * Returns 1 if the regulator is enabled, 0 if not.\n */\n#define EC_CMD_REGULATOR_IS_ENABLED 0x012E\n\nstruct ec_params_regulator_is_enabled {\n\tuint32_t index;\n} __ec_align4;\n\nstruct ec_response_regulator_is_enabled {\n\tuint8_t enabled;\n} __ec_align1;\n\n/*\n * Set voltage for the voltage regulator within the range specified.\n *\n * The driver should select the voltage in range closest to min_mv.\n *\n * Also note that this might be called before the regulator is enabled, and the\n * setting should be in effect after the regulator is enabled.\n */\n#define EC_CMD_REGULATOR_SET_VOLTAGE 0x012F\n\nstruct ec_params_regulator_set_voltage {\n\tuint32_t index;\n\tuint32_t min_mv;\n\tuint32_t max_mv;\n} __ec_align4;\n\n/*\n * Get the currently configured voltage for the voltage regulator.\n *\n * Note that this might be called before the regulator is enabled, and this\n * should return the configured output voltage if the regulator is enabled.\n */\n#define EC_CMD_REGULATOR_GET_VOLTAGE 0x0130\n\nstruct ec_params_regulator_get_voltage {\n\tuint32_t index;\n} __ec_align4;\n\nstruct ec_response_regulator_get_voltage {\n\tuint32_t voltage_mv;\n} __ec_align4;\n\n/*\n * Gather all discovery information for the given port and partner type.\n *\n * Note that if discovery has not yet completed, only the currently completed\n * responses will be filled in.   If the discovery data structures are changed\n * in the process of the command running, BUSY will be returned.\n *\n * VDO field sizes are set to the maximum possible number of VDOs a VDM may\n * contain, while the number of SVIDs here is selected to fit within the PROTO2\n * maximum parameter size.\n */\n#define EC_CMD_TYPEC_DISCOVERY 0x0131\n\nenum typec_partner_type {\n\tTYPEC_PARTNER_SOP = 0,\n\tTYPEC_PARTNER_SOP_PRIME = 1,\n};\n\nstruct ec_params_typec_discovery {\n\tuint8_t port;\n\tuint8_t partner_type; /* enum typec_partner_type */\n} __ec_align1;\n\nstruct svid_mode_info {\n\tuint16_t svid;\n\tuint16_t mode_count;  /* Number of modes partner sent */\n\tuint32_t mode_vdo[6]; /* Max VDOs allowed after VDM header is 6 */\n};\n\nstruct ec_response_typec_discovery {\n\tuint8_t identity_count;    /* Number of identity VDOs partner sent */\n\tuint8_t svid_count;\t   /* Number of SVIDs partner sent */\n\tuint16_t reserved;\n\tuint32_t discovery_vdo[6]; /* Max VDOs allowed after VDM header is 6 */\n\tstruct svid_mode_info svids[0];\n} __ec_align1;\n\n/*\n * Gather all status information for a port.\n *\n * Note: this covers many of the return fields from the deprecated\n * EC_CMD_USB_PD_CONTROL command, except those that are redundant with the\n * discovery data.  The \"enum pd_cc_states\" is defined with the deprecated\n * EC_CMD_USB_PD_CONTROL command.\n *\n * This also combines in the EC_CMD_USB_PD_MUX_INFO flags.\n */\n#define EC_CMD_TYPEC_STATUS 0x0133\n\n/*\n * Power role.\n *\n * Note this is also used for PD header creation, and values align to those in\n * the Power Delivery Specification Revision 3.0 (See\n * 6.2.1.1.4 Port Power Role).\n */\nenum pd_power_role {\n\tPD_ROLE_SINK = 0,\n\tPD_ROLE_SOURCE = 1\n};\n\n/*\n * Data role.\n *\n * Note this is also used for PD header creation, and the first two values\n * align to those in the Power Delivery Specification Revision 3.0 (See\n * 6.2.1.1.6 Port Data Role).\n */\nenum pd_data_role {\n\tPD_ROLE_UFP = 0,\n\tPD_ROLE_DFP = 1,\n\tPD_ROLE_DISCONNECTED = 2,\n};\n\nenum pd_vconn_role {\n\tPD_ROLE_VCONN_OFF = 0,\n\tPD_ROLE_VCONN_SRC = 1,\n};\n\n/*\n * Note: BIT(0) may be used to determine whether the polarity is CC1 or CC2,\n * regardless of whether a debug accessory is connected.\n */\nenum tcpc_cc_polarity {\n\t/*\n\t * _CCx: is used to indicate the polarity while not connected to\n\t * a Debug Accessory.  Only one CC line will assert a resistor and\n\t * the other will be open.\n\t */\n\tPOLARITY_CC1 = 0,\n\tPOLARITY_CC2 = 1,\n\n\t/*\n\t * _CCx_DTS is used to indicate the polarity while connected to a\n\t * SRC Debug Accessory.  Assert resistors on both lines.\n\t */\n\tPOLARITY_CC1_DTS = 2,\n\tPOLARITY_CC2_DTS = 3,\n\n\t/*\n\t * The current TCPC code relies on these specific POLARITY values.\n\t * Adding in a check to verify if the list grows for any reason\n\t * that this will give a hint that other places need to be\n\t * adjusted.\n\t */\n\tPOLARITY_COUNT\n};\n\n#define PD_STATUS_EVENT_SOP_DISC_DONE\t\tBIT(0)\n#define PD_STATUS_EVENT_SOP_PRIME_DISC_DONE\tBIT(1)\n\nstruct ec_params_typec_status {\n\tuint8_t port;\n} __ec_align1;\n\nstruct ec_response_typec_status {\n\tuint8_t pd_enabled;\t\t/* PD communication enabled - bool */\n\tuint8_t dev_connected;\t\t/* Device connected - bool */\n\tuint8_t sop_connected;\t\t/* Device is SOP PD capable - bool */\n\tuint8_t source_cap_count;\t/* Number of Source Cap PDOs */\n\n\tuint8_t power_role;\t\t/* enum pd_power_role */\n\tuint8_t data_role;\t\t/* enum pd_data_role */\n\tuint8_t vconn_role;\t\t/* enum pd_vconn_role */\n\tuint8_t sink_cap_count;\t\t/* Number of Sink Cap PDOs */\n\n\tuint8_t polarity;\t\t/* enum tcpc_cc_polarity */\n\tuint8_t cc_state;\t\t/* enum pd_cc_states */\n\tuint8_t dp_pin;\t\t\t/* DP pin mode (MODE_DP_IN_[A-E]) */\n\tuint8_t mux_state;\t\t/* USB_PD_MUX* - encoded mux state */\n\n\tchar tc_state[32];\t\t/* TC state name */\n\n\tuint32_t events;\t\t/* PD_STATUS_EVENT bitmask */\n\n\t/*\n\t * BCD PD revisions for partners\n\t *\n\t * The format has the PD major reversion in the upper nibble, and PD\n\t * minor version in the next nibble.  Following two nibbles are\n\t * currently 0.\n\t * ex. PD 3.2 would map to 0x3200\n\t *\n\t * PD major/minor will be 0 if no PD device is connected.\n\t */\n\tuint16_t sop_revision;\n\tuint16_t sop_prime_revision;\n\n\tuint32_t source_cap_pdos[7];\t/* Max 7 PDOs can be present */\n\n\tuint32_t sink_cap_pdos[7];\t/* Max 7 PDOs can be present */\n} __ec_align1;\n\n/*****************************************************************************/\n/* The command range 0x200-0x2FF is reserved for Rotor. */\n\n/*****************************************************************************/\n/*\n * Reserve a range of host commands for the CR51 firmware.\n */\n#define EC_CMD_CR51_BASE 0x0300\n#define EC_CMD_CR51_LAST 0x03FF\n\n/*****************************************************************************/\n/* Fingerprint MCU commands: range 0x0400-0x040x */\n\n/* Fingerprint SPI sensor passthru command: prototyping ONLY */\n#define EC_CMD_FP_PASSTHRU 0x0400\n\n#define EC_FP_FLAG_NOT_COMPLETE 0x1\n\nstruct ec_params_fp_passthru {\n\tuint16_t len;\t\t/* Number of bytes to write then read */\n\tuint16_t flags;\t\t/* EC_FP_FLAG_xxx */\n\tuint8_t data[];\t\t/* Data to send */\n} __ec_align2;\n\n/* Configure the Fingerprint MCU behavior */\n#define EC_CMD_FP_MODE 0x0402\n\n/* Put the sensor in its lowest power mode */\n#define FP_MODE_DEEPSLEEP      BIT(0)\n/* Wait to see a finger on the sensor */\n#define FP_MODE_FINGER_DOWN    BIT(1)\n/* Poll until the finger has left the sensor */\n#define FP_MODE_FINGER_UP      BIT(2)\n/* Capture the current finger image */\n#define FP_MODE_CAPTURE        BIT(3)\n/* Finger enrollment session on-going */\n#define FP_MODE_ENROLL_SESSION BIT(4)\n/* Enroll the current finger image */\n#define FP_MODE_ENROLL_IMAGE   BIT(5)\n/* Try to match the current finger image */\n#define FP_MODE_MATCH          BIT(6)\n/* Reset and re-initialize the sensor. */\n#define FP_MODE_RESET_SENSOR   BIT(7)\n/* special value: don't change anything just read back current mode */\n#define FP_MODE_DONT_CHANGE    BIT(31)\n\n#define FP_VALID_MODES (FP_MODE_DEEPSLEEP      | \\\n\t\t\tFP_MODE_FINGER_DOWN    | \\\n\t\t\tFP_MODE_FINGER_UP      | \\\n\t\t\tFP_MODE_CAPTURE        | \\\n\t\t\tFP_MODE_ENROLL_SESSION | \\\n\t\t\tFP_MODE_ENROLL_IMAGE   | \\\n\t\t\tFP_MODE_MATCH          | \\\n\t\t\tFP_MODE_RESET_SENSOR   | \\\n\t\t\tFP_MODE_DONT_CHANGE)\n\n/* Capture types defined in bits [30..28] */\n#define FP_MODE_CAPTURE_TYPE_SHIFT 28\n#define FP_MODE_CAPTURE_TYPE_MASK  (0x7 << FP_MODE_CAPTURE_TYPE_SHIFT)\n/*\n * This enum must remain ordered, if you add new values you must ensure that\n * FP_CAPTURE_TYPE_MAX is still the last one.\n */\nenum fp_capture_type {\n\t/* Full blown vendor-defined capture (produces 'frame_size' bytes) */\n\tFP_CAPTURE_VENDOR_FORMAT = 0,\n\t/* Simple raw image capture (produces width x height x bpp bits) */\n\tFP_CAPTURE_SIMPLE_IMAGE = 1,\n\t/* Self test pattern (e.g. checkerboard) */\n\tFP_CAPTURE_PATTERN0 = 2,\n\t/* Self test pattern (e.g. inverted checkerboard) */\n\tFP_CAPTURE_PATTERN1 = 3,\n\t/* Capture for Quality test with fixed contrast */\n\tFP_CAPTURE_QUALITY_TEST = 4,\n\t/* Capture for pixel reset value test */\n\tFP_CAPTURE_RESET_TEST = 5,\n\tFP_CAPTURE_TYPE_MAX,\n};\n/* Extracts the capture type from the sensor 'mode' word */\n#define FP_CAPTURE_TYPE(mode) (((mode) & FP_MODE_CAPTURE_TYPE_MASK) \\\n\t\t\t\t       >> FP_MODE_CAPTURE_TYPE_SHIFT)\n\nstruct ec_params_fp_mode {\n\tuint32_t mode; /* as defined by FP_MODE_ constants */\n} __ec_align4;\n\nstruct ec_response_fp_mode {\n\tuint32_t mode; /* as defined by FP_MODE_ constants */\n} __ec_align4;\n\n/* Retrieve Fingerprint sensor information */\n#define EC_CMD_FP_INFO 0x0403\n\n/* Number of dead pixels detected on the last maintenance */\n#define FP_ERROR_DEAD_PIXELS(errors) ((errors) & 0x3FF)\n/* Unknown number of dead pixels detected on the last maintenance */\n#define FP_ERROR_DEAD_PIXELS_UNKNOWN (0x3FF)\n/* No interrupt from the sensor */\n#define FP_ERROR_NO_IRQ    BIT(12)\n/* SPI communication error */\n#define FP_ERROR_SPI_COMM  BIT(13)\n/* Invalid sensor Hardware ID */\n#define FP_ERROR_BAD_HWID  BIT(14)\n/* Sensor initialization failed */\n#define FP_ERROR_INIT_FAIL BIT(15)\n\nstruct ec_response_fp_info_v0 {\n\t/* Sensor identification */\n\tuint32_t vendor_id;\n\tuint32_t product_id;\n\tuint32_t model_id;\n\tuint32_t version;\n\t/* Image frame characteristics */\n\tuint32_t frame_size;\n\tuint32_t pixel_format; /* using V4L2_PIX_FMT_ */\n\tuint16_t width;\n\tuint16_t height;\n\tuint16_t bpp;\n\tuint16_t errors; /* see FP_ERROR_ flags above */\n} __ec_align4;\n\nstruct ec_response_fp_info {\n\t/* Sensor identification */\n\tuint32_t vendor_id;\n\tuint32_t product_id;\n\tuint32_t model_id;\n\tuint32_t version;\n\t/* Image frame characteristics */\n\tuint32_t frame_size;\n\tuint32_t pixel_format; /* using V4L2_PIX_FMT_ */\n\tuint16_t width;\n\tuint16_t height;\n\tuint16_t bpp;\n\tuint16_t errors; /* see FP_ERROR_ flags above */\n\t/* Template/finger current information */\n\tuint32_t template_size;  /* max template size in bytes */\n\tuint16_t template_max;   /* maximum number of fingers/templates */\n\tuint16_t template_valid; /* number of valid fingers/templates */\n\tuint32_t template_dirty; /* bitmap of templates with MCU side changes */\n\tuint32_t template_version; /* version of the template format */\n} __ec_align4;\n\n/* Get the last captured finger frame or a template content */\n#define EC_CMD_FP_FRAME 0x0404\n\n/* constants defining the 'offset' field which also contains the frame index */\n#define FP_FRAME_INDEX_SHIFT       28\n/* Frame buffer where the captured image is stored */\n#define FP_FRAME_INDEX_RAW_IMAGE    0\n/* First frame buffer holding a template */\n#define FP_FRAME_INDEX_TEMPLATE     1\n#define FP_FRAME_GET_BUFFER_INDEX(offset) ((offset) >> FP_FRAME_INDEX_SHIFT)\n#define FP_FRAME_OFFSET_MASK       0x0FFFFFFF\n\n/* Version of the format of the encrypted templates. */\n#define FP_TEMPLATE_FORMAT_VERSION 3\n\n/* Constants for encryption parameters */\n#define FP_CONTEXT_NONCE_BYTES 12\n#define FP_CONTEXT_USERID_WORDS (32 / sizeof(uint32_t))\n#define FP_CONTEXT_TAG_BYTES 16\n#define FP_CONTEXT_SALT_BYTES 16\n#define FP_CONTEXT_TPM_BYTES 32\n\nstruct ec_fp_template_encryption_metadata {\n\t/*\n\t * Version of the structure format (N=3).\n\t */\n\tuint16_t struct_version;\n\t/* Reserved bytes, set to 0. */\n\tuint16_t reserved;\n\t/*\n\t * The salt is *only* ever used for key derivation. The nonce is unique,\n\t * a different one is used for every message.\n\t */\n\tuint8_t nonce[FP_CONTEXT_NONCE_BYTES];\n\tuint8_t salt[FP_CONTEXT_SALT_BYTES];\n\tuint8_t tag[FP_CONTEXT_TAG_BYTES];\n};\n\nstruct ec_params_fp_frame {\n\t/*\n\t * The offset contains the template index or FP_FRAME_INDEX_RAW_IMAGE\n\t * in the high nibble, and the real offset within the frame in\n\t * FP_FRAME_OFFSET_MASK.\n\t */\n\tuint32_t offset;\n\tuint32_t size;\n} __ec_align4;\n\n/* Load a template into the MCU */\n#define EC_CMD_FP_TEMPLATE 0x0405\n\n/* Flag in the 'size' field indicating that the full template has been sent */\n#define FP_TEMPLATE_COMMIT 0x80000000\n\nstruct ec_params_fp_template {\n\tuint32_t offset;\n\tuint32_t size;\n\tuint8_t data[];\n} __ec_align4;\n\n/* Clear the current fingerprint user context and set a new one */\n#define EC_CMD_FP_CONTEXT 0x0406\n\nstruct ec_params_fp_context {\n\tuint32_t userid[FP_CONTEXT_USERID_WORDS];\n} __ec_align4;\n\n#define EC_CMD_FP_STATS 0x0407\n\n#define FPSTATS_CAPTURE_INV  BIT(0)\n#define FPSTATS_MATCHING_INV BIT(1)\n\nstruct ec_response_fp_stats {\n\tuint32_t capture_time_us;\n\tuint32_t matching_time_us;\n\tuint32_t overall_time_us;\n\tstruct {\n\t\tuint32_t lo;\n\t\tuint32_t hi;\n\t} overall_t0;\n\tuint8_t timestamps_invalid;\n\tint8_t template_matched;\n} __ec_align2;\n\n#define EC_CMD_FP_SEED 0x0408\nstruct ec_params_fp_seed {\n\t/*\n\t * Version of the structure format (N=3).\n\t */\n\tuint16_t struct_version;\n\t/* Reserved bytes, set to 0. */\n\tuint16_t reserved;\n\t/* Seed from the TPM. */\n\tuint8_t seed[FP_CONTEXT_TPM_BYTES];\n} __ec_align4;\n\n#define EC_CMD_FP_ENC_STATUS 0x0409\n\n/* FP TPM seed has been set or not */\n#define FP_ENC_STATUS_SEED_SET BIT(0)\n\nstruct ec_response_fp_encryption_status {\n\t/* Used bits in encryption engine status */\n\tuint32_t valid_flags;\n\t/* Encryption engine status */\n\tuint32_t status;\n} __ec_align4;\n\n/*****************************************************************************/\n/* Touchpad MCU commands: range 0x0500-0x05FF */\n\n/* Perform touchpad self test */\n#define EC_CMD_TP_SELF_TEST 0x0500\n\n/* Get number of frame types, and the size of each type */\n#define EC_CMD_TP_FRAME_INFO 0x0501\n\nstruct ec_response_tp_frame_info {\n\tuint32_t n_frames;\n\tuint32_t frame_sizes[];\n} __ec_align4;\n\n/* Create a snapshot of current frame readings */\n#define EC_CMD_TP_FRAME_SNAPSHOT 0x0502\n\n/* Read the frame */\n#define EC_CMD_TP_FRAME_GET 0x0503\n\nstruct ec_params_tp_frame_get {\n\tuint32_t frame_index;\n\tuint32_t offset;\n\tuint32_t size;\n} __ec_align4;\n\n/*****************************************************************************/\n/* EC-EC communication commands: range 0x0600-0x06FF */\n\n#define EC_COMM_TEXT_MAX 8\n\n/*\n * Get battery static information, i.e. information that never changes, or\n * very infrequently.\n */\n#define EC_CMD_BATTERY_GET_STATIC 0x0600\n\n/**\n * struct ec_params_battery_static_info - Battery static info parameters\n * @index: Battery index.\n */\nstruct ec_params_battery_static_info {\n\tuint8_t index;\n} __ec_align_size1;\n\n/**\n * struct ec_response_battery_static_info - Battery static info response\n * @design_capacity: Battery Design Capacity (mAh)\n * @design_voltage: Battery Design Voltage (mV)\n * @manufacturer: Battery Manufacturer String\n * @model: Battery Model Number String\n * @serial: Battery Serial Number String\n * @type: Battery Type String\n * @cycle_count: Battery Cycle Count\n */\nstruct ec_response_battery_static_info {\n\tuint16_t design_capacity;\n\tuint16_t design_voltage;\n\tchar manufacturer[EC_COMM_TEXT_MAX];\n\tchar model[EC_COMM_TEXT_MAX];\n\tchar serial[EC_COMM_TEXT_MAX];\n\tchar type[EC_COMM_TEXT_MAX];\n\t/* TODO(crbug.com/795991): Consider moving to dynamic structure. */\n\tuint32_t cycle_count;\n} __ec_align4;\n\n/*\n * Get battery dynamic information, i.e. information that is likely to change\n * every time it is read.\n */\n#define EC_CMD_BATTERY_GET_DYNAMIC 0x0601\n\n/**\n * struct ec_params_battery_dynamic_info - Battery dynamic info parameters\n * @index: Battery index.\n */\nstruct ec_params_battery_dynamic_info {\n\tuint8_t index;\n} __ec_align_size1;\n\n/**\n * struct ec_response_battery_dynamic_info - Battery dynamic info response\n * @actual_voltage: Battery voltage (mV)\n * @actual_current: Battery current (mA); negative=discharging\n * @remaining_capacity: Remaining capacity (mAh)\n * @full_capacity: Capacity (mAh, might change occasionally)\n * @flags: Flags, see EC_BATT_FLAG_*\n * @desired_voltage: Charging voltage desired by battery (mV)\n * @desired_current: Charging current desired by battery (mA)\n */\nstruct ec_response_battery_dynamic_info {\n\tint16_t actual_voltage;\n\tint16_t actual_current;\n\tint16_t remaining_capacity;\n\tint16_t full_capacity;\n\tint16_t flags;\n\tint16_t desired_voltage;\n\tint16_t desired_current;\n} __ec_align2;\n\n/*\n * Control charger chip. Used to control charger chip on the slave.\n */\n#define EC_CMD_CHARGER_CONTROL 0x0602\n\n/**\n * struct ec_params_charger_control - Charger control parameters\n * @max_current: Charger current (mA). Positive to allow base to draw up to\n *     max_current and (possibly) charge battery, negative to request current\n *     from base (OTG).\n * @otg_voltage: Voltage (mV) to use in OTG mode, ignored if max_current is\n *     >= 0.\n * @allow_charging: Allow base battery charging (only makes sense if\n *     max_current > 0).\n */\nstruct ec_params_charger_control {\n\tint16_t max_current;\n\tuint16_t otg_voltage;\n\tuint8_t allow_charging;\n} __ec_align_size1;\n\n/* Get ACK from the USB-C SS muxes */\n#define EC_CMD_USB_PD_MUX_ACK 0x0603\n\nstruct ec_params_usb_pd_mux_ack {\n\tuint8_t port; /* USB-C port number */\n} __ec_align1;\n\n/*****************************************************************************/\n/*\n * Reserve a range of host commands for board-specific, experimental, or\n * special purpose features. These can be (re)used without updating this file.\n *\n * CAUTION: Don't go nuts with this. Shipping products should document ALL\n * their EC commands for easier development, testing, debugging, and support.\n *\n * All commands MUST be #defined to be 4-digit UPPER CASE hex values\n * (e.g., 0x00AB, not 0xab) for CONFIG_HOSTCMD_SECTION_SORTED to work.\n *\n * In your experimental code, you may want to do something like this:\n *\n *   #define EC_CMD_MAGIC_FOO 0x0000\n *   #define EC_CMD_MAGIC_BAR 0x0001\n *   #define EC_CMD_MAGIC_HEY 0x0002\n *\n *   DECLARE_PRIVATE_HOST_COMMAND(EC_CMD_MAGIC_FOO, magic_foo_handler,\n *      EC_VER_MASK(0);\n *\n *   DECLARE_PRIVATE_HOST_COMMAND(EC_CMD_MAGIC_BAR, magic_bar_handler,\n *      EC_VER_MASK(0);\n *\n *   DECLARE_PRIVATE_HOST_COMMAND(EC_CMD_MAGIC_HEY, magic_hey_handler,\n *      EC_VER_MASK(0);\n */\n#define EC_CMD_BOARD_SPECIFIC_BASE 0x3E00\n#define EC_CMD_BOARD_SPECIFIC_LAST 0x3FFF\n\n/*\n * Given the private host command offset, calculate the true private host\n * command value.\n */\n#define EC_PRIVATE_HOST_COMMAND_VALUE(command) \\\n\t(EC_CMD_BOARD_SPECIFIC_BASE + (command))\n\n/*****************************************************************************/\n/*\n * Passthru commands\n *\n * Some platforms have sub-processors chained to each other.  For example.\n *\n *     AP <--> EC <--> PD MCU\n *\n * The top 2 bits of the command number are used to indicate which device the\n * command is intended for.  Device 0 is always the device receiving the\n * command; other device mapping is board-specific.\n *\n * When a device receives a command to be passed to a sub-processor, it passes\n * it on with the device number set back to 0.  This allows the sub-processor\n * to remain blissfully unaware of whether the command originated on the next\n * device up the chain, or was passed through from the AP.\n *\n * In the above example, if the AP wants to send command 0x0002 to the PD MCU,\n *     AP sends command 0x4002 to the EC\n *     EC sends command 0x0002 to the PD MCU\n *     EC forwards PD MCU response back to the AP\n */\n\n/* Offset and max command number for sub-device n */\n#define EC_CMD_PASSTHRU_OFFSET(n) (0x4000 * (n))\n#define EC_CMD_PASSTHRU_MAX(n) (EC_CMD_PASSTHRU_OFFSET(n) + 0x3fff)\n\n/*****************************************************************************/\n/*\n * Deprecated constants. These constants have been renamed for clarity. The\n * meaning and size has not changed. Programs that use the old names should\n * switch to the new names soon, as the old names may not be carried forward\n * forever.\n */\n#define EC_HOST_PARAM_SIZE      EC_PROTO2_MAX_PARAM_SIZE\n#define EC_LPC_ADDR_OLD_PARAM   EC_HOST_CMD_REGION1\n#define EC_OLD_PARAM_SIZE       EC_HOST_CMD_REGION_SIZE\n\n\n\n#endif  /* __CROS_EC_COMMANDS_H */\n"}}, "reports": [{"events": [{"location": {"col": 23, "file": 0, "line": 5579}, "message": "WARNING use flexible-array member instead (https://www.kernel.org/doc/html/latest/process/deprecated.html#zero-length-and-one-element-arrays)"}], "macros": [], "notes": [], "path": "/src/include/linux/platform_data/cros_ec_commands.h", "reportHash": "f4ef01ef87eb5516865ae94522b20aa7", "checkerName": "coccinelle", "reviewStatus": null, "severity": "UNSPECIFIED"}]};
      window.onload = function() {
        if (!browserCompatible) {
          setNonCompatibleBrowserMessage();
        } else {
          BugViewer.init(data.files, data.reports);
          BugViewer.create();
          BugViewer.initByUrl();
        }
      };
    </script>
  </head>
  <body>
  <div class="container">
    <div id="content">
      <div id="side-bar">
        <div class="header">
          <a href="index.html" class="button">&#8249; Return to List</a>
        </div>
        <div id="report-nav">
          <div class="header">Reports</div>
        </div>
      </div>
      <div id="editor-wrapper">
        <div class="header">
          <div id="file">
            <span class="label">File:</span>
            <span id="file-path"></span>
          </div>
          <div id="checker">
            <span class="label">Checker name:</span>
            <span id="checker-name"></span>
          </div>
          <div id="review-status-wrapper">
            <span class="label">Review status:</span>
            <span id="review-status"></span>
          </div>
        </div>
        <div id="editor"></div>
      </div>
    </div>
  </div>
  </body>
</html>
