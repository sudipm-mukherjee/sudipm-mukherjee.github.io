<!DOCTYPE html>
<html>
  <head>
    <title>Plist HTML Viewer</title>

    <meta charset="UTF-8">

    <style type="text/css">
      .CodeMirror{font-family:monospace;height:300px;color:#000;direction:ltr}.CodeMirror-lines{padding:4px 0}.CodeMirror pre{padding:0 4px}.CodeMirror-gutter-filler,.CodeMirror-scrollbar-filler{background-color:#fff}.CodeMirror-gutters{border-right:1px solid #ddd;background-color:#f7f7f7;white-space:nowrap}.CodeMirror-linenumber{padding:0 3px 0 5px;min-width:20px;text-align:right;color:#999;white-space:nowrap}.CodeMirror-guttermarker{color:#000}.CodeMirror-guttermarker-subtle{color:#999}.CodeMirror-cursor{border-left:1px solid #000;border-right:none;width:0}.CodeMirror div.CodeMirror-secondarycursor{border-left:1px solid silver}.cm-fat-cursor .CodeMirror-cursor{width:auto;border:0!important;background:#7e7}.cm-fat-cursor div.CodeMirror-cursors{z-index:1}.cm-animate-fat-cursor{width:auto;border:0;-webkit-animation:blink 1.06s steps(1) infinite;-moz-animation:blink 1.06s steps(1) infinite;animation:blink 1.06s steps(1) infinite;background-color:#7e7}@-moz-keyframes blink{50%{background-color:transparent}}@-webkit-keyframes blink{50%{background-color:transparent}}@keyframes blink{50%{background-color:transparent}}.cm-tab{display:inline-block;text-decoration:inherit}.CodeMirror-rulers{position:absolute;left:0;right:0;top:-50px;bottom:-20px;overflow:hidden}.CodeMirror-ruler{border-left:1px solid #ccc;top:0;bottom:0;position:absolute}.cm-s-default .cm-header{color:#00f}.cm-s-default .cm-quote{color:#090}.cm-negative{color:#d44}.cm-positive{color:#292}.cm-header,.cm-strong{font-weight:700}.cm-em{font-style:italic}.cm-link{text-decoration:underline}.cm-strikethrough{text-decoration:line-through}.cm-s-default .cm-keyword{color:#708}.cm-s-default .cm-atom{color:#219}.cm-s-default .cm-number{color:#164}.cm-s-default .cm-def{color:#00f}.cm-s-default .cm-variable-2{color:#05a}.cm-s-default .cm-type,.cm-s-default .cm-variable-3{color:#085}.cm-s-default .cm-comment{color:#a50}.cm-s-default .cm-string{color:#a11}.cm-s-default .cm-string-2{color:#f50}.cm-s-default .cm-meta{color:#555}.cm-s-default .cm-qualifier{color:#555}.cm-s-default .cm-builtin{color:#30a}.cm-s-default .cm-bracket{color:#997}.cm-s-default .cm-tag{color:#170}.cm-s-default .cm-attribute{color:#00c}.cm-s-default .cm-hr{color:#999}.cm-s-default .cm-link{color:#00c}.cm-s-default .cm-error{color:red}.cm-invalidchar{color:red}.CodeMirror-composing{border-bottom:2px solid}div.CodeMirror span.CodeMirror-matchingbracket{color:#0f0}div.CodeMirror span.CodeMirror-nonmatchingbracket{color:#f22}.CodeMirror-matchingtag{background:rgba(255,150,0,.3)}.CodeMirror-activeline-background{background:#e8f2ff}.CodeMirror{position:relative;overflow:hidden;background:#fff}.CodeMirror-scroll{overflow:scroll!important;margin-bottom:-30px;margin-right:-30px;padding-bottom:30px;height:100%;outline:0;position:relative}.CodeMirror-sizer{position:relative;border-right:30px solid transparent}.CodeMirror-gutter-filler,.CodeMirror-hscrollbar,.CodeMirror-scrollbar-filler,.CodeMirror-vscrollbar{position:absolute;z-index:6;display:none}.CodeMirror-vscrollbar{right:0;top:0;overflow-x:hidden;overflow-y:scroll}.CodeMirror-hscrollbar{bottom:0;left:0;overflow-y:hidden;overflow-x:scroll}.CodeMirror-scrollbar-filler{right:0;bottom:0}.CodeMirror-gutter-filler{left:0;bottom:0}.CodeMirror-gutters{position:absolute;left:0;top:0;min-height:100%;z-index:3}.CodeMirror-gutter{white-space:normal;height:100%;display:inline-block;vertical-align:top;margin-bottom:-30px}.CodeMirror-gutter-wrapper{position:absolute;z-index:4;background:0 0!important;border:none!important}.CodeMirror-gutter-background{position:absolute;top:0;bottom:0;z-index:4}.CodeMirror-gutter-elt{position:absolute;cursor:default;z-index:4}.CodeMirror-gutter-wrapper ::selection{background-color:transparent}.CodeMirror-gutter-wrapper ::-moz-selection{background-color:transparent}.CodeMirror-lines{cursor:text;min-height:1px}.CodeMirror pre{-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;border-width:0;background:0 0;font-family:inherit;font-size:inherit;margin:0;white-space:pre;word-wrap:normal;line-height:inherit;color:inherit;z-index:2;position:relative;overflow:visible;-webkit-tap-highlight-color:transparent;-webkit-font-variant-ligatures:contextual;font-variant-ligatures:contextual}.CodeMirror-wrap pre{word-wrap:break-word;white-space:pre-wrap;word-break:normal}.CodeMirror-linebackground{position:absolute;left:0;right:0;top:0;bottom:0;z-index:0}.CodeMirror-linewidget{position:relative;z-index:2;overflow:auto}.CodeMirror-rtl pre{direction:rtl}.CodeMirror-code{outline:0}.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber,.CodeMirror-scroll,.CodeMirror-sizer{-moz-box-sizing:content-box;box-sizing:content-box}.CodeMirror-measure{position:absolute;width:100%;height:0;overflow:hidden;visibility:hidden}.CodeMirror-cursor{position:absolute;pointer-events:none}.CodeMirror-measure pre{position:static}div.CodeMirror-cursors{visibility:hidden;position:relative;z-index:3}div.CodeMirror-dragcursors{visibility:visible}.CodeMirror-focused div.CodeMirror-cursors{visibility:visible}.CodeMirror-selected{background:#d9d9d9}.CodeMirror-focused .CodeMirror-selected{background:#d7d4f0}.CodeMirror-crosshair{cursor:crosshair}.CodeMirror-line::selection,.CodeMirror-line>span::selection,.CodeMirror-line>span>span::selection{background:#d7d4f0}.CodeMirror-line::-moz-selection,.CodeMirror-line>span::-moz-selection,.CodeMirror-line>span>span::-moz-selection{background:#d7d4f0}.cm-searching{background-color:#ffa;background-color:rgba(255,255,0,.4)}.cm-force-border{padding-right:.1px}@media print{.CodeMirror div.CodeMirror-cursors{visibility:hidden}}.cm-tab-wrap-hack:after{content:''}span.CodeMirror-selectedtext{background:0 0}
/*# sourceMappingURL=codemirror.min.css.map */

      .severity-low {
  background-color: #669603;
}

.severity-low:after {
  content : 'L';
}

.severity-unspecified {
  background-color: #666666;
}

.severity-unspecified:after {
  content : 'U';
}

.severity-style {
  background-color: #9932cc;
}

.severity-style:after {
  content : 'S';
}

.severity-medium {
  background-color: #a9d323;
  color: black;
}

.severity-medium:after {
  content : 'M';
}

.severity-high {
  background-color: #ffa800;
}

.severity-high:after {
  content : 'H';
}

.severity-critical {
  background-color: #e92625;
}

.severity-critical:after {
  content : 'C';
}

i[class*="severity-"] {
  line-height: normal;
  text-transform: capitalize;
  font-size: 0.8em;
  font-weight: bold;
  color: white;
  display: inline-block;
  width: 16px;
  height: 16px;
  text-align: center;
  font-family: sans-serif;
}

      html, body {
  width: 100%;
  height: 100%;
  padding: 0px;
  margin: 0px;
}

div.container {
  padding: 10px;
}

#content {
  height: 100%;
  display: block;
  overflow: hidden;
}

#content > div {
  margin: 10px;
  overflow: hidden;
  border: 1px solid #ddd;
  border-radius: 3px;
  overflow: hidden;
  height: 97%;
}

.button {
  background-color: #f1f1f1;
  text-decoration: none;
  display: inline-block;
  padding: 8px 16px;
  color: black;
  cursor: pointer;
}

.button:hover {
  background-color: #ddd;
  color: black;
}

.review-status {
  color: white;
  text-align: center;
}

.review-status-confirmed {
  background-color: #e92625;
}

.review-status-false-positive {
  background-color: grey;
}

.review-status-intentional {
  background-color: #669603;
}

      div.container {
  width: 100%;
  height: 100%;
  padding: 0px;
}

#editor-wrapper {
  margin: 10px;
}

#side-bar {
  float: left;
  width: 260px;
  margin: 0px;
}

#report-nav ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  overflow-y: auto;
  height: 100%;
}

#report-nav ul > li {
  padding: .4em;
  background-color: #fff;
  border-bottom: 1px solid rgba(0,0,0,.125);
  text-align: left;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

#report-nav ul > li.active {
  background-color: #427ea9;
  color: white;
}

#report-nav ul > li:hover {
  background-color: #427ea9;
  color: white;
  cursor: pointer;
}

#report-nav ul a {
  text-decoration: none;
}

#report-nav i[class*="severity-"] {
  margin-right: 5px;
}

.header {
  border-bottom: 1px solid lightgrey;
  font-family: monospace;
  padding: 10px;
  background-color: #fafbfc;
  border-bottom: 1px solid #e1e4e8;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}

#report-nav .header {
  font-weight: bold;
}

#editor-wrapper .header > div {
  padding-top: 2px;
}

#file-path,
#checker-name {
  color: #195ea2;
}

#review-status {
  padding: 0px 5px;
}

#file-path {
  font-family: monospace;
}

.check-msg {
  display: inline-block;
  padding: 3px 6px;
  margin: 1px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.check-msg.info {
  color: #00546f;
  background-color: #bfdfe9;
  border: 1px solid #87a8b3;
}

.check-msg.error {
  background-color: #f2dede;
  color: #a94442;
  border: 1px solid #ebcccc;
}

.check-msg.macro {
  background-color: #d7dac2;
  color: #4f5c6d;
  border: 1px solid #d7dac2;
}

.check-msg.note {
  background-color: #d7d7d7;
  color: #4f5c6d;
  border: 1px solid #bfbfbf;
}

.check-msg.current {
  border: 2px dashed #3692ff;
}

.check-msg .tag {
  padding: 1px 5px;
  text-align: center;
  border-radius: 2px;
  margin-right: 5px;
  text-decoration: inherit;
}

.check-msg .tag.macro {
  background-color: #83876a;
  color: white;
  text-transform: capitalize;
}

.check-msg .tag.note {
  background-color: #9299a1;
  color: white;
  text-transform: capitalize;
}

.checker-enum {
  color: white;
  padding: 1px 5px;
  text-align: center;
  border-radius: 25px;
  margin-right: 5px;
  text-decoration: inherit;
}

.checker-enum.info {
  background-color: #427ea9;
}

.checker-enum.error {
  background-color: #a94442;
}

.arrow {
  border: solid black;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 3px;
  cursor: pointer;
  margin: 0px 5px;
}

.arrow:hover {
  border: solid #437ea8;
  border-width: 0 3px 3px 0;
}

.left-arrow {
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
}

.right-arrow {
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
}

    </style>

    <script type="text/javascript">
      function setNonCompatibleBrowserMessage() {
  document.body.innerHTML =
    '<h2 style="margin-left: 20px;">Your browser is not compatible with CodeChecker Viewer!</h2> \
     <p style="margin-left: 20px;">The version required for the following browsers are:</p> \
     <ul style="margin-left: 20px;"> \
     <li>Internet Explorer: version 9 or newer</li> \
     <li>Firefox: version 22.0 or newer</li> \
     </ul>';
}

// http://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser
var browserVersion = (function(){
  var ua = navigator.userAgent, tem,
    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];

  if (/trident/i.test(M[1])) {
    tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
    return 'IE ' + (tem[1] || '');
  }

  if (M[1] === 'Chrome') {
    tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
    if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
  }

  M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
  if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
    return M.join(' ');
})();

var pos = browserVersion.indexOf(' ');
var browser = browserVersion.substr(0, pos);
var version = parseInt(browserVersion.substr(pos + 1));

var browserCompatible
  = browser === 'Firefox'
  ? version >= 22
  : browser === 'IE'
  ? version >= 9
  : true;


      /* MIT License

Copyright (C) 2017 by Marijn Haverbeke <marijnh@gmail.com> and others

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 */
      !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CodeMirror=t()}(this,function(){"use strict";function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function t(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function r(e,r){return t(e).appendChild(r)}function n(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),"string"==typeof t)i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function i(e,t,r,i){var o=n(e,t,r,i);return o.setAttribute("role","presentation"),o}function o(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function l(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function s(t,r){var n=t.className;e(r).test(n)||(t.className+=(n?" ":"")+r)}function a(t,r){for(var n=t.split(" "),i=0;i<n.length;i++)n[i]&&!e(n[i]).test(r)&&(r+=" "+n[i]);return r}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function c(e,t,r){t||(t={});for(var n in e)!e.hasOwnProperty(n)||!1===r&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function f(e,t,r,n,i){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,l=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t)return l+(t-o);l+=s-o,l+=r-l%r,o=s+1}}function h(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}function d(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var l=o-n;if(o==e.length||i+l>=t)return n+Math.min(l,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}function p(e){for(;Kl.length<=e;)Kl.push(g(Kl)+" ");return Kl[e]}function g(e){return e[e.length-1]}function v(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function m(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}function y(){}function b(e,t){var r;return Object.create?r=Object.create(e):(y.prototype=e,r=new y),t&&c(t,r),r}function w(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||jl.test(e))}function x(e,t){return t?!!(t.source.indexOf("\\w")>-1&&w(e))||t.test(e):w(e)}function C(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function S(e){return e.charCodeAt(0)>=768&&Xl.test(e)}function L(e,t,r){for(;(r<0?t>0:t<e.length)&&S(e.charAt(t));)t+=r;return t}function k(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}function T(e,t,r){var o=this;this.input=r,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=i("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=i("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var l=i("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[l],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Rl+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),gl&&vl<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),ml||fl&&Tl||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,r.init(o)}function M(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function N(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;i==r.line&&(o=o.slice(0,r.ch)),i==t.line&&(o=o.slice(t.ch)),n.push(o),++i}),n}function O(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function A(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function W(e){if(null==e.parent)return null;for(var t=e.parent,r=h(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function D(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var l=0;l<e.lines.length;++l){var s=e.lines[l].height;if(t<s)break;t-=s}return r+l}function H(e,t){return t>=e.first&&t<e.first+e.size}function F(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function E(e,t,r){if(void 0===r&&(r=null),!(this instanceof E))return new E(e,t,r);this.line=e,this.ch=t,this.sticky=r}function P(e,t){return e.line-t.line||e.ch-t.ch}function I(e,t){return e.sticky==t.sticky&&0==P(e,t)}function z(e){return E(e.line,e.ch)}function R(e,t){return P(e,t)<0?t:e}function B(e,t){return P(e,t)<0?e:t}function G(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function U(e,t){if(t.line<e.first)return E(e.first,0);var r=e.first+e.size-1;return t.line>r?E(r,M(e,r).text.length):V(t,M(e,t.line).text.length)}function V(e,t){var r=e.ch;return null==r||r>t?E(e.line,t):r<0?E(e.line,0):e}function K(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=U(e,t[n]);return r}function j(){Yl=!0}function X(){_l=!0}function Y(e,t,r){this.marker=e,this.from=t,this.to=r}function _(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function $(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function q(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Z(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==l.type&&(!r||!o.marker.insertLeft)){var s=null==o.to||(l.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new Y(l,o.from,s?null:o.to))}}return n}function Q(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.to||(l.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==l.type&&(!r||o.marker.insertLeft)){var s=null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new Y(l,s?null:o.from-t,null==o.to?null:o.to-t))}}return n}function J(e,t){if(t.full)return null;var r=H(e,t.from.line)&&M(e,t.from.line).markedSpans,n=H(e,t.to.line)&&M(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,l=0==P(t.from,t.to),s=Z(r,i,l),a=Q(n,o,l),u=1==t.text.length,c=g(t.text).length+(u?i:0);if(s)for(var f=0;f<s.length;++f){var h=s[f];if(null==h.to){var d=_(a,h.marker);d?u&&(h.to=null==d.to?null:d.to+c):h.to=i}}if(a)for(var p=0;p<a.length;++p){var v=a[p];null!=v.to&&(v.to+=c),null==v.from?_(s,v.marker)||(v.from=c,u&&(s||(s=[])).push(v)):(v.from+=c,u&&(s||(s=[])).push(v))}s&&(s=ee(s)),a&&a!=s&&(a=ee(a));var m=[s];if(!u){var y,b=t.text.length-2;if(b>0&&s)for(var w=0;w<s.length;++w)null==s[w].to&&(y||(y=[])).push(new Y(s[w].marker,null,null));for(var x=0;x<b;++x)m.push(y);m.push(a)}return m}function ee(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&!1!==r.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function te(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=h(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var l=n[o],s=l.find(0),a=0;a<i.length;++a){var u=i[a];if(!(P(u.to,s.from)<0||P(u.from,s.to)>0)){var c=[a,1],f=P(u.from,s.from),d=P(u.to,s.to);(f<0||!l.inclusiveLeft&&!f)&&c.push({from:u.from,to:s.from}),(d>0||!l.inclusiveRight&&!d)&&c.push({from:s.to,to:u.to}),i.splice.apply(i,c),a+=c.length-3}}return i}function re(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function ne(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function ie(e){return e.inclusiveLeft?-1:0}function oe(e){return e.inclusiveRight?1:0}function le(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),i=t.find(),o=P(n.from,i.from)||ie(e)-ie(t);if(o)return-o;var l=P(n.to,i.to)||oe(e)-oe(t);return l||t.id-e.id}function se(e,t){var r,n=_l&&e.markedSpans;if(n)for(var i=void 0,o=0;o<n.length;++o)(i=n[o]).marker.collapsed&&null==(t?i.from:i.to)&&(!r||le(r,i.marker)<0)&&(r=i.marker);return r}function ae(e){return se(e,!0)}function ue(e){return se(e,!1)}function ce(e,t,r,n,i){var o=M(e,t),l=_l&&o.markedSpans;if(l)for(var s=0;s<l.length;++s){var a=l[s];if(a.marker.collapsed){var u=a.marker.find(0),c=P(u.from,r)||ie(a.marker)-ie(i),f=P(u.to,n)||oe(a.marker)-oe(i);if(!(c>=0&&f<=0||c<=0&&f>=0)&&(c<=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.to,r)>=0:P(u.to,r)>0)||c>=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.from,n)<=0:P(u.from,n)<0)))return!0}}}function fe(e){for(var t;t=ae(e);)e=t.find(-1,!0).line;return e}function he(e){for(var t;t=ue(e);)e=t.find(1,!0).line;return e}function de(e){for(var t,r;t=ue(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function pe(e,t){var r=M(e,t),n=fe(r);return r==n?t:W(n)}function ge(e,t){if(t>e.lastLine())return t;var r,n=M(e,t);if(!ve(e,n))return t;for(;r=ue(n);)n=r.find(1,!0).line;return W(n)+1}function ve(e,t){var r=_l&&t.markedSpans;if(r)for(var n=void 0,i=0;i<r.length;++i)if((n=r[i]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&me(e,t,n))return!0}}function me(e,t,r){if(null==r.to){var n=r.marker.find(1,!0);return me(e,n.line,_(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if((i=t.markedSpans[o]).marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(null==i.to||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&me(e,t,i))return!0}function ye(e){for(var t=0,r=(e=fe(e)).parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var l=0;l<o.children.length;++l){var s=o.children[l];if(s==r)break;t+=s.height}return t}function be(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=ae(n);){var i=t.find(0,!0);n=i.from.line,r+=i.from.ch-i.to.ch}for(n=e;t=ue(n);){var o=t.find(0,!0);r-=n.text.length-o.from.ch,r+=(n=o.to.line).text.length-o.to.ch}return r}function we(e){var t=e.display,r=e.doc;t.maxLine=M(r,r.first),t.maxLineLength=be(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=be(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function xe(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var l=e[o];(l.from<r&&l.to>t||t==r&&l.to==t)&&(n(Math.max(l.from,t),Math.min(l.to,r),1==l.level?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}function Ce(e,t,r){var n;$l=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&"before"==r?n=i:$l=i),o.from==t&&(o.from!=o.to&&"before"!=r?n=i:$l=i)}return null!=n?n:$l}function Se(e,t){var r=e.order;return null==r&&(r=e.order=ql(e.text,t)),r}function Le(e,t){return e._handlers&&e._handlers[t]||Zl}function ke(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=h(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function Te(e,t){var r=Le(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function Me(e,t,r){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Te(e,r||t.type,e,t),He(t)||t.codemirrorIgnore}function Ne(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==h(r,t[n])&&r.push(t[n])}function Oe(e,t){return Le(e,t).length>0}function Ae(e){e.prototype.on=function(e,t){Ql(this,e,t)},e.prototype.off=function(e,t){ke(this,e,t)}}function We(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function De(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function He(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){We(e),De(e)}function Ee(e){return e.target||e.srcElement}function Pe(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Ml&&e.ctrlKey&&1==t&&(t=3),t}function Ie(e){if(null==Il){var t=n("span","​");r(e,n("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Il=t.offsetWidth<=1&&t.offsetHeight>2&&!(gl&&vl<8))}var i=Il?n("span","​"):n("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function ze(e){if(null!=zl)return zl;var n=r(e,document.createTextNode("AخA")),i=Wl(n,0,1).getBoundingClientRect(),o=Wl(n,1,2).getBoundingClientRect();return t(e),!(!i||i.left==i.right)&&(zl=o.right-i.right<3)}function Re(e){if(null!=ns)return ns;var t=r(e,n("span","x")),i=t.getBoundingClientRect(),o=Wl(t,0,1).getBoundingClientRect();return ns=Math.abs(i.left-o.left)>1}function Be(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),is[e]=t}function Ge(e){if("string"==typeof e&&os.hasOwnProperty(e))e=os[e];else if(e&&"string"==typeof e.name&&os.hasOwnProperty(e.name)){var t=os[e.name];"string"==typeof t&&(t={name:t}),(e=b(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ue(e,t){t=Ge(t);var r=is[t.name];if(!r)return Ue(e,"text/plain");var n=r(e,t);if(ls.hasOwnProperty(t.name)){var i=ls[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var l in t.modeProps)n[l]=t.modeProps[l];return n}function Ve(e,t){c(t,ls.hasOwnProperty(e)?ls[e]:ls[e]={})}function Ke(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function je(e,t){for(var r;e.innerMode&&(r=e.innerMode(t))&&r.mode!=e;)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Xe(e,t,r){return!e.startState||e.startState(t,r)}function Ye(e,t,r,n){var i=[e.state.modeGen],o={};tt(e,t.text,e.doc.mode,r,function(e,t){return i.push(e,t)},o,n);for(var l=r.state,s=0;s<e.state.overlays.length;++s)!function(n){var l=e.state.overlays[n],s=1,a=0;r.state=!0,tt(e,t.text,l.mode,r,function(e,t){for(var r=s;a<e;){var n=i[s];n>e&&i.splice(s,1,e,i[s+1],n),s+=2,a=Math.min(e,n)}if(t)if(l.opaque)i.splice(r,s-r,e,"overlay "+t),s=r+2;else for(;r<s;r+=2){var o=i[r+1];i[r+1]=(o?o+" ":"")+"overlay "+t}},o)}(s);return r.state=l,{styles:i,classes:o.bgClass||o.textClass?o:null}}function _e(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=$e(e,W(t)),i=t.text.length>e.options.maxHighlightLength&&Ke(e.doc.mode,n.state),o=Ye(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function $e(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new us(n,!0,t);var o=rt(e,t,r),l=o>n.first&&M(n,o-1).stateAfter,s=l?us.fromSaved(n,l,o):new us(n,Xe(n.mode),o);return n.iter(o,t,function(r){qe(e,r.text,s);var n=s.line;r.stateAfter=n==t-1||n%5==0||n>=i.viewFrom&&n<i.viewTo?s.save():null,s.nextLine()}),r&&(n.modeFrontier=s.line),s}function qe(e,t,r,n){var i=e.doc.mode,o=new ss(t,e.options.tabSize,r);for(o.start=o.pos=n||0,""==t&&Ze(i,r.state);!o.eol();)Qe(i,o,r.state),o.start=o.pos}function Ze(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=je(e,t);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function Qe(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=je(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function Je(e,t,r,n){var i,o,l=e.doc,s=l.mode,a=M(l,(t=U(l,t)).line),u=$e(e,t.line,r),c=new ss(a.text,e.options.tabSize,u);for(n&&(o=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,i=Qe(s,c,u.state),n&&o.push(new cs(c,i,Ke(l.mode,u.state)));return n?o:new cs(c,i,u.state)}function et(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}return e}function tt(e,t,r,n,i,o,l){var s=r.flattenSpans;null==s&&(s=e.options.flattenSpans);var a,u=0,c=null,f=new ss(t,e.options.tabSize,n),h=e.options.addModeClass&&[null];for(""==t&&et(Ze(r,n.state),o);!f.eol();){if(f.pos>e.options.maxHighlightLength?(s=!1,l&&qe(e,t,n,f.pos),f.pos=t.length,a=null):a=et(Qe(r,f,n.state,h),o),h){var d=h[0].name;d&&(a="m-"+(a?d+" "+a:d))}if(!s||c!=a){for(;u<f.start;)i(u=Math.min(f.start,u+5e3),c);c=a}f.start=f.pos}for(;u<f.pos;){var p=Math.min(f.pos,u+5e3);i(p,c),u=p}}function rt(e,t,r){for(var n,i,o=e.doc,l=r?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>l;--s){if(s<=o.first)return o.first;var a=M(o,s-1),u=a.stateAfter;if(u&&(!r||s+(u instanceof as?u.lookAhead:0)<=o.modeFrontier))return s;var c=f(a.text,null,e.options.tabSize);(null==i||n>c)&&(i=s-1,n=c)}return i}function nt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=M(e,n).stateAfter;if(i&&(!(i instanceof as)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}function it(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),re(e),ne(e,r);var i=n?n(e):1;i!=e.height&&A(e,i)}function ot(e){e.parent=null,re(e)}function lt(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?ps:ds;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function st(e,t){var r=i("span",null,null,ml?"padding-right: .1px":null),n={pre:i("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(gl||ml)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var l=o?t.rest[o-1]:t.line,s=void 0;n.pos=0,n.addToken=ut,ze(e.display.measure)&&(s=Se(l,e.doc.direction))&&(n.addToken=ft(n.addToken,s)),n.map=[],dt(l,n,_e(e,l,t!=e.display.externalMeasured&&W(l))),l.styleClasses&&(l.styleClasses.bgClass&&(n.bgClass=a(l.styleClasses.bgClass,n.bgClass||"")),l.styleClasses.textClass&&(n.textClass=a(l.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Ie(e.display.measure))),0==o?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(ml){var u=n.content.lastChild;(/\bcm-tab\b/.test(u.className)||u.querySelector&&u.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Te(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=a(n.pre.className,n.textClass||"")),n}function at(e){var t=n("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function ut(e,t,r,i,o,l,s){if(t){var a,u=e.splitSpaces?ct(t,e.trailingSpace):t,c=e.cm.state.specialChars,f=!1;if(c.test(t)){a=document.createDocumentFragment();for(var h=0;;){c.lastIndex=h;var d=c.exec(t),g=d?d.index-h:t.length-h;if(g){var v=document.createTextNode(u.slice(h,h+g));gl&&vl<9?a.appendChild(n("span",[v])):a.appendChild(v),e.map.push(e.pos,e.pos+g,v),e.col+=g,e.pos+=g}if(!d)break;h+=g+1;var m=void 0;if("\t"==d[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(m=a.appendChild(n("span",p(b),"cm-tab"))).setAttribute("role","presentation"),m.setAttribute("cm-text","\t"),e.col+=b}else"\r"==d[0]||"\n"==d[0]?((m=a.appendChild(n("span","\r"==d[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",d[0]),e.col+=1):((m=e.cm.options.specialCharPlaceholder(d[0])).setAttribute("cm-text",d[0]),gl&&vl<9?a.appendChild(n("span",[m])):a.appendChild(m),e.col+=1);e.map.push(e.pos,e.pos+1,m),e.pos++}}else e.col+=t.length,a=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,a),gl&&vl<9&&(f=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),r||i||o||f||s){var w=r||"";i&&(w+=i),o&&(w+=o);var x=n("span",[a],w,s);return l&&(x.title=l),e.content.appendChild(x)}e.content.appendChild(a)}}function ct(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);" "!=o||!r||i!=e.length-1&&32!=e.charCodeAt(i+1)||(o=" "),n+=o,r=" "==o}return n}function ft(e,t){return function(r,n,i,o,l,s,a){i=i?i+" cm-force-border":"cm-force-border";for(var u=r.pos,c=u+n.length;;){for(var f=void 0,h=0;h<t.length&&!((f=t[h]).to>u&&f.from<=u);h++);if(f.to>=c)return e(r,n,i,o,l,s,a);e(r,n.slice(0,f.to-u),i,o,null,s,a),o=null,n=n.slice(f.to-u),u=f.to}}}function ht(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function dt(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(n)for(var l,s,a,u,c,f,h,d=i.length,p=0,g=1,v="",m=0;;){if(m==p){a=u=c=f=s="",h=null,m=1/0;for(var y=[],b=void 0,w=0;w<n.length;++w){var x=n[w],C=x.marker;"bookmark"==C.type&&x.from==p&&C.widgetNode?y.push(C):x.from<=p&&(null==x.to||x.to>p||C.collapsed&&x.to==p&&x.from==p)?(null!=x.to&&x.to!=p&&m>x.to&&(m=x.to,u=""),C.className&&(a+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&x.from==p&&(c+=" "+C.startStyle),C.endStyle&&x.to==m&&(b||(b=[])).push(C.endStyle,x.to),C.title&&!f&&(f=C.title),C.collapsed&&(!h||le(h.marker,C)<0)&&(h=x)):x.from>p&&m>x.from&&(m=x.from)}if(b)for(var S=0;S<b.length;S+=2)b[S+1]==m&&(u+=" "+b[S]);if(!h||h.from==p)for(var L=0;L<y.length;++L)ht(t,0,y[L]);if(h&&(h.from||0)==p){if(ht(t,(null==h.to?d+1:h.to)-p,h.marker,null==h.from),null==h.to)return;h.to==p&&(h=!1)}}if(p>=d)break;for(var k=Math.min(d,m);;){if(v){var T=p+v.length;if(!h){var M=T>k?v.slice(0,k-p):v;t.addToken(t,M,l?l+a:a,c,p+M.length==m?u:"",f,s)}if(T>=k){v=v.slice(k-p),p=k;break}p=T,c=""}v=i.slice(o,o=r[g++]),l=lt(r[g++],t.cm.options)}}else for(var N=1;N<r.length;N+=2)t.addToken(t,i.slice(o,o=r[N]),lt(r[N+1],t.cm.options))}function pt(e,t,r){this.line=t,this.rest=de(t),this.size=this.rest?W(g(this.rest))-r+1:1,this.node=this.text=null,this.hidden=ve(e,t)}function gt(e,t,r){for(var n,i=[],o=t;o<r;o=n){var l=new pt(e.doc,M(e.doc,o),o);n=o+l.size,i.push(l)}return i}function vt(e){gs?gs.ops.push(e):e.ownsGroup=gs={ops:[e],delayedCallbacks:[]}}function mt(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function yt(e,t){var r=e.ownsGroup;if(r)try{mt(r)}finally{gs=null,t(r)}}function bt(e,t){var r=Le(e,t);if(r.length){var n,i=Array.prototype.slice.call(arguments,2);gs?n=gs.delayedCallbacks:vs?n=vs:(n=vs=[],setTimeout(wt,0));for(var o=0;o<r.length;++o)!function(e){n.push(function(){return r[e].apply(null,i)})}(o)}}function wt(){var e=vs;vs=null;for(var t=0;t<e.length;++t)e[t]()}function xt(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];"text"==o?kt(e,t):"gutter"==o?Mt(e,t,r,n):"class"==o?Tt(e,t):"widget"==o&&Nt(e,t,n)}t.changes=null}function Ct(e){return e.node==e.text&&(e.node=n("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),gl&&vl<8&&(e.node.style.zIndex=2)),e.node}function St(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var i=Ct(t);t.background=i.insertBefore(n("div",null,r),i.firstChild),e.display.input.setUneditable(t.background)}}function Lt(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):st(e,t)}function kt(e,t){var r=t.text.className,n=Lt(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,Tt(e,t)):r&&(t.text.className=r)}function Tt(e,t){St(e,t),t.line.wrapClass?Ct(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Mt(e,t,r,i){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var o=Ct(t);t.gutterBackground=n("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text)}var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var s=Ct(t),a=t.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||l&&l["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(n("div",F(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),l)for(var u=0;u<e.options.gutters.length;++u){var c=e.options.gutters[u],f=l.hasOwnProperty(c)&&l[c];f&&a.appendChild(n("div",[f],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function Nt(e,t,r){t.alignable&&(t.alignable=null);for(var n=t.node.firstChild,i=void 0;n;n=i)i=n.nextSibling,"CodeMirror-linewidget"==n.className&&t.node.removeChild(n);At(e,t,r)}function Ot(e,t,r,n){var i=Lt(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),Tt(e,t),Mt(e,t,r,n),At(e,t,n),t.node}function At(e,t,r){if(Wt(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)Wt(e,t.rest[n],t,r,!1)}function Wt(e,t,r,i,o){if(t.widgets)for(var l=Ct(r),s=0,a=t.widgets;s<a.length;++s){var u=a[s],c=n("div",[u.node],"CodeMirror-linewidget");u.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Dt(u,c,r,i),e.display.input.setUneditable(c),o&&u.above?l.insertBefore(c,r.gutter||r.text):l.appendChild(c),bt(u,"redraw")}}function Dt(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Ht(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!o(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),r(t.display.measure,n("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Ft(e,t){for(var r=Ee(t);r!=e.wrapper;r=r.parentNode)if(!r||1==r.nodeType&&"true"==r.getAttribute("cm-ignore-events")||r.parentNode==e.sizer&&r!=e.mover)return!0}function Et(e){return e.lineSpace.offsetTop}function Pt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function It(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=r(e.measure,n("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,o={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(e.cachedPaddingH=o),o}function zt(e){return Rl-e.display.nativeBarWidth}function Rt(e){return e.display.scroller.clientWidth-zt(e)-e.display.barWidth}function Bt(e){return e.display.scroller.clientHeight-zt(e)-e.display.barHeight}function Gt(e,t,r){var n=e.options.lineWrapping,i=n&&Rt(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var l=t.text.firstChild.getClientRects(),s=0;s<l.length-1;s++){var a=l[s],u=l[s+1];Math.abs(a.bottom-u.bottom)>2&&o.push((a.bottom+u.top)/2-r.top)}}o.push(r.bottom-r.top)}}function Ut(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(W(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}function Vt(e,t){var n=W(t=fe(t)),i=e.display.externalMeasured=new pt(e.doc,t,n);i.lineN=n;var o=i.built=st(e,i);return i.text=o.pre,r(e.display.lineMeasure,o.pre),i}function Kt(e,t,r,n){return Yt(e,Xt(e,t),r,n)}function jt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Lr(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function Xt(e,t){var r=W(t),n=jt(e,r);n&&!n.text?n=null:n&&n.changes&&(xt(e,n,r,br(e)),e.curOp.forceUpdate=!0),n||(n=Vt(e,t));var i=Ut(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function Yt(e,t,r,n,i){t.before&&(r=-1);var o,l=r+(n||"");return t.cache.hasOwnProperty(l)?o=t.cache[l]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Gt(e,t.view,t.rect),t.hasHeights=!0),(o=qt(e,t,r,n)).bogus||(t.cache[l]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}function _t(e,t,r){for(var n,i,o,l,s,a,u=0;u<e.length;u+=3)if(s=e[u],a=e[u+1],t<s?(i=0,o=1,l="left"):t<a?o=(i=t-s)+1:(u==e.length-3||t==a&&e[u+3]>t)&&(i=(o=a-s)-1,t>=a&&(l="right")),null!=i){if(n=e[u+2],s==a&&r==(n.insertLeft?"left":"right")&&(l=r),"left"==r&&0==i)for(;u&&e[u-2]==e[u-3]&&e[u-1].insertLeft;)n=e[2+(u-=3)],l="left";if("right"==r&&i==a-s)for(;u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft;)n=e[(u+=3)+2],l="right";break}return{node:n,start:i,end:o,collapse:l,coverStart:s,coverEnd:a}}function $t(e,t){var r=ms;if("left"==t)for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function qt(e,t,r,n){var i,o=_t(t.map,r,n),l=o.node,s=o.start,a=o.end,u=o.collapse;if(3==l.nodeType){for(var c=0;c<4;c++){for(;s&&S(t.line.text.charAt(o.coverStart+s));)--s;for(;o.coverStart+a<o.coverEnd&&S(t.line.text.charAt(o.coverStart+a));)++a;if((i=gl&&vl<9&&0==s&&a==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():$t(Wl(l,s,a).getClientRects(),n)).left||i.right||0==s)break;a=s,s-=1,u="right"}gl&&vl<11&&(i=Zt(e.display.measure,i))}else{s>0&&(u=n="right");var f;i=e.options.lineWrapping&&(f=l.getClientRects()).length>1?f["right"==n?f.length-1:0]:l.getBoundingClientRect()}if(gl&&vl<9&&!s&&(!i||!i.left&&!i.right)){var h=l.parentNode.getClientRects()[0];i=h?{left:h.left,right:h.left+yr(e.display),top:h.top,bottom:h.bottom}:ms}for(var d=i.top-t.rect.top,p=i.bottom-t.rect.top,g=(d+p)/2,v=t.view.measure.heights,m=0;m<v.length-1&&!(g<v[m]);m++);var y=m?v[m-1]:0,b=v[m],w={left:("right"==u?i.right:i.left)-t.rect.left,right:("left"==u?i.left:i.right)-t.rect.left,top:y,bottom:b};return i.left||i.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=d,w.rbottom=p),w}function Zt(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Re(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function Qt(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Jt(e){e.display.externalMeasure=null,t(e.display.lineMeasure);for(var r=0;r<e.display.view.length;r++)Qt(e.display.view[r])}function er(e){Jt(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function tr(){return bl&&kl?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function rr(){return bl&&kl?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function nr(e){var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;++r)e.widgets[r].above&&(t+=Ht(e.widgets[r]));return t}function ir(e,t,r,n,i){if(!i){var o=nr(t);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var l=ye(t);if("local"==n?l+=Et(e.display):l-=e.display.viewOffset,"page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();l+=s.top+("window"==n?0:rr());var a=s.left+("window"==n?0:tr());r.left+=a,r.right+=a}return r.top+=l,r.bottom+=l,r}function or(e,t,r){if("div"==r)return t;var n=t.left,i=t.top;if("page"==r)n-=tr(),i-=rr();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var l=e.display.lineSpace.getBoundingClientRect();return{left:n-l.left,top:i-l.top}}function lr(e,t,r,n,i){return n||(n=M(e.doc,t.line)),ir(e,n,Kt(e,n,t.ch,i),r)}function sr(e,t,r,n,i,o){function l(t,l){var s=Yt(e,i,t,l?"right":"left",o);return l?s.left=s.right:s.right=s.left,ir(e,n,s,r)}function s(e,t,r){var n=1==a[t].level;return l(r?e-1:e,n!=r)}n=n||M(e.doc,t.line),i||(i=Xt(e,n));var a=Se(n,e.doc.direction),u=t.ch,c=t.sticky;if(u>=n.text.length?(u=n.text.length,c="before"):u<=0&&(u=0,c="after"),!a)return l("before"==c?u-1:u,"before"==c);var f=Ce(a,u,c),h=$l,d=s(u,f,"before"==c);return null!=h&&(d.other=s(u,h,"before"!=c)),d}function ar(e,t){var r=0;t=U(e.doc,t),e.options.lineWrapping||(r=yr(e.display)*t.ch);var n=M(e.doc,t.line),i=ye(n)+Et(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function ur(e,t,r,n,i){var o=E(e,t,r);return o.xRel=i,n&&(o.outside=!0),o}function cr(e,t,r){var n=e.doc;if((r+=e.display.viewOffset)<0)return ur(n.first,0,null,!0,-1);var i=D(n,r),o=n.first+n.size-1;if(i>o)return ur(n.first+n.size-1,M(n,o).text.length,null,!0,1);t<0&&(t=0);for(var l=M(n,i);;){var s=pr(e,l,i,t,r),a=ue(l),u=a&&a.find(0,!0);if(!a||!(s.ch>u.from.ch||s.ch==u.from.ch&&s.xRel>0))return s;i=W(l=u.to.line)}}function fr(e,t,r,n){n-=nr(t);var i=t.text.length,o=k(function(t){return Yt(e,r,t-1).bottom<=n},i,0);return i=k(function(t){return Yt(e,r,t).top>n},o,i),{begin:o,end:i}}function hr(e,t,r,n){return r||(r=Xt(e,t)),fr(e,t,r,ir(e,t,Yt(e,r,n),"line").top)}function dr(e,t,r,n){return!(e.bottom<=r)&&(e.top>r||(n?e.left:e.right)>t)}function pr(e,t,r,n,i){i-=ye(t);var o=Xt(e,t),l=nr(t),s=0,a=t.text.length,u=!0,c=Se(t,e.doc.direction);if(c){var f=(e.options.lineWrapping?vr:gr)(e,t,r,o,c,n,i);s=(u=1!=f.level)?f.from:f.to-1,a=u?f.to:f.from-1}var h,d,p=null,g=null,v=k(function(t){var r=Yt(e,o,t);return r.top+=l,r.bottom+=l,!!dr(r,n,i,!1)&&(r.top<=i&&r.left<=n&&(p=t,g=r),!0)},s,a),m=!1;if(g){var y=n-g.left<g.right-n,b=y==u;v=p+(b?0:1),d=b?"after":"before",h=y?g.left:g.right}else{u||v!=a&&v!=s||v++,d=0==v?"after":v==t.text.length?"before":Yt(e,o,v-(u?1:0)).bottom+l<=i==u?"after":"before";var w=sr(e,E(r,v,d),"line",t,o);h=w.left,m=i<w.top||i>=w.bottom}return v=L(t.text,v,1),ur(r,v,d,m,n-h)}function gr(e,t,r,n,i,o,l){var s=k(function(s){var a=i[s],u=1!=a.level;return dr(sr(e,E(r,u?a.to:a.from,u?"before":"after"),"line",t,n),o,l,!0)},0,i.length-1),a=i[s];if(s>0){var u=1!=a.level,c=sr(e,E(r,u?a.from:a.to,u?"after":"before"),"line",t,n);dr(c,o,l,!0)&&c.top>l&&(a=i[s-1])}return a}function vr(e,t,r,n,i,o,l){for(var s=fr(e,t,n,l),a=s.begin,u=s.end,c=null,f=null,h=0;h<i.length;h++){var d=i[h];if(!(d.from>=u||d.to<=a)){var p=Yt(e,n,1!=d.level?Math.min(u,d.to)-1:Math.max(a,d.from)).right,g=p<o?o-p+1e9:p-o;(!c||f>g)&&(c=d,f=g)}}return c||(c=i[i.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>u&&(c={from:c.from,to:u,level:c.level}),c}function mr(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==hs){hs=n("pre");for(var i=0;i<49;++i)hs.appendChild(document.createTextNode("x")),hs.appendChild(n("br"));hs.appendChild(document.createTextNode("x"))}r(e.measure,hs);var o=hs.offsetHeight/50;return o>3&&(e.cachedTextHeight=o),t(e.measure),o||1}function yr(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=n("span","xxxxxxxxxx"),i=n("pre",[t]);r(e.measure,i);var o=t.getBoundingClientRect(),l=(o.right-o.left)/10;return l>2&&(e.cachedCharWidth=l),l||10}function br(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,l=0;o;o=o.nextSibling,++l)r[e.options.gutters[l]]=o.offsetLeft+o.clientLeft+i,n[e.options.gutters[l]]=o.clientWidth;return{fixedPos:wr(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function wr(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function xr(e){var t=mr(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/yr(e.display)-3);return function(i){if(ve(e.doc,i))return 0;var o=0;if(i.widgets)for(var l=0;l<i.widgets.length;l++)i.widgets[l].height&&(o+=i.widgets[l].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function Cr(e){var t=e.doc,r=xr(e);t.iter(function(e){var t=r(e);t!=e.height&&A(e,t)})}function Sr(e,t,r,n){var i=e.display;if(!r&&"true"==Ee(t).getAttribute("cm-not-content"))return null;var o,l,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left,l=t.clientY-s.top}catch(t){return null}var a,u=cr(e,o,l);if(n&&1==u.xRel&&(a=M(e.doc,u.line).text).length==u.ch){var c=f(a,a.length,e.options.tabSize)-a.length;u=E(u.line,Math.max(0,Math.round((o-It(e.display).left)/yr(e.display))-c))}return u}function Lr(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var r=e.display.view,n=0;n<r.length;n++)if((t-=r[n].size)<0)return n}function kr(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Tr(e,t){void 0===t&&(t=!0);for(var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),l=0;l<r.sel.ranges.length;l++)if(t||l!=r.sel.primIndex){var s=r.sel.ranges[l];if(!(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom)){var a=s.empty();(a||e.options.showCursorWhenSelecting)&&Mr(e,s.head,i),a||Or(e,s,o)}}return n}function Mr(e,t,r){var i=sr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),o=r.appendChild(n("div"," ","CodeMirror-cursor"));if(o.style.left=i.left+"px",o.style.top=i.top+"px",o.style.height=Math.max(0,i.bottom-i.top)*e.options.cursorHeight+"px",i.other){var l=r.appendChild(n("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=i.other.left+"px",l.style.top=i.other.top+"px",l.style.height=.85*(i.other.bottom-i.other.top)+"px"}}function Nr(e,t){return e.top-t.top||e.left-t.left}function Or(e,t,r){function i(e,t,r,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),a.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==r?f-e:r)+"px;\n                             height: "+(i-t)+"px"))}function o(t,r,n){function o(r,n){return lr(e,E(t,r),"div",u,n)}var l,a,u=M(s,t),h=u.text.length,d=Se(u,s.direction);return xe(d,r||0,null==n?h:n,function(t,s,p,g){var v=o(t,"ltr"==p?"left":"right"),m=o(s-1,"ltr"==p?"right":"left");if("ltr"==p){var y=null==r&&0==t?c:v.left,b=null==n&&s==h?f:m.right;m.top-v.top<=3?i(y,m.top,b-y,m.bottom):(i(y,v.top,null,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top),i(c,m.top,m.right,m.bottom))}else if(t<s){var w=null==r&&0==t?f:v.right,x=null==n&&s==h?c:m.left;if(m.top-v.top<=3)i(x,m.top,w-x,m.bottom);else{var C=c;if(g){var S=hr(e,u,null,t).end;C=o(S-(/\s/.test(u.text.charAt(S-1))?2:1),"left").left}i(C,v.top,w-C,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top);var L=null;d.length,L=o(hr(e,u,null,s).begin,"right").right-x,i(x,m.top,L,m.bottom)}}(!l||Nr(v,l)<0)&&(l=v),Nr(m,l)<0&&(l=m),(!a||Nr(v,a)<0)&&(a=v),Nr(m,a)<0&&(a=m)}),{start:l,end:a}}var l=e.display,s=e.doc,a=document.createDocumentFragment(),u=It(e.display),c=u.left,f=Math.max(l.sizerWidth,Rt(e)-l.sizer.offsetLeft)-u.right,h=t.from(),d=t.to();if(h.line==d.line)o(h.line,h.ch,d.ch);else{var p=M(s,h.line),g=M(s,d.line),v=fe(p)==fe(g),m=o(h.line,h.ch,v?p.text.length+1:null).end,y=o(d.line,v?0:null,d.ch).start;v&&(m.top<y.top-2?(i(m.right,m.top,null,m.bottom),i(c,y.top,y.left,y.bottom)):i(m.right,m.top,y.left-m.right,m.bottom)),m.bottom<y.top&&i(c,m.bottom,null,y.top)}r.appendChild(a)}function Ar(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Wr(e){e.state.focused||(e.display.input.focus(),Hr(e))}function Dr(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Fr(e))},100)}function Hr(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Te(e,"focus",e,t),e.state.focused=!0,s(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),ml&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),Ar(e))}function Fr(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Te(e,"blur",e,t),e.state.focused=!1,Fl(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Er(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var i=t.view[n],o=void 0;if(!i.hidden){if(gl&&vl<8){var l=i.node.offsetTop+i.node.offsetHeight;o=l-r,r=l}else{var s=i.node.getBoundingClientRect();o=s.bottom-s.top}var a=i.line.height-o;if(o<2&&(o=mr(t)),(a>.005||a<-.005)&&(A(i.line,o),Pr(i.line),i.rest))for(var u=0;u<i.rest.length;u++)Pr(i.rest[u])}}}function Pr(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Ir(e,t,r){var n=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Et(e));var i=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=D(t,n),l=D(t,i);if(r&&r.ensure){var s=r.ensure.from.line,a=r.ensure.to.line;s<o?(o=s,l=D(t,ye(M(t,s))+e.wrapper.clientHeight)):Math.min(a,t.lastLine())>=l&&(o=D(t,ye(M(t,a))-e.wrapper.clientHeight),l=a)}return{from:o,to:Math.max(l,o+1)}}function zr(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=wr(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",l=0;l<r.length;l++)if(!r[l].hidden){e.options.fixedGutter&&(r[l].gutter&&(r[l].gutter.style.left=o),r[l].gutterBackground&&(r[l].gutterBackground.style.left=o));var s=r[l].alignable;if(s)for(var a=0;a<s.length;a++)s[a].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function Rr(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=F(e.options,t.first+t.size-1),i=e.display;if(r.length!=i.lineNumChars){var o=i.measure.appendChild(n("div",[n("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),l=o.firstChild.offsetWidth,s=o.offsetWidth-l;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(l,i.lineGutter.offsetWidth-s)+1,i.lineNumWidth=i.lineNumInnerWidth+s,i.lineNumChars=i.lineNumInnerWidth?r.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",Wn(e),!0}return!1}function Br(e,t){if(!Me(e,"scrollCursorIntoView")){var r=e.display,i=r.sizer.getBoundingClientRect(),o=null;if(t.top+i.top<0?o=!0:t.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!Sl){var l=n("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-Et(e.display))+"px;\n                         height: "+(t.bottom-t.top+zt(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(l),l.scrollIntoView(o),e.display.lineSpace.removeChild(l)}}}function Gr(e,t,r,n){null==n&&(n=0);var i;e.options.lineWrapping||t!=r||(r="before"==(t=t.ch?E(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?E(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var l=!1,s=sr(e,t),a=r&&r!=t?sr(e,r):s,u=Vr(e,i={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n}),c=e.doc.scrollTop,f=e.doc.scrollLeft;if(null!=u.scrollTop&&(qr(e,u.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(l=!0)),null!=u.scrollLeft&&(Qr(e,u.scrollLeft),Math.abs(e.doc.scrollLeft-f)>1&&(l=!0)),!l)break}return i}function Ur(e,t){var r=Vr(e,t);null!=r.scrollTop&&qr(e,r.scrollTop),null!=r.scrollLeft&&Qr(e,r.scrollLeft)}function Vr(e,t){var r=e.display,n=mr(e.display);t.top<0&&(t.top=0);var i=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:r.scroller.scrollTop,o=Bt(e),l={};t.bottom-t.top>o&&(t.bottom=t.top+o);var s=e.doc.height+Pt(r),a=t.top<n,u=t.bottom>s-n;if(t.top<i)l.scrollTop=a?0:t.top;else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);c!=i&&(l.scrollTop=c)}var f=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:r.scroller.scrollLeft,h=Rt(e)-(e.options.fixedGutter?r.gutters.offsetWidth:0),d=t.right-t.left>h;return d&&(t.right=t.left+h),t.left<10?l.scrollLeft=0:t.left<f?l.scrollLeft=Math.max(0,t.left-(d?0:10)):t.right>h+f-3&&(l.scrollLeft=t.right+(d?0:10)-h),l}function Kr(e,t){null!=t&&(_r(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function jr(e){_r(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Xr(e,t,r){null==t&&null==r||_r(e),null!=t&&(e.curOp.scrollLeft=t),null!=r&&(e.curOp.scrollTop=r)}function Yr(e,t){_r(e),e.curOp.scrollToPos=t}function _r(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,$r(e,ar(e,t.from),ar(e,t.to),t.margin))}function $r(e,t,r,n){var i=Vr(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});Xr(e,i.scrollLeft,i.scrollTop)}function qr(e,t){Math.abs(e.doc.scrollTop-t)<2||(fl||On(e,{top:t}),Zr(e,t,!0),fl&&On(e),Cn(e,100))}function Zr(e,t,r){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Qr(e,t,r,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,zr(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Jr(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+Pt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+zt(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}function en(e,t){t||(t=Jr(e));var r=e.display.barWidth,n=e.display.barHeight;tn(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&Er(e),tn(e,Jr(e)),r=e.display.barWidth,n=e.display.barHeight}function tn(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}function rn(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Fl(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new ws[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Ql(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){"horizontal"==r?Qr(e,t):qr(e,t)},e),e.display.scrollbars.addClass&&s(e.display.wrapper,e.display.scrollbars.addClass)}function nn(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++xs},vt(e.curOp)}function on(e){yt(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;ln(e)})}function ln(e){for(var t=e.ops,r=0;r<t.length;r++)sn(t[r]);for(var n=0;n<t.length;n++)an(t[n]);for(var i=0;i<t.length;i++)un(t[i]);for(var o=0;o<t.length;o++)cn(t[o]);for(var l=0;l<t.length;l++)fn(t[l])}function sn(e){var t=e.cm,r=t.display;Ln(t),e.updateMaxLine&&we(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Cs(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function an(e){e.updatedDisplay=e.mustUpdate&&Mn(e.cm,e.update)}function un(e){var t=e.cm,r=t.display;e.updatedDisplay&&Er(t),e.barMeasure=Jr(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Kt(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+zt(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-Rt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function cn(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Qr(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==l();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&en(t,e.barMeasure),e.updatedDisplay&&Dn(t,e.barMeasure),e.selectionChanged&&Ar(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&Wr(e.cm)}function fn(e){var t=e.cm,r=t.display,n=t.doc;e.updatedDisplay&&Nn(t,e.update),null==r.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=e.scrollTop&&Zr(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Qr(t,e.scrollLeft,!0,!0),e.scrollToPos&&Br(t,Gr(t,U(n,e.scrollToPos.from),U(n,e.scrollToPos.to),e.scrollToPos.margin));var i=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(i)for(var l=0;l<i.length;++l)i[l].lines.length||Te(i[l],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&Te(o[s],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Te(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function hn(e,t){if(e.curOp)return t();nn(e);try{return t()}finally{on(e)}}function dn(e,t){return function(){if(e.curOp)return t.apply(e,arguments);nn(e);try{return t.apply(e,arguments)}finally{on(e)}}}function pn(e){return function(){if(this.curOp)return e.apply(this,arguments);nn(this);try{return e.apply(this,arguments)}finally{on(this)}}}function gn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);nn(t);try{return e.apply(this,arguments)}finally{on(t)}}}function vn(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)_l&&pe(e.doc,t)<i.viewTo&&yn(e);else if(r<=i.viewFrom)_l&&ge(e.doc,r+n)>i.viewFrom?yn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)yn(e);else if(t<=i.viewFrom){var o=bn(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):yn(e)}else if(r>=i.viewTo){var l=bn(e,t,t,-1);l?(i.view=i.view.slice(0,l.index),i.viewTo=l.lineN):yn(e)}else{var s=bn(e,t,t,-1),a=bn(e,r,r+n,1);s&&a?(i.view=i.view.slice(0,s.index).concat(gt(e,s.lineN,a.lineN)).concat(i.view.slice(a.index)),i.viewTo+=n):yn(e)}var u=i.externalMeasured;u&&(r<u.lineN?u.lineN+=n:t<u.lineN+u.size&&(i.externalMeasured=null))}function mn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Lr(e,t)];if(null!=o.node){var l=o.changes||(o.changes=[]);-1==h(l,r)&&l.push(r)}}}function yn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function bn(e,t,r,n){var i,o=Lr(e,t),l=e.display.view;if(!_l||r==e.doc.first+e.doc.size)return{index:o,lineN:r};for(var s=e.display.viewFrom,a=0;a<o;a++)s+=l[a].size;if(s!=t){if(n>0){if(o==l.length-1)return null;i=s+l[o].size-t,o++}else i=s-t;t+=i,r+=i}for(;pe(e.doc,r)!=r;){if(o==(n<0?0:l.length-1))return null;r+=n*l[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:r}}function wn(e,t,r){var n=e.display;0==n.view.length||t>=n.viewTo||r<=n.viewFrom?(n.view=gt(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=gt(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Lr(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(gt(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,Lr(e,r)))),n.viewTo=r}function xn(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];i.hidden||i.node&&!i.changes||++r}return r}function Cn(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,u(Sn,e))}function Sn(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=$e(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var l=o.styles,s=o.text.length>e.options.maxHighlightLength?Ke(t.mode,n.state):null,a=Ye(e,o,n,!0);s&&(n.state=s),o.styles=a.styles;var u=o.styleClasses,c=a.classes;c?o.styleClasses=c:u&&(o.styleClasses=null);for(var f=!l||l.length!=o.styles.length||u!=c&&(!u||!c||u.bgClass!=c.bgClass||u.textClass!=c.textClass),h=0;!f&&h<l.length;++h)f=l[h]!=o.styles[h];f&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&qe(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return Cn(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&hn(e,function(){for(var t=0;t<i.length;t++)mn(e,i[t],"text")})}}function Ln(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=zt(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=zt(e)+"px",t.scrollbarsClipped=!0)}function kn(e){if(e.hasFocus())return null;var t=l();if(!t||!o(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}function Tn(e){if(e&&e.activeElt&&e.activeElt!=l()&&(e.activeElt.focus(),e.anchorNode&&o(document.body,e.anchorNode)&&o(document.body,e.focusNode))){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset),r.collapse(!1),t.removeAllRanges(),t.addRange(r),t.extend(e.focusNode,e.focusOffset)}}function Mn(e,r){var n=e.display,i=e.doc;if(r.editorIsHidden)return yn(e),!1;if(!r.force&&r.visible.from>=n.viewFrom&&r.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==xn(e))return!1;Rr(e)&&(yn(e),r.dims=br(e));var o=i.first+i.size,l=Math.max(r.visible.from-e.options.viewportMargin,i.first),s=Math.min(o,r.visible.to+e.options.viewportMargin);n.viewFrom<l&&l-n.viewFrom<20&&(l=Math.max(i.first,n.viewFrom)),n.viewTo>s&&n.viewTo-s<20&&(s=Math.min(o,n.viewTo)),_l&&(l=pe(e.doc,l),s=ge(e.doc,s));var a=l!=n.viewFrom||s!=n.viewTo||n.lastWrapHeight!=r.wrapperHeight||n.lastWrapWidth!=r.wrapperWidth;wn(e,l,s),n.viewOffset=ye(M(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var u=xn(e);if(!a&&0==u&&!r.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var c=kn(e);return u>4&&(n.lineDiv.style.display="none"),An(e,n.updateLineNumbers,r.dims),u>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Tn(c),t(n.cursorDiv),t(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,a&&(n.lastWrapHeight=r.wrapperHeight,n.lastWrapWidth=r.wrapperWidth,Cn(e,400)),n.updateLineNumbers=null,!0}function Nn(e,t){for(var r=t.viewport,n=!0;(n&&e.options.lineWrapping&&t.oldDisplayWidth!=Rt(e)||(r&&null!=r.top&&(r={top:Math.min(e.doc.height+Pt(e.display)-Bt(e),r.top)}),t.visible=Ir(e.display,e.doc,r),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&Mn(e,t);n=!1){Er(e);var i=Jr(e);kr(e),en(e,i),Dn(e,i),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function On(e,t){var r=new Cs(e,t);if(Mn(e,r)){Er(e),Nn(e,r);var n=Jr(e);kr(e),en(e,n),Dn(e,n),r.finish()}}function An(e,r,n){function i(t){var r=t.nextSibling;return ml&&Ml&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var o=e.display,l=e.options.lineNumbers,s=o.lineDiv,a=s.firstChild,u=o.view,c=o.viewFrom,f=0;f<u.length;f++){var d=u[f];if(d.hidden);else if(d.node&&d.node.parentNode==s){for(;a!=d.node;)a=i(a);var p=l&&null!=r&&r<=c&&d.lineNumber;d.changes&&(h(d.changes,"gutter")>-1&&(p=!1),xt(e,d,c,n)),p&&(t(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(F(e.options,c)))),a=d.node.nextSibling}else{var g=Ot(e,d,c,n);s.insertBefore(g,a)}c+=d.size}for(;a;)a=i(a)}function Wn(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Dn(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+zt(e)+"px"}function Hn(e){var r=e.display.gutters,i=e.options.gutters;t(r);for(var o=0;o<i.length;++o){var l=i[o],s=r.appendChild(n("div",null,"CodeMirror-gutter "+l));"CodeMirror-linenumbers"==l&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}r.style.display=o?"":"none",Wn(e)}function Fn(e){var t=h(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function En(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==r&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:null==r&&(r=e.wheelDelta),{x:t,y:r}}function Pn(e){var t=En(e);return t.x*=Ls,t.y*=Ls,t}function In(e,t){var r=En(t),n=r.x,i=r.y,o=e.display,l=o.scroller,s=l.scrollWidth>l.clientWidth,a=l.scrollHeight>l.clientHeight;if(n&&s||i&&a){if(i&&Ml&&ml)e:for(var u=t.target,c=o.view;u!=l;u=u.parentNode)for(var f=0;f<c.length;f++)if(c[f].node==u){e.display.currentWheelTarget=u;break e}if(n&&!fl&&!wl&&null!=Ls)return i&&a&&qr(e,Math.max(0,l.scrollTop+i*Ls)),Qr(e,Math.max(0,l.scrollLeft+n*Ls)),(!i||i&&a)&&We(t),void(o.wheelStartX=null);if(i&&null!=Ls){var h=i*Ls,d=e.doc.scrollTop,p=d+o.wrapper.clientHeight;h<0?d=Math.max(0,d+h-50):p=Math.min(e.doc.height,p+h+50),On(e,{top:d,bottom:p})}Ss<20&&(null==o.wheelStartX?(o.wheelStartX=l.scrollLeft,o.wheelStartY=l.scrollTop,o.wheelDX=n,o.wheelDY=i,setTimeout(function(){if(null!=o.wheelStartX){var e=l.scrollLeft-o.wheelStartX,t=l.scrollTop-o.wheelStartY,r=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,r&&(Ls=(Ls*Ss+r)/(Ss+1),++Ss)}},200)):(o.wheelDX+=n,o.wheelDY+=i))}}function zn(e,t){var r=e[t];e.sort(function(e,t){return P(e.from(),t.from())}),t=h(e,r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(P(o.to(),i.from())>=0){var l=B(o.from(),i.from()),s=R(o.to(),i.to()),a=o.empty()?i.from()==i.head:o.from()==o.head;n<=t&&--t,e.splice(--n,2,new Ts(a?s:l,a?l:s))}}return new ks(e,t)}function Rn(e,t){return new ks([new Ts(e,t||e)],0)}function Bn(e){return e.text?E(e.from.line+e.text.length-1,g(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Gn(e,t){if(P(e,t.from)<0)return e;if(P(e,t.to)<=0)return Bn(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Bn(t).ch-t.to.ch),E(r,n)}function Un(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Ts(Gn(i.anchor,t),Gn(i.head,t)))}return zn(r,e.sel.primIndex)}function Vn(e,t,r){return e.line==t.line?E(r.line,e.ch-t.ch+r.ch):E(r.line+(e.line-t.line),e.ch)}function Kn(e,t,r){for(var n=[],i=E(e.first,0),o=i,l=0;l<t.length;l++){var s=t[l],a=Vn(s.from,i,o),u=Vn(Bn(s),i,o);if(i=s.to,o=u,"around"==r){var c=e.sel.ranges[l],f=P(c.head,c.anchor)<0;n[l]=new Ts(f?u:a,f?a:u)}else n[l]=new Ts(a,a)}return new ks(n,e.sel.primIndex)}function jn(e){e.doc.mode=Ue(e.options,e.doc.modeOption),Xn(e)}function Xn(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Cn(e,100),e.state.modeGen++,e.curOp&&vn(e)}function Yn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==g(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function _n(e,t,r,n){function i(e){return r?r[e]:null}function o(e,r,i){it(e,r,i,n),bt(e,"change",e,t)}function l(e,t){for(var r=[],o=e;o<t;++o)r.push(new fs(u[o],i(o),n));return r}var s=t.from,a=t.to,u=t.text,c=M(e,s.line),f=M(e,a.line),h=g(u),d=i(u.length-1),p=a.line-s.line;if(t.full)e.insert(0,l(0,u.length)),e.remove(u.length,e.size-u.length);else if(Yn(e,t)){var v=l(0,u.length-1);o(f,f.text,d),p&&e.remove(s.line,p),v.length&&e.insert(s.line,v)}else if(c==f)if(1==u.length)o(c,c.text.slice(0,s.ch)+h+c.text.slice(a.ch),d);else{var m=l(1,u.length-1);m.push(new fs(h+c.text.slice(a.ch),d,n)),o(c,c.text.slice(0,s.ch)+u[0],i(0)),e.insert(s.line+1,m)}else if(1==u.length)o(c,c.text.slice(0,s.ch)+u[0]+f.text.slice(a.ch),i(0)),e.remove(s.line+1,p);else{o(c,c.text.slice(0,s.ch)+u[0],i(0)),o(f,h+f.text.slice(a.ch),d);var y=l(1,u.length-1);p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,y)}bt(e,"change",e,t)}function $n(e,t,r){function n(e,i,o){if(e.linked)for(var l=0;l<e.linked.length;++l){var s=e.linked[l];if(s.doc!=i){var a=o&&s.sharedHist;r&&!a||(t(s.doc,a),n(s.doc,e,a))}}}n(e,null,!0)}function qn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Cr(e),jn(e),Zn(e),e.options.lineWrapping||we(e),e.options.mode=t.modeOption,vn(e)}function Zn(e){("rtl"==e.doc.direction?s:Fl)(e.display.lineDiv,"CodeMirror-rtl")}function Qn(e){hn(e,function(){Zn(e),vn(e)})}function Jn(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function ei(e,t){var r={from:z(t.from),to:Bn(t),text:N(e,t.from,t.to)};return si(e,r,t.from.line,t.to.line+1),$n(e,function(e){return si(e,r,t.from.line,t.to.line+1)},!0),r}function ti(e){for(;e.length&&g(e).ranges;)e.pop()}function ri(e,t){return t?(ti(e.done),g(e.done)):e.done.length&&!g(e.done).ranges?g(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),g(e.done)):void 0}function ni(e,t,r,n){var i=e.history;i.undone.length=0;var o,l,s=+new Date;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&i.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=ri(i,i.lastOp==n)))l=g(o.changes),0==P(t.from,t.to)&&0==P(t.from,l.to)?l.to=Bn(t):o.changes.push(ei(e,t));else{var a=g(i.done);for(a&&a.ranges||li(e.sel,i.done),o={changes:[ei(e,t)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=s,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||Te(e,"historyAdded")}function ii(e,t,r,n){var i=t.charAt(0);return"*"==i||"+"==i&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function oi(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||ii(e,o,g(i.done),t))?i.done[i.done.length-1]=t:li(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&!1!==n.clearRedo&&ti(i.undone)}function li(e,t){var r=g(t);r&&r.ranges&&r.equals(e)||t.push(e)}function si(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function ai(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function ui(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(ai(r[i]));return n}function ci(e,t){var r=ui(e,t),n=J(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],l=n[i];if(o&&l)e:for(var s=0;s<l.length;++s){for(var a=l[s],u=0;u<o.length;++u)if(o[u].marker==a.marker)continue e;o.push(a)}else l&&(r[i]=l)}return r}function fi(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges)n.push(r?ks.prototype.deepCopy.call(o):o);else{var l=o.changes,s=[];n.push({changes:s});for(var a=0;a<l.length;++a){var u=l[a],c=void 0;if(s.push({from:u.from,to:u.to,text:u.text}),t)for(var f in u)(c=f.match(/^spans_(\d+)$/))&&h(t,Number(c[1]))>-1&&(g(s)[f]=u[f],delete u[f])}}}return n}function hi(e,t,r,n){if(n){var i=e.anchor;if(r){var o=P(t,i)<0;o!=P(r,i)<0?(i=t,t=r):o!=P(t,r)<0&&(t=r)}return new Ts(i,t)}return new Ts(r||t,t)}function di(e,t,r,n,i){null==i&&(i=e.cm&&(e.cm.display.shift||e.extend)),bi(e,new ks([hi(e.sel.primary(),t,r,i)],0),n)}function pi(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=hi(e.sel.ranges[o],t[o],null,i);bi(e,zn(n,e.sel.primIndex),r)}function gi(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,bi(e,zn(i,e.sel.primIndex),n)}function vi(e,t,r,n){bi(e,Rn(t,r),n)}function mi(e,t,r){var n={ranges:t.ranges,update:function(t){var r=this;this.ranges=[];for(var n=0;n<t.length;n++)r.ranges[n]=new Ts(U(e,t[n].anchor),U(e,t[n].head))},origin:r&&r.origin};return Te(e,"beforeSelectionChange",e,n),e.cm&&Te(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?zn(n.ranges,n.ranges.length-1):t}function yi(e,t,r){var n=e.history.done,i=g(n);i&&i.ranges?(n[n.length-1]=t,wi(e,t,r)):bi(e,t,r)}function bi(e,t,r){wi(e,t,r),oi(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function wi(e,t,r){(Oe(e,"beforeSelectionChange")||e.cm&&Oe(e.cm,"beforeSelectionChange"))&&(t=mi(e,t,r)),xi(e,Si(e,t,r&&r.bias||(P(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),r&&!1===r.scroll||!e.cm||jr(e.cm)}function xi(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Ne(e.cm)),bt(e,"cursorActivity",e))}function Ci(e){xi(e,Si(e,e.sel,null,!1))}function Si(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var l=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],a=ki(e,l.anchor,s&&s.anchor,r,n),u=ki(e,l.head,s&&s.head,r,n);(i||a!=l.anchor||u!=l.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Ts(a,u))}return i?zn(i,t.primIndex):t}function Li(e,t,r,n,i){var o=M(e,t.line);if(o.markedSpans)for(var l=0;l<o.markedSpans.length;++l){var s=o.markedSpans[l],a=s.marker;if((null==s.from||(a.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(a.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(i&&(Te(a,"beforeCursorEnter"),a.explicitlyCleared)){if(o.markedSpans){--l;continue}break}if(!a.atomic)continue;if(r){var u=a.find(n<0?1:-1),c=void 0;if((n<0?a.inclusiveRight:a.inclusiveLeft)&&(u=Ti(e,u,-n,u&&u.line==t.line?o:null)),u&&u.line==t.line&&(c=P(u,r))&&(n<0?c<0:c>0))return Li(e,u,t,n,i)}var f=a.find(n<0?-1:1);return(n<0?a.inclusiveLeft:a.inclusiveRight)&&(f=Ti(e,f,n,f.line==t.line?o:null)),f?Li(e,f,t,n,i):null}}return t}function ki(e,t,r,n,i){var o=n||1,l=Li(e,t,r,o,i)||!i&&Li(e,t,r,o,!0)||Li(e,t,r,-o,i)||!i&&Li(e,t,r,-o,!0);return l||(e.cantEdit=!0,E(e.first,0))}function Ti(e,t,r,n){return r<0&&0==t.ch?t.line>e.first?U(e,E(t.line-1)):null:r>0&&t.ch==(n||M(e,t.line)).text.length?t.line<e.first+e.size-1?E(t.line+1,0):null:new E(t.line,t.ch+r)}function Mi(e){e.setSelection(E(e.firstLine(),0),E(e.lastLine()),Gl)}function Ni(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(t,r,i,o){t&&(n.from=U(e,t)),r&&(n.to=U(e,r)),i&&(n.text=i),void 0!==o&&(n.origin=o)}),Te(e,"beforeChange",e,n),e.cm&&Te(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Oi(e,t,r){if(e.cm){if(!e.cm.curOp)return dn(e.cm,Oi)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"))||(t=Ni(e,t,!0))){var n=Yl&&!r&&te(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Ai(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Ai(e,t)}}function Ai(e,t){if(1!=t.text.length||""!=t.text[0]||0!=P(t.from,t.to)){var r=Un(e,t);ni(e,t,r,e.cm?e.cm.curOp.id:NaN),Hi(e,t,r,J(e,t));var n=[];$n(e,function(e,r){r||-1!=h(n,e.history)||(zi(e.history,t),n.push(e.history)),Hi(e,t,null,J(e,t))})}}function Wi(e,t,r){if(!e.cm||!e.cm.state.suppressEdits||r){for(var n,i=e.history,o=e.sel,l="undo"==t?i.done:i.undone,s="undo"==t?i.undone:i.done,a=0;a<l.length&&(n=l[a],r?!n.ranges||n.equals(e.sel):n.ranges);a++);if(a!=l.length){for(i.lastOrigin=i.lastSelOrigin=null;(n=l.pop()).ranges;){if(li(n,s),r&&!n.equals(e.sel))return void bi(e,n,{clearRedo:!1});o=n}var u=[];li(o,s),s.push({changes:u,generation:i.generation}),i.generation=n.generation||++i.maxGeneration;for(var c=Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"),f=n.changes.length-1;f>=0;--f){var d=function(r){var i=n.changes[r];if(i.origin=t,c&&!Ni(e,i,!1))return l.length=0,{};u.push(ei(e,i));var o=r?Un(e,i):g(l);Hi(e,i,o,ci(e,i)),!r&&e.cm&&e.cm.scrollIntoView({from:i.from,to:Bn(i)});var s=[];$n(e,function(e,t){t||-1!=h(s,e.history)||(zi(e.history,i),s.push(e.history)),Hi(e,i,null,ci(e,i))})}(f);if(d)return d.v}}}}function Di(e,t){if(0!=t&&(e.first+=t,e.sel=new ks(v(e.sel.ranges,function(e){return new Ts(E(e.anchor.line+t,e.anchor.ch),E(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){vn(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)mn(e.cm,n,"gutter")}}function Hi(e,t,r,n){if(e.cm&&!e.cm.curOp)return dn(e.cm,Hi)(e,t,r,n);if(t.to.line<e.first)Di(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Di(e,i),t={from:E(e.first,0),to:E(t.to.line+i,t.to.ch),text:[g(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:E(o,M(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=N(e,t.from,t.to),r||(r=Un(e,t)),e.cm?Fi(e.cm,t,n):_n(e,t,n),wi(e,r,Gl)}}function Fi(e,t,r){var n=e.doc,i=e.display,o=t.from,l=t.to,s=!1,a=o.line;e.options.lineWrapping||(a=W(fe(M(n,o.line))),n.iter(a,l.line+1,function(e){if(e==i.maxLine)return s=!0,!0})),n.sel.contains(t.from,t.to)>-1&&Ne(e),_n(n,t,r,xr(e)),e.options.lineWrapping||(n.iter(a,o.line+t.text.length,function(e){var t=be(e);t>i.maxLineLength&&(i.maxLine=e,i.maxLineLength=t,i.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0)),nt(n,o.line),Cn(e,400);var u=t.text.length-(l.line-o.line)-1;t.full?vn(e):o.line!=l.line||1!=t.text.length||Yn(e.doc,t)?vn(e,o.line,l.line+1,u):mn(e,o.line,"text");var c=Oe(e,"changes"),f=Oe(e,"change");if(f||c){var h={from:o,to:l,text:t.text,removed:t.removed,origin:t.origin};f&&bt(e,"change",e,h),c&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function Ei(e,t,r,n,i){if(n||(n=r),P(n,r)<0){var o;r=(o=[n,r])[0],n=o[1]}"string"==typeof t&&(t=e.splitLines(t)),Oi(e,{from:r,to:n,text:t,origin:i})}function Pi(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Ii(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],l=!0;if(o.ranges){o.copied||((o=e[i]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)Pi(o.ranges[s].anchor,t,r,n),Pi(o.ranges[s].head,t,r,n)}else{for(var a=0;a<o.changes.length;++a){var u=o.changes[a];if(r<u.from.line)u.from=E(u.from.line+n,u.from.ch),u.to=E(u.to.line+n,u.to.ch);else if(t<=u.to.line){l=!1;break}}l||(e.splice(0,i+1),i=0)}}}function zi(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Ii(e.done,r,n,i),Ii(e.undone,r,n,i)}function Ri(e,t,r,n){var i=t,o=t;return"number"==typeof t?o=M(e,G(e,t)):i=W(t),null==i?null:(n(o,i)&&e.cm&&mn(e.cm,i,r),o)}function Bi(e){var t=this;this.lines=e,this.parent=null;for(var r=0,n=0;n<e.length;++n)e[n].parent=t,r+=e[n].height;this.height=r}function Gi(e){var t=this;this.children=e;for(var r=0,n=0,i=0;i<e.length;++i){var o=e[i];r+=o.chunkSize(),n+=o.height,o.parent=t}this.size=r,this.height=n,this.parent=null}function Ui(e,t,r){ye(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Kr(e,r)}function Vi(e,t,r,n){var i=new Ms(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),Ri(e,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==i.insertAt?r.push(i):r.splice(Math.min(r.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,o&&!ve(e,t)){var n=ye(t)<e.scrollTop;A(t,t.height+Ht(i)),n&&Kr(o,i.height),o.curOp.forceUpdate=!0}return!0}),bt(o,"lineWidgetAdded",o,i,"number"==typeof t?t:W(t)),i}function Ki(e,t,r,n,o){if(n&&n.shared)return ji(e,t,r,n,o);if(e.cm&&!e.cm.curOp)return dn(e.cm,Ki)(e,t,r,n,o);var l=new Os(e,o),s=P(t,r);if(n&&c(n,l,!1),s>0||0==s&&!1!==l.clearWhenEmpty)return l;if(l.replacedWith&&(l.collapsed=!0,l.widgetNode=i("span",[l.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||l.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(l.widgetNode.insertLeft=!0)),l.collapsed){if(ce(e,t.line,t,r,l)||t.line!=r.line&&ce(e,r.line,t,r,l))throw new Error("Inserting collapsed marker partially overlapping an existing one");X()}l.addToHistory&&ni(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var a,u=t.line,f=e.cm;if(e.iter(u,r.line+1,function(e){f&&l.collapsed&&!f.options.lineWrapping&&fe(e)==f.display.maxLine&&(a=!0),l.collapsed&&u!=t.line&&A(e,0),q(e,new Y(l,u==t.line?t.ch:null,u==r.line?r.ch:null)),++u}),l.collapsed&&e.iter(t.line,r.line+1,function(t){ve(e,t)&&A(t,0)}),l.clearOnEnter&&Ql(l,"beforeCursorEnter",function(){return l.clear()}),l.readOnly&&(j(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),l.collapsed&&(l.id=++Ns,l.atomic=!0),f){if(a&&(f.curOp.updateMaxLine=!0),l.collapsed)vn(f,t.line,r.line+1);else if(l.className||l.title||l.startStyle||l.endStyle||l.css)for(var h=t.line;h<=r.line;h++)mn(f,h,"text");l.atomic&&Ci(f.doc),bt(f,"markerAdded",f,l)}return l}function ji(e,t,r,n,i){(n=c(n)).shared=!1;var o=[Ki(e,t,r,n,i)],l=o[0],s=n.widgetNode;return $n(e,function(e){s&&(n.widgetNode=s.cloneNode(!0)),o.push(Ki(e,U(e,t),U(e,r),n,i));for(var a=0;a<e.linked.length;++a)if(e.linked[a].isParent)return;l=g(o)}),new As(o,l)}function Xi(e){return e.findMarks(E(e.first,0),e.clipPos(E(e.lastLine())),function(e){return e.parent})}function Yi(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),l=e.clipPos(i.to);if(P(o,l)){var s=Ki(e,o,l,n.primary,n.primary.type);n.markers.push(s),s.parent=n}}}function _i(e){for(var t=0;t<e.length;t++)!function(t){var r=e[t],n=[r.primary.doc];$n(r.primary.doc,function(e){return n.push(e)});for(var i=0;i<r.markers.length;i++){var o=r.markers[i];-1==h(n,o.doc)&&(o.parent=null,r.markers.splice(i--,1))}}(t)}function $i(e){var t=this;if(Qi(t),!Me(t,e)&&!Ft(t.display,e)){We(e),gl&&(Hs=+new Date);var r=Sr(t,e,!0),n=e.dataTransfer.files;if(r&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),l=0,s=0;s<i;++s)!function(e,n){if(!t.options.allowDropFileTypes||-1!=h(t.options.allowDropFileTypes,e.type)){var s=new FileReader;s.onload=dn(t,function(){var e=s.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),o[n]=e,++l==i){var a={from:r=U(t.doc,r),to:r,text:t.doc.splitLines(o.join(t.doc.lineSeparator())),origin:"paste"};Oi(t.doc,a),yi(t.doc,Rn(r,Bn(a)))}}),s.readAsText(e)}}(n[s],s);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var a=e.dataTransfer.getData("Text");if(a){var u;if(t.state.draggingText&&!t.state.draggingText.copy&&(u=t.listSelections()),wi(t.doc,Rn(r,r)),u)for(var c=0;c<u.length;++c)Ei(t.doc,"",u[c].anchor,u[c].head,"drag");t.replaceSelection(a,"around","paste"),t.display.input.focus()}}catch(e){}}}}function qi(e,t){if(gl&&(!e.state.draggingText||+new Date-Hs<100))Fe(t);else if(!Me(e,t)&&!Ft(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!xl)){var r=n("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",wl&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),wl&&r.parentNode.removeChild(r)}}function Zi(e,t){var i=Sr(e,t);if(i){var o=document.createDocumentFragment();Mr(e,i,o),e.display.dragCursor||(e.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),r(e.display.dragCursor,o)}}function Qi(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Ji(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),r=0;r<t.length;r++){var n=t[r].CodeMirror;n&&e(n)}}function eo(){Fs||(to(),Fs=!0)}function to(){var e;Ql(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Ji(ro)},100))}),Ql(window,"blur",function(){return Ji(Fr)})}function ro(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function no(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var r,n,i,o,l=0;l<t.length-1;l++){var s=t[l];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))r=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);i=!0}}return r&&(e="Alt-"+e),n&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function io(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if("..."==n){delete e[r];continue}for(var i=v(r.split(" "),no),o=0;o<i.length;o++){var l=void 0,s=void 0;o==i.length-1?(s=i.join(" "),l=n):(s=i.slice(0,o+1).join(" "),l="...");var a=t[s];if(a){if(a!=l)throw new Error("Inconsistent bindings for "+s)}else t[s]=l}delete e[r]}for(var u in t)e[u]=t[u];return e}function oo(e,t,r,n){var i=(t=uo(t)).call?t.call(e,n):t[e];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&r(i))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return oo(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var l=oo(e,t.fallthrough[o],r,n);if(l)return l}}}function lo(e){var t="string"==typeof e?e:Es[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function so(e,t,r){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(Dl?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(Dl?t.ctrlKey:t.metaKey)&&"Cmd"!=n&&(e="Cmd-"+e),!r&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function ao(e,t){if(wl&&34==e.keyCode&&e.char)return!1;var r=Es[e.keyCode];return null!=r&&!e.altGraphKey&&so(r,e,t)}function uo(e){return"string"==typeof e?Rs[e]:e}function co(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&P(o.from,g(n).to)<=0;){var l=n.pop();if(P(l.from,o.from)<0){o.from=l.from;break}}n.push(o)}hn(e,function(){for(var t=n.length-1;t>=0;t--)Ei(e.doc,"",n[t].from,n[t].to,"+delete");jr(e)})}function fo(e,t,r){var n=L(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ho(e,t,r){var n=fo(e,t.ch,r);return null==n?null:new E(t.line,n,r<0?"after":"before")}function po(e,t,r,n,i){if(e){var o=Se(r,t.doc.direction);if(o){var l,s=i<0?g(o):o[0],a=i<0==(1==s.level)?"after":"before";if(s.level>0){var u=Xt(t,r);l=i<0?r.text.length-1:0;var c=Yt(t,u,l).top;l=k(function(e){return Yt(t,u,e).top==c},i<0==(1==s.level)?s.from:s.to-1,l),"before"==a&&(l=fo(r,l,1))}else l=i<0?s.to:s.from;return new E(n,l,a)}}return new E(n,i<0?r.text.length:0,i<0?"before":"after")}function go(e,t,r,n){var i=Se(t,e.doc.direction);if(!i)return ho(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=Ce(i,r.ch,r.sticky),l=i[o];if("ltr"==e.doc.direction&&l.level%2==0&&(n>0?l.to>r.ch:l.from<r.ch))return ho(t,r,n);var s,a=function(e,r){return fo(t,e instanceof E?e.ch:e,r)},u=function(r){return e.options.lineWrapping?(s=s||Xt(e,t),hr(e,t,s,r)):{begin:0,end:t.text.length}},c=u("before"==r.sticky?a(r,-1):r.ch);if("rtl"==e.doc.direction||1==l.level){var f=1==l.level==n<0,h=a(r,f?1:-1);if(null!=h&&(f?h<=l.to&&h<=c.end:h>=l.from&&h>=c.begin)){var d=f?"before":"after";return new E(r.line,h,d)}}var p=function(e,t,n){for(var o=function(e,t){return t?new E(r.line,a(e,1),"before"):new E(r.line,e,"after")};e>=0&&e<i.length;e+=t){var l=i[e],s=t>0==(1!=l.level),u=s?n.begin:a(n.end,-1);if(l.from<=u&&u<l.to)return o(u,s);if(u=s?l.from:a(l.to,-1),n.begin<=u&&u<n.end)return o(u,s)}},g=p(o+n,n,c);if(g)return g;var v=n>0?c.end:a(c.begin,-1);return null==v||n>0&&v==t.text.length||!(g=p(n>0?0:i.length-1,n,u(v)))?null:g}function vo(e,t){var r=M(e.doc,t),n=fe(r);return n!=r&&(t=W(n)),po(!0,e,n,t,1)}function mo(e,t){var r=M(e.doc,t),n=he(r);return n!=r&&(t=W(n)),po(!0,e,r,t,-1)}function yo(e,t){var r=vo(e,t.line),n=M(e.doc,r.line),i=Se(n,e.doc.direction);if(!i||0==i[0].level){var o=Math.max(0,n.text.search(/\S/)),l=t.line==r.line&&t.ch<=o&&t.ch;return E(r.line,l?0:o,r.sticky)}return r}function bo(e,t,r){if("string"==typeof t&&!(t=Bs[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=Bl}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function wo(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=oo(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&oo(t,e.options.extraKeys,r,e)||oo(t,e.options.keyMap,r,e)}function xo(e,t,r,n){var i=e.state.keySeq;if(i){if(lo(t))return"handled";Gs.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),t=i+" "+t}var o=wo(e,t,n);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&bt(e,"keyHandled",e,t,r),"handled"!=o&&"multi"!=o||(We(r),Ar(e)),i&&!o&&/\'$/.test(t)?(We(r),!0):!!o}function Co(e,t){var r=ao(t,!0);return!!r&&(t.shiftKey&&!e.state.keySeq?xo(e,"Shift-"+r,t,function(t){return bo(e,t,!0)})||xo(e,r,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return bo(e,t)}):xo(e,r,t,function(t){return bo(e,t)}))}function So(e,t,r){return xo(e,"'"+r+"'",t,function(t){return bo(e,t,!0)})}function Lo(e){var t=this;if(t.curOp.focus=l(),!Me(t,e)){gl&&vl<11&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=Co(t,e);wl&&(Us=n?r:null,!n&&88==r&&!rs&&(Ml?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=r||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ko(t)}}function ko(e){function t(e){18!=e.keyCode&&e.altKey||(Fl(r,"CodeMirror-crosshair"),ke(document,"keyup",t),ke(document,"mouseover",t))}var r=e.display.lineDiv;s(r,"CodeMirror-crosshair"),Ql(document,"keyup",t),Ql(document,"mouseover",t)}function To(e){16==e.keyCode&&(this.doc.sel.shift=!1),Me(this,e)}function Mo(e){var t=this;if(!(Ft(t.display,e)||Me(t,e)||e.ctrlKey&&!e.altKey||Ml&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(wl&&r==Us)return Us=null,void We(e);if(!wl||e.which&&!(e.which<10)||!Co(t,e)){var i=String.fromCharCode(null==n?r:n);"\b"!=i&&(So(t,e,i)||t.display.input.onKeyPress(e))}}}function No(e,t){var r=+new Date;return js&&js.compare(r,e,t)?(Ks=js=null,"triple"):Ks&&Ks.compare(r,e,t)?(js=new Vs(r,e,t),Ks=null,"double"):(Ks=new Vs(r,e,t),js=null,"single")}function Oo(e){var t=this,r=t.display;if(!(Me(t,e)||r.activeTouch&&r.input.supportsTouch()))if(r.input.ensurePolled(),r.shift=e.shiftKey,Ft(r,e))ml||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));else if(!zo(t,e)){var n=Sr(t,e),i=Pe(e),o=n?No(n,i):"single";window.focus(),1==i&&t.state.selectingText&&t.state.selectingText(e),n&&Ao(t,i,n,o,e)||(1==i?n?Do(t,n,o,e):Ee(e)==r.scroller&&We(e):2==i?(n&&di(t.doc,n),setTimeout(function(){return r.input.focus()},20)):3==i&&(Hl?Ro(t,e):Dr(t)))}}function Ao(e,t,r,n,i){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),o=(1==t?"Left":2==t?"Middle":"Right")+o,xo(e,so(o,i),i,function(t){if("string"==typeof t&&(t=Bs[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,r)!=Bl}finally{e.state.suppressEdits=!1}return n})}function Wo(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(null==i.unit){var o=Nl?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==i.extend||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey),null==i.addNew&&(i.addNew=Ml?r.metaKey:r.ctrlKey),null==i.moveOnDrag&&(i.moveOnDrag=!(Ml?r.altKey:r.ctrlKey)),i}function Do(e,t,r,n){gl?setTimeout(u(Wr,e),0):e.curOp.focus=l();var i,o=Wo(e,r,n),s=e.doc.sel;e.options.dragDrop&&Jl&&!e.isReadOnly()&&"single"==r&&(i=s.contains(t))>-1&&(P((i=s.ranges[i]).from(),t)<0||t.xRel>0)&&(P(i.to(),t)>0||t.xRel<0)?Ho(e,n,t,o):Eo(e,n,t,o)}function Ho(e,t,r,n){var i=e.display,o=!1,l=dn(e,function(t){ml&&(i.scroller.draggable=!1),e.state.draggingText=!1,ke(document,"mouseup",l),ke(document,"mousemove",s),ke(i.scroller,"dragstart",a),ke(i.scroller,"drop",l),o||(We(t),n.addNew||di(e.doc,r,null,null,n.extend),ml||gl&&9==vl?setTimeout(function(){document.body.focus(),i.input.focus()},20):i.input.focus())}),s=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},a=function(){return o=!0};ml&&(i.scroller.draggable=!0),e.state.draggingText=l,l.copy=!n.moveOnDrag,i.scroller.dragDrop&&i.scroller.dragDrop(),Ql(document,"mouseup",l),Ql(document,"mousemove",s),Ql(i.scroller,"dragstart",a),Ql(i.scroller,"drop",l),Dr(e),setTimeout(function(){return i.input.focus()},20)}function Fo(e,t,r){if("char"==r)return new Ts(t,t);if("word"==r)return e.findWordAt(t);if("line"==r)return new Ts(E(t.line,0),U(e.doc,E(t.line+1,0)));var n=r(e,t);return new Ts(n.from,n.to)}function Eo(e,t,r,n){function i(t){if(0!=P(m,t))if(m=t,"rectangle"==n.unit){for(var i=[],o=e.options.tabSize,l=f(M(u,r.line).text,r.ch,o),s=f(M(u,t.line).text,t.ch,o),a=Math.min(l,s),g=Math.max(l,s),v=Math.min(r.line,t.line),y=Math.min(e.lastLine(),Math.max(r.line,t.line));v<=y;v++){var b=M(u,v).text,w=d(b,a,o);a==g?i.push(new Ts(E(v,w),E(v,w))):b.length>w&&i.push(new Ts(E(v,w),E(v,d(b,g,o))))}i.length||i.push(new Ts(r,r)),bi(u,zn(p.ranges.slice(0,h).concat(i),h),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var x,C=c,S=Fo(e,t,n.unit),L=C.anchor;P(S.anchor,L)>0?(x=S.head,L=B(C.from(),S.anchor)):(x=S.anchor,L=R(C.to(),S.head));var k=p.ranges.slice(0);k[h]=Po(e,new Ts(U(u,L),x)),bi(u,zn(k,h),Ul)}}function o(t){var r=++b,s=Sr(e,t,!0,"rectangle"==n.unit);if(s)if(0!=P(s,m)){e.curOp.focus=l(),i(s);var c=Ir(a,u);(s.line>=c.to||s.line<c.from)&&setTimeout(dn(e,function(){b==r&&o(t)}),150)}else{var f=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;f&&setTimeout(dn(e,function(){b==r&&(a.scroller.scrollTop+=f,o(t))}),50)}}function s(t){e.state.selectingText=!1,b=1/0,We(t),a.input.focus(),ke(document,"mousemove",w),ke(document,"mouseup",x),u.history.lastSelOrigin=null}var a=e.display,u=e.doc;We(t);var c,h,p=u.sel,g=p.ranges;if(n.addNew&&!n.extend?(h=u.sel.contains(r),c=h>-1?g[h]:new Ts(r,r)):(c=u.sel.primary(),h=u.sel.primIndex),"rectangle"==n.unit)n.addNew||(c=new Ts(r,r)),r=Sr(e,t,!0,!0),h=-1;else{var v=Fo(e,r,n.unit);c=n.extend?hi(c,v.anchor,v.head,n.extend):v}n.addNew?-1==h?(h=g.length,bi(u,zn(g.concat([c]),h),{scroll:!1,origin:"*mouse"})):g.length>1&&g[h].empty()&&"char"==n.unit&&!n.extend?(bi(u,zn(g.slice(0,h).concat(g.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),p=u.sel):gi(u,h,c,Ul):(h=0,bi(u,new ks([c],0),Ul),p=u.sel);var m=r,y=a.wrapper.getBoundingClientRect(),b=0,w=dn(e,function(e){Pe(e)?o(e):s(e)}),x=dn(e,s);e.state.selectingText=x,Ql(document,"mousemove",w),Ql(document,"mouseup",x)}function Po(e,t){var r=t.anchor,n=t.head,i=M(e.doc,r.line);if(0==P(r,n)&&r.sticky==n.sticky)return t;var o=Se(i);if(!o)return t;var l=Ce(o,r.ch,r.sticky),s=o[l];if(s.from!=r.ch&&s.to!=r.ch)return t;var a=l+(s.from==r.ch==(1!=s.level)?0:1);if(0==a||a==o.length)return t;var u;if(n.line!=r.line)u=(n.line-r.line)*("ltr"==e.doc.direction?1:-1)>0;else{var c=Ce(o,n.ch,n.sticky),f=c-l||(n.ch-r.ch)*(1==s.level?-1:1);u=c==a-1||c==a?f<0:f>0}var h=o[a+(u?-1:0)],d=u==(1==h.level),p=d?h.from:h.to,g=d?"after":"before";return r.ch==p&&r.sticky==g?t:new Ts(new E(r.line,p,g),n)}function Io(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&We(t);var l=e.display,s=l.lineDiv.getBoundingClientRect();if(o>s.bottom||!Oe(e,r))return He(t);o-=s.top-l.viewOffset;for(var a=0;a<e.options.gutters.length;++a){var u=l.gutters.childNodes[a];if(u&&u.getBoundingClientRect().right>=i)return Te(e,r,e,D(e.doc,o),e.options.gutters[a],t),He(t)}}function zo(e,t){return Io(e,t,"gutterClick",!0)}function Ro(e,t){Ft(e.display,t)||Bo(e,t)||Me(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Bo(e,t){return!!Oe(e,"gutterContextMenu")&&Io(e,t,"gutterContextMenu",!1)}function Go(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),er(e)}function Uo(e){Hn(e),vn(e),zr(e)}function Vo(e,t,r){if(!t!=!(r&&r!=Xs)){var n=e.display.dragFunctions,i=t?Ql:ke;i(e.display.scroller,"dragstart",n.start),i(e.display.scroller,"dragenter",n.enter),i(e.display.scroller,"dragover",n.over),i(e.display.scroller,"dragleave",n.leave),i(e.display.scroller,"drop",n.drop)}}function Ko(e){e.options.lineWrapping?(s(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Fl(e.display.wrapper,"CodeMirror-wrap"),we(e)),Cr(e),vn(e),er(e),setTimeout(function(){return en(e)},100)}function jo(e,t){var r=this;if(!(this instanceof jo))return new jo(e,t);this.options=t=t?c(t):{},c(Ys,t,!1),Fn(t);var n=t.value;"string"==typeof n&&(n=new Ds(n,t.mode,null,t.lineSeparator,t.direction)),this.doc=n;var i=new jo.inputStyles[t.inputStyle](this),o=this.display=new T(e,n,i);o.wrapper.CodeMirror=this,Hn(this),Go(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),rn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Pl,keySeq:null,specialChars:null},t.autofocus&&!Tl&&o.input.focus(),gl&&vl<11&&setTimeout(function(){return r.display.input.reset(!0)},20),Xo(this),eo(),nn(this),this.curOp.forceUpdate=!0,qn(this,n),t.autofocus&&!Tl||this.hasFocus()?setTimeout(u(Hr,this),20):Fr(this);for(var l in _s)_s.hasOwnProperty(l)&&_s[l](r,t[l],Xs);Rr(this),t.finishInit&&t.finishInit(this);for(var s=0;s<$s.length;++s)$s[s](r);on(this),ml&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Xo(e){function t(){i.activeTouch&&(o=setTimeout(function(){return i.activeTouch=null},1e3),(l=i.activeTouch).end=+new Date)}function r(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function n(e,t){if(null==t.left)return!0;var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>400}var i=e.display;Ql(i.scroller,"mousedown",dn(e,Oo)),gl&&vl<11?Ql(i.scroller,"dblclick",dn(e,function(t){if(!Me(e,t)){var r=Sr(e,t);if(r&&!zo(e,t)&&!Ft(e.display,t)){We(t);var n=e.findWordAt(r);di(e.doc,n.anchor,n.head)}}})):Ql(i.scroller,"dblclick",function(t){return Me(e,t)||We(t)}),Hl||Ql(i.scroller,"contextmenu",function(t){return Ro(e,t)});var o,l={end:0};Ql(i.scroller,"touchstart",function(t){if(!Me(e,t)&&!r(t)&&!zo(e,t)){i.input.ensurePolled(),clearTimeout(o);var n=+new Date;i.activeTouch={start:n,moved:!1,prev:n-l.end<=300?l:null},1==t.touches.length&&(i.activeTouch.left=t.touches[0].pageX,i.activeTouch.top=t.touches[0].pageY)}}),Ql(i.scroller,"touchmove",function(){i.activeTouch&&(i.activeTouch.moved=!0)}),Ql(i.scroller,"touchend",function(r){var o=i.activeTouch;if(o&&!Ft(i,r)&&null!=o.left&&!o.moved&&new Date-o.start<300){var l,s=e.coordsChar(i.activeTouch,"page");l=!o.prev||n(o,o.prev)?new Ts(s,s):!o.prev.prev||n(o,o.prev.prev)?e.findWordAt(s):new Ts(E(s.line,0),U(e.doc,E(s.line+1,0))),e.setSelection(l.anchor,l.head),e.focus(),We(r)}t()}),Ql(i.scroller,"touchcancel",t),Ql(i.scroller,"scroll",function(){i.scroller.clientHeight&&(qr(e,i.scroller.scrollTop),Qr(e,i.scroller.scrollLeft,!0),Te(e,"scroll",e))}),Ql(i.scroller,"mousewheel",function(t){return In(e,t)}),Ql(i.scroller,"DOMMouseScroll",function(t){return In(e,t)}),Ql(i.wrapper,"scroll",function(){return i.wrapper.scrollTop=i.wrapper.scrollLeft=0}),i.dragFunctions={enter:function(t){Me(e,t)||Fe(t)},over:function(t){Me(e,t)||(Zi(e,t),Fe(t))},start:function(t){return qi(e,t)},drop:dn(e,$i),leave:function(t){Me(e,t)||Qi(e)}};var s=i.input.getField();Ql(s,"keyup",function(t){return To.call(e,t)}),Ql(s,"keydown",dn(e,Lo)),Ql(s,"keypress",dn(e,Mo)),Ql(s,"focus",function(t){return Hr(e,t)}),Ql(s,"blur",function(t){return Fr(e,t)})}function Yo(e,t,r,n){var i,o=e.doc;null==r&&(r="add"),"smart"==r&&(o.mode.indent?i=$e(e,t).state:r="prev");var l=e.options.tabSize,s=M(o,t),a=f(s.text,null,l);s.stateAfter&&(s.stateAfter=null);var u,c=s.text.match(/^\s*/)[0];if(n||/\S/.test(s.text)){if("smart"==r&&((u=o.mode.indent(i,s.text.slice(c.length),s.text))==Bl||u>150)){if(!n)return;r="prev"}}else u=0,r="not";"prev"==r?u=t>o.first?f(M(o,t-1).text,null,l):0:"add"==r?u=a+e.options.indentUnit:"subtract"==r?u=a-e.options.indentUnit:"number"==typeof r&&(u=a+r),u=Math.max(0,u);var h="",d=0;if(e.options.indentWithTabs)for(var g=Math.floor(u/l);g;--g)d+=l,h+="\t";if(d<u&&(h+=p(u-d)),h!=c)return Ei(o,h,E(t,0),E(t,c.length),"+input"),s.stateAfter=null,!0;for(var v=0;v<o.sel.ranges.length;v++){var m=o.sel.ranges[v];if(m.head.line==t&&m.head.ch<c.length){var y=E(t,c.length);gi(o,v,new Ts(y,y));break}}}function _o(e){qs=e}function $o(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var l=e.state.pasteIncoming||"paste"==i,s=es(t),a=null;if(l&&n.ranges.length>1)if(qs&&qs.text.join("\n")==t){if(n.ranges.length%qs.text.length==0){a=[];for(var u=0;u<qs.text.length;u++)a.push(o.splitLines(qs.text[u]))}}else s.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(a=v(s,function(e){return[e]}));for(var c,f=n.ranges.length-1;f>=0;f--){var h=n.ranges[f],d=h.from(),p=h.to();h.empty()&&(r&&r>0?d=E(d.line,d.ch-r):e.state.overwrite&&!l?p=E(p.line,Math.min(M(o,p.line).text.length,p.ch+g(s).length)):qs&&qs.lineWise&&qs.text.join("\n")==t&&(d=p=E(d.line,0))),c=e.curOp.updateInput;var m={from:d,to:p,text:a?a[f%a.length]:s,origin:i||(l?"paste":e.state.cutIncoming?"cut":"+input")};Oi(e.doc,m),bt(e,"inputRead",e,m)}t&&!l&&Zo(e,t),jr(e),e.curOp.updateInput=c,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function qo(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||hn(t,function(){return $o(t,r,0,null,"paste")}),!0}function Zo(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),l=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(t.indexOf(o.electricChars.charAt(s))>-1){l=Yo(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(M(e.doc,i.head.line).text.slice(0,i.head.ch))&&(l=Yo(e,i.head.line,"smart"));l&&bt(e,"electricInput",e,i.head.line)}}}function Qo(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:E(i,0),head:E(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Jo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function el(){var e=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=n("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ml?e.style.width="1000px":e.setAttribute("wrap","off"),Ll&&(e.style.border="1px solid black"),Jo(e),t}function tl(e,t,r,n,i){function o(){var n=t.line+r;return!(n<e.first||n>=e.first+e.size)&&(t=new E(n,t.ch,t.sticky),u=M(e,n))}function l(n){var l;if(null==(l=i?go(e.cm,u,t,r):ho(u,t,r))){if(n||!o())return!1;t=po(i,e.cm,u,t.line,r)}else t=l;return!0}var s=t,a=r,u=M(e,t.line);if("char"==n)l();else if("column"==n)l(!0);else if("word"==n||"group"==n)for(var c=null,f="group"==n,h=e.cm&&e.cm.getHelper(t,"wordChars"),d=!0;!(r<0)||l(!d);d=!1){var p=u.text.charAt(t.ch)||"\n",g=x(p,h)?"w":f&&"\n"==p?"n":!f||/\s/.test(p)?null:"p";if(!f||d||g||(g="s"),c&&c!=g){r<0&&(r=1,l(),t.sticky="after");break}if(g&&(c=g),r>0&&!l(!d))break}var v=ki(e,t,s,a,!0);return I(s,v)&&(v.hitSide=!0),v}function rl(e,t,r,n){var i,o=e.doc,l=t.left;if("page"==n){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),a=Math.max(s-.5*mr(e.display),3);i=(r>0?t.bottom:t.top)+r*a}else"line"==n&&(i=r>0?t.bottom+3:t.top-3);for(var u;(u=cr(e,l,i)).outside;){if(r<0?i<=0:i>=o.height){u.hitSide=!0;break}i+=5*r}return u}function nl(e,t){var r=jt(e,t.line);if(!r||r.hidden)return null;var n=M(e.doc,t.line),i=Ut(r,n,t.line),o=Se(n,e.doc.direction),l="left";o&&(l=Ce(o,t.ch)%2?"right":"left");var s=_t(i.map,t.ch,l);return s.offset="right"==s.collapse?s.end:s.start,s}function il(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ol(e,t){return t&&(e.bad=!0),e}function ll(e,t,r,n,i){function o(e){return function(t){return t.id==e}}function l(){c&&(u+=f,c=!1)}function s(e){e&&(l(),u+=e)}function a(t){if(1==t.nodeType){var r=t.getAttribute("cm-text");if(null!=r)return void s(r||t.textContent.replace(/\u200b/g,""));var u,h=t.getAttribute("cm-marker");if(h){var d=e.findMarks(E(n,0),E(i+1,0),o(+h));return void(d.length&&(u=d[0].find(0))&&s(N(e.doc,u.from,u.to).join(f)))}if("false"==t.getAttribute("contenteditable"))return;var p=/^(pre|div|p)$/i.test(t.nodeName);p&&l();for(var g=0;g<t.childNodes.length;g++)a(t.childNodes[g]);p&&(c=!0)}else 3==t.nodeType&&s(t.nodeValue)}for(var u="",c=!1,f=e.doc.lineSeparator();a(t),t!=r;)t=t.nextSibling;return u}function sl(e,t,r){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[r]))return ol(e.clipPos(E(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return al(o,t,r)}}function al(e,t,r){function n(t,r,n){for(var i=-1;i<(f?f.length:0);i++)for(var o=i<0?c.map:f[i],l=0;l<o.length;l+=3){var s=o[l+2];if(s==t||s==r){var a=W(i<0?e.line:e.rest[i]),u=o[l]+n;return(n<0||s!=t)&&(u=o[l+(n?1:0)]),E(a,u)}}}var i=e.text.firstChild,l=!1;if(!t||!o(i,t))return ol(E(W(e.line),0),!0);if(t==i&&(l=!0,t=i.childNodes[r],r=0,!t)){var s=e.rest?g(e.rest):e.line;return ol(E(W(s),s.text.length),l)}var a=3==t.nodeType?t:null,u=t;for(a||1!=t.childNodes.length||3!=t.firstChild.nodeType||(a=t.firstChild,r&&(r=a.nodeValue.length));u.parentNode!=i;)u=u.parentNode;var c=e.measure,f=c.maps,h=n(a,u,r);if(h)return ol(h,l);for(var d=u.nextSibling,p=a?a.nodeValue.length-r:0;d;d=d.nextSibling){if(h=n(d,d.firstChild,0))return ol(E(h.line,h.ch-p),l);p+=d.textContent.length}for(var v=u.previousSibling,m=r;v;v=v.previousSibling){if(h=n(v,v.firstChild,-1))return ol(E(h.line,h.ch+m),l);m+=v.textContent.length}}var ul=navigator.userAgent,cl=navigator.platform,fl=/gecko\/\d/i.test(ul),hl=/MSIE \d/.test(ul),dl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ul),pl=/Edge\/(\d+)/.exec(ul),gl=hl||dl||pl,vl=gl&&(hl?document.documentMode||6:+(pl||dl)[1]),ml=!pl&&/WebKit\//.test(ul),yl=ml&&/Qt\/\d+\.\d+/.test(ul),bl=!pl&&/Chrome\//.test(ul),wl=/Opera\//.test(ul),xl=/Apple Computer/.test(navigator.vendor),Cl=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ul),Sl=/PhantomJS/.test(ul),Ll=!pl&&/AppleWebKit/.test(ul)&&/Mobile\/\w+/.test(ul),kl=/Android/.test(ul),Tl=Ll||kl||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ul),Ml=Ll||/Mac/.test(cl),Nl=/\bCrOS\b/.test(ul),Ol=/win/i.test(cl),Al=wl&&ul.match(/Version\/(\d*\.\d*)/);Al&&(Al=Number(Al[1])),Al&&Al>=15&&(wl=!1,ml=!0);var Wl,Dl=Ml&&(yl||wl&&(null==Al||Al<12.11)),Hl=fl||gl&&vl>=9,Fl=function(t,r){var n=t.className,i=e(r).exec(n);if(i){var o=n.slice(i.index+i[0].length);t.className=n.slice(0,i.index)+(o?i[1]+o:"")}};Wl=document.createRange?function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};var El=function(e){e.select()};Ll?El=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:gl&&(El=function(e){try{e.select()}catch(e){}});var Pl=function(){this.id=null};Pl.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Il,zl,Rl=30,Bl={toString:function(){return"CodeMirror.Pass"}},Gl={scroll:!1},Ul={origin:"*mouse"},Vl={origin:"+move"},Kl=[""],jl=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Xl=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Yl=!1,_l=!1,$l=null,ql=function(){function e(e){return e<=247?r.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?n.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function t(e,t,r){this.level=e,this.from=t,this.to=r}var r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,l=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;return function(r,n){var u="ltr"==n?"L":"R";if(0==r.length||"ltr"==n&&!i.test(r))return!1;for(var c=r.length,f=[],h=0;h<c;++h)f.push(e(r.charCodeAt(h)));for(var d=0,p=u;d<c;++d){var v=f[d];"m"==v?f[d]=p:p=v}for(var m=0,y=u;m<c;++m){var b=f[m];"1"==b&&"r"==y?f[m]="n":l.test(b)&&(y=b,"r"==b&&(f[m]="R"))}for(var w=1,x=f[0];w<c-1;++w){var C=f[w];"+"==C&&"1"==x&&"1"==f[w+1]?f[w]="1":","!=C||x!=f[w+1]||"1"!=x&&"n"!=x||(f[w]=x),x=C}for(var S=0;S<c;++S){var L=f[S];if(","==L)f[S]="N";else if("%"==L){var k=void 0;for(k=S+1;k<c&&"%"==f[k];++k);for(var T=S&&"!"==f[S-1]||k<c&&"1"==f[k]?"1":"N",M=S;M<k;++M)f[M]=T;S=k-1}}for(var N=0,O=u;N<c;++N){var A=f[N];"L"==O&&"1"==A?f[N]="L":l.test(A)&&(O=A)}for(var W=0;W<c;++W)if(o.test(f[W])){var D=void 0;for(D=W+1;D<c&&o.test(f[D]);++D);for(var H="L"==(W?f[W-1]:u),F=H==("L"==(D<c?f[D]:u))?H?"L":"R":u,E=W;E<D;++E)f[E]=F;W=D-1}for(var P,I=[],z=0;z<c;)if(s.test(f[z])){var R=z;for(++z;z<c&&s.test(f[z]);++z);I.push(new t(0,R,z))}else{var B=z,G=I.length;for(++z;z<c&&"L"!=f[z];++z);for(var U=B;U<z;)if(a.test(f[U])){B<U&&I.splice(G,0,new t(1,B,U));var V=U;for(++U;U<z&&a.test(f[U]);++U);I.splice(G,0,new t(2,V,U)),B=U}else++U;B<z&&I.splice(G,0,new t(1,B,z))}return 1==I[0].level&&(P=r.match(/^\s+/))&&(I[0].from=P[0].length,I.unshift(new t(0,0,P[0].length))),1==g(I).level&&(P=r.match(/\s+$/))&&(g(I).to-=P[0].length,I.push(new t(0,c-P[0].length,c))),"rtl"==n?I.reverse():I}}(),Zl=[],Ql=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Zl).concat(r)}},Jl=function(){if(gl&&vl<9)return!1;var e=n("div");return"draggable"in e||"dragDrop"in e}(),es=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),l=o.indexOf("\r");-1!=l?(r.push(o.slice(0,l)),t+=l+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},ts=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},rs=function(){var e=n("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),ns=null,is={},os={},ls={},ss=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};ss.prototype.eol=function(){return this.pos>=this.string.length},ss.prototype.sol=function(){return this.pos==this.lineStart},ss.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ss.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ss.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},ss.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},ss.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},ss.prototype.skipToEnd=function(){this.pos=this.string.length},ss.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},ss.prototype.backUp=function(e){this.pos-=e},ss.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=f(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.indentation=function(){return f(this.string,null,this.tabSize)-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.match=function(e,t,r){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var i=function(e){return r?e.toLowerCase():e};if(i(this.string.substr(this.pos,e.length))==i(e))return!1!==t&&(this.pos+=e.length),!0},ss.prototype.current=function(){return this.string.slice(this.start,this.pos)},ss.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},ss.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var as=function(e,t){this.state=e,this.lookAhead=t},us=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0};us.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},us.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},us.fromSaved=function(e,t,r){return t instanceof as?new us(e,Ke(e.mode,t.state),r,t.lookAhead):new us(e,Ke(e.mode,t),r)},us.prototype.save=function(e){var t=!1!==e?Ke(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new as(t,this.maxLookAhead):t};var cs=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r},fs=function(e,t,r){this.text=e,ne(this,t),this.height=r?r(this):1};fs.prototype.lineNo=function(){return W(this)},Ae(fs);var hs,ds={},ps={},gs=null,vs=null,ms={left:0,right:0,top:0,bottom:0},ys=function(e,t,r){this.cm=r;var i=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(i),e(o),Ql(i,"scroll",function(){i.clientHeight&&t(i.scrollTop,"vertical")}),Ql(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,gl&&vl<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};ys.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},ys.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},ys.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},ys.prototype.zeroWidthHack=function(){var e=Ml&&!Cl?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Pl,this.disableVert=new Pl},ys.prototype.enableZeroWidthBar=function(e,t,r){function n(){var i=e.getBoundingClientRect();("vert"==r?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}e.style.pointerEvents="auto",t.set(1e3,n)},ys.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var bs=function(){};bs.prototype.update=function(){return{bottom:0,right:0}},bs.prototype.setScrollLeft=function(){},bs.prototype.setScrollTop=function(){},bs.prototype.clear=function(){};var ws={native:ys,null:bs},xs=0,Cs=function(e,t,r){var n=e.display;this.viewport=t,this.visible=Ir(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Rt(e),this.force=r,this.dims=br(e),this.events=[]};Cs.prototype.signal=function(e,t){Oe(e,t)&&this.events.push(arguments)},Cs.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Te.apply(null,e.events[t])};var Ss=0,Ls=null;gl?Ls=-.53:fl?Ls=15:bl?Ls=-.7:xl&&(Ls=-1/3);var ks=function(e,t){this.ranges=e,this.primIndex=t};ks.prototype.primary=function(){return this.ranges[this.primIndex]},ks.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var r=0;r<this.ranges.length;r++){var n=t.ranges[r],i=e.ranges[r];if(!I(n.anchor,i.anchor)||!I(n.head,i.head))return!1}return!0},ks.prototype.deepCopy=function(){for(var e=this,t=[],r=0;r<this.ranges.length;r++)t[r]=new Ts(z(e.ranges[r].anchor),z(e.ranges[r].head));return new ks(t,this.primIndex)},ks.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},ks.prototype.contains=function(e,t){var r=this;t||(t=e);for(var n=0;n<this.ranges.length;n++){var i=r.ranges[n];if(P(t,i.from())>=0&&P(e,i.to())<=0)return n}return-1};var Ts=function(e,t){this.anchor=e,this.head=t};Ts.prototype.from=function(){return B(this.anchor,this.head)},Ts.prototype.to=function(){return R(this.anchor,this.head)},Ts.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Bi.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=this,n=e,i=e+t;n<i;++n){var o=r.lines[n];r.height-=o.height,ot(o),bt(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){var n=this;this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=n},iterN:function(e,t,r){for(var n=this,i=e+t;e<i;++e)if(r(n.lines[e]))return!0}},Gi.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var r=this;this.size-=t;for(var n=0;n<this.children.length;++n){var i=r.children[n],o=i.chunkSize();if(e<o){var l=Math.min(t,o-e),s=i.height;if(i.removeInner(e,l),r.height-=s-i.height,o==l&&(r.children.splice(n--,1),i.parent=null),0==(t-=l))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Bi))){var a=[];this.collapse(a),this.children=[new Bi(a)],this.children[0].parent=this}},collapse:function(e){for(var t=this,r=0;r<this.children.length;++r)t.children[r].collapse(e)},insertInner:function(e,t,r){var n=this;this.size+=t.length,this.height+=r;for(var i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<=l){if(o.insertInner(e,t,r),o.lines&&o.lines.length>50){for(var s=o.lines.length%25+25,a=s;a<o.lines.length;){var u=new Bi(o.lines.slice(a,a+=25));o.height-=u.height,n.children.splice(++i,0,u),u.parent=n}o.lines=o.lines.slice(0,s),n.maybeSpill()}break}e-=l}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Gi(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var r=h(e.parent.children,e);e.parent.children.splice(r+1,0,t)}else{var n=new Gi(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=this,i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<l){var s=Math.min(t,l-e);if(o.iterN(e,s,r))return!0;if(0==(t-=s))break;e=0}else e-=l}}};var Ms=function(e,t,r){var n=this;if(r)for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);this.doc=e,this.node=t};Ms.prototype.clear=function(){var e=this,t=this.doc.cm,r=this.line.widgets,n=this.line,i=W(n);if(null!=i&&r){for(var o=0;o<r.length;++o)r[o]==e&&r.splice(o--,1);r.length||(n.widgets=null);var l=Ht(this);A(n,Math.max(0,n.height-l)),t&&(hn(t,function(){Ui(t,n,-l),mn(t,i,"widget")}),bt(t,"lineWidgetCleared",t,this,i))}},Ms.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Ht(this)-t;i&&(A(n,n.height+i),r&&hn(r,function(){r.curOp.forceUpdate=!0,Ui(r,n,i),bt(r,"lineWidgetChanged",r,e,W(n))}))},Ae(Ms);var Ns=0,Os=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ns};Os.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,r=t&&!t.curOp;if(r&&nn(t),Oe(this,"clear")){var n=this.find();n&&bt(this,"clear",n.from,n.to)}for(var i=null,o=null,l=0;l<this.lines.length;++l){var s=e.lines[l],a=_(s.markedSpans,e);t&&!e.collapsed?mn(t,W(s),"text"):t&&(null!=a.to&&(o=W(s)),null!=a.from&&(i=W(s))),s.markedSpans=$(s.markedSpans,a),null==a.from&&e.collapsed&&!ve(e.doc,s)&&t&&A(s,mr(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var u=0;u<this.lines.length;++u){var c=fe(e.lines[u]),f=be(c);f>t.display.maxLineLength&&(t.display.maxLine=c,t.display.maxLineLength=f,t.display.maxLineChanged=!0)}null!=i&&t&&this.collapsed&&vn(t,i,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ci(t.doc)),t&&bt(t,"markerCleared",t,this,i,o),r&&on(t),this.parent&&this.parent.clear()}},Os.prototype.find=function(e,t){var r=this;null==e&&"bookmark"==this.type&&(e=1);for(var n,i,o=0;o<this.lines.length;++o){var l=r.lines[o],s=_(l.markedSpans,r);if(null!=s.from&&(n=E(t?l:W(l),s.from),-1==e))return n;if(null!=s.to&&(i=E(t?l:W(l),s.to),1==e))return i}return n&&{from:n,to:i}},Os.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;t&&n&&hn(n,function(){var i=t.line,o=W(t.line),l=jt(n,o);if(l&&(Qt(l),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ve(r.doc,i)&&null!=r.height){var s=r.height;r.height=null;var a=Ht(r)-s;a&&A(i,i.height+a)}bt(n,"markerChanged",n,e)})},Os.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=h(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Os.prototype.detachLine=function(e){if(this.lines.splice(h(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Ae(Os);var As=function(e,t){var r=this;this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=r};As.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();bt(this,"clear")}},As.prototype.find=function(e,t){return this.primary.find(e,t)},Ae(As);var Ws=0,Ds=function(e,t,r,n,i){if(!(this instanceof Ds))return new Ds(e,t,r,n,i);null==r&&(r=0),Gi.call(this,[new Bi([new fs("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=E(r,0);this.sel=Rn(o),this.history=new Jn(null),this.id=++Ws,this.modeOption=t,this.lineSep=n,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),_n(this,{from:o,to:o,text:e}),bi(this,Rn(o),Gl)};Ds.prototype=b(Gi.prototype,{constructor:Ds,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=O(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:gn(function(e){var t=E(this.first,0),r=this.first+this.size-1;Oi(this,{from:t,to:E(r,M(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Xr(this.cm,0,0),bi(this,Rn(t),Gl)}),replaceRange:function(e,t,r,n){Ei(this,e,t=U(this,t),r=r?U(this,r):t,n)},getRange:function(e,t,r){var n=N(this,U(this,e),U(this,t));return!1===r?n:n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(H(this,e))return M(this,e)},getLineNumber:function(e){return W(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=M(this,e)),fe(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return U(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:gn(function(e,t,r){vi(this,U(this,"number"==typeof e?E(e,t||0):e),null,r)}),setSelection:gn(function(e,t,r){vi(this,U(this,e),U(this,t||e),r)}),extendSelection:gn(function(e,t,r){di(this,U(this,e),t&&U(this,t),r)}),extendSelections:gn(function(e,t){pi(this,K(this,e),t)}),extendSelectionsBy:gn(function(e,t){pi(this,K(this,v(this.sel.ranges,e)),t)}),setSelections:gn(function(e,t,r){var n=this;if(e.length){for(var i=[],o=0;o<e.length;o++)i[o]=new Ts(U(n,e[o].anchor),U(n,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),bi(this,zn(i,t),r)}}),addSelection:gn(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Ts(U(this,e),U(this,t||e))),bi(this,zn(n,n.length-1),r)}),getSelection:function(e){for(var t,r=this,n=this.sel.ranges,i=0;i<n.length;i++){var o=N(r,n[i].from(),n[i].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,r=[],n=this.sel.ranges,i=0;i<n.length;i++){var o=N(t,n[i].from(),n[i].to());!1!==e&&(o=o.join(e||t.lineSeparator())),r[i]=o}return r},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:gn(function(e,t,r){for(var n=this,i=[],o=this.sel,l=0;l<o.ranges.length;l++){var s=o.ranges[l];i[l]={from:s.from(),to:s.to(),text:n.splitLines(e[l]),origin:r}}for(var a=t&&"end"!=t&&Kn(this,i,t),u=i.length-1;u>=0;u--)Oi(n,i[u]);a?yi(this,a):this.cm&&jr(this.cm)}),undo:gn(function(){Wi(this,"undo")}),redo:gn(function(){Wi(this,"redo")}),undoSelection:gn(function(){Wi(this,"undo",!0)}),redoSelection:gn(function(){Wi(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){this.history=new Jn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:fi(this.history.done),undone:fi(this.history.undone)}},setHistory:function(e){var t=this.history=new Jn(this.history.maxGeneration);t.done=fi(e.done.slice(0),null,!0),t.undone=fi(e.undone.slice(0),null,!0)},setGutterMarker:gn(function(e,t,r){return Ri(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&C(n)&&(e.gutterMarkers=null),!0})}),clearGutter:gn(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&Ri(t,r,"gutter",function(){return r.gutterMarkers[e]=null,C(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!H(this,e))return null;if(t=e,!(e=M(this,e)))return null}else if(null==(t=W(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass";if(t[i]){if(e(n).test(t[i]))return!1;t[i]+=" "+n}else t[i]=n;return!0})}),removeLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass",o=t[i];if(!o)return!1;if(null==n)t[i]=null;else{var l=o.match(e(n));if(!l)return!1;var s=l.index+l[0].length;t[i]=o.slice(0,l.index)+(l.index&&s!=o.length?" ":"")+o.slice(s)||null}return!0})}),addLineWidget:gn(function(e,t,r){return Vi(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return Ki(this,U(this,e),U(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=U(this,e),Ki(this,e,e,r,"bookmark")},findMarksAt:function(e){var t=[],r=M(this,(e=U(this,e)).line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=U(this,e),t=U(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var l=o.markedSpans;if(l)for(var s=0;s<l.length;s++){var a=l[s];null!=a.to&&i==e.line&&e.ch>=a.to||null==a.from&&i!=e.line||null!=a.from&&i==t.line&&a.from>=t.ch||r&&!r(a.marker)||n.push(a.marker.parent||a.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),U(this,E(r,t))},indexFromPos:function(e){var t=(e=U(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+r}),t},copy:function(e){var t=new Ds(O(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Ds(O(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Yi(n,Xi(this)),n},unlinkDoc:function(e){var t=this;if(e instanceof jo&&(e=e.doc),this.linked)for(var r=0;r<this.linked.length;++r)if(t.linked[r].doc==e){t.linked.splice(r,1),e.unlinkDoc(t),_i(Xi(t));break}if(e.history==this.history){var n=[e.id];$n(e,function(e){return n.push(e.id)},!0),e.history=new Jn(null),e.history.done=fi(this.history.done,n),e.history.undone=fi(this.history.undone,n)}},iterLinkedDocs:function(e){$n(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):es(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:gn(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Qn(this.cm))})}),Ds.prototype.eachLine=Ds.prototype.iter;for(var Hs=0,Fs=!1,Es={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ps=0;Ps<10;Ps++)Es[Ps+48]=Es[Ps+96]=String(Ps);for(var Is=65;Is<=90;Is++)Es[Is]=String.fromCharCode(Is);for(var zs=1;zs<=12;zs++)Es[zs+111]=Es[zs+63235]="F"+zs;var Rs={};Rs.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Rs.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Rs.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Rs.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Rs.default=Ml?Rs.macDefault:Rs.pcDefault;var Bs={selectAll:Mi,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Gl)},killLine:function(e){return co(e,function(t){if(t.empty()){var r=M(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:E(t.head.line+1,0)}:{from:t.head,to:E(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return co(e,function(t){return{from:E(t.from().line,0),to:U(e.doc,E(t.to().line+1,0))}})},delLineLeft:function(e){return co(e,function(e){return{from:E(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:r},"div"),to:t.from()}})},delWrappedLineRight:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(E(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(E(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return vo(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return yo(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return mo(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},Vl)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},Vl)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?yo(e,t.head):n},Vl)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),l=f(e.getLine(o.line),o.ch,n);t.push(p(n-l%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return hn(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=M(e.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new E(i.line,i.ch-1)),i.ch>0)i=new E(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),E(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var l=M(e.doc,i.line-1).text;l&&(i=new E(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+l.charAt(l.length-1),E(i.line-1,l.length-1),i,"+transpose"))}r.push(new Ts(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return hn(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);jr(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Gs=new Pl,Us=null,Vs=function(e,t,r){this.time=e,this.pos=t,this.button=r};Vs.prototype.compare=function(e,t,r){return this.time+400>e&&0==P(t,this.pos)&&r==this.button};var Ks,js,Xs={toString:function(){return"CodeMirror.Init"}},Ys={},_s={};jo.defaults=Ys,jo.optionHandlers=_s;var $s=[];jo.defineInitHook=function(e){return $s.push(e)};var qs=null,Zs=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Pl,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Zs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation(function(){i.setSelections(t.ranges,0,Gl),i.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var r=qs.text.join("\n");if(e.clipboardData.setData("Text",r),e.clipboardData.getData("Text")==r)return void e.preventDefault()}var l=el(),s=l.firstChild;i.display.lineSpace.insertBefore(l,i.display.lineSpace.firstChild),s.value=qs.text.join("\n");var a=document.activeElement;El(s),setTimeout(function(){i.display.lineSpace.removeChild(l),a.focus(),a==o&&n.showPrimarySelection()},50)}}var r=this,n=this,i=n.cm,o=n.div=e.lineDiv;Jo(o,i.options.spellcheck),Ql(o,"paste",function(e){Me(i,e)||qo(e,i)||vl<=11&&setTimeout(dn(i,function(){return r.updateFromDOM()}),20)}),Ql(o,"compositionstart",function(e){r.composing={data:e.data,done:!1}}),Ql(o,"compositionupdate",function(e){r.composing||(r.composing={data:e.data,done:!1})}),Ql(o,"compositionend",function(e){r.composing&&(e.data!=r.composing.data&&r.readFromDOMSoon(),r.composing.done=!0)}),Ql(o,"touchstart",function(){return n.forceCompositionEnd()}),Ql(o,"input",function(){r.composing||r.readFromDOMSoon()}),Ql(o,"copy",t),Ql(o,"cut",t)},Zs.prototype.prepareSelection=function(){var e=Tr(this.cm,!1);return e.focus=this.cm.state.focused,e},Zs.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Zs.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom)e.removeAllRanges();else{var o=sl(t,e.anchorNode,e.anchorOffset),l=sl(t,e.focusNode,e.focusOffset);if(!o||o.bad||!l||l.bad||0!=P(B(o,l),n)||0!=P(R(o,l),i)){var s=t.display.view,a=n.line>=t.display.viewFrom&&nl(t,n)||{node:s[0].measure.map[2],offset:0},u=i.line<t.display.viewTo&&nl(t,i);if(!u){var c=s[s.length-1].measure,f=c.maps?c.maps[c.maps.length-1]:c.map;u={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}}if(a&&u){var h,d=e.rangeCount&&e.getRangeAt(0);try{h=Wl(a.node,a.offset,u.offset,u.node)}catch(e){}h&&(!fl&&t.state.focused?(e.collapse(a.node,a.offset),h.collapsed||(e.removeAllRanges(),e.addRange(h))):(e.removeAllRanges(),e.addRange(h)),d&&null==e.anchorNode?e.addRange(d):fl&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Zs.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Zs.prototype.showMultipleSelections=function(e){r(this.cm.display.cursorDiv,e.cursors),r(this.cm.display.selectionDiv,e.selection)},Zs.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Zs.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return o(this.div,t)},Zs.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Zs.prototype.blur=function(){this.div.blur()},Zs.prototype.getField=function(){return this.div},Zs.prototype.supportsTouch=function(){return!0},Zs.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():hn(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Zs.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Zs.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(kl&&bl&&this.cm.options.gutters.length&&il(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var r=sl(t,e.anchorNode,e.anchorOffset),n=sl(t,e.focusNode,e.focusOffset);r&&n&&hn(t,function(){bi(t.doc,Rn(r,n),Gl),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},Zs.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,r=e.doc.sel.primary(),n=r.from(),i=r.to();if(0==n.ch&&n.line>e.firstLine()&&(n=E(n.line-1,M(e.doc,n.line-1).length)),i.ch==M(e.doc,i.line).text.length&&i.line<e.lastLine()&&(i=E(i.line+1,0)),n.line<t.viewFrom||i.line>t.viewTo-1)return!1;var o,l,s;n.line==t.viewFrom||0==(o=Lr(e,n.line))?(l=W(t.view[0].line),s=t.view[0].node):(l=W(t.view[o].line),s=t.view[o-1].node.nextSibling);var a,u,c=Lr(e,i.line);if(c==t.view.length-1?(a=t.viewTo-1,u=t.lineDiv.lastChild):(a=W(t.view[c+1].line)-1,u=t.view[c+1].node.previousSibling),!s)return!1;for(var f=e.doc.splitLines(ll(e,s,u,l,a)),h=N(e.doc,E(l,0),E(a,M(e.doc,a).text.length));f.length>1&&h.length>1;)if(g(f)==g(h))f.pop(),h.pop(),a--;else{if(f[0]!=h[0])break;f.shift(),h.shift(),l++}for(var d=0,p=0,v=f[0],m=h[0],y=Math.min(v.length,m.length);d<y&&v.charCodeAt(d)==m.charCodeAt(d);)++d;for(var b=g(f),w=g(h),x=Math.min(b.length-(1==f.length?d:0),w.length-(1==h.length?d:0));p<x&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)++p;if(1==f.length&&1==h.length&&l==n.line)for(;d&&d>n.ch&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)d--,p++;f[f.length-1]=b.slice(0,b.length-p).replace(/^\u200b+/,""),f[0]=f[0].slice(d).replace(/\u200b+$/,"");var C=E(l,d),S=E(a,h.length?g(h).length-p:0);return f.length>1||f[0]||P(C,S)?(Ei(e.doc,f,C,S,"+input"),!0):void 0},Zs.prototype.ensurePolled=function(){this.forceCompositionEnd()},Zs.prototype.reset=function(){this.forceCompositionEnd()},Zs.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Zs.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Zs.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||hn(this.cm,function(){return vn(e.cm)})},Zs.prototype.setUneditable=function(e){e.contentEditable="false"},Zs.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||dn(this.cm,$o)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Zs.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Zs.prototype.onContextMenu=function(){},Zs.prototype.resetPosition=function(){},Zs.prototype.needsContentAttribute=!0;var Qs=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Pl,this.hasSelection=!1,this.composing=null};Qs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type?i.setSelections(t.ranges,null,Gl):(n.prevInput="",l.value=t.text.join("\n"),El(l))}"cut"==e.type&&(i.state.cutIncoming=!0)}}var r=this,n=this,i=this.cm,o=this.wrapper=el(),l=this.textarea=o.firstChild;e.wrapper.insertBefore(o,e.wrapper.firstChild),Ll&&(l.style.width="0px"),Ql(l,"input",function(){gl&&vl>=9&&r.hasSelection&&(r.hasSelection=null),n.poll()}),Ql(l,"paste",function(e){Me(i,e)||qo(e,i)||(i.state.pasteIncoming=!0,n.fastPoll())}),Ql(l,"cut",t),Ql(l,"copy",t),Ql(e.scroller,"paste",function(t){Ft(e,t)||Me(i,t)||(i.state.pasteIncoming=!0,n.focus())}),Ql(e.lineSpace,"selectstart",function(t){Ft(e,t)||We(t)}),Ql(l,"compositionstart",function(){var e=i.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}}),Ql(l,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Qs.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=Tr(e);if(e.options.moveInputWithCursor){var i=sr(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),l=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+l.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+l.left-o.left))}return n},Qs.prototype.showSelection=function(e){var t=this.cm.display;r(t.cursorDiv,e.cursors),r(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Qs.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&El(this.textarea),gl&&vl>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",gl&&vl>=9&&(this.hasSelection=null))}},Qs.prototype.getField=function(){return this.textarea},Qs.prototype.supportsTouch=function(){return!1},Qs.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Tl||l()!=this.textarea))try{this.textarea.focus()}catch(e){}},Qs.prototype.blur=function(){this.textarea.blur()},Qs.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Qs.prototype.receivedFocus=function(){this.slowPoll()},Qs.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Qs.prototype.fastPoll=function(){function e(){r.poll()||t?(r.pollingFast=!1,r.slowPoll()):(t=!0,r.polling.set(60,e))}var t=!1,r=this;r.pollingFast=!0,r.polling.set(20,e)},Qs.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||ts(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(gl&&vl>=9&&this.hasSelection===i||Ml&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(8203!=o||n||(n="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,s=Math.min(n.length,i.length);l<s&&n.charCodeAt(l)==i.charCodeAt(l);)++l;return hn(t,function(){$o(t,i.slice(l),n.length-l,null,e.composing?"*compose":null),i.length>1e3||i.indexOf("\n")>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Qs.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Qs.prototype.onKeyPress=function(){gl&&vl>=9&&(this.hasSelection=null),this.fastPoll()},Qs.prototype.onContextMenu=function(e){function t(){if(null!=l.selectionStart){var e=i.somethingSelected(),t="​"+(e?l.value:"");l.value="⇚",l.value=t,n.prevInput=e?"":"​",l.selectionStart=1,l.selectionEnd=t.length,o.selForContextMenu=i.doc.sel}}function r(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=c,l.style.cssText=u,gl&&vl<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=a),null!=l.selectionStart){(!gl||gl&&vl<9)&&t();var e=0,r=function(){o.selForContextMenu==i.doc.sel&&0==l.selectionStart&&l.selectionEnd>0&&"​"==n.prevInput?dn(i,Mi)(i):e++<10?o.detectingSelectAll=setTimeout(r,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(r,200)}}var n=this,i=n.cm,o=i.display,l=n.textarea,s=Sr(i,e),a=o.scroller.scrollTop;if(s&&!wl){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(s)&&dn(i,bi)(i.doc,Rn(s),Gl);var u=l.style.cssText,c=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var f=n.wrapper.getBoundingClientRect();l.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(gl?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var h;if(ml&&(h=window.scrollY),o.input.focus(),ml&&window.scrollTo(null,h),o.input.reset(),i.somethingSelected()||(l.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=i.doc.sel,clearTimeout(o.detectingSelectAll),gl&&vl>=9&&t(),Hl){Fe(e);var d=function(){ke(window,"mouseup",d),setTimeout(r,20)};Ql(window,"mouseup",d)}else setTimeout(r,50)}},Qs.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Qs.prototype.setUneditable=function(){},Qs.prototype.needsContentAttribute=!1,function(e){function t(t,n,i,o){e.defaults[t]=n,i&&(r[t]=o?function(e,t,r){r!=Xs&&i(e,t,r)}:i)}var r=e.optionHandlers;e.defineOption=t,e.Init=Xs,t("value","",function(e,t){return e.setValue(t)},!0),t("mode",null,function(e,t){e.doc.modeOption=t,jn(e)},!0),t("indentUnit",2,jn,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(e){Xn(e),er(e),vn(e)},!0),t("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var r=[],n=e.doc.first;e.doc.iter(function(e){for(var i=0;;){var o=e.text.indexOf(t,i);if(-1==o)break;i=o+t.length,r.push(E(n,o))}n++});for(var i=r.length-1;i>=0;i--)Ei(e.doc,t,r[i],E(r[i].line,r[i].ch+t.length))}}),t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),r!=Xs&&e.refresh()}),t("specialCharPlaceholder",at,function(e){return e.refresh()},!0),t("electricChars",!0),t("inputStyle",Tl?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),t("rtlMoveVisually",!Ol),t("wholeLineUpdateBefore",!0),t("theme","default",function(e){Go(e),Uo(e)},!0),t("keyMap","default",function(e,t,r){var n=uo(t),i=r!=Xs&&uo(r);i&&i.detach&&i.detach(e,n),n.attach&&n.attach(e,i||null)}),t("extraKeys",null),t("configureMouse",null),t("lineWrapping",!1,Ko,!0),t("gutters",[],function(e){Fn(e.options),Uo(e)},!0),t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?wr(e.display)+"px":"0",e.refresh()},!0),t("coverGutterNextToScrollbar",!1,function(e){return en(e)},!0),t("scrollbarStyle","native",function(e){rn(e),en(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),t("lineNumbers",!1,function(e){Fn(e.options),Uo(e)},!0),t("firstLineNumber",1,Uo,!0),t("lineNumberFormatter",function(e){return e},Uo,!0),t("showCursorWhenSelecting",!1,kr,!0),t("resetSelectionOnContextMenu",!0),t("lineWiseCopyCut",!0),t("pasteLinesPerSelection",!0),t("readOnly",!1,function(e,t){"nocursor"==t&&(Fr(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),t("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),t("dragDrop",!0,Vo),t("allowDropFileTypes",null),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1,kr,!0),t("singleCursorHeightPerLine",!0,kr,!0),t("workTime",100),t("workDelay",100),t("flattenSpans",!0,Xn,!0),t("addModeClass",!1,Xn,!0),t("pollInterval",100),t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),t("historyEventDelay",1250),t("viewportMargin",10,function(e){return e.refresh()},!0),t("maxHighlightLength",1e4,Xn,!0),t("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),t("autofocus",null),t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}(jo),function(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,r){var n=this.options,i=n[e];n[e]==r&&"mode"!=e||(n[e]=r,t.hasOwnProperty(e)&&dn(this,t[e])(this,r,i),Te(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](uo(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||t[r].name==e)return t.splice(r,1),!0},addOverlay:pn(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");m(this.state.overlays,{mode:n,modeSpec:t,opaque:r&&r.opaque,priority:r&&r.priority||0},function(e){return e.priority}),this.state.modeGen++,vn(this)}),removeOverlay:pn(function(e){for(var t=this,r=this.state.overlays,n=0;n<r.length;++n){var i=r[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return r.splice(n,1),t.state.modeGen++,void vn(t)}}),indentLine:pn(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),H(this.doc,e)&&Yo(this,e,t,r)}),indentSelection:pn(function(e){for(var t=this,r=this.doc.sel.ranges,n=-1,i=0;i<r.length;i++){var o=r[i];if(o.empty())o.head.line>n&&(Yo(t,o.head.line,e,!0),n=o.head.line,i==t.doc.sel.primIndex&&jr(t));else{var l=o.from(),s=o.to(),a=Math.max(n,l.line);n=Math.min(t.lastLine(),s.line-(s.ch?0:1))+1;for(var u=a;u<n;++u)Yo(t,u,e);var c=t.doc.sel.ranges;0==l.ch&&r.length==c.length&&c[i].from().ch>0&&gi(t.doc,i,new Ts(l,c[i].to()),Gl)}}}),getTokenAt:function(e,t){return Je(this,e,t)},getLineTokens:function(e,t){return Je(this,E(e),t,!0)},getTokenTypeAt:function(e){e=U(this.doc,e);var t,r=_e(this,M(this.doc,e.line)),n=0,i=(r.length-1)/2,o=e.ch;if(0==o)t=r[2];else for(;;){var l=n+i>>1;if((l?r[2*l-1]:0)>=o)i=l;else{if(!(r[2*l+1]<o)){t=r[2*l+2];break}n=l+1}}var s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=this,i=[];if(!r.hasOwnProperty(t))return i;var o=r[t],l=this.getModeAt(e);if("string"==typeof l[t])o[l[t]]&&i.push(o[l[t]]);else if(l[t])for(var s=0;s<l[t].length;s++){var a=o[l[t][s]];a&&i.push(a)}else l.helperType&&o[l.helperType]?i.push(o[l.helperType]):o[l.name]&&i.push(o[l.name]);for(var u=0;u<o._global.length;u++){var c=o._global[u];c.pred(l,n)&&-1==h(i,c.val)&&i.push(c.val)}return i},getStateAfter:function(e,t){var r=this.doc;return e=G(r,null==e?r.first+r.size-1:e),$e(this,e+1,t).state},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();return r=null==e?n.head:"object"==typeof e?U(this.doc,e):e?n.from():n.to(),sr(this,r,t||"page")},charCoords:function(e,t){return lr(this,U(this.doc,e),t||"page")},coordsChar:function(e,t){return e=or(this,e,t||"page"),cr(this,e.left,e.top)},lineAtHeight:function(e,t){return e=or(this,{top:e,left:0},t||"page").top,D(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n,i=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,i=!0),n=M(this.doc,e)}else n=e;return ir(this,n,{top:0,left:0},t||"page",r||i).top+(i?this.doc.height-ye(n):0)},defaultTextHeight:function(){return mr(this.display)},defaultCharWidth:function(){return yr(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o=this.display,l=(e=sr(this,U(this.doc,e))).bottom,s=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)l=e.top;else if("above"==n||"near"==n){var a=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>a)&&e.top>t.offsetHeight?l=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=a&&(l=e.bottom),s+t.offsetWidth>u&&(s=u-t.offsetWidth)}t.style.top=l+"px",t.style.left=t.style.right="","right"==i?(s=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?s=0:"middle"==i&&(s=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),r&&Ur(this,{left:s,top:l,right:s+t.offsetWidth,bottom:l+t.offsetHeight})},triggerOnKeyDown:pn(Lo),triggerOnKeyPress:pn(Mo),triggerOnKeyUp:To,triggerOnMouseDown:pn(Oo),execCommand:function(e){if(Bs.hasOwnProperty(e))return Bs[e].call(null,this)},triggerElectric:pn(function(e){Zo(this,e)}),findPosH:function(e,t,r,n){var i=this,o=1;t<0&&(o=-1,t=-t);for(var l=U(this.doc,e),s=0;s<t&&!(l=tl(i.doc,l,o,r,n)).hitSide;++s);return l},moveH:pn(function(e,t){var r=this;this.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?tl(r.doc,n.head,e,t,r.options.rtlMoveVisually):e<0?n.from():n.to()},Vl)}),deleteH:pn(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):co(this,function(r){var i=tl(n,r.head,e,t,!1);return e<0?{from:i,to:r.head}:{from:r.head,to:i}})}),findPosV:function(e,t,r,n){var i=this,o=1,l=n;t<0&&(o=-1,t=-t);for(var s=U(this.doc,e),a=0;a<t;++a){var u=sr(i,s,"div");if(null==l?l=u.left:u.left=l,(s=rl(i,u,o,r)).hitSide)break}return s},moveV:pn(function(e,t){var r=this,n=this.doc,i=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(l){if(o)return e<0?l.from():l.to();var s=sr(r,l.head,"div");null!=l.goalColumn&&(s.left=l.goalColumn),i.push(s.left);var a=rl(r,s,e,t);return"page"==t&&l==n.sel.primary()&&Kr(r,lr(r,a,"div").top-s.top),a},Vl),i.length)for(var l=0;l<n.sel.ranges.length;l++)n.sel.ranges[l].goalColumn=i[l]}),findWordAt:function(e){var t=M(this.doc,e.line).text,r=e.ch,n=e.ch;if(t){var i=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!r?++n:--r;for(var o=t.charAt(r),l=x(o,i)?function(e){return x(e,i)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!x(e)};r>0&&l(t.charAt(r-1));)--r;for(;n<t.length&&l(t.charAt(n));)++n}return new Ts(E(e.line,r),E(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?s(this.display.cursorDiv,"CodeMirror-overwrite"):Fl(this.display.cursorDiv,"CodeMirror-overwrite"),Te(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==l()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pn(function(e,t){Xr(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-zt(this)-this.display.barHeight,width:e.scrollWidth-zt(this)-this.display.barWidth,clientHeight:Bt(this),clientWidth:Rt(this)}},scrollIntoView:pn(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:E(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Yr(this,e):$r(this,e.from,e.to,e.margin)}),setSize:pn(function(e,t){var r=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Jt(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){mn(r,i,"widget");break}++i}),this.curOp.forceUpdate=!0,Te(this,"refresh",this)}),operation:function(e){return hn(this,e)},startOperation:function(){return nn(this)},endOperation:function(){return on(this)},refresh:pn(function(){var e=this.display.cachedTextHeight;vn(this),this.curOp.forceUpdate=!0,er(this),Xr(this,this.doc.scrollLeft,this.doc.scrollTop),Wn(this),(null==e||Math.abs(e-mr(this.display))>.5)&&Cr(this),Te(this,"refresh",this)}),swapDoc:pn(function(e){var t=this.doc;return t.cm=null,qn(this,e),er(this),this.display.input.reset(),Xr(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,bt(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ae(e),e.registerHelper=function(t,n,i){r.hasOwnProperty(t)||(r[t]=e[t]={_global:[]}),r[t][n]=i},e.registerGlobalHelper=function(t,n,i,o){e.registerHelper(t,n,o),r[t]._global.push({pred:i,val:o})}}(jo);var Js="iter insert remove copy getEditor constructor".split(" ");for(var ea in Ds.prototype)Ds.prototype.hasOwnProperty(ea)&&h(Js,ea)<0&&(jo.prototype[ea]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ds.prototype[ea]));return Ae(Ds),jo.inputStyles={textarea:Qs,contenteditable:Zs},jo.defineMode=function(e){jo.defaults.mode||"null"==e||(jo.defaults.mode=e),Be.apply(this,arguments)},jo.defineMIME=function(e,t){os[e]=t},jo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),jo.defineMIME("text/plain","null"),jo.defineExtension=function(e,t){jo.prototype[e]=t},jo.defineDocExtension=function(e,t){Ds.prototype[e]=t},jo.fromTextArea=function(e,t){function r(){e.value=a.getValue()}if(t=t?c(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=l();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}var i;if(e.form&&(Ql(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var s=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=s}}catch(e){}}t.finishInit=function(t){t.save=r,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,r(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(ke(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=i))}},e.style.display="none";var a=jo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return a},function(e){e.off=ke,e.on=Ql,e.wheelEventPixels=Pn,e.Doc=Ds,e.splitLines=es,e.countColumn=f,e.findColumn=d,e.isWordChar=w,e.Pass=Bl,e.signal=Te,e.Line=fs,e.changeEnd=Bn,e.scrollbarModel=ws,e.Pos=E,e.cmpPos=P,e.modes=is,e.mimeModes=os,e.resolveMode=Ge,e.getMode=Ue,e.modeExtensions=ls,e.extendMode=Ve,e.copyState=Ke,e.startState=Xe,e.innerMode=je,e.commands=Bs,e.keyMap=Rs,e.keyName=ao,e.isModifierKey=lo,e.lookupKey=oo,e.normalizeKeyMap=io,e.StringStream=ss,e.SharedTextMarker=As,e.TextMarker=Os,e.LineWidget=Ms,e.e_preventDefault=We,e.e_stopPropagation=De,e.e_stop=Fe,e.addClass=s,e.contains=o,e.rmClass=Fl,e.keyNames=Es}(jo),jo.version="5.30.0",jo});
      !function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t,n,r,o,a){this.indented=e,this.column=t,this.type=n,this.info=r,this.align=o,this.prev=a}function n(e,n,r,o){var a=e.indented;return e.context&&"statement"==e.context.type&&"statement"!=r&&(a=e.context.indented),e.context=new t(a,n,r,o,null,e.context)}function r(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}function o(e,t,n){return"variable"==t.prevToken||"type"==t.prevToken||(!!/\S(?:[^- ]>|[*\]])\s*$|\*$/.test(e.string.slice(0,n))||(!(!t.typeAtEndOfLine||e.column()!=e.indentation())||void 0))}function a(e){for(;;){if(!e||"top"==e.type)return!0;if("}"==e.type&&"namespace"!=e.prev.info)return!1;e=e.prev}}function i(e){for(var t={},n=e.split(" "),r=0;r<n.length;++r)t[n[r]]=!0;return t}function l(e,t){return"function"==typeof e?e(t):e.propertyIsEnumerable(t)}function s(e,t){if(!t.startOfLine)return!1;for(var n,r=null;n=e.peek();){if("\\"==n&&e.match(/^.$/)){r=s;break}if("/"==n&&e.match(/^\/[\/\*]/,!1))break;e.next()}return t.tokenize=r,"meta"}function c(e,t){return"type"==t.prevToken&&"type"}function u(e){return e.eatWhile(/[\w\.']/),"number"}function d(e,t){if(e.backUp(1),e.match(/(R|u8R|uR|UR|LR)/)){var n=e.match(/"([^\s\\()]{0,16})\(/);return!!n&&(t.cpp11RawStringDelim=n[1],t.tokenize=m,m(e,t))}return e.match(/(u8|u|U|L)/)?!!e.match(/["']/,!1)&&"string":(e.next(),!1)}function f(e){var t=/(\w+)::~?(\w+)$/.exec(e);return t&&t[1]==t[2]}function p(e,t){for(var n;null!=(n=e.next());)if('"'==n&&!e.eat('"')){t.tokenize=null;break}return"string"}function m(e,t){var n=t.cpp11RawStringDelim.replace(/[^\w\s]/g,"\\$&");return e.match(new RegExp(".*?\\)"+n+'"'))?t.tokenize=null:e.skipToEnd(),"string"}function h(t,n){function r(e){if(e)for(var t in e)e.hasOwnProperty(t)&&o.push(t)}"string"==typeof t&&(t=[t]);var o=[];r(n.keywords),r(n.types),r(n.builtin),r(n.atoms),o.length&&(n.helperType=t[0],e.registerHelper("hintWords",t[0],o));for(var a=0;a<t.length;++a)e.defineMIME(t[a],n)}function g(e,t){for(var n=!1;!e.eol();){if(!n&&e.match('"""')){t.tokenize=null;break}n="\\"==e.next()&&!n}return"string"}function y(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!e&&!o&&t.match('"')){a=!0;break}if(e&&t.match('"""')){a=!0;break}r=t.next(),!o&&"$"==r&&t.match("{")&&t.skipTo("}"),o=!o&&"\\"==r&&!e}return!a&&e||(n.tokenize=null),"string"}}function x(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!o&&t.match('"')&&("single"==e||t.match('""'))){a=!0;break}if(!o&&t.match("``")){w=x(e),a=!0;break}r=t.next(),o="single"==e&&!o&&"\\"==r}return a&&(n.tokenize=null),"string"}}e.defineMode("clike",function(i,s){function c(e,t){var n=e.next();if(S[n]){var r=S[n](e,t);if(!1!==r)return r}if('"'==n||"'"==n)return t.tokenize=u(n),t.tokenize(e,t);if(D.test(n))return p=n,null;if(L.test(n)){if(e.backUp(1),e.match(I))return"number";e.next()}if("/"==n){if(e.eat("*"))return t.tokenize=d,d(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if(F.test(n)){for(;!e.match(/^\/[\/*]/,!1)&&e.eat(F););return"operator"}if(e.eatWhile(z),P)for(;e.match(P);)e.eatWhile(z);var o=e.current();return l(x,o)?(l(w,o)&&(p="newstatement"),l(v,o)&&(m=!0),"keyword"):l(b,o)?"type":l(k,o)?(l(w,o)&&(p="newstatement"),"builtin"):l(_,o)?"atom":"variable"}function u(e){return function(t,n){for(var r,o=!1,a=!1;null!=(r=t.next());){if(r==e&&!o){a=!0;break}o=!o&&"\\"==r}return(a||!o&&!C)&&(n.tokenize=null),"string"}}function d(e,t){for(var n,r=!1;n=e.next();){if("/"==n&&r){t.tokenize=null;break}r="*"==n}return"comment"}function f(e,t){s.typeFirstDefinitions&&e.eol()&&a(t.context)&&(t.typeAtEndOfLine=o(e,t,e.pos))}var p,m,h=i.indentUnit,g=s.statementIndentUnit||h,y=s.dontAlignCalls,x=s.keywords||{},b=s.types||{},k=s.builtin||{},w=s.blockKeywords||{},v=s.defKeywords||{},_=s.atoms||{},S=s.hooks||{},C=s.multiLineStrings,T=!1!==s.indentStatements,M=!1!==s.indentSwitch,P=s.namespaceSeparator,D=s.isPunctuationChar||/[\[\]{}\(\),;\:\.]/,L=s.numberStart||/[\d\.]/,I=s.number||/^(?:0x[a-f\d]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[-+]?\d+)?)(u|ll?|l|f)?/i,F=s.isOperatorChar||/[+\-*&%=<>!?|\/]/,z=s.isIdentifierChar||/[\w\$_\xa1-\uffff]/;return{startState:function(e){return{tokenize:null,context:new t((e||0)-h,0,"top",null,!1),indented:0,startOfLine:!0,prevToken:null}},token:function(e,t){var i=t.context;if(e.sol()&&(null==i.align&&(i.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return f(e,t),null;p=m=null;var l=(t.tokenize||c)(e,t);if("comment"==l||"meta"==l)return l;if(null==i.align&&(i.align=!0),";"==p||":"==p||","==p&&e.match(/^\s*(?:\/\/.*)?$/,!1))for(;"statement"==t.context.type;)r(t);else if("{"==p)n(t,e.column(),"}");else if("["==p)n(t,e.column(),"]");else if("("==p)n(t,e.column(),")");else if("}"==p){for(;"statement"==i.type;)i=r(t);for("}"==i.type&&(i=r(t));"statement"==i.type;)i=r(t)}else p==i.type?r(t):T&&(("}"==i.type||"top"==i.type)&&";"!=p||"statement"==i.type&&"newstatement"==p)&&n(t,e.column(),"statement",e.current());if("variable"==l&&("def"==t.prevToken||s.typeFirstDefinitions&&o(e,t,e.start)&&a(t.context)&&e.match(/^\s*\(/,!1))&&(l="def"),S.token){var u=S.token(e,t,l);void 0!==u&&(l=u)}return"def"==l&&!1===s.styleDefs&&(l="variable"),t.startOfLine=!1,t.prevToken=m?"def":l||p,f(e,t),l},indent:function(t,n){if(t.tokenize!=c&&null!=t.tokenize||t.typeAtEndOfLine)return e.Pass;var r=t.context,o=n&&n.charAt(0);if("statement"==r.type&&"}"==o&&(r=r.prev),s.dontIndentStatements)for(;"statement"==r.type&&s.dontIndentStatements.test(r.info);)r=r.prev;if(S.indent){var a=S.indent(t,r,n);if("number"==typeof a)return a}var i=o==r.type,l=r.prev&&"switch"==r.prev.info;if(s.allmanIndentation&&/[{(]/.test(o)){for(;"top"!=r.type&&"}"!=r.type;)r=r.prev;return r.indented}return"statement"==r.type?r.indented+("{"==o?0:g):!r.align||y&&")"==r.type?")"!=r.type||i?r.indented+(i?0:h)+(i||!l||/^(?:case|default)\b/.test(n)?0:h):r.indented+g:r.column+(i?0:1)},electricInput:M?/^\s*(?:case .*?:|default:|\{\}?|\})$/:/^\s*[{}]$/,blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//",fold:"brace"}});var b="auto if break case register continue return default do sizeof static else struct switch extern typedef union for goto while enum const volatile",k="int long char short double float unsigned signed void size_t ptrdiff_t";h(["text/x-csrc","text/x-c","text/x-chdr"],{name:"clike",keywords:i(b),types:i(k+" bool _Complex _Bool float_t double_t intptr_t intmax_t int8_t int16_t int32_t int64_t uintptr_t uintmax_t uint8_t uint16_t uint32_t uint64_t"),blockKeywords:i("case do else for if switch while struct"),defKeywords:i("struct"),typeFirstDefinitions:!0,atoms:i("null true false"),hooks:{"#":s,"*":c},modeProps:{fold:["brace","include"]}}),h(["text/x-c++src","text/x-c++hdr"],{name:"clike",keywords:i(b+" asm dynamic_cast namespace reinterpret_cast try explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected alignas alignof constexpr decltype nullptr noexcept thread_local final static_assert override"),types:i(k+" bool wchar_t"),blockKeywords:i("catch class do else finally for if struct switch try while"),defKeywords:i("class namespace struct enum union"),typeFirstDefinitions:!0,atoms:i("true false null"),dontIndentStatements:/^template$/,isIdentifierChar:/[\w\$_~\xa1-\uffff]/,hooks:{"#":s,"*":c,u:d,U:d,L:d,R:d,0:u,1:u,2:u,3:u,4:u,5:u,6:u,7:u,8:u,9:u,token:function(e,t,n){if("variable"==n&&"("==e.peek()&&(";"==t.prevToken||null==t.prevToken||"}"==t.prevToken)&&f(e.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),h("text/x-java",{name:"clike",keywords:i("abstract assert break case catch class const continue default do else enum extends final finally float for goto if implements import instanceof interface native new package private protected public return static strictfp super switch synchronized this throw throws transient try volatile while @interface"),types:i("byte short int long float double boolean char void Boolean Byte Character Double Float Integer Long Number Object Short String StringBuffer StringBuilder Void"),blockKeywords:i("catch class do else finally for if switch try while"),defKeywords:i("class interface package enum @interface"),typeFirstDefinitions:!0,atoms:i("true false null"),number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,hooks:{"@":function(e){return!e.match("interface",!1)&&(e.eatWhile(/[\w\$_]/),"meta")}},modeProps:{fold:["brace","import"]}}),h("text/x-csharp",{name:"clike",keywords:i("abstract as async await base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in interface internal is lock namespace new operator out override params private protected public readonly ref return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),types:i("Action Boolean Byte Char DateTime DateTimeOffset Decimal Double Func Guid Int16 Int32 Int64 Object SByte Single String Task TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),blockKeywords:i("catch class do else finally for foreach if struct switch try while"),defKeywords:i("class interface namespace struct var"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"@":function(e,t){return e.eat('"')?(t.tokenize=p,p(e,t)):(e.eatWhile(/[\w\$_]/),"meta")}}}),h("text/x-scala",{name:"clike",keywords:i("abstract case catch class def do else extends final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try type val var while with yield _ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble"),types:i("AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Int Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),multiLineStrings:!0,blockKeywords:i("catch class enum do else finally for forSome if match switch try while"),defKeywords:i("class enum def object package trait type val var"),atoms:i("true false null"),indentStatements:!1,indentSwitch:!1,isOperatorChar:/[+\-*&%=<>!?|\/#:@]/,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return!!e.match('""')&&(t.tokenize=g,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},"=":function(e,n){var r=n.context;return!("}"!=r.type||!r.align||!e.eat(">"))&&(n.context=new t(r.indented,r.column,r.type,r.info,null,r.prev),"operator")}},modeProps:{closeBrackets:{triples:'"'}}}),h("text/x-kotlin",{name:"clike",keywords:i("package as typealias class interface this super val var fun for is in This throw return break continue object if else while do try when !in !is as? file import where by get set abstract enum open inner override private public internal protected catch finally out final vararg reified dynamic companion constructor init sealed field property receiver param sparam lateinit data inline noinline tailrec external annotation crossinline const operator infix suspend"),types:i("Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),intendSwitch:!1,indentStatements:!1,multiLineStrings:!0,number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,blockKeywords:i("catch class do else finally for if where try while enum"),defKeywords:i("class val var object package interface fun"),atoms:i("true false null this"),hooks:{'"':function(e,t){return t.tokenize=y(e.match('""')),t.tokenize(e,t)}},modeProps:{closeBrackets:{triples:'"'}}}),h(["x-shader/x-vertex","x-shader/x-fragment"],{name:"clike",keywords:i("sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),types:i("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4"),blockKeywords:i("for while do if else struct"),builtin:i("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),atoms:i("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TexureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),indentSwitch:!1,hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-nesc",{name:"clike",keywords:i(b+"as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),types:i(k),blockKeywords:i("case do else for if switch while struct"),atoms:i("null true false"),hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-objectivec",{name:"clike",keywords:i(b+"inline restrict _Bool _Complex _Imaginary BOOL Class bycopy byref id IMP in inout nil oneway out Protocol SEL self super atomic nonatomic retain copy readwrite readonly"),types:i(k),atoms:i("YES NO NULL NILL ON OFF true false"),hooks:{"@":function(e){return e.eatWhile(/[\w\$]/),"keyword"},"#":s,indent:function(e,t,n){if("statement"==t.type&&/^@\w/.test(n))return t.indented}},modeProps:{fold:"brace"}}),h("text/x-squirrel",{name:"clike",keywords:i("base break clone continue const default delete enum extends function in class foreach local resume return this throw typeof yield constructor instanceof static"),types:i(k),blockKeywords:i("case catch class else for foreach if switch try while"),defKeywords:i("function local class"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"#":s},modeProps:{fold:["brace","include"]}});var w=null;h("text/x-ceylon",{name:"clike",keywords:i("abstracts alias assembly assert assign break case catch class continue dynamic else exists extends finally for function given if import in interface is let module new nonempty object of out outer package return satisfies super switch then this throw try value void while"),types:function(e){var t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()},blockKeywords:i("case catch class dynamic else finally for function if interface module new object switch try while"),defKeywords:i("class dynamic function interface module object package value"),builtin:i("abstract actual aliased annotation by default deprecated doc final formal late license native optional sealed see serializable shared suppressWarnings tagged throws variable"),isPunctuationChar:/[\[\]{}\(\),;\:\.`]/,isOperatorChar:/[+\-*&%=<>!?|^~:\/]/,numberStart:/[\d#$]/,number:/^(?:#[\da-fA-F_]+|\$[01_]+|[\d_]+[kMGTPmunpf]?|[\d_]+\.[\d_]+(?:[eE][-+]?\d+|[kMGTPmunpf]|)|)/i,multiLineStrings:!0,typeFirstDefinitions:!0,atoms:i("true false null larger smaller equal empty finished"),indentSwitch:!1,styleDefs:!1,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return t.tokenize=x(e.match('""')?"triple":"single"),t.tokenize(e,t)},"`":function(e,t){return!(!w||!e.match("`"))&&(t.tokenize=w,w=null,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},token:function(e,t,n){if(("variable"==n||"type"==n)&&"."==t.prevToken)return"variable-2"}},modeProps:{fold:["brace","import"],closeBrackets:{triples:'"'}}})});
      // -------------------------------------------------------------------------
//  Part of the CodeChecker project, under the Apache License v2.0 with
//  LLVM Exceptions. See LICENSE for license information.
//  SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
// -------------------------------------------------------------------------

var BugViewer = {
  _files : [],
  _reports : [],
  _lineWidgets : [],
  _navigationMenuItems : [],
  _sourceFileData : null,
  _currentReport : null,
  _lastBugEvent  : null,

  init : function (files, reports) {
    this._files = files;
    this._reports = reports;

    this.initEscapeChars();
  },

  initEscapeChars : function () {
    this.escapeChars = {
      ' ' : 'nbsp',
      '<' : 'lt',
      '>' : 'gt',
      '"' : 'quot',
      '&' : 'amp'
    };

    var regexString = '[';
    for (var key in this.escapeChars) {
      regexString += key;
    }
    regexString += ']';

    this.escapeRegExp = new RegExp( regexString, 'g');
  },

  escapeHTML : function (str) {
    var that = this;

    return str.replace(this.escapeRegExp, function (m) {
      return '&' + that.escapeChars[m] + ';';
    });
  },

  initByUrl : function () {
    if (!this._reports) return;

    var state = {};
    window.location.hash.substr(1).split('&').forEach(function (s) {
      var parts = s.split('=');
      state[parts[0]] = parts[1];
    });

    for (var key in this._reports) {
      var report = this._reports[key];
      if (report.reportHash === state['reportHash']) {
        this.navigate(report);
        return;
      }
    }

    this.navigate(this._reports[0]);
  },

  create : function () {
    this._content = document.getElementById('editor-wrapper');
    this._filepath = document.getElementById('file-path');
    this._checkerName = document.getElementById('checker-name');
    this._reviewStatusWrapper =
      document.getElementById('review-status-wrapper');
    this._reviewStatus = document.getElementById('review-status');
    this._editor = document.getElementById('editor');

    this._codeMirror = CodeMirror(this._editor, {
      mode: 'text/x-c++src',
      matchBrackets : true,
      lineNumbers : true,
      readOnly : true,
      foldGutter : true,
      extraKeys : {},
      viewportMargin : 100
    });

    this._createNavigationMenu();
  },

  navigate : function (report, item) {
    if (!item) {
      var items = this._navigationMenuItems.filter(function (navItem) {
        return navItem.report.reportHash === report.reportHash;
      });

      if (!items.length) return;

      item = items[0].widget;
    }

    this._selectedReport.classList.remove('active');
    this._selectedReport = item;
    this._selectedReport.classList.add('active');
    this.setReport(report);
  },

  _createNavigationMenu : function () {
    var that = this;

    var nav = document.getElementById('report-nav');
    var list = document.createElement('ul');
    this._reports.forEach(function (report) {
      var events = report['events'];
      var lastBugEvent = events[events.length - 1];
      var item = document.createElement('li');

      var severity = document.createElement('i');
      severity.className = 'severity-' + report.severity.toLowerCase();

      item.appendChild(severity);
      item.appendChild(document.createTextNode(lastBugEvent.message));

      item.addEventListener('click', function () {
        that.navigate(report, item);
      })
      list.appendChild(item);
      that._navigationMenuItems.push({ report : report, widget : item });
    });

    if (!this._selectedReport && list.childNodes.length) {
      this._selectedReport = list.childNodes[0];
      this._selectedReport.classList.add('active');
    }

    nav.appendChild(list);
  },

  setReport : function (report) {
    this._currentReport = report;
    var events = report['events'];
    var lastBugEvent = events[events.length - 1];
    this.setCurrentBugEvent(lastBugEvent, events.length - 1);
    this.setCheckerName(report.checkerName);
    this.setReviewStatus(report.reviewStatus);

    window.location.hash = '#reportHash=' + report.reportHash;
  },

  setCurrentBugEvent : function (event, idx) {
    this._currentBugEvent = event;
    this.setSourceFileData(this._files[event.location.file]);
    this.drawBugPath();

    this.jumpTo(event.location.line, 0);
    this.highlightBugEvent(event, idx);
  },

  highlightBugEvent : function (event, idx) {
    this._lineWidgets.forEach(function (widget) {
      var lineIdx = widget.node.getAttribute('idx');
      if (parseInt(lineIdx) === idx) {
        widget.node.classList.add('current');
      }
    });
  },

  setCheckerName : function (checkerName) {
    this._checkerName.innerHTML = checkerName;
  },

  setReviewStatus : function (status) {
    if (status) {
      var className =
        'review-status-' + status.toLowerCase().split(' ').join('-');
      this._reviewStatus.className = "review-status " + className;

      this._reviewStatus.innerHTML = status;
      this._reviewStatusWrapper.style.display = 'block';
    } else {
      this._reviewStatusWrapper.style.display = 'none';
    }
  },

  setSourceFileData : function (file) {
    if (this._sourceFileData && file.id === this._sourceFileData.id) {
      return;
    }

    this._sourceFileData = file;
    this._filepath.innerHTML = file.path;
    this._codeMirror.doc.setValue(file.content);
    this._refresh();
  },

  _refresh : function () {
    var that = this;
    setTimeout(function () {
      var fullHeight = parseInt(that._content.clientHeight);
      var headerHeight = that._filepath.clientHeight;

      that._codeMirror.setSize('auto', fullHeight - headerHeight);
      that._codeMirror.refresh();
    }, 200);
  },

  clearBubbles : function () {
    this._lineWidgets.forEach(function (widget) { widget.clear(); });
    this._lineWidgets = [];
  },

  getMessage : function (event, kind) {
    if (kind === 'macro') {
      var name = 'macro expansion' + (event.name ? ': ' + event.name : '');

      return '<span class="tag macro">' + name + '</span>'
        + this.escapeHTML(event.expansion).replace(/(?:\r\n|\r|\n)/g, '<br>');
    } else if (kind === 'note') {
      return '<span class="tag note">note</span>'
        +  this.escapeHTML(event.message).replace(/(?:\r\n|\r|\n)/g, '<br>');
    }
  },

  addExtraPathEvents : function (events, kind) {
    var that = this;

    if (!events) {
      return;
    }

    events.forEach(function (event) {
      if (event.location.file !== that._currentBugEvent.location.file) {
        return;
      }

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + kind);

      var msg = document.createElement('span');
      msg.innerHTML = that.getMessage(event, kind);
      element.appendChild(msg);

      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  drawBugPath : function () {
    var that = this;

    this.clearBubbles();

    this.addExtraPathEvents(this._currentReport.macros, 'macro');
    this.addExtraPathEvents(this._currentReport.notes, 'note');

    // Processing bug path events.
    var currentEvents = this._currentReport.events;
    currentEvents.forEach(function (event, step) {
      if (event.location.file !== that._currentBugEvent.location.file)
        return;

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';
      var type = step === currentEvents.length - 1 ? 'error' : 'info';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + type);
      element.setAttribute('idx', step);

      var enumeration = document.createElement('span');
      enumeration.setAttribute('class', 'checker-enum ' + type);
      enumeration.innerHTML = step + 1;

      if (currentEvents.length > 1)
        element.appendChild(enumeration);

      var prevBugEvent = step - 1;
      if (step > 0) {
        var prevBug = document.createElement('span');
        prevBug.setAttribute('class', 'arrow left-arrow');
        prevBug.addEventListener('click', function () {
          var event = currentEvents[prevBugEvent];
          that.setCurrentBugEvent(event, prevBugEvent);
        });
        element.appendChild(prevBug);
      }

      var msg = document.createElement('span');
      msg.innerHTML = that.escapeHTML(event.message)
        .replace(/(?:\r\n|\r|\n)/g, '<br>');

      element.appendChild(msg);

      var nextBugEvent = step + 1;
      if (nextBugEvent < currentEvents.length) {
        var nextBug = document.createElement('span');
        nextBug.setAttribute('class', 'arrow right-arrow');
        nextBug.addEventListener('click', function () {
          var event = currentEvents[nextBugEvent];
          that.setCurrentBugEvent(event, nextBugEvent);
        });
        element.appendChild(nextBug);
      }


      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  jumpTo : function (line, column) {
    var that = this;

    setTimeout(function () {
      var selPosPixel
        = that._codeMirror.charCoords({ line : line, ch : column }, 'local');
      var editorSize = {
        width  : that._editor.clientWidth,
        height : that._editor.clientHeight
      };

      that._codeMirror.scrollIntoView({
        top    : selPosPixel.top - 100,
        bottom : selPosPixel.top + editorSize.height - 150,
        left   : selPosPixel.left < editorSize.width - 100
               ? 0
               : selPosPixel.left - 50,
        right  : selPosPixel.left < editorSize.width - 100
               ? 10
               : selPosPixel.left + editorSize.width - 100
      });
    }, 0);
  }
}


      var data = {"files": {"0": {"id": 0, "path": "/src/drivers/scsi/qla2xxx/qla_def.h", "content": "/* SPDX-License-Identifier: GPL-2.0-only */\n/*\n * QLogic Fibre Channel HBA Driver\n * Copyright (c)  2003-2014 QLogic Corporation\n */\n#ifndef __QLA_DEF_H\n#define __QLA_DEF_H\n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/types.h>\n#include <linux/module.h>\n#include <linux/list.h>\n#include <linux/pci.h>\n#include <linux/dma-mapping.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/dmapool.h>\n#include <linux/mempool.h>\n#include <linux/spinlock.h>\n#include <linux/completion.h>\n#include <linux/interrupt.h>\n#include <linux/workqueue.h>\n#include <linux/firmware.h>\n#include <linux/aer.h>\n#include <linux/mutex.h>\n#include <linux/btree.h>\n\n#include <scsi/scsi.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi_transport_fc.h>\n#include <scsi/scsi_bsg_fc.h>\n\n#include <uapi/scsi/fc/fc_els.h>\n\n/* Big endian Fibre Channel S_ID (source ID) or D_ID (destination ID). */\ntypedef struct {\n\tuint8_t domain;\n\tuint8_t area;\n\tuint8_t al_pa;\n} be_id_t;\n\n/* Little endian Fibre Channel S_ID (source ID) or D_ID (destination ID). */\ntypedef struct {\n\tuint8_t al_pa;\n\tuint8_t area;\n\tuint8_t domain;\n} le_id_t;\n\n#include \"qla_bsg.h\"\n#include \"qla_dsd.h\"\n#include \"qla_nx.h\"\n#include \"qla_nx2.h\"\n#include \"qla_nvme.h\"\n#define QLA2XXX_DRIVER_NAME\t\"qla2xxx\"\n#define QLA2XXX_APIDEV\t\t\"ql2xapidev\"\n#define QLA2XXX_MANUFACTURER\t\"QLogic Corporation\"\n\n/*\n * We have MAILBOX_REGISTER_COUNT sized arrays in a few places,\n * but that's fine as we don't look at the last 24 ones for\n * ISP2100 HBAs.\n */\n#define MAILBOX_REGISTER_COUNT_2100\t8\n#define MAILBOX_REGISTER_COUNT_2200\t24\n#define MAILBOX_REGISTER_COUNT\t\t32\n\n#define QLA2200A_RISC_ROM_VER\t4\n#define FPM_2300\t\t6\n#define FPM_2310\t\t7\n\n#include \"qla_settings.h\"\n\n#define MODE_DUAL (MODE_TARGET | MODE_INITIATOR)\n\n/*\n * Data bit definitions\n */\n#define BIT_0\t0x1\n#define BIT_1\t0x2\n#define BIT_2\t0x4\n#define BIT_3\t0x8\n#define BIT_4\t0x10\n#define BIT_5\t0x20\n#define BIT_6\t0x40\n#define BIT_7\t0x80\n#define BIT_8\t0x100\n#define BIT_9\t0x200\n#define BIT_10\t0x400\n#define BIT_11\t0x800\n#define BIT_12\t0x1000\n#define BIT_13\t0x2000\n#define BIT_14\t0x4000\n#define BIT_15\t0x8000\n#define BIT_16\t0x10000\n#define BIT_17\t0x20000\n#define BIT_18\t0x40000\n#define BIT_19\t0x80000\n#define BIT_20\t0x100000\n#define BIT_21\t0x200000\n#define BIT_22\t0x400000\n#define BIT_23\t0x800000\n#define BIT_24\t0x1000000\n#define BIT_25\t0x2000000\n#define BIT_26\t0x4000000\n#define BIT_27\t0x8000000\n#define BIT_28\t0x10000000\n#define BIT_29\t0x20000000\n#define BIT_30\t0x40000000\n#define BIT_31\t0x80000000\n\n#define LSB(x)\t((uint8_t)(x))\n#define MSB(x)\t((uint8_t)((uint16_t)(x) >> 8))\n\n#define LSW(x)\t((uint16_t)(x))\n#define MSW(x)\t((uint16_t)((uint32_t)(x) >> 16))\n\n#define LSD(x)\t((uint32_t)((uint64_t)(x)))\n#define MSD(x)\t((uint32_t)((((uint64_t)(x)) >> 16) >> 16))\n\nstatic inline uint32_t make_handle(uint16_t x, uint16_t y)\n{\n\treturn ((uint32_t)x << 16) | y;\n}\n\n/*\n * I/O register\n*/\n\nstatic inline u8 rd_reg_byte(const volatile u8 __iomem *addr)\n{\n\treturn readb(addr);\n}\n\nstatic inline u16 rd_reg_word(const volatile __le16 __iomem *addr)\n{\n\treturn readw(addr);\n}\n\nstatic inline u32 rd_reg_dword(const volatile __le32 __iomem *addr)\n{\n\treturn readl(addr);\n}\n\nstatic inline u8 rd_reg_byte_relaxed(const volatile u8 __iomem *addr)\n{\n\treturn readb_relaxed(addr);\n}\n\nstatic inline u16 rd_reg_word_relaxed(const volatile __le16 __iomem *addr)\n{\n\treturn readw_relaxed(addr);\n}\n\nstatic inline u32 rd_reg_dword_relaxed(const volatile __le32 __iomem *addr)\n{\n\treturn readl_relaxed(addr);\n}\n\nstatic inline void wrt_reg_byte(volatile u8 __iomem *addr, u8 data)\n{\n\treturn writeb(data, addr);\n}\n\nstatic inline void wrt_reg_word(volatile __le16 __iomem *addr, u16 data)\n{\n\treturn writew(data, addr);\n}\n\nstatic inline void wrt_reg_dword(volatile __le32 __iomem *addr, u32 data)\n{\n\treturn writel(data, addr);\n}\n\n/*\n * ISP83XX specific remote register addresses\n */\n#define QLA83XX_LED_PORT0\t\t\t0x00201320\n#define QLA83XX_LED_PORT1\t\t\t0x00201328\n#define QLA83XX_IDC_DEV_STATE\t\t0x22102384\n#define QLA83XX_IDC_MAJOR_VERSION\t0x22102380\n#define QLA83XX_IDC_MINOR_VERSION\t0x22102398\n#define QLA83XX_IDC_DRV_PRESENCE\t0x22102388\n#define QLA83XX_IDC_DRIVER_ACK\t\t0x2210238c\n#define QLA83XX_IDC_CONTROL\t\t\t0x22102390\n#define QLA83XX_IDC_AUDIT\t\t\t0x22102394\n#define QLA83XX_IDC_LOCK_RECOVERY\t0x2210239c\n#define QLA83XX_DRIVER_LOCKID\t\t0x22102104\n#define QLA83XX_DRIVER_LOCK\t\t\t0x8111c028\n#define QLA83XX_DRIVER_UNLOCK\t\t0x8111c02c\n#define QLA83XX_FLASH_LOCKID\t\t0x22102100\n#define QLA83XX_FLASH_LOCK\t\t\t0x8111c010\n#define QLA83XX_FLASH_UNLOCK\t\t0x8111c014\n#define QLA83XX_DEV_PARTINFO1\t\t0x221023e0\n#define QLA83XX_DEV_PARTINFO2\t\t0x221023e4\n#define QLA83XX_FW_HEARTBEAT\t\t0x221020b0\n#define QLA83XX_PEG_HALT_STATUS1\t0x221020a8\n#define QLA83XX_PEG_HALT_STATUS2\t0x221020ac\n\n/* 83XX: Macros defining 8200 AEN Reason codes */\n#define IDC_DEVICE_STATE_CHANGE BIT_0\n#define IDC_PEG_HALT_STATUS_CHANGE BIT_1\n#define IDC_NIC_FW_REPORTED_FAILURE BIT_2\n#define IDC_HEARTBEAT_FAILURE BIT_3\n\n/* 83XX: Macros defining 8200 AEN Error-levels */\n#define ERR_LEVEL_NON_FATAL 0x1\n#define ERR_LEVEL_RECOVERABLE_FATAL 0x2\n#define ERR_LEVEL_UNRECOVERABLE_FATAL 0x4\n\n/* 83XX: Macros for IDC Version */\n#define QLA83XX_SUPP_IDC_MAJOR_VERSION 0x01\n#define QLA83XX_SUPP_IDC_MINOR_VERSION 0x0\n\n/* 83XX: Macros for scheduling dpc tasks */\n#define QLA83XX_NIC_CORE_RESET 0x1\n#define QLA83XX_IDC_STATE_HANDLER 0x2\n#define QLA83XX_NIC_CORE_UNRECOVERABLE 0x3\n\n/* 83XX: Macros for defining IDC-Control bits */\n#define QLA83XX_IDC_RESET_DISABLED BIT_0\n#define QLA83XX_IDC_GRACEFUL_RESET BIT_1\n\n/* 83XX: Macros for different timeouts */\n#define QLA83XX_IDC_INITIALIZATION_TIMEOUT 30\n#define QLA83XX_IDC_RESET_ACK_TIMEOUT 10\n#define QLA83XX_MAX_LOCK_RECOVERY_WAIT (2 * HZ)\n\n/* 83XX: Macros for defining class in DEV-Partition Info register */\n#define QLA83XX_CLASS_TYPE_NONE\t\t0x0\n#define QLA83XX_CLASS_TYPE_NIC\t\t0x1\n#define QLA83XX_CLASS_TYPE_FCOE\t\t0x2\n#define QLA83XX_CLASS_TYPE_ISCSI\t0x3\n\n/* 83XX: Macros for IDC Lock-Recovery stages */\n#define IDC_LOCK_RECOVERY_STAGE1\t0x1 /* Stage1: Intent for\n\t\t\t\t\t     * lock-recovery\n\t\t\t\t\t     */\n#define IDC_LOCK_RECOVERY_STAGE2\t0x2 /* Stage2: Perform lock-recovery */\n\n/* 83XX: Macros for IDC Audit type */\n#define IDC_AUDIT_TIMESTAMP\t\t0x0 /* IDC-AUDIT: Record timestamp of\n\t\t\t\t\t     * dev-state change to NEED-RESET\n\t\t\t\t\t     * or NEED-QUIESCENT\n\t\t\t\t\t     */\n#define IDC_AUDIT_COMPLETION\t\t0x1 /* IDC-AUDIT: Record duration of\n\t\t\t\t\t     * reset-recovery completion is\n\t\t\t\t\t     * second\n\t\t\t\t\t     */\n/* ISP2031: Values for laser on/off */\n#define PORT_0_2031\t0x00201340\n#define PORT_1_2031\t0x00201350\n#define LASER_ON_2031\t0x01800100\n#define LASER_OFF_2031\t0x01800180\n\n/*\n * The ISP2312 v2 chip cannot access the FLASH/GPIO registers via MMIO in an\n * 133Mhz slot.\n */\n#define RD_REG_WORD_PIO(addr)\t\t(inw((unsigned long)addr))\n#define WRT_REG_WORD_PIO(addr, data)\t(outw(data, (unsigned long)addr))\n\n/*\n * Fibre Channel device definitions.\n */\n#define WWN_SIZE\t\t8\t/* Size of WWPN, WWN & WWNN */\n#define MAX_FIBRE_DEVICES_2100\t512\n#define MAX_FIBRE_DEVICES_2400\t2048\n#define MAX_FIBRE_DEVICES_LOOP\t128\n#define MAX_FIBRE_DEVICES_MAX\tMAX_FIBRE_DEVICES_2400\n#define LOOPID_MAP_SIZE\t\t(ha->max_fibre_devices)\n#define MAX_FIBRE_LUNS  \t0xFFFF\n#define\tMAX_HOST_COUNT\t\t16\n\n/*\n * Host adapter default definitions.\n */\n#define MAX_BUSES\t\t1  /* We only have one bus today */\n#define MIN_LUNS\t\t8\n#define MAX_LUNS\t\tMAX_FIBRE_LUNS\n#define MAX_CMDS_PER_LUN\t255\n\n/*\n * Fibre Channel device definitions.\n */\n#define SNS_LAST_LOOP_ID_2100\t0xfe\n#define SNS_LAST_LOOP_ID_2300\t0x7ff\n\n#define LAST_LOCAL_LOOP_ID\t0x7d\n#define SNS_FL_PORT\t\t0x7e\n#define FABRIC_CONTROLLER\t0x7f\n#define SIMPLE_NAME_SERVER\t0x80\n#define SNS_FIRST_LOOP_ID\t0x81\n#define MANAGEMENT_SERVER\t0xfe\n#define BROADCAST\t\t0xff\n\n/*\n * There is no correspondence between an N-PORT id and an AL_PA.  Therefore the\n * valid range of an N-PORT id is 0 through 0x7ef.\n */\n#define NPH_LAST_HANDLE\t\t0x7ee\n#define NPH_MGMT_SERVER\t\t0x7ef\t\t/*  FFFFEF */\n#define NPH_SNS\t\t\t0x7fc\t\t/*  FFFFFC */\n#define NPH_FABRIC_CONTROLLER\t0x7fd\t\t/*  FFFFFD */\n#define NPH_F_PORT\t\t0x7fe\t\t/*  FFFFFE */\n#define NPH_IP_BROADCAST\t0x7ff\t\t/*  FFFFFF */\n\n#define NPH_SNS_LID(ha)\t(IS_FWI2_CAPABLE(ha) ? NPH_SNS : SIMPLE_NAME_SERVER)\n\n#define MAX_CMDSZ\t16\t\t/* SCSI maximum CDB size. */\n#include \"qla_fw.h\"\n\nstruct name_list_extended {\n\tstruct get_name_list_extended *l;\n\tdma_addr_t\t\tldma;\n\tstruct list_head\tfcports;\n\tu32\t\t\tsize;\n\tu8\t\t\tsent;\n};\n/*\n * Timeout timer counts in seconds\n */\n#define PORT_RETRY_TIME\t\t\t1\n#define LOOP_DOWN_TIMEOUT\t\t60\n#define LOOP_DOWN_TIME\t\t\t255\t/* 240 */\n#define\tLOOP_DOWN_RESET\t\t\t(LOOP_DOWN_TIME - 30)\n\n#define DEFAULT_OUTSTANDING_COMMANDS\t4096\n#define MIN_OUTSTANDING_COMMANDS\t128\n\n/* ISP request and response entry counts (37-65535) */\n#define REQUEST_ENTRY_CNT_2100\t\t128\t/* Number of request entries. */\n#define REQUEST_ENTRY_CNT_2200\t\t2048\t/* Number of request entries. */\n#define REQUEST_ENTRY_CNT_24XX\t\t2048\t/* Number of request entries. */\n#define REQUEST_ENTRY_CNT_83XX\t\t8192\t/* Number of request entries. */\n#define RESPONSE_ENTRY_CNT_83XX\t\t4096\t/* Number of response entries.*/\n#define RESPONSE_ENTRY_CNT_2100\t\t64\t/* Number of response entries.*/\n#define RESPONSE_ENTRY_CNT_2300\t\t512\t/* Number of response entries.*/\n#define RESPONSE_ENTRY_CNT_MQ\t\t128\t/* Number of response entries.*/\n#define ATIO_ENTRY_CNT_24XX\t\t4096\t/* Number of ATIO entries. */\n#define RESPONSE_ENTRY_CNT_FX00\t\t256     /* Number of response entries.*/\n#define FW_DEF_EXCHANGES_CNT 2048\n#define FW_MAX_EXCHANGES_CNT (32 * 1024)\n#define REDUCE_EXCHANGES_CNT  (8 * 1024)\n\nstruct req_que;\nstruct qla_tgt_sess;\n\n/*\n * SCSI Request Block\n */\nstruct srb_cmd {\n\tstruct scsi_cmnd *cmd;\t\t/* Linux SCSI command pkt */\n\tuint32_t request_sense_length;\n\tuint32_t fw_sense_length;\n\tuint8_t *request_sense_ptr;\n\tstruct ct6_dsd *ct6_ctx;\n\tstruct crc_context *crc_ctx;\n};\n\n/*\n * SRB flag definitions\n */\n#define SRB_DMA_VALID\t\t\tBIT_0\t/* Command sent to ISP */\n#define SRB_FCP_CMND_DMA_VALID\t\tBIT_12\t/* DIF: DSD List valid */\n#define SRB_CRC_CTX_DMA_VALID\t\tBIT_2\t/* DIF: context DMA valid */\n#define SRB_CRC_PROT_DMA_VALID\t\tBIT_4\t/* DIF: prot DMA valid */\n#define SRB_CRC_CTX_DSD_VALID\t\tBIT_5\t/* DIF: dsd_list valid */\n#define SRB_WAKEUP_ON_COMP\t\tBIT_6\n#define SRB_DIF_BUNDL_DMA_VALID\t\tBIT_7   /* DIF: DMA list valid */\n\n/* To identify if a srb is of T10-CRC type. @sp => srb_t pointer */\n#define IS_PROT_IO(sp)\t(sp->flags & SRB_CRC_CTX_DSD_VALID)\n\n/*\n * 24 bit port ID type definition.\n */\ntypedef union {\n\tuint32_t b24 : 24;\n\n\tstruct {\n#ifdef __BIG_ENDIAN\n\t\tuint8_t domain;\n\t\tuint8_t area;\n\t\tuint8_t al_pa;\n#elif defined(__LITTLE_ENDIAN)\n\t\tuint8_t al_pa;\n\t\tuint8_t area;\n\t\tuint8_t domain;\n#else\n#error \"__BIG_ENDIAN or __LITTLE_ENDIAN must be defined!\"\n#endif\n\t\tuint8_t rsvd_1;\n\t} b;\n} port_id_t;\n#define INVALID_PORT_ID\t0xFFFFFF\n\nstatic inline le_id_t be_id_to_le(be_id_t id)\n{\n\tle_id_t res;\n\n\tres.domain = id.domain;\n\tres.area   = id.area;\n\tres.al_pa  = id.al_pa;\n\n\treturn res;\n}\n\nstatic inline be_id_t le_id_to_be(le_id_t id)\n{\n\tbe_id_t res;\n\n\tres.domain = id.domain;\n\tres.area   = id.area;\n\tres.al_pa  = id.al_pa;\n\n\treturn res;\n}\n\nstatic inline port_id_t be_to_port_id(be_id_t id)\n{\n\tport_id_t res;\n\n\tres.b.domain = id.domain;\n\tres.b.area   = id.area;\n\tres.b.al_pa  = id.al_pa;\n\tres.b.rsvd_1 = 0;\n\n\treturn res;\n}\n\nstatic inline be_id_t port_id_to_be_id(port_id_t port_id)\n{\n\tbe_id_t res;\n\n\tres.domain = port_id.b.domain;\n\tres.area   = port_id.b.area;\n\tres.al_pa  = port_id.b.al_pa;\n\n\treturn res;\n}\n\nstruct els_logo_payload {\n\tuint8_t opcode;\n\tuint8_t rsvd[3];\n\tuint8_t s_id[3];\n\tuint8_t rsvd1[1];\n\tuint8_t wwpn[WWN_SIZE];\n};\n\nstruct els_plogi_payload {\n\tuint8_t opcode;\n\tuint8_t rsvd[3];\n\t__be32\tdata[112 / 4];\n};\n\nstruct ct_arg {\n\tvoid\t\t*iocb;\n\tu16\t\tnport_handle;\n\tdma_addr_t\treq_dma;\n\tdma_addr_t\trsp_dma;\n\tu32\t\treq_size;\n\tu32\t\trsp_size;\n\tu32\t\treq_allocated_size;\n\tu32\t\trsp_allocated_size;\n\tvoid\t\t*req;\n\tvoid\t\t*rsp;\n\tport_id_t\tid;\n};\n\n/*\n * SRB extensions.\n */\nstruct srb_iocb {\n\tunion {\n\t\tstruct {\n\t\t\tuint16_t flags;\n#define SRB_LOGIN_RETRIED\tBIT_0\n#define SRB_LOGIN_COND_PLOGI\tBIT_1\n#define SRB_LOGIN_SKIP_PRLI\tBIT_2\n#define SRB_LOGIN_NVME_PRLI\tBIT_3\n#define SRB_LOGIN_PRLI_ONLY\tBIT_4\n\t\t\tuint16_t data[2];\n\t\t\tu32 iop[2];\n\t\t} logio;\n\t\tstruct {\n#define ELS_DCMD_TIMEOUT 20\n#define ELS_DCMD_LOGO 0x5\n\t\t\tuint32_t flags;\n\t\t\tuint32_t els_cmd;\n\t\t\tstruct completion comp;\n\t\t\tstruct els_logo_payload *els_logo_pyld;\n\t\t\tdma_addr_t els_logo_pyld_dma;\n\t\t} els_logo;\n\t\tstruct els_plogi {\n#define ELS_DCMD_PLOGI 0x3\n\t\t\tuint32_t flags;\n\t\t\tuint32_t els_cmd;\n\t\t\tstruct completion comp;\n\t\t\tstruct els_plogi_payload *els_plogi_pyld;\n\t\t\tstruct els_plogi_payload *els_resp_pyld;\n\t\t\tu32 tx_size;\n\t\t\tu32 rx_size;\n\t\t\tdma_addr_t els_plogi_pyld_dma;\n\t\t\tdma_addr_t els_resp_pyld_dma;\n\t\t\t__le32\tfw_status[3];\n\t\t\t__le16\tcomp_status;\n\t\t\t__le16\tlen;\n\t\t} els_plogi;\n\t\tstruct {\n\t\t\t/*\n\t\t\t * Values for flags field below are as\n\t\t\t * defined in tsk_mgmt_entry struct\n\t\t\t * for control_flags field in qla_fw.h.\n\t\t\t */\n\t\t\tuint64_t lun;\n\t\t\tuint32_t flags;\n\t\t\tuint32_t data;\n\t\t\tstruct completion comp;\n\t\t\t__le16 comp_status;\n\t\t} tmf;\n\t\tstruct {\n#define SRB_FXDISC_REQ_DMA_VALID\tBIT_0\n#define SRB_FXDISC_RESP_DMA_VALID\tBIT_1\n#define SRB_FXDISC_REQ_DWRD_VALID\tBIT_2\n#define SRB_FXDISC_RSP_DWRD_VALID\tBIT_3\n#define FXDISC_TIMEOUT 20\n\t\t\tuint8_t flags;\n\t\t\tuint32_t req_len;\n\t\t\tuint32_t rsp_len;\n\t\t\tvoid *req_addr;\n\t\t\tvoid *rsp_addr;\n\t\t\tdma_addr_t req_dma_handle;\n\t\t\tdma_addr_t rsp_dma_handle;\n\t\t\t__le32 adapter_id;\n\t\t\t__le32 adapter_id_hi;\n\t\t\t__le16 req_func_type;\n\t\t\t__le32 req_data;\n\t\t\t__le32 req_data_extra;\n\t\t\t__le32 result;\n\t\t\t__le32 seq_number;\n\t\t\t__le16 fw_flags;\n\t\t\tstruct completion fxiocb_comp;\n\t\t\t__le32 reserved_0;\n\t\t\tuint8_t reserved_1;\n\t\t} fxiocb;\n\t\tstruct {\n\t\t\tuint32_t cmd_hndl;\n\t\t\t__le16 comp_status;\n\t\t\t__le16 req_que_no;\n\t\t\tstruct completion comp;\n\t\t} abt;\n\t\tstruct ct_arg ctarg;\n#define MAX_IOCB_MB_REG 28\n#define SIZEOF_IOCB_MB_REG (MAX_IOCB_MB_REG * sizeof(uint16_t))\n\t\tstruct {\n\t\t\tu16 in_mb[MAX_IOCB_MB_REG];\t/* from FW */\n\t\t\tu16 out_mb[MAX_IOCB_MB_REG];\t/* to FW */\n\t\t\tvoid *out, *in;\n\t\t\tdma_addr_t out_dma, in_dma;\n\t\t\tstruct completion comp;\n\t\t\tint rc;\n\t\t} mbx;\n\t\tstruct {\n\t\t\tstruct imm_ntfy_from_isp *ntfy;\n\t\t} nack;\n\t\tstruct {\n\t\t\t__le16 comp_status;\n\t\t\t__le16 rsp_pyld_len;\n\t\t\tuint8_t\taen_op;\n\t\t\tvoid *desc;\n\n\t\t\t/* These are only used with ls4 requests */\n\t\t\tint cmd_len;\n\t\t\tint rsp_len;\n\t\t\tdma_addr_t cmd_dma;\n\t\t\tdma_addr_t rsp_dma;\n\t\t\tenum nvmefc_fcp_datadir dir;\n\t\t\tuint32_t dl;\n\t\t\tuint32_t timeout_sec;\n\t\t\tstruct\tlist_head   entry;\n\t\t} nvme;\n\t\tstruct {\n\t\t\tu16 cmd;\n\t\t\tu16 vp_index;\n\t\t} ctrlvp;\n\t} u;\n\n\tstruct timer_list timer;\n\tvoid (*timeout)(void *);\n};\n\n/* Values for srb_ctx type */\n#define SRB_LOGIN_CMD\t1\n#define SRB_LOGOUT_CMD\t2\n#define SRB_ELS_CMD_RPT 3\n#define SRB_ELS_CMD_HST 4\n#define SRB_CT_CMD\t5\n#define SRB_ADISC_CMD\t6\n#define SRB_TM_CMD\t7\n#define SRB_SCSI_CMD\t8\n#define SRB_BIDI_CMD\t9\n#define SRB_FXIOCB_DCMD\t10\n#define SRB_FXIOCB_BCMD\t11\n#define SRB_ABT_CMD\t12\n#define SRB_ELS_DCMD\t13\n#define SRB_MB_IOCB\t14\n#define SRB_CT_PTHRU_CMD 15\n#define SRB_NACK_PLOGI\t16\n#define SRB_NACK_PRLI\t17\n#define SRB_NACK_LOGO\t18\n#define SRB_NVME_CMD\t19\n#define SRB_NVME_LS\t20\n#define SRB_PRLI_CMD\t21\n#define SRB_CTRL_VP\t22\n#define SRB_PRLO_CMD\t23\n\nenum {\n\tTYPE_SRB,\n\tTYPE_TGT_CMD,\n\tTYPE_TGT_TMCMD,\t\t/* task management */\n};\n\nstruct iocb_resource {\n\tu8 res_type;\n\tu8 pad;\n\tu16 iocb_cnt;\n};\n\ntypedef struct srb {\n\t/*\n\t * Do not move cmd_type field, it needs to\n\t * line up with qla_tgt_cmd->cmd_type\n\t */\n\tuint8_t cmd_type;\n\tuint8_t pad[3];\n\tstruct iocb_resource iores;\n\tstruct kref cmd_kref;\t/* need to migrate ref_count over to this */\n\tvoid *priv;\n\twait_queue_head_t nvme_ls_waitq;\n\tstruct fc_port *fcport;\n\tstruct scsi_qla_host *vha;\n\tunsigned int start_timer:1;\n\n\tuint32_t handle;\n\tuint16_t flags;\n\tuint16_t type;\n\tconst char *name;\n\tint iocbs;\n\tstruct qla_qpair *qpair;\n\tstruct srb *cmd_sp;\n\tstruct list_head elem;\n\tu32 gen1;\t/* scratch */\n\tu32 gen2;\t/* scratch */\n\tint rc;\n\tint retry_count;\n\tstruct completion *comp;\n\tunion {\n\t\tstruct srb_iocb iocb_cmd;\n\t\tstruct bsg_job *bsg_job;\n\t\tstruct srb_cmd scmd;\n\t} u;\n\t/*\n\t * Report completion status @res and call sp_put(@sp). @res is\n\t * an NVMe status code, a SCSI result (e.g. DID_OK << 16) or a\n\t * QLA_* status value.\n\t */\n\tvoid (*done)(struct srb *sp, int res);\n\t/* Stop the timer and free @sp. Only used by the FCP code. */\n\tvoid (*free)(struct srb *sp);\n\t/*\n\t * Call nvme_private->fd->done() and free @sp. Only used by the NVMe\n\t * code.\n\t */\n\tvoid (*put_fn)(struct kref *kref);\n} srb_t;\n\n#define GET_CMD_SP(sp) (sp->u.scmd.cmd)\n\n#define GET_CMD_SENSE_LEN(sp) \\\n\t(sp->u.scmd.request_sense_length)\n#define SET_CMD_SENSE_LEN(sp, len) \\\n\t(sp->u.scmd.request_sense_length = len)\n#define GET_CMD_SENSE_PTR(sp) \\\n\t(sp->u.scmd.request_sense_ptr)\n#define SET_CMD_SENSE_PTR(sp, ptr) \\\n\t(sp->u.scmd.request_sense_ptr = ptr)\n#define GET_FW_SENSE_LEN(sp) \\\n\t(sp->u.scmd.fw_sense_length)\n#define SET_FW_SENSE_LEN(sp, len) \\\n\t(sp->u.scmd.fw_sense_length = len)\n\nstruct msg_echo_lb {\n\tdma_addr_t send_dma;\n\tdma_addr_t rcv_dma;\n\tuint16_t req_sg_cnt;\n\tuint16_t rsp_sg_cnt;\n\tuint16_t options;\n\tuint32_t transfer_size;\n\tuint32_t iteration_count;\n};\n\n/*\n * ISP I/O Register Set structure definitions.\n */\nstruct device_reg_2xxx {\n\t__le16\tflash_address; \t/* Flash BIOS address */\n\t__le16\tflash_data;\t\t/* Flash BIOS data */\n\t__le16\tunused_1[1];\t\t/* Gap */\n\t__le16\tctrl_status;\t\t/* Control/Status */\n#define CSR_FLASH_64K_BANK\tBIT_3\t/* Flash upper 64K bank select */\n#define CSR_FLASH_ENABLE\tBIT_1\t/* Flash BIOS Read/Write enable */\n#define CSR_ISP_SOFT_RESET\tBIT_0\t/* ISP soft reset */\n\n\t__le16\tictrl;\t\t\t/* Interrupt control */\n#define ICR_EN_INT\t\tBIT_15\t/* ISP enable interrupts. */\n#define ICR_EN_RISC\t\tBIT_3\t/* ISP enable RISC interrupts. */\n\n\t__le16\tistatus;\t\t/* Interrupt status */\n#define ISR_RISC_INT\t\tBIT_3\t/* RISC interrupt */\n\n\t__le16\tsemaphore;\t\t/* Semaphore */\n\t__le16\tnvram;\t\t\t/* NVRAM register. */\n#define NVR_DESELECT\t\t0\n#define NVR_BUSY\t\tBIT_15\n#define NVR_WRT_ENABLE\t\tBIT_14\t/* Write enable */\n#define NVR_PR_ENABLE\t\tBIT_13\t/* Protection register enable */\n#define NVR_DATA_IN\t\tBIT_3\n#define NVR_DATA_OUT\t\tBIT_2\n#define NVR_SELECT\t\tBIT_1\n#define NVR_CLOCK\t\tBIT_0\n\n#define NVR_WAIT_CNT\t\t20000\n\n\tunion {\n\t\tstruct {\n\t\t\t__le16\tmailbox0;\n\t\t\t__le16\tmailbox1;\n\t\t\t__le16\tmailbox2;\n\t\t\t__le16\tmailbox3;\n\t\t\t__le16\tmailbox4;\n\t\t\t__le16\tmailbox5;\n\t\t\t__le16\tmailbox6;\n\t\t\t__le16\tmailbox7;\n\t\t\t__le16\tunused_2[59];\t/* Gap */\n\t\t} __attribute__((packed)) isp2100;\n\t\tstruct {\n\t\t\t\t\t\t/* Request Queue */\n\t\t\t__le16\treq_q_in;\t/*  In-Pointer */\n\t\t\t__le16\treq_q_out;\t/*  Out-Pointer */\n\t\t\t\t\t\t/* Response Queue */\n\t\t\t__le16\trsp_q_in;\t/*  In-Pointer */\n\t\t\t__le16\trsp_q_out;\t/*  Out-Pointer */\n\n\t\t\t\t\t\t/* RISC to Host Status */\n\t\t\t__le32\thost_status;\n#define HSR_RISC_INT\t\tBIT_15\t/* RISC interrupt */\n#define HSR_RISC_PAUSED\t\tBIT_8\t/* RISC Paused */\n\n\t\t\t\t\t/* Host to Host Semaphore */\n\t\t\t__le16\thost_semaphore;\n\t\t\t__le16\tunused_3[17];\t/* Gap */\n\t\t\t__le16\tmailbox0;\n\t\t\t__le16\tmailbox1;\n\t\t\t__le16\tmailbox2;\n\t\t\t__le16\tmailbox3;\n\t\t\t__le16\tmailbox4;\n\t\t\t__le16\tmailbox5;\n\t\t\t__le16\tmailbox6;\n\t\t\t__le16\tmailbox7;\n\t\t\t__le16\tmailbox8;\n\t\t\t__le16\tmailbox9;\n\t\t\t__le16\tmailbox10;\n\t\t\t__le16\tmailbox11;\n\t\t\t__le16\tmailbox12;\n\t\t\t__le16\tmailbox13;\n\t\t\t__le16\tmailbox14;\n\t\t\t__le16\tmailbox15;\n\t\t\t__le16\tmailbox16;\n\t\t\t__le16\tmailbox17;\n\t\t\t__le16\tmailbox18;\n\t\t\t__le16\tmailbox19;\n\t\t\t__le16\tmailbox20;\n\t\t\t__le16\tmailbox21;\n\t\t\t__le16\tmailbox22;\n\t\t\t__le16\tmailbox23;\n\t\t\t__le16\tmailbox24;\n\t\t\t__le16\tmailbox25;\n\t\t\t__le16\tmailbox26;\n\t\t\t__le16\tmailbox27;\n\t\t\t__le16\tmailbox28;\n\t\t\t__le16\tmailbox29;\n\t\t\t__le16\tmailbox30;\n\t\t\t__le16\tmailbox31;\n\t\t\t__le16\tfb_cmd;\n\t\t\t__le16\tunused_4[10];\t/* Gap */\n\t\t} __attribute__((packed)) isp2300;\n\t} u;\n\n\t__le16\tfpm_diag_config;\n\t__le16\tunused_5[0x4];\t\t/* Gap */\n\t__le16\trisc_hw;\n\t__le16\tunused_5_1;\t\t/* Gap */\n\t__le16\tpcr;\t\t\t/* Processor Control Register. */\n\t__le16\tunused_6[0x5];\t\t/* Gap */\n\t__le16\tmctr;\t\t\t/* Memory Configuration and Timing. */\n\t__le16\tunused_7[0x3];\t\t/* Gap */\n\t__le16\tfb_cmd_2100;\t\t/* Unused on 23XX */\n\t__le16\tunused_8[0x3];\t\t/* Gap */\n\t__le16\thccr;\t\t\t/* Host command & control register. */\n#define HCCR_HOST_INT\t\tBIT_7\t/* Host interrupt bit */\n#define HCCR_RISC_PAUSE\t\tBIT_5\t/* Pause mode bit */\n\t\t\t\t\t/* HCCR commands */\n#define HCCR_RESET_RISC\t\t0x1000\t/* Reset RISC */\n#define HCCR_PAUSE_RISC\t\t0x2000\t/* Pause RISC */\n#define HCCR_RELEASE_RISC\t0x3000\t/* Release RISC from reset. */\n#define HCCR_SET_HOST_INT\t0x5000\t/* Set host interrupt */\n#define HCCR_CLR_HOST_INT\t0x6000\t/* Clear HOST interrupt */\n#define HCCR_CLR_RISC_INT\t0x7000\t/* Clear RISC interrupt */\n#define\tHCCR_DISABLE_PARITY_PAUSE 0x4001 /* Disable parity error RISC pause. */\n#define HCCR_ENABLE_PARITY\t0xA000\t/* Enable PARITY interrupt */\n\n\t__le16\tunused_9[5];\t\t/* Gap */\n\t__le16\tgpiod;\t\t\t/* GPIO Data register. */\n\t__le16\tgpioe;\t\t\t/* GPIO Enable register. */\n#define GPIO_LED_MASK\t\t\t0x00C0\n#define GPIO_LED_GREEN_OFF_AMBER_OFF\t0x0000\n#define GPIO_LED_GREEN_ON_AMBER_OFF\t0x0040\n#define GPIO_LED_GREEN_OFF_AMBER_ON\t0x0080\n#define GPIO_LED_GREEN_ON_AMBER_ON\t0x00C0\n#define GPIO_LED_ALL_OFF\t\t0x0000\n#define GPIO_LED_RED_ON_OTHER_OFF\t0x0001\t/* isp2322 */\n#define GPIO_LED_RGA_ON\t\t\t0x00C1\t/* isp2322: red green amber */\n\n\tunion {\n\t\tstruct {\n\t\t\t__le16\tunused_10[8];\t/* Gap */\n\t\t\t__le16\tmailbox8;\n\t\t\t__le16\tmailbox9;\n\t\t\t__le16\tmailbox10;\n\t\t\t__le16\tmailbox11;\n\t\t\t__le16\tmailbox12;\n\t\t\t__le16\tmailbox13;\n\t\t\t__le16\tmailbox14;\n\t\t\t__le16\tmailbox15;\n\t\t\t__le16\tmailbox16;\n\t\t\t__le16\tmailbox17;\n\t\t\t__le16\tmailbox18;\n\t\t\t__le16\tmailbox19;\n\t\t\t__le16\tmailbox20;\n\t\t\t__le16\tmailbox21;\n\t\t\t__le16\tmailbox22;\n\t\t\t__le16\tmailbox23;\t/* Also probe reg. */\n\t\t} __attribute__((packed)) isp2200;\n\t} u_end;\n};\n\nstruct device_reg_25xxmq {\n\t__le32\treq_q_in;\n\t__le32\treq_q_out;\n\t__le32\trsp_q_in;\n\t__le32\trsp_q_out;\n\t__le32\tatio_q_in;\n\t__le32\tatio_q_out;\n};\n\n\nstruct device_reg_fx00 {\n\t__le32\tmailbox0;\t\t/* 00 */\n\t__le32\tmailbox1;\t\t/* 04 */\n\t__le32\tmailbox2;\t\t/* 08 */\n\t__le32\tmailbox3;\t\t/* 0C */\n\t__le32\tmailbox4;\t\t/* 10 */\n\t__le32\tmailbox5;\t\t/* 14 */\n\t__le32\tmailbox6;\t\t/* 18 */\n\t__le32\tmailbox7;\t\t/* 1C */\n\t__le32\tmailbox8;\t\t/* 20 */\n\t__le32\tmailbox9;\t\t/* 24 */\n\t__le32\tmailbox10;\t\t/* 28 */\n\t__le32\tmailbox11;\n\t__le32\tmailbox12;\n\t__le32\tmailbox13;\n\t__le32\tmailbox14;\n\t__le32\tmailbox15;\n\t__le32\tmailbox16;\n\t__le32\tmailbox17;\n\t__le32\tmailbox18;\n\t__le32\tmailbox19;\n\t__le32\tmailbox20;\n\t__le32\tmailbox21;\n\t__le32\tmailbox22;\n\t__le32\tmailbox23;\n\t__le32\tmailbox24;\n\t__le32\tmailbox25;\n\t__le32\tmailbox26;\n\t__le32\tmailbox27;\n\t__le32\tmailbox28;\n\t__le32\tmailbox29;\n\t__le32\tmailbox30;\n\t__le32\tmailbox31;\n\t__le32\taenmailbox0;\n\t__le32\taenmailbox1;\n\t__le32\taenmailbox2;\n\t__le32\taenmailbox3;\n\t__le32\taenmailbox4;\n\t__le32\taenmailbox5;\n\t__le32\taenmailbox6;\n\t__le32\taenmailbox7;\n\t/* Request Queue. */\n\t__le32\treq_q_in;\t\t/* A0 - Request Queue In-Pointer */\n\t__le32\treq_q_out;\t\t/* A4 - Request Queue Out-Pointer */\n\t/* Response Queue. */\n\t__le32\trsp_q_in;\t\t/* A8 - Response Queue In-Pointer */\n\t__le32\trsp_q_out;\t\t/* AC - Response Queue Out-Pointer */\n\t/* Init values shadowed on FW Up Event */\n\t__le32\tinitval0;\t\t/* B0 */\n\t__le32\tinitval1;\t\t/* B4 */\n\t__le32\tinitval2;\t\t/* B8 */\n\t__le32\tinitval3;\t\t/* BC */\n\t__le32\tinitval4;\t\t/* C0 */\n\t__le32\tinitval5;\t\t/* C4 */\n\t__le32\tinitval6;\t\t/* C8 */\n\t__le32\tinitval7;\t\t/* CC */\n\t__le32\tfwheartbeat;\t\t/* D0 */\n\t__le32\tpseudoaen;\t\t/* D4 */\n};\n\n\n\ntypedef union {\n\t\tstruct device_reg_2xxx isp;\n\t\tstruct device_reg_24xx isp24;\n\t\tstruct device_reg_25xxmq isp25mq;\n\t\tstruct device_reg_82xx isp82;\n\t\tstruct device_reg_fx00 ispfx00;\n} __iomem device_reg_t;\n\n#define ISP_REQ_Q_IN(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox4 : \\\n\t &(reg)->u.isp2300.req_q_in)\n#define ISP_REQ_Q_OUT(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox4 : \\\n\t &(reg)->u.isp2300.req_q_out)\n#define ISP_RSP_Q_IN(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox5 : \\\n\t &(reg)->u.isp2300.rsp_q_in)\n#define ISP_RSP_Q_OUT(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox5 : \\\n\t &(reg)->u.isp2300.rsp_q_out)\n\n#define ISP_ATIO_Q_IN(vha) (vha->hw->tgt.atio_q_in)\n#define ISP_ATIO_Q_OUT(vha) (vha->hw->tgt.atio_q_out)\n\n#define MAILBOX_REG(ha, reg, num) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t (num < 8 ? \\\n\t  &(reg)->u.isp2100.mailbox0 + (num) : \\\n\t  &(reg)->u_end.isp2200.mailbox8 + (num) - 8) : \\\n\t &(reg)->u.isp2300.mailbox0 + (num))\n#define RD_MAILBOX_REG(ha, reg, num) \\\n\trd_reg_word(MAILBOX_REG(ha, reg, num))\n#define WRT_MAILBOX_REG(ha, reg, num, data) \\\n\twrt_reg_word(MAILBOX_REG(ha, reg, num), data)\n\n#define FB_CMD_REG(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->fb_cmd_2100 : \\\n\t &(reg)->u.isp2300.fb_cmd)\n#define RD_FB_CMD_REG(ha, reg) \\\n\trd_reg_word(FB_CMD_REG(ha, reg))\n#define WRT_FB_CMD_REG(ha, reg, data) \\\n\twrt_reg_word(FB_CMD_REG(ha, reg), data)\n\ntypedef struct {\n\tuint32_t\tout_mb;\t\t/* outbound from driver */\n\tuint32_t\tin_mb;\t\t\t/* Incoming from RISC */\n\tuint16_t\tmb[MAILBOX_REGISTER_COUNT];\n\tlong\t\tbuf_size;\n\tvoid\t\t*bufp;\n\tuint32_t\ttov;\n\tuint8_t\t\tflags;\n#define MBX_DMA_IN\tBIT_0\n#define\tMBX_DMA_OUT\tBIT_1\n#define IOCTL_CMD\tBIT_2\n} mbx_cmd_t;\n\nstruct mbx_cmd_32 {\n\tuint32_t\tout_mb;\t\t/* outbound from driver */\n\tuint32_t\tin_mb;\t\t\t/* Incoming from RISC */\n\tuint32_t\tmb[MAILBOX_REGISTER_COUNT];\n\tlong\t\tbuf_size;\n\tvoid\t\t*bufp;\n\tuint32_t\ttov;\n\tuint8_t\t\tflags;\n#define MBX_DMA_IN\tBIT_0\n#define\tMBX_DMA_OUT\tBIT_1\n#define IOCTL_CMD\tBIT_2\n};\n\n\n#define\tMBX_TOV_SECONDS\t30\n\n/*\n *  ISP product identification definitions in mailboxes after reset.\n */\n#define PROD_ID_1\t\t0x4953\n#define PROD_ID_2\t\t0x0000\n#define PROD_ID_2a\t\t0x5020\n#define PROD_ID_3\t\t0x2020\n\n/*\n * ISP mailbox Self-Test status codes\n */\n#define MBS_FRM_ALIVE\t\t0\t/* Firmware Alive. */\n#define MBS_CHKSUM_ERR\t\t1\t/* Checksum Error. */\n#define MBS_BUSY\t\t4\t/* Busy. */\n\n/*\n * ISP mailbox command complete status codes\n */\n#define MBS_COMMAND_COMPLETE\t\t0x4000\n#define MBS_INVALID_COMMAND\t\t0x4001\n#define MBS_HOST_INTERFACE_ERROR\t0x4002\n#define MBS_TEST_FAILED\t\t\t0x4003\n#define MBS_COMMAND_ERROR\t\t0x4005\n#define MBS_COMMAND_PARAMETER_ERROR\t0x4006\n#define MBS_PORT_ID_USED\t\t0x4007\n#define MBS_LOOP_ID_USED\t\t0x4008\n#define MBS_ALL_IDS_IN_USE\t\t0x4009\n#define MBS_NOT_LOGGED_IN\t\t0x400A\n#define MBS_LINK_DOWN_ERROR\t\t0x400B\n#define MBS_DIAG_ECHO_TEST_ERROR\t0x400C\n\nstatic inline bool qla2xxx_is_valid_mbs(unsigned int mbs)\n{\n\treturn MBS_COMMAND_COMPLETE <= mbs && mbs <= MBS_DIAG_ECHO_TEST_ERROR;\n}\n\n/*\n * ISP mailbox asynchronous event status codes\n */\n#define MBA_ASYNC_EVENT\t\t0x8000\t/* Asynchronous event. */\n#define MBA_RESET\t\t0x8001\t/* Reset Detected. */\n#define MBA_SYSTEM_ERR\t\t0x8002\t/* System Error. */\n#define MBA_REQ_TRANSFER_ERR\t0x8003\t/* Request Transfer Error. */\n#define MBA_RSP_TRANSFER_ERR\t0x8004\t/* Response Transfer Error. */\n#define MBA_WAKEUP_THRES\t0x8005\t/* Request Queue Wake-up. */\n#define MBA_LIP_OCCURRED\t0x8010\t/* Loop Initialization Procedure */\n\t\t\t\t\t/* occurred. */\n#define MBA_LOOP_UP\t\t0x8011\t/* FC Loop UP. */\n#define MBA_LOOP_DOWN\t\t0x8012\t/* FC Loop Down. */\n#define MBA_LIP_RESET\t\t0x8013\t/* LIP reset occurred. */\n#define MBA_PORT_UPDATE\t\t0x8014\t/* Port Database update. */\n#define MBA_RSCN_UPDATE\t\t0x8015\t/* Register State Chg Notification. */\n#define MBA_LIP_F8\t\t0x8016\t/* Received a LIP F8. */\n#define MBA_LOOP_INIT_ERR\t0x8017\t/* Loop Initialization Error. */\n#define MBA_FABRIC_AUTH_REQ\t0x801b\t/* Fabric Authentication Required. */\n#define MBA_CONGN_NOTI_RECV\t0x801e\t/* Congestion Notification Received */\n#define MBA_SCSI_COMPLETION\t0x8020\t/* SCSI Command Complete. */\n#define MBA_CTIO_COMPLETION\t0x8021\t/* CTIO Complete. */\n#define MBA_IP_COMPLETION\t0x8022\t/* IP Transmit Command Complete. */\n#define MBA_IP_RECEIVE\t\t0x8023\t/* IP Received. */\n#define MBA_IP_BROADCAST\t0x8024\t/* IP Broadcast Received. */\n#define MBA_IP_LOW_WATER_MARK\t0x8025\t/* IP Low Water Mark reached. */\n#define MBA_IP_RCV_BUFFER_EMPTY 0x8026\t/* IP receive buffer queue empty. */\n#define MBA_IP_HDR_DATA_SPLIT\t0x8027\t/* IP header/data splitting feature */\n\t\t\t\t\t/* used. */\n#define MBA_TRACE_NOTIFICATION\t0x8028\t/* Trace/Diagnostic notification. */\n#define MBA_POINT_TO_POINT\t0x8030\t/* Point to point mode. */\n#define MBA_CMPLT_1_16BIT\t0x8031\t/* Completion 1 16bit IOSB. */\n#define MBA_CMPLT_2_16BIT\t0x8032\t/* Completion 2 16bit IOSB. */\n#define MBA_CMPLT_3_16BIT\t0x8033\t/* Completion 3 16bit IOSB. */\n#define MBA_CMPLT_4_16BIT\t0x8034\t/* Completion 4 16bit IOSB. */\n#define MBA_CMPLT_5_16BIT\t0x8035\t/* Completion 5 16bit IOSB. */\n#define MBA_CHG_IN_CONNECTION\t0x8036\t/* Change in connection mode. */\n#define MBA_RIO_RESPONSE\t0x8040\t/* RIO response queue update. */\n#define MBA_ZIO_RESPONSE\t0x8040\t/* ZIO response queue update. */\n#define MBA_CMPLT_2_32BIT\t0x8042\t/* Completion 2 32bit IOSB. */\n#define MBA_BYPASS_NOTIFICATION\t0x8043\t/* Auto bypass notification. */\n#define MBA_DISCARD_RND_FRAME\t0x8048\t/* discard RND frame due to error. */\n#define MBA_REJECTED_FCP_CMD\t0x8049\t/* rejected FCP_CMD. */\n#define MBA_FW_NOT_STARTED\t0x8050\t/* Firmware not started */\n#define MBA_FW_STARTING\t\t0x8051\t/* Firmware starting */\n#define MBA_FW_RESTART_CMPLT\t0x8060\t/* Firmware restart complete */\n#define MBA_INIT_REQUIRED\t0x8061\t/* Initialization required */\n#define MBA_SHUTDOWN_REQUESTED\t0x8062\t/* Shutdown Requested */\n#define MBA_TEMPERATURE_ALERT\t0x8070\t/* Temperature Alert */\n#define MBA_DPORT_DIAGNOSTICS\t0x8080\t/* D-port Diagnostics */\n#define MBA_TRANS_INSERT\t0x8130\t/* Transceiver Insertion */\n#define MBA_TRANS_REMOVE\t0x8131\t/* Transceiver Removal */\n#define MBA_FW_INIT_FAILURE\t0x8401\t/* Firmware initialization failure */\n#define MBA_MIRROR_LUN_CHANGE\t0x8402\t/* Mirror LUN State Change\n\t\t\t\t\t   Notification */\n#define MBA_FW_POLL_STATE\t0x8600  /* Firmware in poll diagnostic state */\n#define MBA_FW_RESET_FCT\t0x8502\t/* Firmware reset factory defaults */\n#define MBA_FW_INIT_INPROGRESS\t0x8500\t/* Firmware boot in progress */\n/* 83XX FCoE specific */\n#define MBA_IDC_AEN\t\t0x8200  /* FCoE: NIC Core state change AEN */\n\n/* Interrupt type codes */\n#define INTR_ROM_MB_SUCCESS\t\t0x1\n#define INTR_ROM_MB_FAILED\t\t0x2\n#define INTR_MB_SUCCESS\t\t\t0x10\n#define INTR_MB_FAILED\t\t\t0x11\n#define INTR_ASYNC_EVENT\t\t0x12\n#define INTR_RSP_QUE_UPDATE\t\t0x13\n#define INTR_RSP_QUE_UPDATE_83XX\t0x14\n#define INTR_ATIO_QUE_UPDATE\t\t0x1C\n#define INTR_ATIO_RSP_QUE_UPDATE\t0x1D\n#define INTR_ATIO_QUE_UPDATE_27XX\t0x1E\n\n/* ISP mailbox loopback echo diagnostic error code */\n#define MBS_LB_RESET\t0x17\n/*\n * Firmware options 1, 2, 3.\n */\n#define FO1_AE_ON_LIPF8\t\t\tBIT_0\n#define FO1_AE_ALL_LIP_RESET\t\tBIT_1\n#define FO1_CTIO_RETRY\t\t\tBIT_3\n#define FO1_DISABLE_LIP_F7_SW\t\tBIT_4\n#define FO1_DISABLE_100MS_LOS_WAIT\tBIT_5\n#define FO1_DISABLE_GPIO6_7\t\tBIT_6\t/* LED bits */\n#define FO1_AE_ON_LOOP_INIT_ERR\t\tBIT_7\n#define FO1_SET_EMPHASIS_SWING\t\tBIT_8\n#define FO1_AE_AUTO_BYPASS\t\tBIT_9\n#define FO1_ENABLE_PURE_IOCB\t\tBIT_10\n#define FO1_AE_PLOGI_RJT\t\tBIT_11\n#define FO1_ENABLE_ABORT_SEQUENCE\tBIT_12\n#define FO1_AE_QUEUE_FULL\t\tBIT_13\n\n#define FO2_ENABLE_ATIO_TYPE_3\t\tBIT_0\n#define FO2_REV_LOOPBACK\t\tBIT_1\n\n#define FO3_ENABLE_EMERG_IOCB\t\tBIT_0\n#define FO3_AE_RND_ERROR\t\tBIT_1\n\n/* 24XX additional firmware options */\n#define ADD_FO_COUNT\t\t\t3\n#define ADD_FO1_DISABLE_GPIO_LED_CTRL\tBIT_6\t/* LED bits */\n#define ADD_FO1_ENABLE_PUREX_IOCB\tBIT_10\n\n#define ADD_FO2_ENABLE_SEL_CLS2\t\tBIT_5\n\n#define ADD_FO3_NO_ABT_ON_LINK_DOWN\tBIT_14\n\n/*\n * ISP mailbox commands\n */\n#define MBC_LOAD_RAM\t\t\t1\t/* Load RAM. */\n#define MBC_EXECUTE_FIRMWARE\t\t2\t/* Execute firmware. */\n#define MBC_READ_RAM_WORD\t\t5\t/* Read RAM word. */\n#define MBC_MAILBOX_REGISTER_TEST\t6\t/* Wrap incoming mailboxes */\n#define MBC_VERIFY_CHECKSUM\t\t7\t/* Verify checksum. */\n#define MBC_GET_FIRMWARE_VERSION\t8\t/* Get firmware revision. */\n#define MBC_LOAD_RISC_RAM\t\t9\t/* Load RAM command. */\n#define MBC_DUMP_RISC_RAM\t\t0xa\t/* Dump RAM command. */\n#define MBC_SECURE_FLASH_UPDATE\t\t0xa\t/* Secure Flash Update(28xx) */\n#define MBC_LOAD_RISC_RAM_EXTENDED\t0xb\t/* Load RAM extended. */\n#define MBC_DUMP_RISC_RAM_EXTENDED\t0xc\t/* Dump RAM extended. */\n#define MBC_WRITE_RAM_WORD_EXTENDED\t0xd\t/* Write RAM word extended */\n#define MBC_READ_RAM_EXTENDED\t\t0xf\t/* Read RAM extended. */\n#define MBC_IOCB_COMMAND\t\t0x12\t/* Execute IOCB command. */\n#define MBC_STOP_FIRMWARE\t\t0x14\t/* Stop firmware. */\n#define MBC_ABORT_COMMAND\t\t0x15\t/* Abort IOCB command. */\n#define MBC_ABORT_DEVICE\t\t0x16\t/* Abort device (ID/LUN). */\n#define MBC_ABORT_TARGET\t\t0x17\t/* Abort target (ID). */\n#define MBC_RESET\t\t\t0x18\t/* Reset. */\n#define MBC_GET_ADAPTER_LOOP_ID\t\t0x20\t/* Get loop id of ISP2200. */\n#define MBC_GET_SET_ZIO_THRESHOLD\t0x21\t/* Get/SET ZIO THRESHOLD. */\n#define MBC_GET_RETRY_COUNT\t\t0x22\t/* Get f/w retry cnt/delay. */\n#define MBC_DISABLE_VI\t\t\t0x24\t/* Disable VI operation. */\n#define MBC_ENABLE_VI\t\t\t0x25\t/* Enable VI operation. */\n#define MBC_GET_FIRMWARE_OPTION\t\t0x28\t/* Get Firmware Options. */\n#define MBC_GET_MEM_OFFLOAD_CNTRL_STAT\t0x34\t/* Memory Offload ctrl/Stat*/\n#define MBC_SET_FIRMWARE_OPTION\t\t0x38\t/* Set Firmware Options. */\n#define MBC_SET_GET_FC_LED_CONFIG\t0x3b\t/* Set/Get FC LED config */\n#define MBC_LOOP_PORT_BYPASS\t\t0x40\t/* Loop Port Bypass. */\n#define MBC_LOOP_PORT_ENABLE\t\t0x41\t/* Loop Port Enable. */\n#define MBC_GET_RESOURCE_COUNTS\t\t0x42\t/* Get Resource Counts. */\n#define MBC_NON_PARTICIPATE\t\t0x43\t/* Non-Participating Mode. */\n#define MBC_DIAGNOSTIC_ECHO\t\t0x44\t/* Diagnostic echo. */\n#define MBC_DIAGNOSTIC_LOOP_BACK\t0x45\t/* Diagnostic loop back. */\n#define MBC_ONLINE_SELF_TEST\t\t0x46\t/* Online self-test. */\n#define MBC_ENHANCED_GET_PORT_DATABASE\t0x47\t/* Get port database + login */\n#define MBC_CONFIGURE_VF\t\t0x4b\t/* Configure VFs */\n#define MBC_RESET_LINK_STATUS\t\t0x52\t/* Reset Link Error Status */\n#define MBC_IOCB_COMMAND_A64\t\t0x54\t/* Execute IOCB command (64) */\n#define MBC_PORT_LOGOUT\t\t\t0x56\t/* Port Logout request */\n#define MBC_SEND_RNID_ELS\t\t0x57\t/* Send RNID ELS request */\n#define MBC_SET_RNID_PARAMS\t\t0x59\t/* Set RNID parameters */\n#define MBC_GET_RNID_PARAMS\t\t0x5a\t/* Get RNID parameters */\n#define MBC_DATA_RATE\t\t\t0x5d\t/* Data Rate */\n#define MBC_INITIALIZE_FIRMWARE\t\t0x60\t/* Initialize firmware */\n#define MBC_INITIATE_LIP\t\t0x62\t/* Initiate Loop */\n\t\t\t\t\t\t/* Initialization Procedure */\n#define MBC_GET_FC_AL_POSITION_MAP\t0x63\t/* Get FC_AL Position Map. */\n#define MBC_GET_PORT_DATABASE\t\t0x64\t/* Get Port Database. */\n#define MBC_CLEAR_ACA\t\t\t0x65\t/* Clear ACA. */\n#define MBC_TARGET_RESET\t\t0x66\t/* Target Reset. */\n#define MBC_CLEAR_TASK_SET\t\t0x67\t/* Clear Task Set. */\n#define MBC_ABORT_TASK_SET\t\t0x68\t/* Abort Task Set. */\n#define MBC_GET_FIRMWARE_STATE\t\t0x69\t/* Get firmware state. */\n#define MBC_GET_PORT_NAME\t\t0x6a\t/* Get port name. */\n#define MBC_GET_LINK_STATUS\t\t0x6b\t/* Get port link status. */\n#define MBC_LIP_RESET\t\t\t0x6c\t/* LIP reset. */\n#define MBC_SEND_SNS_COMMAND\t\t0x6e\t/* Send Simple Name Server */\n\t\t\t\t\t\t/* commandd. */\n#define MBC_LOGIN_FABRIC_PORT\t\t0x6f\t/* Login fabric port. */\n#define MBC_SEND_CHANGE_REQUEST\t\t0x70\t/* Send Change Request. */\n#define MBC_LOGOUT_FABRIC_PORT\t\t0x71\t/* Logout fabric port. */\n#define MBC_LIP_FULL_LOGIN\t\t0x72\t/* Full login LIP. */\n#define MBC_LOGIN_LOOP_PORT\t\t0x74\t/* Login Loop Port. */\n#define MBC_PORT_NODE_NAME_LIST\t\t0x75\t/* Get port/node name list. */\n#define MBC_INITIALIZE_RECEIVE_QUEUE\t0x77\t/* Initialize receive queue */\n#define MBC_UNLOAD_IP\t\t\t0x79\t/* Shutdown IP */\n#define MBC_GET_ID_LIST\t\t\t0x7C\t/* Get Port ID list. */\n#define MBC_SEND_LFA_COMMAND\t\t0x7D\t/* Send Loop Fabric Address */\n#define MBC_LUN_RESET\t\t\t0x7E\t/* Send LUN reset */\n\n/*\n * all the Mt. Rainier mailbox command codes that clash with FC/FCoE ones\n * should be defined with MBC_MR_*\n */\n#define MBC_MR_DRV_SHUTDOWN\t\t0x6A\n\n/*\n * ISP24xx mailbox commands\n */\n#define MBC_WRITE_SERDES\t\t0x3\t/* Write serdes word. */\n#define MBC_READ_SERDES\t\t\t0x4\t/* Read serdes word. */\n#define MBC_LOAD_DUMP_MPI_RAM\t\t0x5\t/* Load/Dump MPI RAM. */\n#define MBC_SERDES_PARAMS\t\t0x10\t/* Serdes Tx Parameters. */\n#define MBC_GET_IOCB_STATUS\t\t0x12\t/* Get IOCB status command. */\n#define MBC_PORT_PARAMS\t\t\t0x1A\t/* Port iDMA Parameters. */\n#define MBC_GET_TIMEOUT_PARAMS\t\t0x22\t/* Get FW timeouts. */\n#define MBC_TRACE_CONTROL\t\t0x27\t/* Trace control command. */\n#define MBC_GEN_SYSTEM_ERROR\t\t0x2a\t/* Generate System Error. */\n#define MBC_WRITE_SFP\t\t\t0x30\t/* Write SFP Data. */\n#define MBC_READ_SFP\t\t\t0x31\t/* Read SFP Data. */\n#define MBC_SET_TIMEOUT_PARAMS\t\t0x32\t/* Set FW timeouts. */\n#define MBC_DPORT_DIAGNOSTICS\t\t0x47\t/* D-Port Diagnostics */\n#define MBC_MID_INITIALIZE_FIRMWARE\t0x48\t/* MID Initialize firmware. */\n#define MBC_MID_GET_VP_DATABASE\t\t0x49\t/* MID Get VP Database. */\n#define MBC_MID_GET_VP_ENTRY\t\t0x4a\t/* MID Get VP Entry. */\n#define MBC_HOST_MEMORY_COPY\t\t0x53\t/* Host Memory Copy. */\n#define MBC_SEND_RNFT_ELS\t\t0x5e\t/* Send RNFT ELS request */\n#define MBC_GET_LINK_PRIV_STATS\t\t0x6d\t/* Get link & private data. */\n#define MBC_LINK_INITIALIZATION\t\t0x72\t/* Do link initialization. */\n#define MBC_SET_VENDOR_ID\t\t0x76\t/* Set Vendor ID. */\n#define MBC_PORT_RESET\t\t\t0x120\t/* Port Reset */\n#define MBC_SET_PORT_CONFIG\t\t0x122\t/* Set port configuration */\n#define MBC_GET_PORT_CONFIG\t\t0x123\t/* Get port configuration */\n\n/*\n * ISP81xx mailbox commands\n */\n#define MBC_WRITE_MPI_REGISTER\t\t0x01    /* Write MPI Register. */\n\n/*\n * ISP8044 mailbox commands\n */\n#define MBC_SET_GET_ETH_SERDES_REG\t0x150\n#define HCS_WRITE_SERDES\t\t0x3\n#define HCS_READ_SERDES\t\t\t0x4\n\n/* Firmware return data sizes */\n#define FCAL_MAP_SIZE\t128\n\n/* Mailbox bit definitions for out_mb and in_mb */\n#define\tMBX_31\t\tBIT_31\n#define\tMBX_30\t\tBIT_30\n#define\tMBX_29\t\tBIT_29\n#define\tMBX_28\t\tBIT_28\n#define\tMBX_27\t\tBIT_27\n#define\tMBX_26\t\tBIT_26\n#define\tMBX_25\t\tBIT_25\n#define\tMBX_24\t\tBIT_24\n#define\tMBX_23\t\tBIT_23\n#define\tMBX_22\t\tBIT_22\n#define\tMBX_21\t\tBIT_21\n#define\tMBX_20\t\tBIT_20\n#define\tMBX_19\t\tBIT_19\n#define\tMBX_18\t\tBIT_18\n#define\tMBX_17\t\tBIT_17\n#define\tMBX_16\t\tBIT_16\n#define\tMBX_15\t\tBIT_15\n#define\tMBX_14\t\tBIT_14\n#define\tMBX_13\t\tBIT_13\n#define\tMBX_12\t\tBIT_12\n#define\tMBX_11\t\tBIT_11\n#define\tMBX_10\t\tBIT_10\n#define\tMBX_9\t\tBIT_9\n#define\tMBX_8\t\tBIT_8\n#define\tMBX_7\t\tBIT_7\n#define\tMBX_6\t\tBIT_6\n#define\tMBX_5\t\tBIT_5\n#define\tMBX_4\t\tBIT_4\n#define\tMBX_3\t\tBIT_3\n#define\tMBX_2\t\tBIT_2\n#define\tMBX_1\t\tBIT_1\n#define\tMBX_0\t\tBIT_0\n\n#define RNID_TYPE_ELS_CMD\t0x5\n#define RNID_TYPE_PORT_LOGIN\t0x7\n#define RNID_BUFFER_CREDITS\t0x8\n#define RNID_TYPE_SET_VERSION\t0x9\n#define RNID_TYPE_ASIC_TEMP\t0xC\n\n#define ELS_CMD_MAP_SIZE\t32\n\n/*\n * Firmware state codes from get firmware state mailbox command\n */\n#define FSTATE_CONFIG_WAIT      0\n#define FSTATE_WAIT_AL_PA       1\n#define FSTATE_WAIT_LOGIN       2\n#define FSTATE_READY            3\n#define FSTATE_LOSS_OF_SYNC     4\n#define FSTATE_ERROR            5\n#define FSTATE_REINIT           6\n#define FSTATE_NON_PART         7\n\n#define FSTATE_CONFIG_CORRECT      0\n#define FSTATE_P2P_RCV_LIP         1\n#define FSTATE_P2P_CHOOSE_LOOP     2\n#define FSTATE_P2P_RCV_UNIDEN_LIP  3\n#define FSTATE_FATAL_ERROR         4\n#define FSTATE_LOOP_BACK_CONN      5\n\n#define QLA27XX_IMG_STATUS_VER_MAJOR   0x01\n#define QLA27XX_IMG_STATUS_VER_MINOR    0x00\n#define QLA27XX_IMG_STATUS_SIGN   0xFACEFADE\n#define QLA28XX_IMG_STATUS_SIGN    0xFACEFADF\n#define QLA28XX_IMG_STATUS_SIGN\t\t0xFACEFADF\n#define QLA28XX_AUX_IMG_STATUS_SIGN\t0xFACEFAED\n#define QLA27XX_DEFAULT_IMAGE\t\t0\n#define QLA27XX_PRIMARY_IMAGE  1\n#define QLA27XX_SECONDARY_IMAGE    2\n\n/*\n * Port Database structure definition\n * Little endian except where noted.\n */\n#define\tPORT_DATABASE_SIZE\t128\t/* bytes */\ntypedef struct {\n\tuint8_t options;\n\tuint8_t control;\n\tuint8_t master_state;\n\tuint8_t slave_state;\n\tuint8_t reserved[2];\n\tuint8_t hard_address;\n\tuint8_t reserved_1;\n\tuint8_t port_id[4];\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n\t__le16\texecution_throttle;\n\tuint16_t execution_count;\n\tuint8_t reset_count;\n\tuint8_t reserved_2;\n\tuint16_t resource_allocation;\n\tuint16_t current_allocation;\n\tuint16_t queue_head;\n\tuint16_t queue_tail;\n\tuint16_t transmit_execution_list_next;\n\tuint16_t transmit_execution_list_previous;\n\tuint16_t common_features;\n\tuint16_t total_concurrent_sequences;\n\tuint16_t RO_by_information_category;\n\tuint8_t recipient;\n\tuint8_t initiator;\n\tuint16_t receive_data_size;\n\tuint16_t concurrent_sequences;\n\tuint16_t open_sequences_per_exchange;\n\tuint16_t lun_abort_flags;\n\tuint16_t lun_stop_flags;\n\tuint16_t stop_queue_head;\n\tuint16_t stop_queue_tail;\n\tuint16_t port_retry_timer;\n\tuint16_t next_sequence_id;\n\tuint16_t frame_count;\n\tuint16_t PRLI_payload_length;\n\tuint8_t prli_svc_param_word_0[2];\t/* Big endian */\n\t\t\t\t\t\t/* Bits 15-0 of word 0 */\n\tuint8_t prli_svc_param_word_3[2];\t/* Big endian */\n\t\t\t\t\t\t/* Bits 15-0 of word 3 */\n\tuint16_t loop_id;\n\tuint16_t extended_lun_info_list_pointer;\n\tuint16_t extended_lun_stop_list_pointer;\n} port_database_t;\n\n/*\n * Port database slave/master states\n */\n#define PD_STATE_DISCOVERY\t\t\t0\n#define PD_STATE_WAIT_DISCOVERY_ACK\t\t1\n#define PD_STATE_PORT_LOGIN\t\t\t2\n#define PD_STATE_WAIT_PORT_LOGIN_ACK\t\t3\n#define PD_STATE_PROCESS_LOGIN\t\t\t4\n#define PD_STATE_WAIT_PROCESS_LOGIN_ACK\t\t5\n#define PD_STATE_PORT_LOGGED_IN\t\t\t6\n#define PD_STATE_PORT_UNAVAILABLE\t\t7\n#define PD_STATE_PROCESS_LOGOUT\t\t\t8\n#define PD_STATE_WAIT_PROCESS_LOGOUT_ACK\t9\n#define PD_STATE_PORT_LOGOUT\t\t\t10\n#define PD_STATE_WAIT_PORT_LOGOUT_ACK\t\t11\n\n\n#define QLA_ZIO_MODE_6\t\t(BIT_2 | BIT_1)\n#define QLA_ZIO_DISABLED\t0\n#define QLA_ZIO_DEFAULT_TIMER\t2\n\n/*\n * ISP Initialization Control Block.\n * Little endian except where noted.\n */\n#define\tICB_VERSION 1\ntypedef struct {\n\tuint8_t  version;\n\tuint8_t  reserved_1;\n\n\t/*\n\t * LSB BIT 0  = Enable Hard Loop Id\n\t * LSB BIT 1  = Enable Fairness\n\t * LSB BIT 2  = Enable Full-Duplex\n\t * LSB BIT 3  = Enable Fast Posting\n\t * LSB BIT 4  = Enable Target Mode\n\t * LSB BIT 5  = Disable Initiator Mode\n\t * LSB BIT 6  = Enable ADISC\n\t * LSB BIT 7  = Enable Target Inquiry Data\n\t *\n\t * MSB BIT 0  = Enable PDBC Notify\n\t * MSB BIT 1  = Non Participating LIP\n\t * MSB BIT 2  = Descending Loop ID Search\n\t * MSB BIT 3  = Acquire Loop ID in LIPA\n\t * MSB BIT 4  = Stop PortQ on Full Status\n\t * MSB BIT 5  = Full Login after LIP\n\t * MSB BIT 6  = Node Name Option\n\t * MSB BIT 7  = Ext IFWCB enable bit\n\t */\n\tuint8_t  firmware_options[2];\n\n\t__le16\tframe_payload_size;\n\t__le16\tmax_iocb_allocation;\n\t__le16\texecution_throttle;\n\tuint8_t  retry_count;\n\tuint8_t\t retry_delay;\t\t\t/* unused */\n\tuint8_t\t port_name[WWN_SIZE];\t\t/* Big endian. */\n\tuint16_t hard_address;\n\tuint8_t\t inquiry_data;\n\tuint8_t\t login_timeout;\n\tuint8_t\t node_name[WWN_SIZE];\t\t/* Big endian. */\n\n\t__le16\trequest_q_outpointer;\n\t__le16\tresponse_q_inpointer;\n\t__le16\trequest_q_length;\n\t__le16\tresponse_q_length;\n\t__le64  request_q_address __packed;\n\t__le64  response_q_address __packed;\n\n\t__le16\tlun_enables;\n\tuint8_t  command_resource_count;\n\tuint8_t  immediate_notify_resource_count;\n\t__le16\ttimeout;\n\tuint8_t  reserved_2[2];\n\n\t/*\n\t * LSB BIT 0 = Timer Operation mode bit 0\n\t * LSB BIT 1 = Timer Operation mode bit 1\n\t * LSB BIT 2 = Timer Operation mode bit 2\n\t * LSB BIT 3 = Timer Operation mode bit 3\n\t * LSB BIT 4 = Init Config Mode bit 0\n\t * LSB BIT 5 = Init Config Mode bit 1\n\t * LSB BIT 6 = Init Config Mode bit 2\n\t * LSB BIT 7 = Enable Non part on LIHA failure\n\t *\n\t * MSB BIT 0 = Enable class 2\n\t * MSB BIT 1 = Enable ACK0\n\t * MSB BIT 2 =\n\t * MSB BIT 3 =\n\t * MSB BIT 4 = FC Tape Enable\n\t * MSB BIT 5 = Enable FC Confirm\n\t * MSB BIT 6 = Enable command queuing in target mode\n\t * MSB BIT 7 = No Logo On Link Down\n\t */\n\tuint8_t\t add_firmware_options[2];\n\n\tuint8_t\t response_accumulation_timer;\n\tuint8_t\t interrupt_delay_timer;\n\n\t/*\n\t * LSB BIT 0 = Enable Read xfr_rdy\n\t * LSB BIT 1 = Soft ID only\n\t * LSB BIT 2 =\n\t * LSB BIT 3 =\n\t * LSB BIT 4 = FCP RSP Payload [0]\n\t * LSB BIT 5 = FCP RSP Payload [1] / Sbus enable - 2200\n\t * LSB BIT 6 = Enable Out-of-Order frame handling\n\t * LSB BIT 7 = Disable Automatic PLOGI on Local Loop\n\t *\n\t * MSB BIT 0 = Sbus enable - 2300\n\t * MSB BIT 1 =\n\t * MSB BIT 2 =\n\t * MSB BIT 3 =\n\t * MSB BIT 4 = LED mode\n\t * MSB BIT 5 = enable 50 ohm termination\n\t * MSB BIT 6 = Data Rate (2300 only)\n\t * MSB BIT 7 = Data Rate (2300 only)\n\t */\n\tuint8_t\t special_options[2];\n\n\tuint8_t  reserved_3[26];\n} init_cb_t;\n\n/* Special Features Control Block */\nstruct init_sf_cb {\n\tuint8_t\tformat;\n\tuint8_t\treserved0;\n\t/*\n\t * BIT 15-14 = Reserved\n\t * BIT_13 = SAN Congestion Management (1 - Enabled, 0 - Disabled)\n\t * BIT_12 = Remote Write Optimization (1 - Enabled, 0 - Disabled)\n\t * BIT 11-0 = Reserved\n\t */\n\tuint16_t flags;\n\tuint8_t\treserved1[32];\n\tuint16_t discard_OHRB_timeout_value;\n\tuint16_t remote_write_opt_queue_num;\n\tuint8_t\treserved2[40];\n\tuint8_t scm_related_parameter[16];\n\tuint8_t reserved3[32];\n};\n\n/*\n * Get Link Status mailbox command return buffer.\n */\n#define GLSO_SEND_RPS\tBIT_0\n#define GLSO_USE_DID\tBIT_3\n\nstruct link_statistics {\n\t__le32 link_fail_cnt;\n\t__le32 loss_sync_cnt;\n\t__le32 loss_sig_cnt;\n\t__le32 prim_seq_err_cnt;\n\t__le32 inval_xmit_word_cnt;\n\t__le32 inval_crc_cnt;\n\t__le32 lip_cnt;\n\t__le32 link_up_cnt;\n\t__le32 link_down_loop_init_tmo;\n\t__le32 link_down_los;\n\t__le32 link_down_loss_rcv_clk;\n\tuint32_t reserved0[5];\n\t__le32 port_cfg_chg;\n\tuint32_t reserved1[11];\n\t__le32 rsp_q_full;\n\t__le32 atio_q_full;\n\t__le32 drop_ae;\n\t__le32 els_proto_err;\n\t__le32 reserved2;\n\t__le32 tx_frames;\n\t__le32 rx_frames;\n\t__le32 discarded_frames;\n\t__le32 dropped_frames;\n\tuint32_t reserved3;\n\t__le32 nos_rcvd;\n\tuint32_t reserved4[4];\n\t__le32 tx_prjt;\n\t__le32 rcv_exfail;\n\t__le32 rcv_abts;\n\t__le32 seq_frm_miss;\n\t__le32 corr_err;\n\t__le32 mb_rqst;\n\t__le32 nport_full;\n\t__le32 eofa;\n\tuint32_t reserved5;\n\t__le64 fpm_recv_word_cnt;\n\t__le64 fpm_disc_word_cnt;\n\t__le64 fpm_xmit_word_cnt;\n\tuint32_t reserved6[70];\n};\n\n/*\n * NVRAM Command values.\n */\n#define NV_START_BIT            BIT_2\n#define NV_WRITE_OP             (BIT_26+BIT_24)\n#define NV_READ_OP              (BIT_26+BIT_25)\n#define NV_ERASE_OP             (BIT_26+BIT_25+BIT_24)\n#define NV_MASK_OP              (BIT_26+BIT_25+BIT_24)\n#define NV_DELAY_COUNT          10\n\n/*\n * QLogic ISP2100, ISP2200 and ISP2300 NVRAM structure definition.\n */\ntypedef struct {\n\t/*\n\t * NVRAM header\n\t */\n\tuint8_t\tid[4];\n\tuint8_t\tnvram_version;\n\tuint8_t\treserved_0;\n\n\t/*\n\t * NVRAM RISC parameter block\n\t */\n\tuint8_t\tparameter_block_version;\n\tuint8_t\treserved_1;\n\n\t/*\n\t * LSB BIT 0  = Enable Hard Loop Id\n\t * LSB BIT 1  = Enable Fairness\n\t * LSB BIT 2  = Enable Full-Duplex\n\t * LSB BIT 3  = Enable Fast Posting\n\t * LSB BIT 4  = Enable Target Mode\n\t * LSB BIT 5  = Disable Initiator Mode\n\t * LSB BIT 6  = Enable ADISC\n\t * LSB BIT 7  = Enable Target Inquiry Data\n\t *\n\t * MSB BIT 0  = Enable PDBC Notify\n\t * MSB BIT 1  = Non Participating LIP\n\t * MSB BIT 2  = Descending Loop ID Search\n\t * MSB BIT 3  = Acquire Loop ID in LIPA\n\t * MSB BIT 4  = Stop PortQ on Full Status\n\t * MSB BIT 5  = Full Login after LIP\n\t * MSB BIT 6  = Node Name Option\n\t * MSB BIT 7  = Ext IFWCB enable bit\n\t */\n\tuint8_t\t firmware_options[2];\n\n\t__le16\tframe_payload_size;\n\t__le16\tmax_iocb_allocation;\n\t__le16\texecution_throttle;\n\tuint8_t\t retry_count;\n\tuint8_t\t retry_delay;\t\t\t/* unused */\n\tuint8_t\t port_name[WWN_SIZE];\t\t/* Big endian. */\n\tuint16_t hard_address;\n\tuint8_t\t inquiry_data;\n\tuint8_t\t login_timeout;\n\tuint8_t\t node_name[WWN_SIZE];\t\t/* Big endian. */\n\n\t/*\n\t * LSB BIT 0 = Timer Operation mode bit 0\n\t * LSB BIT 1 = Timer Operation mode bit 1\n\t * LSB BIT 2 = Timer Operation mode bit 2\n\t * LSB BIT 3 = Timer Operation mode bit 3\n\t * LSB BIT 4 = Init Config Mode bit 0\n\t * LSB BIT 5 = Init Config Mode bit 1\n\t * LSB BIT 6 = Init Config Mode bit 2\n\t * LSB BIT 7 = Enable Non part on LIHA failure\n\t *\n\t * MSB BIT 0 = Enable class 2\n\t * MSB BIT 1 = Enable ACK0\n\t * MSB BIT 2 =\n\t * MSB BIT 3 =\n\t * MSB BIT 4 = FC Tape Enable\n\t * MSB BIT 5 = Enable FC Confirm\n\t * MSB BIT 6 = Enable command queuing in target mode\n\t * MSB BIT 7 = No Logo On Link Down\n\t */\n\tuint8_t\t add_firmware_options[2];\n\n\tuint8_t\t response_accumulation_timer;\n\tuint8_t\t interrupt_delay_timer;\n\n\t/*\n\t * LSB BIT 0 = Enable Read xfr_rdy\n\t * LSB BIT 1 = Soft ID only\n\t * LSB BIT 2 =\n\t * LSB BIT 3 =\n\t * LSB BIT 4 = FCP RSP Payload [0]\n\t * LSB BIT 5 = FCP RSP Payload [1] / Sbus enable - 2200\n\t * LSB BIT 6 = Enable Out-of-Order frame handling\n\t * LSB BIT 7 = Disable Automatic PLOGI on Local Loop\n\t *\n\t * MSB BIT 0 = Sbus enable - 2300\n\t * MSB BIT 1 =\n\t * MSB BIT 2 =\n\t * MSB BIT 3 =\n\t * MSB BIT 4 = LED mode\n\t * MSB BIT 5 = enable 50 ohm termination\n\t * MSB BIT 6 = Data Rate (2300 only)\n\t * MSB BIT 7 = Data Rate (2300 only)\n\t */\n\tuint8_t\t special_options[2];\n\n\t/* Reserved for expanded RISC parameter block */\n\tuint8_t reserved_2[22];\n\n\t/*\n\t * LSB BIT 0 = Tx Sensitivity 1G bit 0\n\t * LSB BIT 1 = Tx Sensitivity 1G bit 1\n\t * LSB BIT 2 = Tx Sensitivity 1G bit 2\n\t * LSB BIT 3 = Tx Sensitivity 1G bit 3\n\t * LSB BIT 4 = Rx Sensitivity 1G bit 0\n\t * LSB BIT 5 = Rx Sensitivity 1G bit 1\n\t * LSB BIT 6 = Rx Sensitivity 1G bit 2\n\t * LSB BIT 7 = Rx Sensitivity 1G bit 3\n\t *\n\t * MSB BIT 0 = Tx Sensitivity 2G bit 0\n\t * MSB BIT 1 = Tx Sensitivity 2G bit 1\n\t * MSB BIT 2 = Tx Sensitivity 2G bit 2\n\t * MSB BIT 3 = Tx Sensitivity 2G bit 3\n\t * MSB BIT 4 = Rx Sensitivity 2G bit 0\n\t * MSB BIT 5 = Rx Sensitivity 2G bit 1\n\t * MSB BIT 6 = Rx Sensitivity 2G bit 2\n\t * MSB BIT 7 = Rx Sensitivity 2G bit 3\n\t *\n\t * LSB BIT 0 = Output Swing 1G bit 0\n\t * LSB BIT 1 = Output Swing 1G bit 1\n\t * LSB BIT 2 = Output Swing 1G bit 2\n\t * LSB BIT 3 = Output Emphasis 1G bit 0\n\t * LSB BIT 4 = Output Emphasis 1G bit 1\n\t * LSB BIT 5 = Output Swing 2G bit 0\n\t * LSB BIT 6 = Output Swing 2G bit 1\n\t * LSB BIT 7 = Output Swing 2G bit 2\n\t *\n\t * MSB BIT 0 = Output Emphasis 2G bit 0\n\t * MSB BIT 1 = Output Emphasis 2G bit 1\n\t * MSB BIT 2 = Output Enable\n\t * MSB BIT 3 =\n\t * MSB BIT 4 =\n\t * MSB BIT 5 =\n\t * MSB BIT 6 =\n\t * MSB BIT 7 =\n\t */\n\tuint8_t seriallink_options[4];\n\n\t/*\n\t * NVRAM host parameter block\n\t *\n\t * LSB BIT 0 = Enable spinup delay\n\t * LSB BIT 1 = Disable BIOS\n\t * LSB BIT 2 = Enable Memory Map BIOS\n\t * LSB BIT 3 = Enable Selectable Boot\n\t * LSB BIT 4 = Disable RISC code load\n\t * LSB BIT 5 = Set cache line size 1\n\t * LSB BIT 6 = PCI Parity Disable\n\t * LSB BIT 7 = Enable extended logging\n\t *\n\t * MSB BIT 0 = Enable 64bit addressing\n\t * MSB BIT 1 = Enable lip reset\n\t * MSB BIT 2 = Enable lip full login\n\t * MSB BIT 3 = Enable target reset\n\t * MSB BIT 4 = Enable database storage\n\t * MSB BIT 5 = Enable cache flush read\n\t * MSB BIT 6 = Enable database load\n\t * MSB BIT 7 = Enable alternate WWN\n\t */\n\tuint8_t host_p[2];\n\n\tuint8_t boot_node_name[WWN_SIZE];\n\tuint8_t boot_lun_number;\n\tuint8_t reset_delay;\n\tuint8_t port_down_retry_count;\n\tuint8_t boot_id_number;\n\t__le16\tmax_luns_per_target;\n\tuint8_t fcode_boot_port_name[WWN_SIZE];\n\tuint8_t alternate_port_name[WWN_SIZE];\n\tuint8_t alternate_node_name[WWN_SIZE];\n\n\t/*\n\t * BIT 0 = Selective Login\n\t * BIT 1 = Alt-Boot Enable\n\t * BIT 2 =\n\t * BIT 3 = Boot Order List\n\t * BIT 4 =\n\t * BIT 5 = Selective LUN\n\t * BIT 6 =\n\t * BIT 7 = unused\n\t */\n\tuint8_t efi_parameters;\n\n\tuint8_t link_down_timeout;\n\n\tuint8_t adapter_id[16];\n\n\tuint8_t alt1_boot_node_name[WWN_SIZE];\n\tuint16_t alt1_boot_lun_number;\n\tuint8_t alt2_boot_node_name[WWN_SIZE];\n\tuint16_t alt2_boot_lun_number;\n\tuint8_t alt3_boot_node_name[WWN_SIZE];\n\tuint16_t alt3_boot_lun_number;\n\tuint8_t alt4_boot_node_name[WWN_SIZE];\n\tuint16_t alt4_boot_lun_number;\n\tuint8_t alt5_boot_node_name[WWN_SIZE];\n\tuint16_t alt5_boot_lun_number;\n\tuint8_t alt6_boot_node_name[WWN_SIZE];\n\tuint16_t alt6_boot_lun_number;\n\tuint8_t alt7_boot_node_name[WWN_SIZE];\n\tuint16_t alt7_boot_lun_number;\n\n\tuint8_t reserved_3[2];\n\n\t/* Offset 200-215 : Model Number */\n\tuint8_t model_number[16];\n\n\t/* OEM related items */\n\tuint8_t oem_specific[16];\n\n\t/*\n\t * NVRAM Adapter Features offset 232-239\n\t *\n\t * LSB BIT 0 = External GBIC\n\t * LSB BIT 1 = Risc RAM parity\n\t * LSB BIT 2 = Buffer Plus Module\n\t * LSB BIT 3 = Multi Chip Adapter\n\t * LSB BIT 4 = Internal connector\n\t * LSB BIT 5 =\n\t * LSB BIT 6 =\n\t * LSB BIT 7 =\n\t *\n\t * MSB BIT 0 =\n\t * MSB BIT 1 =\n\t * MSB BIT 2 =\n\t * MSB BIT 3 =\n\t * MSB BIT 4 =\n\t * MSB BIT 5 =\n\t * MSB BIT 6 =\n\t * MSB BIT 7 =\n\t */\n\tuint8_t\tadapter_features[2];\n\n\tuint8_t reserved_4[16];\n\n\t/* Subsystem vendor ID for ISP2200 */\n\tuint16_t subsystem_vendor_id_2200;\n\n\t/* Subsystem device ID for ISP2200 */\n\tuint16_t subsystem_device_id_2200;\n\n\tuint8_t\t reserved_5;\n\tuint8_t\t checksum;\n} nvram_t;\n\n/*\n * ISP queue - response queue entry definition.\n */\ntypedef struct {\n\tuint8_t\t\tentry_type;\t\t/* Entry type. */\n\tuint8_t\t\tentry_count;\t\t/* Entry count. */\n\tuint8_t\t\tsys_define;\t\t/* System defined. */\n\tuint8_t\t\tentry_status;\t\t/* Entry Status. */\n\tuint32_t\thandle;\t\t\t/* System defined handle */\n\tuint8_t\t\tdata[52];\n\tuint32_t\tsignature;\n#define RESPONSE_PROCESSED\t0xDEADDEAD\t/* Signature */\n} response_t;\n\n/*\n * ISP queue - ATIO queue entry definition.\n */\nstruct atio {\n\tuint8_t\t\tentry_type;\t\t/* Entry type. */\n\tuint8_t\t\tentry_count;\t\t/* Entry count. */\n\t__le16\t\tattr_n_length;\n\tuint8_t\t\tdata[56];\n\tuint32_t\tsignature;\n#define ATIO_PROCESSED 0xDEADDEAD\t\t/* Signature */\n};\n\ntypedef union {\n\t__le16\textended;\n\tstruct {\n\t\tuint8_t reserved;\n\t\tuint8_t standard;\n\t} id;\n} target_id_t;\n\n#define SET_TARGET_ID(ha, to, from)\t\t\t\\\ndo {\t\t\t\t\t\t\t\\\n\tif (HAS_EXTENDED_IDS(ha))\t\t\t\\\n\t\tto.extended = cpu_to_le16(from);\t\\\n\telse\t\t\t\t\t\t\\\n\t\tto.id.standard = (uint8_t)from;\t\t\\\n} while (0)\n\n/*\n * ISP queue - command entry structure definition.\n */\n#define COMMAND_TYPE\t0x11\t\t/* Command entry */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t sys_define;\t\t/* System defined. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t handle;\t\t/* System handle. */\n\ttarget_id_t target;\t\t/* SCSI ID */\n\t__le16\tlun;\t\t\t/* SCSI LUN */\n\t__le16\tcontrol_flags;\t\t/* Control flags. */\n#define CF_WRITE\tBIT_6\n#define CF_READ\t\tBIT_5\n#define CF_SIMPLE_TAG\tBIT_3\n#define CF_ORDERED_TAG\tBIT_2\n#define CF_HEAD_TAG\tBIT_1\n\tuint16_t reserved_1;\n\t__le16\ttimeout;\t\t/* Command timeout. */\n\t__le16\tdseg_count;\t\t/* Data segment count. */\n\tuint8_t scsi_cdb[MAX_CMDSZ]; \t/* SCSI command words. */\n\t__le32\tbyte_count;\t\t/* Total byte count. */\n\tunion {\n\t\tstruct dsd32 dsd32[3];\n\t\tstruct dsd64 dsd64[2];\n\t};\n} cmd_entry_t;\n\n/*\n * ISP queue - 64-Bit addressing, command entry structure definition.\n */\n#define COMMAND_A64_TYPE\t0x19\t/* Command A64 entry */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t sys_define;\t\t/* System defined. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t handle;\t\t/* System handle. */\n\ttarget_id_t target;\t\t/* SCSI ID */\n\t__le16\tlun;\t\t\t/* SCSI LUN */\n\t__le16\tcontrol_flags;\t\t/* Control flags. */\n\tuint16_t reserved_1;\n\t__le16\ttimeout;\t\t/* Command timeout. */\n\t__le16\tdseg_count;\t\t/* Data segment count. */\n\tuint8_t scsi_cdb[MAX_CMDSZ];\t/* SCSI command words. */\n\tuint32_t byte_count;\t\t/* Total byte count. */\n\tstruct dsd64 dsd[2];\n} cmd_a64_entry_t, request_t;\n\n/*\n * ISP queue - continuation entry structure definition.\n */\n#define CONTINUE_TYPE\t\t0x02\t/* Continuation entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t sys_define;\t\t/* System defined. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t reserved;\n\tstruct dsd32 dsd[7];\n} cont_entry_t;\n\n/*\n * ISP queue - 64-Bit addressing, continuation entry structure definition.\n */\n#define CONTINUE_A64_TYPE\t0x0A\t/* Continuation A64 entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t sys_define;\t\t/* System defined. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tstruct dsd64 dsd[5];\n} cont_a64_entry_t;\n\n#define PO_MODE_DIF_INSERT\t0\n#define PO_MODE_DIF_REMOVE\t1\n#define PO_MODE_DIF_PASS\t2\n#define PO_MODE_DIF_REPLACE\t3\n#define PO_MODE_DIF_TCP_CKSUM\t6\n#define PO_ENABLE_INCR_GUARD_SEED\tBIT_3\n#define PO_DISABLE_GUARD_CHECK\tBIT_4\n#define PO_DISABLE_INCR_REF_TAG\tBIT_5\n#define PO_DIS_HEADER_MODE\tBIT_7\n#define PO_ENABLE_DIF_BUNDLING\tBIT_8\n#define PO_DIS_FRAME_MODE\tBIT_9\n#define PO_DIS_VALD_APP_ESC\tBIT_10 /* Dis validation for escape tag/ffffh */\n#define PO_DIS_VALD_APP_REF_ESC BIT_11\n\n#define PO_DIS_APP_TAG_REPL\tBIT_12 /* disable REG Tag replacement */\n#define PO_DIS_REF_TAG_REPL\tBIT_13\n#define PO_DIS_APP_TAG_VALD\tBIT_14 /* disable REF Tag validation */\n#define PO_DIS_REF_TAG_VALD\tBIT_15\n\n/*\n * ISP queue - 64-Bit addressing, continuation crc entry structure definition.\n */\nstruct crc_context {\n\tuint32_t handle;\t\t/* System handle. */\n\t__le32 ref_tag;\n\t__le16 app_tag;\n\tuint8_t ref_tag_mask[4];\t/* Validation/Replacement Mask*/\n\tuint8_t app_tag_mask[2];\t/* Validation/Replacement Mask*/\n\t__le16 guard_seed;\t\t/* Initial Guard Seed */\n\t__le16 prot_opts;\t\t/* Requested Data Protection Mode */\n\t__le16 blk_size;\t\t/* Data size in bytes */\n\t__le16\trunt_blk_guard;\t/* Guard value for runt block (tape\n\t\t\t\t\t * only) */\n\t__le32 byte_count;\t\t/* Total byte count/ total data\n\t\t\t\t\t * transfer count */\n\tunion {\n\t\tstruct {\n\t\t\tuint32_t\treserved_1;\n\t\t\tuint16_t\treserved_2;\n\t\t\tuint16_t\treserved_3;\n\t\t\tuint32_t\treserved_4;\n\t\t\tstruct dsd64\tdata_dsd[1];\n\t\t\tuint32_t\treserved_5[2];\n\t\t\tuint32_t\treserved_6;\n\t\t} nobundling;\n\t\tstruct {\n\t\t\t__le32\tdif_byte_count;\t/* Total DIF byte\n\t\t\t\t\t\t\t * count */\n\t\t\tuint16_t\treserved_1;\n\t\t\t__le16\tdseg_count;\t/* Data segment count */\n\t\t\tuint32_t\treserved_2;\n\t\t\tstruct dsd64\tdata_dsd[1];\n\t\t\tstruct dsd64\tdif_dsd;\n\t\t} bundling;\n\t} u;\n\n\tstruct fcp_cmnd\tfcp_cmnd;\n\tdma_addr_t\tcrc_ctx_dma;\n\t/* List of DMA context transfers */\n\tstruct list_head dsd_list;\n\n\t/* List of DIF Bundling context DMA address */\n\tstruct list_head ldif_dsd_list;\n\tu8 no_ldif_dsd;\n\n\tstruct list_head ldif_dma_hndl_list;\n\tu32 dif_bundl_len;\n\tu8 no_dif_bundl;\n\t/* This structure should not exceed 512 bytes */\n};\n\n#define CRC_CONTEXT_LEN_FW\t(offsetof(struct crc_context, fcp_cmnd.lun))\n#define CRC_CONTEXT_FCPCMND_OFF\t(offsetof(struct crc_context, fcp_cmnd.lun))\n\n/*\n * ISP queue - status entry structure definition.\n */\n#define\tSTATUS_TYPE\t0x03\t\t/* Status entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t sys_define;\t\t/* System defined. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t handle;\t\t/* System handle. */\n\t__le16\tscsi_status;\t\t/* SCSI status. */\n\t__le16\tcomp_status;\t\t/* Completion status. */\n\t__le16\tstate_flags;\t\t/* State flags. */\n\t__le16\tstatus_flags;\t\t/* Status flags. */\n\t__le16\trsp_info_len;\t\t/* Response Info Length. */\n\t__le16\treq_sense_length;\t/* Request sense data length. */\n\t__le32\tresidual_length;\t/* Residual transfer length. */\n\tuint8_t rsp_info[8];\t\t/* FCP response information. */\n\tuint8_t req_sense_data[32];\t/* Request sense data. */\n} sts_entry_t;\n\n/*\n * Status entry entry status\n */\n#define RF_RQ_DMA_ERROR\tBIT_6\t\t/* Request Queue DMA error. */\n#define RF_INV_E_ORDER\tBIT_5\t\t/* Invalid entry order. */\n#define RF_INV_E_COUNT\tBIT_4\t\t/* Invalid entry count. */\n#define RF_INV_E_PARAM\tBIT_3\t\t/* Invalid entry parameter. */\n#define RF_INV_E_TYPE\tBIT_2\t\t/* Invalid entry type. */\n#define RF_BUSY\t\tBIT_1\t\t/* Busy */\n#define RF_MASK\t\t(RF_RQ_DMA_ERROR | RF_INV_E_ORDER | RF_INV_E_COUNT | \\\n\t\t\t RF_INV_E_PARAM | RF_INV_E_TYPE | RF_BUSY)\n#define RF_MASK_24XX\t(RF_INV_E_ORDER | RF_INV_E_COUNT | RF_INV_E_PARAM | \\\n\t\t\t RF_INV_E_TYPE)\n\n/*\n * Status entry SCSI status bit definitions.\n */\n#define SS_MASK\t\t\t\t0xfff\t/* Reserved bits BIT_12-BIT_15*/\n#define SS_RESIDUAL_UNDER\t\tBIT_11\n#define SS_RESIDUAL_OVER\t\tBIT_10\n#define SS_SENSE_LEN_VALID\t\tBIT_9\n#define SS_RESPONSE_INFO_LEN_VALID\tBIT_8\n#define SS_SCSI_STATUS_BYTE\t0xff\n\n#define SS_RESERVE_CONFLICT\t\t(BIT_4 | BIT_3)\n#define SS_BUSY_CONDITION\t\tBIT_3\n#define SS_CONDITION_MET\t\tBIT_2\n#define SS_CHECK_CONDITION\t\tBIT_1\n\n/*\n * Status entry completion status\n */\n#define CS_COMPLETE\t\t0x0\t/* No errors */\n#define CS_INCOMPLETE\t\t0x1\t/* Incomplete transfer of cmd. */\n#define CS_DMA\t\t\t0x2\t/* A DMA direction error. */\n#define CS_TRANSPORT\t\t0x3\t/* Transport error. */\n#define CS_RESET\t\t0x4\t/* SCSI bus reset occurred */\n#define CS_ABORTED\t\t0x5\t/* System aborted command. */\n#define CS_TIMEOUT\t\t0x6\t/* Timeout error. */\n#define CS_DATA_OVERRUN\t\t0x7\t/* Data overrun. */\n#define CS_DIF_ERROR\t\t0xC\t/* DIF error detected  */\n\n#define CS_DATA_UNDERRUN\t0x15\t/* Data Underrun. */\n#define CS_QUEUE_FULL\t\t0x1C\t/* Queue Full. */\n#define CS_PORT_UNAVAILABLE\t0x28\t/* Port unavailable */\n\t\t\t\t\t/* (selection timeout) */\n#define CS_PORT_LOGGED_OUT\t0x29\t/* Port Logged Out */\n#define CS_PORT_CONFIG_CHG\t0x2A\t/* Port Configuration Changed */\n#define CS_PORT_BUSY\t\t0x2B\t/* Port Busy */\n#define CS_COMPLETE_CHKCOND\t0x30\t/* Error? */\n#define CS_IOCB_ERROR\t\t0x31\t/* Generic error for IOCB request\n\t\t\t\t\t   failure */\n#define CS_BAD_PAYLOAD\t\t0x80\t/* Driver defined */\n#define CS_UNKNOWN\t\t0x81\t/* Driver defined */\n#define CS_RETRY\t\t0x82\t/* Driver defined */\n#define CS_LOOP_DOWN_ABORT\t0x83\t/* Driver defined */\n\n#define CS_BIDIR_RD_OVERRUN\t\t\t0x700\n#define CS_BIDIR_RD_WR_OVERRUN\t\t\t0x707\n#define CS_BIDIR_RD_OVERRUN_WR_UNDERRUN\t\t0x715\n#define CS_BIDIR_RD_UNDERRUN\t\t\t0x1500\n#define CS_BIDIR_RD_UNDERRUN_WR_OVERRUN\t\t0x1507\n#define CS_BIDIR_RD_WR_UNDERRUN\t\t\t0x1515\n#define CS_BIDIR_DMA\t\t\t\t0x200\n/*\n * Status entry status flags\n */\n#define SF_ABTS_TERMINATED\tBIT_10\n#define SF_LOGOUT_SENT\t\tBIT_13\n\n/*\n * ISP queue - status continuation entry structure definition.\n */\n#define\tSTATUS_CONT_TYPE\t0x10\t/* Status continuation entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t sys_define;\t\t/* System defined. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint8_t data[60];\t\t/* data */\n} sts_cont_entry_t;\n\n/*\n * ISP queue -\tRIO Type 1 status entry (32 bit I/O entry handles)\n *\t\tstructure definition.\n */\n#define\tSTATUS_TYPE_21 0x21\t\t/* Status entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t handle_count;\t\t/* Handle count. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t handle[15];\t\t/* System handles. */\n} sts21_entry_t;\n\n/*\n * ISP queue -\tRIO Type 2 status entry (16 bit I/O entry handles)\n *\t\tstructure definition.\n */\n#define\tSTATUS_TYPE_22\t0x22\t\t/* Status entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t handle_count;\t\t/* Handle count. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint16_t handle[30];\t\t/* System handles. */\n} sts22_entry_t;\n\n/*\n * ISP queue - marker entry structure definition.\n */\n#define MARKER_TYPE\t0x04\t\t/* Marker entry. */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t handle_count;\t\t/* Handle count. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t sys_define_2;\t\t/* System defined. */\n\ttarget_id_t target;\t\t/* SCSI ID */\n\tuint8_t modifier;\t\t/* Modifier (7-0). */\n#define MK_SYNC_ID_LUN\t0\t\t/* Synchronize ID/LUN */\n#define MK_SYNC_ID\t1\t\t/* Synchronize ID */\n#define MK_SYNC_ALL\t2\t\t/* Synchronize all ID/LUN */\n#define MK_SYNC_LIP\t3\t\t/* Synchronize all ID/LUN, */\n\t\t\t\t\t/* clear port changed, */\n\t\t\t\t\t/* use sequence number. */\n\tuint8_t reserved_1;\n\t__le16\tsequence_number;\t/* Sequence number of event */\n\t__le16\tlun;\t\t\t/* SCSI LUN */\n\tuint8_t reserved_2[48];\n} mrk_entry_t;\n\n/*\n * ISP queue - Management Server entry structure definition.\n */\n#define MS_IOCB_TYPE\t\t0x29\t/* Management Server IOCB entry */\ntypedef struct {\n\tuint8_t entry_type;\t\t/* Entry type. */\n\tuint8_t entry_count;\t\t/* Entry count. */\n\tuint8_t handle_count;\t\t/* Handle count. */\n\tuint8_t entry_status;\t\t/* Entry Status. */\n\tuint32_t handle1;\t\t/* System handle. */\n\ttarget_id_t loop_id;\n\t__le16\tstatus;\n\t__le16\tcontrol_flags;\t\t/* Control flags. */\n\tuint16_t reserved2;\n\t__le16\ttimeout;\n\t__le16\tcmd_dsd_count;\n\t__le16\ttotal_dsd_count;\n\tuint8_t type;\n\tuint8_t r_ctl;\n\t__le16\trx_id;\n\tuint16_t reserved3;\n\tuint32_t handle2;\n\t__le32\trsp_bytecount;\n\t__le32\treq_bytecount;\n\tstruct dsd64 req_dsd;\n\tstruct dsd64 rsp_dsd;\n} ms_iocb_entry_t;\n\n#define SCM_EDC_ACC_RECEIVED\t\tBIT_6\n#define SCM_RDF_ACC_RECEIVED\t\tBIT_7\n\n/*\n * ISP queue - Mailbox Command entry structure definition.\n */\n#define MBX_IOCB_TYPE\t0x39\nstruct mbx_entry {\n\tuint8_t entry_type;\n\tuint8_t entry_count;\n\tuint8_t sys_define1;\n\t/* Use sys_define1 for source type */\n#define SOURCE_SCSI\t0x00\n#define SOURCE_IP\t0x01\n#define SOURCE_VI\t0x02\n#define SOURCE_SCTP\t0x03\n#define SOURCE_MP\t0x04\n#define SOURCE_MPIOCTL\t0x05\n#define SOURCE_ASYNC_IOCB 0x07\n\n\tuint8_t entry_status;\n\n\tuint32_t handle;\n\ttarget_id_t loop_id;\n\n\t__le16\tstatus;\n\t__le16\tstate_flags;\n\t__le16\tstatus_flags;\n\n\tuint32_t sys_define2[2];\n\n\t__le16\tmb0;\n\t__le16\tmb1;\n\t__le16\tmb2;\n\t__le16\tmb3;\n\t__le16\tmb6;\n\t__le16\tmb7;\n\t__le16\tmb9;\n\t__le16\tmb10;\n\tuint32_t reserved_2[2];\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n};\n\n#ifndef IMMED_NOTIFY_TYPE\n#define IMMED_NOTIFY_TYPE 0x0D\t\t/* Immediate notify entry. */\n/*\n * ISP queue -\timmediate notify entry structure definition.\n *\t\tThis is sent by the ISP to the Target driver.\n *\t\tThis IOCB would have report of events sent by the\n *\t\tinitiator, that needs to be handled by the target\n *\t\tdriver immediately.\n */\nstruct imm_ntfy_from_isp {\n\tuint8_t\t entry_type;\t\t    /* Entry type. */\n\tuint8_t\t entry_count;\t\t    /* Entry count. */\n\tuint8_t\t sys_define;\t\t    /* System defined. */\n\tuint8_t\t entry_status;\t\t    /* Entry Status. */\n\tunion {\n\t\tstruct {\n\t\t\t__le32\tsys_define_2; /* System defined. */\n\t\t\ttarget_id_t target;\n\t\t\t__le16\tlun;\n\t\t\tuint8_t  target_id;\n\t\t\tuint8_t  reserved_1;\n\t\t\t__le16\tstatus_modifier;\n\t\t\t__le16\tstatus;\n\t\t\t__le16\ttask_flags;\n\t\t\t__le16\tseq_id;\n\t\t\t__le16\tsrr_rx_id;\n\t\t\t__le32\tsrr_rel_offs;\n\t\t\t__le16\tsrr_ui;\n#define SRR_IU_DATA_IN\t0x1\n#define SRR_IU_DATA_OUT\t0x5\n#define SRR_IU_STATUS\t0x7\n\t\t\t__le16\tsrr_ox_id;\n\t\t\tuint8_t reserved_2[28];\n\t\t} isp2x;\n\t\tstruct {\n\t\t\tuint32_t reserved;\n\t\t\t__le16\tnport_handle;\n\t\t\tuint16_t reserved_2;\n\t\t\t__le16\tflags;\n#define NOTIFY24XX_FLAGS_GLOBAL_TPRLO   BIT_1\n#define NOTIFY24XX_FLAGS_PUREX_IOCB     BIT_0\n\t\t\t__le16\tsrr_rx_id;\n\t\t\t__le16\tstatus;\n\t\t\tuint8_t  status_subcode;\n\t\t\tuint8_t  fw_handle;\n\t\t\t__le32\texchange_address;\n\t\t\t__le32\tsrr_rel_offs;\n\t\t\t__le16\tsrr_ui;\n\t\t\t__le16\tsrr_ox_id;\n\t\t\tunion {\n\t\t\t\tstruct {\n\t\t\t\t\tuint8_t node_name[8];\n\t\t\t\t} plogi; /* PLOGI/ADISC/PDISC */\n\t\t\t\tstruct {\n\t\t\t\t\t/* PRLI word 3 bit 0-15 */\n\t\t\t\t\t__le16\twd3_lo;\n\t\t\t\t\tuint8_t resv0[6];\n\t\t\t\t} prli;\n\t\t\t\tstruct {\n\t\t\t\t\tuint8_t port_id[3];\n\t\t\t\t\tuint8_t resv1;\n\t\t\t\t\t__le16\tnport_handle;\n\t\t\t\t\tuint16_t resv2;\n\t\t\t\t} req_els;\n\t\t\t} u;\n\t\t\tuint8_t port_name[8];\n\t\t\tuint8_t resv3[3];\n\t\t\tuint8_t  vp_index;\n\t\t\tuint32_t reserved_5;\n\t\t\tuint8_t  port_id[3];\n\t\t\tuint8_t  reserved_6;\n\t\t} isp24;\n\t} u;\n\tuint16_t reserved_7;\n\t__le16\tox_id;\n} __packed;\n#endif\n\n/*\n * ISP request and response queue entry sizes\n */\n#define RESPONSE_ENTRY_SIZE\t(sizeof(response_t))\n#define REQUEST_ENTRY_SIZE\t(sizeof(request_t))\n\n\n\n/*\n * Switch info gathering structure.\n */\ntypedef struct {\n\tport_id_t d_id;\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n\tuint8_t fabric_port_name[WWN_SIZE];\n\tuint16_t fp_speed;\n\tuint8_t fc4_type;\n\tuint8_t fc4_features;\n} sw_info_t;\n\n/* FCP-4 types */\n#define FC4_TYPE_FCP_SCSI\t0x08\n#define FC4_TYPE_NVME\t\t0x28\n#define FC4_TYPE_OTHER\t\t0x0\n#define FC4_TYPE_UNKNOWN\t0xff\n\n/* mailbox command 4G & above */\nstruct mbx_24xx_entry {\n\tuint8_t\t\tentry_type;\n\tuint8_t\t\tentry_count;\n\tuint8_t\t\tsys_define1;\n\tuint8_t\t\tentry_status;\n\tuint32_t\thandle;\n\tuint16_t\tmb[28];\n};\n\n#define IOCB_SIZE 64\n\n/*\n * Fibre channel port type.\n */\ntypedef enum {\n\tFCT_UNKNOWN,\n\tFCT_RSCN,\n\tFCT_SWITCH,\n\tFCT_BROADCAST,\n\tFCT_INITIATOR,\n\tFCT_TARGET,\n\tFCT_NVME_INITIATOR = 0x10,\n\tFCT_NVME_TARGET = 0x20,\n\tFCT_NVME_DISCOVERY = 0x40,\n\tFCT_NVME = 0xf0,\n} fc_port_type_t;\n\nenum qla_sess_deletion {\n\tQLA_SESS_DELETION_NONE\t\t= 0,\n\tQLA_SESS_DELETION_IN_PROGRESS,\n\tQLA_SESS_DELETED,\n};\n\nenum qlt_plogi_link_t {\n\tQLT_PLOGI_LINK_SAME_WWN,\n\tQLT_PLOGI_LINK_CONFLICT,\n\tQLT_PLOGI_LINK_MAX\n};\n\nstruct qlt_plogi_ack_t {\n\tstruct list_head\tlist;\n\tstruct imm_ntfy_from_isp iocb;\n\tport_id_t\tid;\n\tint\t\tref_count;\n\tvoid\t\t*fcport;\n};\n\nstruct ct_sns_desc {\n\tstruct ct_sns_pkt\t*ct_sns;\n\tdma_addr_t\t\tct_sns_dma;\n};\n\nenum discovery_state {\n\tDSC_DELETED,\n\tDSC_GNN_ID,\n\tDSC_GNL,\n\tDSC_LOGIN_PEND,\n\tDSC_LOGIN_FAILED,\n\tDSC_GPDB,\n\tDSC_UPD_FCPORT,\n\tDSC_LOGIN_COMPLETE,\n\tDSC_ADISC,\n\tDSC_DELETE_PEND,\n};\n\nenum login_state {\t/* FW control Target side */\n\tDSC_LS_LLIOCB_SENT = 2,\n\tDSC_LS_PLOGI_PEND,\n\tDSC_LS_PLOGI_COMP,\n\tDSC_LS_PRLI_PEND,\n\tDSC_LS_PRLI_COMP,\n\tDSC_LS_PORT_UNAVAIL,\n\tDSC_LS_PRLO_PEND = 9,\n\tDSC_LS_LOGO_PEND,\n};\n\nenum rscn_addr_format {\n\tRSCN_PORT_ADDR,\n\tRSCN_AREA_ADDR,\n\tRSCN_DOM_ADDR,\n\tRSCN_FAB_ADDR,\n};\n\n/*\n * Fibre channel port structure.\n */\ntypedef struct fc_port {\n\tstruct list_head list;\n\tstruct scsi_qla_host *vha;\n\n\tunsigned int conf_compl_supported:1;\n\tunsigned int deleted:2;\n\tunsigned int free_pending:1;\n\tunsigned int local:1;\n\tunsigned int logout_on_delete:1;\n\tunsigned int logo_ack_needed:1;\n\tunsigned int keep_nport_handle:1;\n\tunsigned int send_els_logo:1;\n\tunsigned int login_pause:1;\n\tunsigned int login_succ:1;\n\tunsigned int query:1;\n\tunsigned int id_changed:1;\n\tunsigned int scan_needed:1;\n\tunsigned int n2n_flag:1;\n\tunsigned int explicit_logout:1;\n\tunsigned int prli_pend_timer:1;\n\tuint8_t nvme_flag;\n\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n\tport_id_t d_id;\n\tuint16_t loop_id;\n\tuint16_t old_loop_id;\n\n\tstruct completion nvme_del_done;\n\tuint32_t nvme_prli_service_param;\n#define NVME_PRLI_SP_PI_CTRL\tBIT_9\n#define NVME_PRLI_SP_SLER\tBIT_8\n#define NVME_PRLI_SP_CONF       BIT_7\n#define NVME_PRLI_SP_INITIATOR  BIT_5\n#define NVME_PRLI_SP_TARGET     BIT_4\n#define NVME_PRLI_SP_DISCOVERY  BIT_3\n#define NVME_PRLI_SP_FIRST_BURST\tBIT_0\n\n\tuint32_t nvme_first_burst_size;\n#define NVME_FLAG_REGISTERED 4\n#define NVME_FLAG_DELETING 2\n#define NVME_FLAG_RESETTING 1\n\n\tstruct fc_port *conflict;\n\tunsigned char logout_completed;\n\tint generation;\n\n\tstruct se_session *se_sess;\n\tstruct kref sess_kref;\n\tstruct qla_tgt *tgt;\n\tunsigned long expires;\n\tstruct list_head del_list_entry;\n\tstruct work_struct free_work;\n\tstruct work_struct reg_work;\n\tuint64_t jiffies_at_registration;\n\tunsigned long prli_expired;\n\tstruct qlt_plogi_ack_t *plogi_link[QLT_PLOGI_LINK_MAX];\n\n\tuint16_t tgt_id;\n\tuint16_t old_tgt_id;\n\tuint16_t sec_since_registration;\n\n\tuint8_t fcp_prio;\n\n\tuint8_t fabric_port_name[WWN_SIZE];\n\tuint16_t fp_speed;\n\n\tfc_port_type_t port_type;\n\n\tatomic_t state;\n\tuint32_t flags;\n\n\tint login_retry;\n\n\tstruct fc_rport *rport, *drport;\n\tu32 supported_classes;\n\n\tuint8_t fc4_type;\n\tuint8_t fc4_features;\n\tuint8_t scan_state;\n\n\tunsigned long last_queue_full;\n\tunsigned long last_ramp_up;\n\n\tuint16_t port_id;\n\n\tstruct nvme_fc_remote_port *nvme_remote_port;\n\n\tunsigned long retry_delay_timestamp;\n\tstruct qla_tgt_sess *tgt_session;\n\tstruct ct_sns_desc ct_desc;\n\tenum discovery_state disc_state;\n\tatomic_t shadow_disc_state;\n\tenum discovery_state next_disc_state;\n\tenum login_state fw_login_state;\n\tunsigned long dm_login_expire;\n\tunsigned long plogi_nack_done_deadline;\n\n\tu32 login_gen, last_login_gen;\n\tu32 rscn_gen, last_rscn_gen;\n\tu32 chip_reset;\n\tstruct list_head gnl_entry;\n\tstruct work_struct del_work;\n\tu8 iocb[IOCB_SIZE];\n\tu8 current_login_state;\n\tu8 last_login_state;\n\tu16 n2n_link_reset_cnt;\n\tu16 n2n_chip_reset;\n\n\tstruct dentry *dfs_rport_dir;\n} fc_port_t;\n\nenum {\n\tFC4_PRIORITY_NVME = 1,\n\tFC4_PRIORITY_FCP  = 2,\n};\n\n#define QLA_FCPORT_SCAN\t\t1\n#define QLA_FCPORT_FOUND\t2\n\nstruct event_arg {\n\tfc_port_t\t\t*fcport;\n\tsrb_t\t\t\t*sp;\n\tport_id_t\t\tid;\n\tu16\t\t\tdata[2], rc;\n\tu8\t\t\tport_name[WWN_SIZE];\n\tu32\t\t\tiop[2];\n};\n\n#include \"qla_mr.h\"\n\n/*\n * Fibre channel port/lun states.\n */\n#define FCS_UNCONFIGURED\t1\n#define FCS_DEVICE_DEAD\t\t2\n#define FCS_DEVICE_LOST\t\t3\n#define FCS_ONLINE\t\t4\n\nextern const char *const port_state_str[5];\n\nstatic const char * const port_dstate_str[] = {\n\t\"DELETED\",\n\t\"GNN_ID\",\n\t\"GNL\",\n\t\"LOGIN_PEND\",\n\t\"LOGIN_FAILED\",\n\t\"GPDB\",\n\t\"UPD_FCPORT\",\n\t\"LOGIN_COMPLETE\",\n\t\"ADISC\",\n\t\"DELETE_PEND\"\n};\n\n/*\n * FC port flags.\n */\n#define FCF_FABRIC_DEVICE\tBIT_0\n#define FCF_LOGIN_NEEDED\tBIT_1\n#define FCF_FCP2_DEVICE\t\tBIT_2\n#define FCF_ASYNC_SENT\t\tBIT_3\n#define FCF_CONF_COMP_SUPPORTED BIT_4\n#define FCF_ASYNC_ACTIVE\tBIT_5\n\n/* No loop ID flag. */\n#define FC_NO_LOOP_ID\t\t0x1000\n\n/*\n * FC-CT interface\n *\n * NOTE: All structures are big-endian in form.\n */\n\n#define CT_REJECT_RESPONSE\t0x8001\n#define CT_ACCEPT_RESPONSE\t0x8002\n#define CT_REASON_INVALID_COMMAND_CODE\t\t0x01\n#define CT_REASON_CANNOT_PERFORM\t\t0x09\n#define CT_REASON_COMMAND_UNSUPPORTED\t\t0x0b\n#define CT_EXPL_ALREADY_REGISTERED\t\t0x10\n#define CT_EXPL_HBA_ATTR_NOT_REGISTERED\t\t0x11\n#define CT_EXPL_MULTIPLE_HBA_ATTR\t\t0x12\n#define CT_EXPL_INVALID_HBA_BLOCK_LENGTH\t0x13\n#define CT_EXPL_MISSING_REQ_HBA_ATTR\t\t0x14\n#define CT_EXPL_PORT_NOT_REGISTERED_\t\t0x15\n#define CT_EXPL_MISSING_HBA_ID_PORT_LIST\t0x16\n#define CT_EXPL_HBA_NOT_REGISTERED\t\t0x17\n#define CT_EXPL_PORT_ATTR_NOT_REGISTERED\t0x20\n#define CT_EXPL_PORT_NOT_REGISTERED\t\t0x21\n#define CT_EXPL_MULTIPLE_PORT_ATTR\t\t0x22\n#define CT_EXPL_INVALID_PORT_BLOCK_LENGTH\t0x23\n\n#define NS_N_PORT_TYPE\t0x01\n#define NS_NL_PORT_TYPE\t0x02\n#define NS_NX_PORT_TYPE\t0x7F\n\n#define\tGA_NXT_CMD\t0x100\n#define\tGA_NXT_REQ_SIZE\t(16 + 4)\n#define\tGA_NXT_RSP_SIZE\t(16 + 620)\n\n#define\tGPN_FT_CMD\t0x172\n#define\tGPN_FT_REQ_SIZE\t(16 + 4)\n#define\tGNN_FT_CMD\t0x173\n#define\tGNN_FT_REQ_SIZE\t(16 + 4)\n\n#define\tGID_PT_CMD\t0x1A1\n#define\tGID_PT_REQ_SIZE\t(16 + 4)\n\n#define\tGPN_ID_CMD\t0x112\n#define\tGPN_ID_REQ_SIZE\t(16 + 4)\n#define\tGPN_ID_RSP_SIZE\t(16 + 8)\n\n#define\tGNN_ID_CMD\t0x113\n#define\tGNN_ID_REQ_SIZE\t(16 + 4)\n#define\tGNN_ID_RSP_SIZE\t(16 + 8)\n\n#define\tGFT_ID_CMD\t0x117\n#define\tGFT_ID_REQ_SIZE\t(16 + 4)\n#define\tGFT_ID_RSP_SIZE\t(16 + 32)\n\n#define GID_PN_CMD 0x121\n#define GID_PN_REQ_SIZE (16 + 8)\n#define GID_PN_RSP_SIZE (16 + 4)\n\n#define\tRFT_ID_CMD\t0x217\n#define\tRFT_ID_REQ_SIZE\t(16 + 4 + 32)\n#define\tRFT_ID_RSP_SIZE\t16\n\n#define\tRFF_ID_CMD\t0x21F\n#define\tRFF_ID_REQ_SIZE\t(16 + 4 + 2 + 1 + 1)\n#define\tRFF_ID_RSP_SIZE\t16\n\n#define\tRNN_ID_CMD\t0x213\n#define\tRNN_ID_REQ_SIZE\t(16 + 4 + 8)\n#define\tRNN_ID_RSP_SIZE\t16\n\n#define\tRSNN_NN_CMD\t 0x239\n#define\tRSNN_NN_REQ_SIZE (16 + 8 + 1 + 255)\n#define\tRSNN_NN_RSP_SIZE 16\n\n#define\tGFPN_ID_CMD\t0x11C\n#define\tGFPN_ID_REQ_SIZE (16 + 4)\n#define\tGFPN_ID_RSP_SIZE (16 + 8)\n\n#define\tGPSC_CMD\t0x127\n#define\tGPSC_REQ_SIZE\t(16 + 8)\n#define\tGPSC_RSP_SIZE\t(16 + 2 + 2)\n\n#define GFF_ID_CMD\t0x011F\n#define GFF_ID_REQ_SIZE\t(16 + 4)\n#define GFF_ID_RSP_SIZE (16 + 128)\n\n/*\n * FDMI HBA attribute types.\n */\n#define FDMI1_HBA_ATTR_COUNT\t\t\t9\n#define FDMI2_HBA_ATTR_COUNT\t\t\t17\n\n#define FDMI_HBA_NODE_NAME\t\t\t0x1\n#define FDMI_HBA_MANUFACTURER\t\t\t0x2\n#define FDMI_HBA_SERIAL_NUMBER\t\t\t0x3\n#define FDMI_HBA_MODEL\t\t\t\t0x4\n#define FDMI_HBA_MODEL_DESCRIPTION\t\t0x5\n#define FDMI_HBA_HARDWARE_VERSION\t\t0x6\n#define FDMI_HBA_DRIVER_VERSION\t\t\t0x7\n#define FDMI_HBA_OPTION_ROM_VERSION\t\t0x8\n#define FDMI_HBA_FIRMWARE_VERSION\t\t0x9\n#define FDMI_HBA_OS_NAME_AND_VERSION\t\t0xa\n#define FDMI_HBA_MAXIMUM_CT_PAYLOAD_LENGTH\t0xb\n\n#define FDMI_HBA_NODE_SYMBOLIC_NAME\t\t0xc\n#define FDMI_HBA_VENDOR_SPECIFIC_INFO\t\t0xd\n#define FDMI_HBA_NUM_PORTS\t\t\t0xe\n#define FDMI_HBA_FABRIC_NAME\t\t\t0xf\n#define FDMI_HBA_BOOT_BIOS_NAME\t\t\t0x10\n#define FDMI_HBA_VENDOR_IDENTIFIER\t\t0xe0\n\nstruct ct_fdmi_hba_attr {\n\t__be16\ttype;\n\t__be16\tlen;\n\tunion {\n\t\tuint8_t node_name[WWN_SIZE];\n\t\tuint8_t manufacturer[64];\n\t\tuint8_t serial_num[32];\n\t\tuint8_t model[16+1];\n\t\tuint8_t model_desc[80];\n\t\tuint8_t hw_version[32];\n\t\tuint8_t driver_version[32];\n\t\tuint8_t orom_version[16];\n\t\tuint8_t fw_version[32];\n\t\tuint8_t os_version[128];\n\t\t__be32\t max_ct_len;\n\n\t\tuint8_t sym_name[256];\n\t\t__be32\t vendor_specific_info;\n\t\t__be32\t num_ports;\n\t\tuint8_t fabric_name[WWN_SIZE];\n\t\tuint8_t bios_name[32];\n\t\tuint8_t vendor_identifier[8];\n\t} a;\n};\n\nstruct ct_fdmi1_hba_attributes {\n\t__be32\tcount;\n\tstruct ct_fdmi_hba_attr entry[FDMI1_HBA_ATTR_COUNT];\n};\n\nstruct ct_fdmi2_hba_attributes {\n\t__be32\tcount;\n\tstruct ct_fdmi_hba_attr entry[FDMI2_HBA_ATTR_COUNT];\n};\n\n/*\n * FDMI Port attribute types.\n */\n#define FDMI1_PORT_ATTR_COUNT\t\t6\n#define FDMI2_PORT_ATTR_COUNT\t\t16\n#define FDMI2_SMARTSAN_PORT_ATTR_COUNT\t23\n\n#define FDMI_PORT_FC4_TYPES\t\t0x1\n#define FDMI_PORT_SUPPORT_SPEED\t\t0x2\n#define FDMI_PORT_CURRENT_SPEED\t\t0x3\n#define FDMI_PORT_MAX_FRAME_SIZE\t0x4\n#define FDMI_PORT_OS_DEVICE_NAME\t0x5\n#define FDMI_PORT_HOST_NAME\t\t0x6\n\n#define FDMI_PORT_NODE_NAME\t\t0x7\n#define FDMI_PORT_NAME\t\t\t0x8\n#define FDMI_PORT_SYM_NAME\t\t0x9\n#define FDMI_PORT_TYPE\t\t\t0xa\n#define FDMI_PORT_SUPP_COS\t\t0xb\n#define FDMI_PORT_FABRIC_NAME\t\t0xc\n#define FDMI_PORT_FC4_TYPE\t\t0xd\n#define FDMI_PORT_STATE\t\t\t0x101\n#define FDMI_PORT_COUNT\t\t\t0x102\n#define FDMI_PORT_IDENTIFIER\t\t0x103\n\n#define FDMI_SMARTSAN_SERVICE\t\t0xF100\n#define FDMI_SMARTSAN_GUID\t\t0xF101\n#define FDMI_SMARTSAN_VERSION\t\t0xF102\n#define FDMI_SMARTSAN_PROD_NAME\t\t0xF103\n#define FDMI_SMARTSAN_PORT_INFO\t\t0xF104\n#define FDMI_SMARTSAN_QOS_SUPPORT\t0xF105\n#define FDMI_SMARTSAN_SECURITY_SUPPORT\t0xF106\n\n#define FDMI_PORT_SPEED_1GB\t\t0x1\n#define FDMI_PORT_SPEED_2GB\t\t0x2\n#define FDMI_PORT_SPEED_10GB\t\t0x4\n#define FDMI_PORT_SPEED_4GB\t\t0x8\n#define FDMI_PORT_SPEED_8GB\t\t0x10\n#define FDMI_PORT_SPEED_16GB\t\t0x20\n#define FDMI_PORT_SPEED_32GB\t\t0x40\n#define FDMI_PORT_SPEED_64GB\t\t0x80\n#define FDMI_PORT_SPEED_UNKNOWN\t\t0x8000\n\n#define FC_CLASS_2\t0x04\n#define FC_CLASS_3\t0x08\n#define FC_CLASS_2_3\t0x0C\n\nstruct ct_fdmi_port_attr {\n\t__be16\ttype;\n\t__be16\tlen;\n\tunion {\n\t\tuint8_t fc4_types[32];\n\t\t__be32\tsup_speed;\n\t\t__be32\tcur_speed;\n\t\t__be32\tmax_frame_size;\n\t\tuint8_t os_dev_name[32];\n\t\tuint8_t host_name[256];\n\n\t\tuint8_t node_name[WWN_SIZE];\n\t\tuint8_t port_name[WWN_SIZE];\n\t\tuint8_t port_sym_name[128];\n\t\t__be32\tport_type;\n\t\t__be32\tport_supported_cos;\n\t\tuint8_t fabric_name[WWN_SIZE];\n\t\tuint8_t port_fc4_type[32];\n\t\t__be32\t port_state;\n\t\t__be32\t num_ports;\n\t\t__be32\t port_id;\n\n\t\tuint8_t smartsan_service[24];\n\t\tuint8_t smartsan_guid[16];\n\t\tuint8_t smartsan_version[24];\n\t\tuint8_t smartsan_prod_name[16];\n\t\t__be32\t smartsan_port_info;\n\t\t__be32\t smartsan_qos_support;\n\t\t__be32\t smartsan_security_support;\n\t} a;\n};\n\nstruct ct_fdmi1_port_attributes {\n\t__be32\t count;\n\tstruct ct_fdmi_port_attr entry[FDMI1_PORT_ATTR_COUNT];\n};\n\nstruct ct_fdmi2_port_attributes {\n\t__be32\tcount;\n\tstruct ct_fdmi_port_attr entry[FDMI2_PORT_ATTR_COUNT];\n};\n\n#define FDMI_ATTR_TYPELEN(obj) \\\n\t(sizeof((obj)->type) + sizeof((obj)->len))\n\n#define FDMI_ATTR_ALIGNMENT(len) \\\n\t(4 - ((len) & 3))\n\n/* FDMI register call options */\n#define CALLOPT_FDMI1\t\t0\n#define CALLOPT_FDMI2\t\t1\n#define CALLOPT_FDMI2_SMARTSAN\t2\n\n/* FDMI definitions. */\n#define GRHL_CMD\t0x100\n#define GHAT_CMD\t0x101\n#define GRPL_CMD\t0x102\n#define GPAT_CMD\t0x110\n\n#define RHBA_CMD\t0x200\n#define RHBA_RSP_SIZE\t16\n\n#define RHAT_CMD\t0x201\n\n#define RPRT_CMD\t0x210\n#define RPRT_RSP_SIZE\t24\n\n#define RPA_CMD\t\t0x211\n#define RPA_RSP_SIZE\t16\n#define SMARTSAN_RPA_RSP_SIZE\t24\n\n#define DHBA_CMD\t0x300\n#define DHBA_REQ_SIZE\t(16 + 8)\n#define DHBA_RSP_SIZE\t16\n\n#define DHAT_CMD\t0x301\n#define DPRT_CMD\t0x310\n#define DPA_CMD\t\t0x311\n\n/* CT command header -- request/response common fields */\nstruct ct_cmd_hdr {\n\tuint8_t revision;\n\tuint8_t in_id[3];\n\tuint8_t gs_type;\n\tuint8_t gs_subtype;\n\tuint8_t options;\n\tuint8_t reserved;\n};\n\n/* CT command request */\nstruct ct_sns_req {\n\tstruct ct_cmd_hdr header;\n\t__be16\tcommand;\n\t__be16\tmax_rsp_size;\n\tuint8_t fragment_id;\n\tuint8_t reserved[3];\n\n\tunion {\n\t\t/* GA_NXT, GPN_ID, GNN_ID, GFT_ID, GFPN_ID */\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t} port_id;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t domain;\n\t\t\tuint8_t area;\n\t\t\tuint8_t port_type;\n\t\t} gpn_ft;\n\n\t\tstruct {\n\t\t\tuint8_t port_type;\n\t\t\tuint8_t domain;\n\t\t\tuint8_t area;\n\t\t\tuint8_t reserved;\n\t\t} gid_pt;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t\tuint8_t fc4_types[32];\n\t\t} rft_id;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t\tuint16_t reserved2;\n\t\t\tuint8_t fc4_feature;\n\t\t\tuint8_t fc4_type;\n\t\t} rff_id;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t\tuint8_t node_name[8];\n\t\t} rnn_id;\n\n\t\tstruct {\n\t\t\tuint8_t node_name[8];\n\t\t\tuint8_t name_len;\n\t\t\tuint8_t sym_node_name[255];\n\t\t} rsnn_nn;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t} ghat;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t\t__be32\tentry_count;\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi2_hba_attributes attrs;\n\t\t} rhba;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t\tstruct ct_fdmi1_hba_attributes attrs;\n\t\t} rhat;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi2_port_attributes attrs;\n\t\t} rpa;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi2_port_attributes attrs;\n\t\t} rprt;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dhba;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dhat;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dprt;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dpa;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gpsc;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t port_id[3];\n\t\t} gff_id;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gid_pn;\n\t} req;\n};\n\n/* CT command response header */\nstruct ct_rsp_hdr {\n\tstruct ct_cmd_hdr header;\n\t__be16\tresponse;\n\tuint16_t residual;\n\tuint8_t fragment_id;\n\tuint8_t reason_code;\n\tuint8_t explanation_code;\n\tuint8_t vendor_unique;\n};\n\nstruct ct_sns_gid_pt_data {\n\tuint8_t control_byte;\n\tbe_id_t port_id;\n};\n\n/* It's the same for both GPN_FT and GNN_FT */\nstruct ct_sns_gpnft_rsp {\n\tstruct {\n\t\tstruct ct_cmd_hdr header;\n\t\tuint16_t response;\n\t\tuint16_t residual;\n\t\tuint8_t fragment_id;\n\t\tuint8_t reason_code;\n\t\tuint8_t explanation_code;\n\t\tuint8_t vendor_unique;\n\t};\n\t/* Assume the largest number of targets for the union */\n\tstruct ct_sns_gpn_ft_data {\n\t\tu8 control_byte;\n\t\tu8 port_id[3];\n\t\tu32 reserved;\n\t\tu8 port_name[8];\n\t} entries[1];\n};\n\n/* CT command response */\nstruct ct_sns_rsp {\n\tstruct ct_rsp_hdr header;\n\n\tunion {\n\t\tstruct {\n\t\t\tuint8_t port_type;\n\t\t\tbe_id_t port_id;\n\t\t\tuint8_t port_name[8];\n\t\t\tuint8_t sym_port_name_len;\n\t\t\tuint8_t sym_port_name[255];\n\t\t\tuint8_t node_name[8];\n\t\t\tuint8_t sym_node_name_len;\n\t\t\tuint8_t sym_node_name[255];\n\t\t\tuint8_t init_proc_assoc[8];\n\t\t\tuint8_t node_ip_addr[16];\n\t\t\tuint8_t class_of_service[4];\n\t\t\tuint8_t fc4_types[32];\n\t\t\tuint8_t ip_address[16];\n\t\t\tuint8_t fabric_port_name[8];\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t hard_address[3];\n\t\t} ga_nxt;\n\n\t\tstruct {\n\t\t\t/* Assume the largest number of targets for the union */\n\t\t\tstruct ct_sns_gid_pt_data\n\t\t\t    entries[MAX_FIBRE_DEVICES_MAX];\n\t\t} gid_pt;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gpn_id;\n\n\t\tstruct {\n\t\t\tuint8_t node_name[8];\n\t\t} gnn_id;\n\n\t\tstruct {\n\t\t\tuint8_t fc4_types[32];\n\t\t} gft_id;\n\n\t\tstruct {\n\t\t\tuint32_t entry_count;\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi1_hba_attributes attrs;\n\t\t} ghat;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gfpn_id;\n\n\t\tstruct {\n\t\t\t__be16\tspeeds;\n\t\t\t__be16\tspeed;\n\t\t} gpsc;\n\n#define GFF_FCP_SCSI_OFFSET\t7\n#define GFF_NVME_OFFSET\t\t23 /* type = 28h */\n\t\tstruct {\n\t\t\tuint8_t fc4_features[128];\n\t\t} gff_id;\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t port_id[3];\n\t\t} gid_pn;\n\t} rsp;\n};\n\nstruct ct_sns_pkt {\n\tunion {\n\t\tstruct ct_sns_req req;\n\t\tstruct ct_sns_rsp rsp;\n\t} p;\n};\n\nstruct ct_sns_gpnft_pkt {\n\tunion {\n\t\tstruct ct_sns_req req;\n\t\tstruct ct_sns_gpnft_rsp rsp;\n\t} p;\n};\n\nenum scan_flags_t {\n\tSF_SCANNING = BIT_0,\n\tSF_QUEUED = BIT_1,\n};\n\nenum fc4type_t {\n\tFS_FC4TYPE_FCP\t= BIT_0,\n\tFS_FC4TYPE_NVME\t= BIT_1,\n\tFS_FCP_IS_N2N = BIT_7,\n};\n\nstruct fab_scan_rp {\n\tport_id_t id;\n\tenum fc4type_t fc4type;\n\tu8 port_name[8];\n\tu8 node_name[8];\n};\n\nstruct fab_scan {\n\tstruct fab_scan_rp *l;\n\tu32 size;\n\tu16 scan_retry;\n#define MAX_SCAN_RETRIES 5\n\tenum scan_flags_t scan_flags;\n\tstruct delayed_work scan_work;\n};\n\n/*\n * SNS command structures -- for 2200 compatibility.\n */\n#define\tRFT_ID_SNS_SCMD_LEN\t22\n#define\tRFT_ID_SNS_CMD_SIZE\t60\n#define\tRFT_ID_SNS_DATA_SIZE\t16\n\n#define\tRNN_ID_SNS_SCMD_LEN\t10\n#define\tRNN_ID_SNS_CMD_SIZE\t36\n#define\tRNN_ID_SNS_DATA_SIZE\t16\n\n#define\tGA_NXT_SNS_SCMD_LEN\t6\n#define\tGA_NXT_SNS_CMD_SIZE\t28\n#define\tGA_NXT_SNS_DATA_SIZE\t(620 + 16)\n\n#define\tGID_PT_SNS_SCMD_LEN\t6\n#define\tGID_PT_SNS_CMD_SIZE\t28\n/*\n * Assume MAX_FIBRE_DEVICES_2100 as these defines are only used with older\n * adapters.\n */\n#define\tGID_PT_SNS_DATA_SIZE\t(MAX_FIBRE_DEVICES_2100 * 4 + 16)\n\n#define\tGPN_ID_SNS_SCMD_LEN\t6\n#define\tGPN_ID_SNS_CMD_SIZE\t28\n#define\tGPN_ID_SNS_DATA_SIZE\t(8 + 16)\n\n#define\tGNN_ID_SNS_SCMD_LEN\t6\n#define\tGNN_ID_SNS_CMD_SIZE\t28\n#define\tGNN_ID_SNS_DATA_SIZE\t(8 + 16)\n\nstruct sns_cmd_pkt {\n\tunion {\n\t\tstruct {\n\t\t\t__le16\tbuffer_length;\n\t\t\t__le16\treserved_1;\n\t\t\t__le64\tbuffer_address __packed;\n\t\t\t__le16\tsubcommand_length;\n\t\t\t__le16\treserved_2;\n\t\t\t__le16\tsubcommand;\n\t\t\t__le16\tsize;\n\t\t\tuint32_t reserved_3;\n\t\t\tuint8_t param[36];\n\t\t} cmd;\n\n\t\tuint8_t rft_data[RFT_ID_SNS_DATA_SIZE];\n\t\tuint8_t rnn_data[RNN_ID_SNS_DATA_SIZE];\n\t\tuint8_t gan_data[GA_NXT_SNS_DATA_SIZE];\n\t\tuint8_t gid_data[GID_PT_SNS_DATA_SIZE];\n\t\tuint8_t gpn_data[GPN_ID_SNS_DATA_SIZE];\n\t\tuint8_t gnn_data[GNN_ID_SNS_DATA_SIZE];\n\t} p;\n};\n\nstruct fw_blob {\n\tchar *name;\n\tuint32_t segs[4];\n\tconst struct firmware *fw;\n};\n\n/* Return data from MBC_GET_ID_LIST call. */\nstruct gid_list_info {\n\tuint8_t\tal_pa;\n\tuint8_t\tarea;\n\tuint8_t\tdomain;\n\tuint8_t\tloop_id_2100;\t/* ISP2100/ISP2200 -- 4 bytes. */\n\t__le16\tloop_id;\t/* ISP23XX         -- 6 bytes. */\n\tuint16_t reserved_1;\t/* ISP24XX         -- 8 bytes. */\n};\n\n/* NPIV */\ntypedef struct vport_info {\n\tuint8_t\t\tport_name[WWN_SIZE];\n\tuint8_t\t\tnode_name[WWN_SIZE];\n\tint\t\tvp_id;\n\tuint16_t\tloop_id;\n\tunsigned long\thost_no;\n\tuint8_t\t\tport_id[3];\n\tint\t\tloop_state;\n} vport_info_t;\n\ntypedef struct vport_params {\n\tuint8_t \tport_name[WWN_SIZE];\n\tuint8_t \tnode_name[WWN_SIZE];\n\tuint32_t \toptions;\n#define\tVP_OPTS_RETRY_ENABLE\tBIT_0\n#define\tVP_OPTS_VP_DISABLE\tBIT_1\n} vport_params_t;\n\n/* NPIV - return codes of VP create and modify */\n#define VP_RET_CODE_OK\t\t\t0\n#define VP_RET_CODE_FATAL\t\t1\n#define VP_RET_CODE_WRONG_ID\t\t2\n#define VP_RET_CODE_WWPN\t\t3\n#define VP_RET_CODE_RESOURCES\t\t4\n#define VP_RET_CODE_NO_MEM\t\t5\n#define VP_RET_CODE_NOT_FOUND\t\t6\n\nstruct qla_hw_data;\nstruct rsp_que;\n/*\n * ISP operations\n */\nstruct isp_operations {\n\n\tint (*pci_config) (struct scsi_qla_host *);\n\tint (*reset_chip)(struct scsi_qla_host *);\n\tint (*chip_diag) (struct scsi_qla_host *);\n\tvoid (*config_rings) (struct scsi_qla_host *);\n\tint (*reset_adapter)(struct scsi_qla_host *);\n\tint (*nvram_config) (struct scsi_qla_host *);\n\tvoid (*update_fw_options) (struct scsi_qla_host *);\n\tint (*load_risc) (struct scsi_qla_host *, uint32_t *);\n\n\tchar * (*pci_info_str)(struct scsi_qla_host *, char *, size_t);\n\tchar * (*fw_version_str)(struct scsi_qla_host *, char *, size_t);\n\n\tirq_handler_t intr_handler;\n\tvoid (*enable_intrs) (struct qla_hw_data *);\n\tvoid (*disable_intrs) (struct qla_hw_data *);\n\n\tint (*abort_command) (srb_t *);\n\tint (*target_reset) (struct fc_port *, uint64_t, int);\n\tint (*lun_reset) (struct fc_port *, uint64_t, int);\n\tint (*fabric_login) (struct scsi_qla_host *, uint16_t, uint8_t,\n\t\tuint8_t, uint8_t, uint16_t *, uint8_t);\n\tint (*fabric_logout) (struct scsi_qla_host *, uint16_t, uint8_t,\n\t    uint8_t, uint8_t);\n\n\tuint16_t (*calc_req_entries) (uint16_t);\n\tvoid (*build_iocbs) (srb_t *, cmd_entry_t *, uint16_t);\n\tvoid *(*prep_ms_iocb) (struct scsi_qla_host *, struct ct_arg *);\n\tvoid *(*prep_ms_fdmi_iocb) (struct scsi_qla_host *, uint32_t,\n\t    uint32_t);\n\n\tuint8_t *(*read_nvram)(struct scsi_qla_host *, void *,\n\t\tuint32_t, uint32_t);\n\tint (*write_nvram)(struct scsi_qla_host *, void *, uint32_t,\n\t\tuint32_t);\n\n\tvoid (*fw_dump)(struct scsi_qla_host *vha);\n\tvoid (*mpi_fw_dump)(struct scsi_qla_host *, int);\n\n\tint (*beacon_on) (struct scsi_qla_host *);\n\tint (*beacon_off) (struct scsi_qla_host *);\n\tvoid (*beacon_blink) (struct scsi_qla_host *);\n\n\tvoid *(*read_optrom)(struct scsi_qla_host *, void *,\n\t\tuint32_t, uint32_t);\n\tint (*write_optrom)(struct scsi_qla_host *, void *, uint32_t,\n\t\tuint32_t);\n\n\tint (*get_flash_version) (struct scsi_qla_host *, void *);\n\tint (*start_scsi) (srb_t *);\n\tint (*start_scsi_mq) (srb_t *);\n\tint (*abort_isp) (struct scsi_qla_host *);\n\tint (*iospace_config)(struct qla_hw_data *);\n\tint (*initialize_adapter)(struct scsi_qla_host *);\n};\n\n/* MSI-X Support *************************************************************/\n\n#define QLA_MSIX_CHIP_REV_24XX\t3\n#define QLA_MSIX_FW_MODE(m)\t(((m) & (BIT_7|BIT_8|BIT_9)) >> 7)\n#define QLA_MSIX_FW_MODE_1(m)\t(QLA_MSIX_FW_MODE(m) == 1)\n\n#define QLA_BASE_VECTORS\t2 /* default + RSP */\n#define QLA_MSIX_RSP_Q\t\t\t0x01\n#define QLA_ATIO_VECTOR\t\t0x02\n#define QLA_MSIX_QPAIR_MULTIQ_RSP_Q\t0x03\n#define QLA_MSIX_QPAIR_MULTIQ_RSP_Q_HS\t0x04\n\n#define QLA_MIDX_DEFAULT\t0\n#define QLA_MIDX_RSP_Q\t\t1\n#define QLA_PCI_MSIX_CONTROL\t0xa2\n#define QLA_83XX_PCI_MSIX_CONTROL\t0x92\n\nstruct scsi_qla_host;\n\n\n#define QLA83XX_RSPQ_MSIX_ENTRY_NUMBER 1 /* refer to qla83xx_msix_entries */\n\nstruct qla_msix_entry {\n\tint have_irq;\n\tint in_use;\n\tuint32_t vector;\n\tuint16_t entry;\n\tchar name[30];\n\tvoid *handle;\n\tint cpuid;\n};\n\n#define\tWATCH_INTERVAL\t\t1       /* number of seconds */\n\n/* Work events.  */\nenum qla_work_type {\n\tQLA_EVT_AEN,\n\tQLA_EVT_IDC_ACK,\n\tQLA_EVT_ASYNC_LOGIN,\n\tQLA_EVT_ASYNC_LOGOUT,\n\tQLA_EVT_ASYNC_ADISC,\n\tQLA_EVT_UEVENT,\n\tQLA_EVT_AENFX,\n\tQLA_EVT_GPNID,\n\tQLA_EVT_UNMAP,\n\tQLA_EVT_NEW_SESS,\n\tQLA_EVT_GPDB,\n\tQLA_EVT_PRLI,\n\tQLA_EVT_GPSC,\n\tQLA_EVT_GNL,\n\tQLA_EVT_NACK,\n\tQLA_EVT_RELOGIN,\n\tQLA_EVT_ASYNC_PRLO,\n\tQLA_EVT_ASYNC_PRLO_DONE,\n\tQLA_EVT_GPNFT,\n\tQLA_EVT_GPNFT_DONE,\n\tQLA_EVT_GNNFT_DONE,\n\tQLA_EVT_GNNID,\n\tQLA_EVT_GFPNID,\n\tQLA_EVT_SP_RETRY,\n\tQLA_EVT_IIDMA,\n\tQLA_EVT_ELS_PLOGI,\n};\n\n\nstruct qla_work_evt {\n\tstruct list_head\tlist;\n\tenum qla_work_type\ttype;\n\tu32\t\t\tflags;\n#define QLA_EVT_FLAG_FREE\t0x1\n\n\tunion {\n\t\tstruct {\n\t\t\tenum fc_host_event_code code;\n\t\t\tu32 data;\n\t\t} aen;\n\t\tstruct {\n#define QLA_IDC_ACK_REGS\t7\n\t\t\tuint16_t mb[QLA_IDC_ACK_REGS];\n\t\t} idc_ack;\n\t\tstruct {\n\t\t\tstruct fc_port *fcport;\n#define QLA_LOGIO_LOGIN_RETRIED\tBIT_0\n\t\t\tu16 data[2];\n\t\t} logio;\n\t\tstruct {\n\t\t\tu32 code;\n#define QLA_UEVENT_CODE_FW_DUMP\t0\n\t\t} uevent;\n\t\tstruct {\n\t\t\tuint32_t        evtcode;\n\t\t\tuint32_t        mbx[8];\n\t\t\tuint32_t        count;\n\t\t} aenfx;\n\t\tstruct {\n\t\t\tsrb_t *sp;\n\t\t} iosb;\n\t\tstruct {\n\t\t\tport_id_t id;\n\t\t} gpnid;\n\t\tstruct {\n\t\t\tport_id_t id;\n\t\t\tu8 port_name[8];\n\t\t\tu8 node_name[8];\n\t\t\tvoid *pla;\n\t\t\tu8 fc4_type;\n\t\t} new_sess;\n\t\tstruct { /*Get PDB, Get Speed, update fcport, gnl, gidpn */\n\t\t\tfc_port_t *fcport;\n\t\t\tu8 opt;\n\t\t} fcport;\n\t\tstruct {\n\t\t\tfc_port_t *fcport;\n\t\t\tu8 iocb[IOCB_SIZE];\n\t\t\tint type;\n\t\t} nack;\n\t\tstruct {\n\t\t\tu8 fc4_type;\n\t\t\tsrb_t *sp;\n\t\t} gpnft;\n\t } u;\n};\n\nstruct qla_chip_state_84xx {\n\tstruct list_head list;\n\tstruct kref kref;\n\n\tvoid *bus;\n\tspinlock_t access_lock;\n\tstruct mutex fw_update_mutex;\n\tuint32_t fw_update;\n\tuint32_t op_fw_version;\n\tuint32_t op_fw_size;\n\tuint32_t op_fw_seq_size;\n\tuint32_t diag_fw_version;\n\tuint32_t gold_fw_version;\n};\n\nstruct qla_dif_statistics {\n\tuint64_t dif_input_bytes;\n\tuint64_t dif_output_bytes;\n\tuint64_t dif_input_requests;\n\tuint64_t dif_output_requests;\n\tuint32_t dif_guard_err;\n\tuint32_t dif_ref_tag_err;\n\tuint32_t dif_app_tag_err;\n};\n\nstruct qla_statistics {\n\tuint32_t total_isp_aborts;\n\tuint64_t input_bytes;\n\tuint64_t output_bytes;\n\tuint64_t input_requests;\n\tuint64_t output_requests;\n\tuint32_t control_requests;\n\n\tuint64_t jiffies_at_last_reset;\n\tuint32_t stat_max_pend_cmds;\n\tuint32_t stat_max_qfull_cmds_alloc;\n\tuint32_t stat_max_qfull_cmds_dropped;\n\n\tstruct qla_dif_statistics qla_dif_stats;\n};\n\nstruct bidi_statistics {\n\tunsigned long long io_count;\n\tunsigned long long transfer_bytes;\n};\n\nstruct qla_tc_param {\n\tstruct scsi_qla_host *vha;\n\tuint32_t blk_sz;\n\tuint32_t bufflen;\n\tstruct scatterlist *sg;\n\tstruct scatterlist *prot_sg;\n\tstruct crc_context *ctx;\n\tuint8_t *ctx_dsd_alloced;\n};\n\n/* Multi queue support */\n#define MBC_INITIALIZE_MULTIQ 0x1f\n#define QLA_QUE_PAGE 0X1000\n#define QLA_MQ_SIZE 32\n#define QLA_MAX_QUEUES 256\n#define ISP_QUE_REG(ha, id) \\\n\t((ha->mqenable || IS_QLA83XX(ha) || \\\n\t  IS_QLA27XX(ha) || IS_QLA28XX(ha)) ? \\\n\t ((void __iomem *)ha->mqiobase + (QLA_QUE_PAGE * id)) :\\\n\t ((void __iomem *)ha->iobase))\n#define QLA_REQ_QUE_ID(tag) \\\n\t((tag < QLA_MAX_QUEUES && tag > 0) ? tag : 0)\n#define QLA_DEFAULT_QUE_QOS 5\n#define QLA_PRECONFIG_VPORTS 32\n#define QLA_MAX_VPORTS_QLA24XX\t128\n#define QLA_MAX_VPORTS_QLA25XX\t256\n\nstruct qla_tgt_counters {\n\tuint64_t qla_core_sbt_cmd;\n\tuint64_t core_qla_que_buf;\n\tuint64_t qla_core_ret_ctio;\n\tuint64_t core_qla_snd_status;\n\tuint64_t qla_core_ret_sta_ctio;\n\tuint64_t core_qla_free_cmd;\n\tuint64_t num_q_full_sent;\n\tuint64_t num_alloc_iocb_failed;\n\tuint64_t num_term_xchg_sent;\n};\n\nstruct qla_counters {\n\tuint64_t input_bytes;\n\tuint64_t input_requests;\n\tuint64_t output_bytes;\n\tuint64_t output_requests;\n\n};\n\nstruct qla_qpair;\n\n/* Response queue data structure */\nstruct rsp_que {\n\tdma_addr_t  dma;\n\tresponse_t *ring;\n\tresponse_t *ring_ptr;\n\t__le32\t__iomem *rsp_q_in;\t/* FWI2-capable only. */\n\t__le32\t__iomem *rsp_q_out;\n\tuint16_t  ring_index;\n\tuint16_t  out_ptr;\n\tuint16_t  *in_ptr;\t\t/* queue shadow in index */\n\tuint16_t  length;\n\tuint16_t  options;\n\tuint16_t  rid;\n\tuint16_t  id;\n\tuint16_t  vp_idx;\n\tstruct qla_hw_data *hw;\n\tstruct qla_msix_entry *msix;\n\tstruct req_que *req;\n\tsrb_t *status_srb; /* status continuation entry */\n\tstruct qla_qpair *qpair;\n\n\tdma_addr_t  dma_fx00;\n\tresponse_t *ring_fx00;\n\tuint16_t  length_fx00;\n\tuint8_t rsp_pkt[REQUEST_ENTRY_SIZE];\n};\n\n/* Request queue data structure */\nstruct req_que {\n\tdma_addr_t  dma;\n\trequest_t *ring;\n\trequest_t *ring_ptr;\n\t__le32\t__iomem *req_q_in;\t/* FWI2-capable only. */\n\t__le32\t__iomem *req_q_out;\n\tuint16_t  ring_index;\n\tuint16_t  in_ptr;\n\tuint16_t  *out_ptr;\t\t/* queue shadow out index */\n\tuint16_t  cnt;\n\tuint16_t  length;\n\tuint16_t  options;\n\tuint16_t  rid;\n\tuint16_t  id;\n\tuint16_t  qos;\n\tuint16_t  vp_idx;\n\tstruct rsp_que *rsp;\n\tsrb_t **outstanding_cmds;\n\tuint32_t current_outstanding_cmd;\n\tuint16_t num_outstanding_cmds;\n\tint max_q_depth;\n\n\tdma_addr_t  dma_fx00;\n\trequest_t *ring_fx00;\n\tuint16_t  length_fx00;\n\tuint8_t req_pkt[REQUEST_ENTRY_SIZE];\n};\n\nstruct qla_fw_resources {\n\tu16 iocbs_total;\n\tu16 iocbs_limit;\n\tu16 iocbs_qp_limit;\n\tu16 iocbs_used;\n};\n\n#define QLA_IOCB_PCT_LIMIT 95\n\n/*Queue pair data structure */\nstruct qla_qpair {\n\tspinlock_t qp_lock;\n\tatomic_t ref_count;\n\tuint32_t lun_cnt;\n\t/*\n\t * For qpair 0, qp_lock_ptr will point at hardware_lock due to\n\t * legacy code. For other Qpair(s), it will point at qp_lock.\n\t */\n\tspinlock_t *qp_lock_ptr;\n\tstruct scsi_qla_host *vha;\n\tu32 chip_reset;\n\n\t/* distill these fields down to 'online=0/1'\n\t * ha->flags.eeh_busy\n\t * ha->flags.pci_channel_io_perm_failure\n\t * base_vha->loop_state\n\t */\n\tuint32_t online:1;\n\t/* move vha->flags.difdix_supported here */\n\tuint32_t difdix_supported:1;\n\tuint32_t delete_in_progress:1;\n\tuint32_t fw_started:1;\n\tuint32_t enable_class_2:1;\n\tuint32_t enable_explicit_conf:1;\n\tuint32_t use_shadow_reg:1;\n\tuint32_t rcv_intr:1;\n\n\tuint16_t id;\t\t\t/* qp number used with FW */\n\tuint16_t vp_idx;\t\t/* vport ID */\n\tmempool_t *srb_mempool;\n\n\tstruct pci_dev  *pdev;\n\tvoid (*reqq_start_iocbs)(struct qla_qpair *);\n\n\t/* to do: New driver: move queues to here instead of pointers */\n\tstruct req_que *req;\n\tstruct rsp_que *rsp;\n\tstruct atio_que *atio;\n\tstruct qla_msix_entry *msix; /* point to &ha->msix_entries[x] */\n\tstruct qla_hw_data *hw;\n\tstruct work_struct q_work;\n\tstruct qla_counters counters;\n\n\tstruct list_head qp_list_elem; /* vha->qp_list */\n\tstruct list_head hints_list;\n\n\tuint16_t retry_term_cnt;\n\t__le32\tretry_term_exchg_addr;\n\tuint64_t retry_term_jiff;\n\tstruct qla_tgt_counters tgt_counters;\n\tuint16_t cpuid;\n\tstruct qla_fw_resources fwres ____cacheline_aligned;\n};\n\n/* Place holder for FW buffer parameters */\nstruct qlfc_fw {\n\tvoid *fw_buf;\n\tdma_addr_t fw_dma;\n\tuint32_t len;\n};\n\nstruct rdp_req_payload {\n\tuint32_t\tels_request;\n\tuint32_t\tdesc_list_len;\n\n\t/* NPIV descriptor */\n\tstruct {\n\t\tuint32_t desc_tag;\n\t\tuint32_t desc_len;\n\t\tuint8_t  reserved;\n\t\tuint8_t  nport_id[3];\n\t} npiv_desc;\n};\n\nstruct rdp_rsp_payload {\n\tstruct {\n\t\t__be32\tcmd;\n\t\t__be32\tlen;\n\t} hdr;\n\n\t/* LS Request Info descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\treq_payload_word_0;\n\t} ls_req_info_desc;\n\n\t/* LS Request Info descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\treq_payload_word_0;\n\t} ls_req_info_desc2;\n\n\t/* SFP diagnostic param descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be16\ttemperature;\n\t\t__be16\tvcc;\n\t\t__be16\ttx_bias;\n\t\t__be16\ttx_power;\n\t\t__be16\trx_power;\n\t\t__be16\tsfp_flags;\n\t} sfp_diag_desc;\n\n\t/* Port Speed Descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be16\tspeed_capab;\n\t\t__be16\toperating_speed;\n\t} port_speed_desc;\n\n\t/* Link Error Status Descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\tlink_fail_cnt;\n\t\t__be32\tloss_sync_cnt;\n\t\t__be32\tloss_sig_cnt;\n\t\t__be32\tprim_seq_err_cnt;\n\t\t__be32\tinval_xmit_word_cnt;\n\t\t__be32\tinval_crc_cnt;\n\t\tuint8_t  pn_port_phy_type;\n\t\tuint8_t  reserved[3];\n\t} ls_err_desc;\n\n\t/* Port name description with diag param */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\tuint8_t WWNN[WWN_SIZE];\n\t\tuint8_t WWPN[WWN_SIZE];\n\t} port_name_diag_desc;\n\n\t/* Port Name desc for Direct attached Fx_Port or Nx_Port */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\tuint8_t WWNN[WWN_SIZE];\n\t\tuint8_t WWPN[WWN_SIZE];\n\t} port_name_direct_desc;\n\n\t/* Buffer Credit descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\tfcport_b2b;\n\t\t__be32\tattached_fcport_b2b;\n\t\t__be32\tfcport_rtt;\n\t} buffer_credit_desc;\n\n\t/* Optical Element Data Descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be16\thigh_alarm;\n\t\t__be16\tlow_alarm;\n\t\t__be16\thigh_warn;\n\t\t__be16\tlow_warn;\n\t\t__be32\telement_flags;\n\t} optical_elmt_desc[5];\n\n\t/* Optical Product Data Descriptor */\n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\tuint8_t  vendor_name[16];\n\t\tuint8_t  part_number[16];\n\t\tuint8_t  serial_number[16];\n\t\tuint8_t  revision[4];\n\t\tuint8_t  date[8];\n\t} optical_prod_desc;\n};\n\n#define RDP_DESC_LEN(obj) \\\n\t(sizeof(obj) - sizeof((obj).desc_tag) - sizeof((obj).desc_len))\n\n#define RDP_PORT_SPEED_1GB\t\tBIT_15\n#define RDP_PORT_SPEED_2GB\t\tBIT_14\n#define RDP_PORT_SPEED_4GB\t\tBIT_13\n#define RDP_PORT_SPEED_10GB\t\tBIT_12\n#define RDP_PORT_SPEED_8GB\t\tBIT_11\n#define RDP_PORT_SPEED_16GB\t\tBIT_10\n#define RDP_PORT_SPEED_32GB\t\tBIT_9\n#define RDP_PORT_SPEED_64GB             BIT_8\n#define RDP_PORT_SPEED_UNKNOWN\t\tBIT_0\n\nstruct scsi_qlt_host {\n\tvoid *target_lport_ptr;\n\tstruct mutex tgt_mutex;\n\tstruct mutex tgt_host_action_mutex;\n\tstruct qla_tgt *qla_tgt;\n};\n\nstruct qlt_hw_data {\n\t/* Protected by hw lock */\n\tuint32_t node_name_set:1;\n\n\tdma_addr_t atio_dma;\t/* Physical address. */\n\tstruct atio *atio_ring;\t/* Base virtual address */\n\tstruct atio *atio_ring_ptr;\t/* Current address. */\n\tuint16_t atio_ring_index; /* Current index. */\n\tuint16_t atio_q_length;\n\t__le32 __iomem *atio_q_in;\n\t__le32 __iomem *atio_q_out;\n\n\tstruct qla_tgt_func_tmpl *tgt_ops;\n\tstruct qla_tgt_vp_map *tgt_vp_map;\n\n\tint saved_set;\n\t__le16\tsaved_exchange_count;\n\t__le32\tsaved_firmware_options_1;\n\t__le32\tsaved_firmware_options_2;\n\t__le32\tsaved_firmware_options_3;\n\tuint8_t saved_firmware_options[2];\n\tuint8_t saved_add_firmware_options[2];\n\n\tuint8_t tgt_node_name[WWN_SIZE];\n\n\tstruct dentry *dfs_tgt_sess;\n\tstruct dentry *dfs_tgt_port_database;\n\tstruct dentry *dfs_naqp;\n\n\tstruct list_head q_full_list;\n\tuint32_t num_pend_cmds;\n\tuint32_t num_qfull_cmds_alloc;\n\tuint32_t num_qfull_cmds_dropped;\n\tspinlock_t q_full_lock;\n\tuint32_t leak_exchg_thresh_hold;\n\tspinlock_t sess_lock;\n\tint num_act_qpairs;\n#define DEFAULT_NAQP 2\n\tspinlock_t atio_lock ____cacheline_aligned;\n\tstruct btree_head32 host_map;\n};\n\n#define MAX_QFULL_CMDS_ALLOC\t8192\n#define Q_FULL_THRESH_HOLD_PERCENT 90\n#define Q_FULL_THRESH_HOLD(ha) \\\n\t((ha->cur_fw_xcb_count/100) * Q_FULL_THRESH_HOLD_PERCENT)\n\n#define LEAK_EXCHG_THRESH_HOLD_PERCENT 75\t/* 75 percent */\n\nstruct qla_hw_data_stat {\n\tu32 num_fw_dump;\n\tu32 num_mpi_reset;\n};\n\n/*\n * Qlogic host adapter specific data structure.\n*/\nstruct qla_hw_data {\n\tstruct pci_dev  *pdev;\n\t/* SRB cache. */\n#define SRB_MIN_REQ     128\n\tmempool_t       *srb_mempool;\n\n\tvolatile struct {\n\t\tuint32_t\tmbox_int\t\t:1;\n\t\tuint32_t\tmbox_busy\t\t:1;\n\t\tuint32_t\tdisable_risc_code_load\t:1;\n\t\tuint32_t\tenable_64bit_addressing\t:1;\n\t\tuint32_t\tenable_lip_reset\t:1;\n\t\tuint32_t\tenable_target_reset\t:1;\n\t\tuint32_t\tenable_lip_full_login\t:1;\n\t\tuint32_t\tenable_led_scheme\t:1;\n\n\t\tuint32_t\tmsi_enabled\t\t:1;\n\t\tuint32_t\tmsix_enabled\t\t:1;\n\t\tuint32_t\tdisable_serdes\t\t:1;\n\t\tuint32_t\tgpsc_supported\t\t:1;\n\t\tuint32_t\tnpiv_supported\t\t:1;\n\t\tuint32_t\tpci_channel_io_perm_failure\t:1;\n\t\tuint32_t\tfce_enabled\t\t:1;\n\t\tuint32_t\tfac_supported\t\t:1;\n\n\t\tuint32_t\tchip_reset_done\t\t:1;\n\t\tuint32_t\trunning_gold_fw\t\t:1;\n\t\tuint32_t\teeh_busy\t\t:1;\n\t\tuint32_t\tdisable_msix_handshake\t:1;\n\t\tuint32_t\tfcp_prio_enabled\t:1;\n\t\tuint32_t\tisp82xx_fw_hung:1;\n\t\tuint32_t\tnic_core_hung:1;\n\n\t\tuint32_t\tquiesce_owner:1;\n\t\tuint32_t\tnic_core_reset_hdlr_active:1;\n\t\tuint32_t\tnic_core_reset_owner:1;\n\t\tuint32_t\tisp82xx_no_md_cap:1;\n\t\tuint32_t\thost_shutting_down:1;\n\t\tuint32_t\tidc_compl_status:1;\n\t\tuint32_t        mr_reset_hdlr_active:1;\n\t\tuint32_t        mr_intr_valid:1;\n\n\t\tuint32_t        dport_enabled:1;\n\t\tuint32_t\tfawwpn_enabled:1;\n\t\tuint32_t\texlogins_enabled:1;\n\t\tuint32_t\texchoffld_enabled:1;\n\n\t\tuint32_t\tlip_ae:1;\n\t\tuint32_t\tn2n_ae:1;\n\t\tuint32_t\tfw_started:1;\n\t\tuint32_t\tfw_init_done:1;\n\n\t\tuint32_t\tlr_detected:1;\n\n\t\tuint32_t\trida_fmt2:1;\n\t\tuint32_t\tpurge_mbox:1;\n\t\tuint32_t        n2n_bigger:1;\n\t\tuint32_t\tsecure_adapter:1;\n\t\tuint32_t\tsecure_fw:1;\n\t\t\t\t/* Supported by Adapter */\n\t\tuint32_t\tscm_supported_a:1;\n\t\t\t\t/* Supported by Firmware */\n\t\tuint32_t\tscm_supported_f:1;\n\t\t\t\t/* Enabled in Driver */\n\t\tuint32_t\tscm_enabled:1;\n\t\tuint32_t\tmax_req_queue_warned:1;\n\t\tuint32_t\tplogi_template_valid:1;\n\t} flags;\n\n\tuint16_t max_exchg;\n\tuint16_t lr_distance;\t/* 32G & above */\n#define LR_DISTANCE_5K  1\n#define LR_DISTANCE_10K 0\n\n\t/* This spinlock is used to protect \"io transactions\", you must\n\t* acquire it before doing any IO to the card, eg with RD_REG*() and\n\t* WRT_REG*() for the duration of your entire commandtransaction.\n\t*\n\t* This spinlock is of lower priority than the io request lock.\n\t*/\n\n\tspinlock_t\thardware_lock ____cacheline_aligned;\n\tint\t\tbars;\n\tint\t\tmem_only;\n\tdevice_reg_t *iobase;           /* Base I/O address */\n\tresource_size_t pio_address;\n\n#define MIN_IOBASE_LEN          0x100\n\tdma_addr_t\t\tbar0_hdl;\n\n\tvoid __iomem *cregbase;\n\tdma_addr_t\t\tbar2_hdl;\n#define BAR0_LEN_FX00\t\t\t(1024 * 1024)\n#define BAR2_LEN_FX00\t\t\t(128 * 1024)\n\n\tuint32_t\t\trqstq_intr_code;\n\tuint32_t\t\tmbx_intr_code;\n\tuint32_t\t\treq_que_len;\n\tuint32_t\t\trsp_que_len;\n\tuint32_t\t\treq_que_off;\n\tuint32_t\t\trsp_que_off;\n\n\t/* Multi queue data structs */\n\tdevice_reg_t *mqiobase;\n\tdevice_reg_t *msixbase;\n\tuint16_t        msix_count;\n\tuint8_t         mqenable;\n\tstruct req_que **req_q_map;\n\tstruct rsp_que **rsp_q_map;\n\tstruct qla_qpair **queue_pair_map;\n\tunsigned long req_qid_map[(QLA_MAX_QUEUES / 8) / sizeof(unsigned long)];\n\tunsigned long rsp_qid_map[(QLA_MAX_QUEUES / 8) / sizeof(unsigned long)];\n\tunsigned long qpair_qid_map[(QLA_MAX_QUEUES / 8)\n\t\t/ sizeof(unsigned long)];\n\tuint8_t \tmax_req_queues;\n\tuint8_t \tmax_rsp_queues;\n\tuint8_t\t\tmax_qpairs;\n\tuint8_t\t\tnum_qpairs;\n\tstruct qla_qpair *base_qpair;\n\tstruct qla_npiv_entry *npiv_info;\n\tuint16_t\tnvram_npiv_size;\n\n\tuint16_t        switch_cap;\n#define FLOGI_SEQ_DEL           BIT_8\n#define FLOGI_MID_SUPPORT       BIT_10\n#define FLOGI_VSAN_SUPPORT      BIT_12\n#define FLOGI_SP_SUPPORT        BIT_13\n\n\tuint8_t\t\tport_no;\t\t/* Physical port of adapter */\n\tuint8_t\t\texch_starvation;\n\n\t/* Timeout timers. */\n\tuint8_t \tloop_down_abort_time;    /* port down timer */\n\tatomic_t\tloop_down_timer;         /* loop down timer */\n\tuint8_t\t\tlink_down_timeout;       /* link down timeout */\n\tuint16_t\tmax_loop_id;\n\tuint16_t\tmax_fibre_devices;\t/* Maximum number of targets */\n\n\tuint16_t\tfb_rev;\n\tuint16_t\tmin_external_loopid;    /* First external loop Id */\n\n#define PORT_SPEED_UNKNOWN 0xFFFF\n#define PORT_SPEED_1GB  0x00\n#define PORT_SPEED_2GB  0x01\n#define PORT_SPEED_AUTO 0x02\n#define PORT_SPEED_4GB  0x03\n#define PORT_SPEED_8GB  0x04\n#define PORT_SPEED_16GB 0x05\n#define PORT_SPEED_32GB 0x06\n#define PORT_SPEED_64GB 0x07\n#define PORT_SPEED_10GB\t0x13\n\tuint16_t\tlink_data_rate;         /* F/W operating speed */\n\tuint16_t\tset_data_rate;\t\t/* Set by user */\n\n\tuint8_t\t\tcurrent_topology;\n\tuint8_t\t\tprev_topology;\n#define ISP_CFG_NL\t1\n#define ISP_CFG_N\t2\n#define ISP_CFG_FL\t4\n#define ISP_CFG_F\t8\n\n\tuint8_t\t\toperating_mode;         /* F/W operating mode */\n#define LOOP      0\n#define P2P       1\n#define LOOP_P2P  2\n#define P2P_LOOP  3\n\tuint8_t\t\tinterrupts_on;\n\tuint32_t\tisp_abort_cnt;\n#define PCI_DEVICE_ID_QLOGIC_ISP2532    0x2532\n#define PCI_DEVICE_ID_QLOGIC_ISP8432    0x8432\n#define PCI_DEVICE_ID_QLOGIC_ISP8001\t0x8001\n#define PCI_DEVICE_ID_QLOGIC_ISP8031\t0x8031\n#define PCI_DEVICE_ID_QLOGIC_ISP2031\t0x2031\n#define PCI_DEVICE_ID_QLOGIC_ISP2071\t0x2071\n#define PCI_DEVICE_ID_QLOGIC_ISP2271\t0x2271\n#define PCI_DEVICE_ID_QLOGIC_ISP2261\t0x2261\n#define PCI_DEVICE_ID_QLOGIC_ISP2061\t0x2061\n#define PCI_DEVICE_ID_QLOGIC_ISP2081\t0x2081\n#define PCI_DEVICE_ID_QLOGIC_ISP2089\t0x2089\n#define PCI_DEVICE_ID_QLOGIC_ISP2281\t0x2281\n#define PCI_DEVICE_ID_QLOGIC_ISP2289\t0x2289\n\n\tuint32_t\tisp_type;\n#define DT_ISP2100                      BIT_0\n#define DT_ISP2200                      BIT_1\n#define DT_ISP2300                      BIT_2\n#define DT_ISP2312                      BIT_3\n#define DT_ISP2322                      BIT_4\n#define DT_ISP6312                      BIT_5\n#define DT_ISP6322                      BIT_6\n#define DT_ISP2422                      BIT_7\n#define DT_ISP2432                      BIT_8\n#define DT_ISP5422                      BIT_9\n#define DT_ISP5432                      BIT_10\n#define DT_ISP2532                      BIT_11\n#define DT_ISP8432                      BIT_12\n#define DT_ISP8001\t\t\tBIT_13\n#define DT_ISP8021\t\t\tBIT_14\n#define DT_ISP2031\t\t\tBIT_15\n#define DT_ISP8031\t\t\tBIT_16\n#define DT_ISPFX00\t\t\tBIT_17\n#define DT_ISP8044\t\t\tBIT_18\n#define DT_ISP2071\t\t\tBIT_19\n#define DT_ISP2271\t\t\tBIT_20\n#define DT_ISP2261\t\t\tBIT_21\n#define DT_ISP2061\t\t\tBIT_22\n#define DT_ISP2081\t\t\tBIT_23\n#define DT_ISP2089\t\t\tBIT_24\n#define DT_ISP2281\t\t\tBIT_25\n#define DT_ISP2289\t\t\tBIT_26\n#define DT_ISP_LAST\t\t\t(DT_ISP2289 << 1)\n\n\tuint32_t\tdevice_type;\n#define DT_T10_PI                       BIT_25\n#define DT_IIDMA                        BIT_26\n#define DT_FWI2                         BIT_27\n#define DT_ZIO_SUPPORTED                BIT_28\n#define DT_OEM_001                      BIT_29\n#define DT_ISP2200A                     BIT_30\n#define DT_EXTENDED_IDS                 BIT_31\n\n#define DT_MASK(ha)     ((ha)->isp_type & (DT_ISP_LAST - 1))\n#define IS_QLA2100(ha)  (DT_MASK(ha) & DT_ISP2100)\n#define IS_QLA2200(ha)  (DT_MASK(ha) & DT_ISP2200)\n#define IS_QLA2300(ha)  (DT_MASK(ha) & DT_ISP2300)\n#define IS_QLA2312(ha)  (DT_MASK(ha) & DT_ISP2312)\n#define IS_QLA2322(ha)  (DT_MASK(ha) & DT_ISP2322)\n#define IS_QLA6312(ha)  (DT_MASK(ha) & DT_ISP6312)\n#define IS_QLA6322(ha)  (DT_MASK(ha) & DT_ISP6322)\n#define IS_QLA2422(ha)  (DT_MASK(ha) & DT_ISP2422)\n#define IS_QLA2432(ha)  (DT_MASK(ha) & DT_ISP2432)\n#define IS_QLA5422(ha)  (DT_MASK(ha) & DT_ISP5422)\n#define IS_QLA5432(ha)  (DT_MASK(ha) & DT_ISP5432)\n#define IS_QLA2532(ha)  (DT_MASK(ha) & DT_ISP2532)\n#define IS_QLA8432(ha)  (DT_MASK(ha) & DT_ISP8432)\n#define IS_QLA8001(ha)\t(DT_MASK(ha) & DT_ISP8001)\n#define IS_QLA81XX(ha)\t(IS_QLA8001(ha))\n#define IS_QLA82XX(ha)\t(DT_MASK(ha) & DT_ISP8021)\n#define IS_QLA8044(ha)  (DT_MASK(ha) & DT_ISP8044)\n#define IS_QLA2031(ha)\t(DT_MASK(ha) & DT_ISP2031)\n#define IS_QLA8031(ha)\t(DT_MASK(ha) & DT_ISP8031)\n#define IS_QLAFX00(ha)\t(DT_MASK(ha) & DT_ISPFX00)\n#define IS_QLA2071(ha)\t(DT_MASK(ha) & DT_ISP2071)\n#define IS_QLA2271(ha)\t(DT_MASK(ha) & DT_ISP2271)\n#define IS_QLA2261(ha)\t(DT_MASK(ha) & DT_ISP2261)\n#define IS_QLA2081(ha)\t(DT_MASK(ha) & DT_ISP2081)\n#define IS_QLA2281(ha)\t(DT_MASK(ha) & DT_ISP2281)\n\n#define IS_QLA23XX(ha)  (IS_QLA2300(ha) || IS_QLA2312(ha) || IS_QLA2322(ha) || \\\n\t\t\tIS_QLA6312(ha) || IS_QLA6322(ha))\n#define IS_QLA24XX(ha)  (IS_QLA2422(ha) || IS_QLA2432(ha))\n#define IS_QLA54XX(ha)  (IS_QLA5422(ha) || IS_QLA5432(ha))\n#define IS_QLA25XX(ha)  (IS_QLA2532(ha))\n#define IS_QLA83XX(ha)\t(IS_QLA2031(ha) || IS_QLA8031(ha))\n#define IS_QLA84XX(ha)  (IS_QLA8432(ha))\n#define IS_QLA27XX(ha)  (IS_QLA2071(ha) || IS_QLA2271(ha) || IS_QLA2261(ha))\n#define IS_QLA28XX(ha)\t(IS_QLA2081(ha) || IS_QLA2281(ha))\n#define IS_QLA24XX_TYPE(ha)     (IS_QLA24XX(ha) || IS_QLA54XX(ha) || \\\n\t\t\t\tIS_QLA84XX(ha))\n#define IS_CNA_CAPABLE(ha)\t(IS_QLA81XX(ha) || IS_QLA82XX(ha) || \\\n\t\t\t\tIS_QLA8031(ha) || IS_QLA8044(ha))\n#define IS_P3P_TYPE(ha)\t\t(IS_QLA82XX(ha) || IS_QLA8044(ha))\n#define IS_QLA2XXX_MIDTYPE(ha)\t(IS_QLA24XX(ha) || IS_QLA84XX(ha) || \\\n\t\t\t\tIS_QLA25XX(ha) || IS_QLA81XX(ha) || \\\n\t\t\t\tIS_QLA82XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA8044(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_MSIX_NACK_CAPABLE(ha) (IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_NOPOLLING_TYPE(ha)\t(IS_QLA81XX(ha) && (ha)->flags.msix_enabled)\n#define IS_FAC_REQUIRED(ha)\t(IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_NOCACHE_VPD_TYPE(ha)\t(IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_ALOGIO_CAPABLE(ha)\t(IS_QLA23XX(ha) || IS_FWI2_CAPABLE(ha))\n\n#define IS_T10_PI_CAPABLE(ha)   ((ha)->device_type & DT_T10_PI)\n#define IS_IIDMA_CAPABLE(ha)    ((ha)->device_type & DT_IIDMA)\n#define IS_FWI2_CAPABLE(ha)     ((ha)->device_type & DT_FWI2)\n#define IS_ZIO_SUPPORTED(ha)    ((ha)->device_type & DT_ZIO_SUPPORTED)\n#define IS_OEM_001(ha)          ((ha)->device_type & DT_OEM_001)\n#define HAS_EXTENDED_IDS(ha)    ((ha)->device_type & DT_EXTENDED_IDS)\n#define IS_CT6_SUPPORTED(ha)\t((ha)->device_type & DT_CT6_SUPPORTED)\n#define IS_MQUE_CAPABLE(ha)\t((ha)->mqenable || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_BIDI_CAPABLE(ha) \\\n    (IS_QLA25XX(ha) || IS_QLA2031(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n/* Bit 21 of fw_attributes decides the MCTP capabilities */\n#define IS_MCTP_CAPABLE(ha)\t(IS_QLA2031(ha) && \\\n\t\t\t\t((ha)->fw_attributes_ext[0] & BIT_0))\n#define IS_PI_UNINIT_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha))\n#define IS_PI_IPGUARD_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha))\n#define IS_PI_DIFB_DIX0_CAPABLE(ha)\t(0)\n#define IS_PI_SPLIT_DET_CAPABLE_HBA(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\t\tIS_QLA28XX(ha))\n#define IS_PI_SPLIT_DET_CAPABLE(ha)\t(IS_PI_SPLIT_DET_CAPABLE_HBA(ha) && \\\n    (((ha)->fw_attributes_h << 16 | (ha)->fw_attributes) & BIT_22))\n#define IS_ATIO_MSIX_CAPABLE(ha) (IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_TGT_MODE_CAPABLE(ha)\t(ha->tgt.atio_q_length)\n#define IS_SHADOW_REG_CAPABLE(ha)  (IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_DPORT_CAPABLE(ha)  (IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_FAWWN_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_EXCHG_OFFLD_CAPABLE(ha) \\\n\t(IS_QLA81XX(ha) || IS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_EXLOGIN_OFFLD_CAPABLE(ha) \\\n\t(IS_QLA25XX(ha) || IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define USE_ASYNC_SCAN(ha) (IS_QLA25XX(ha) || IS_QLA81XX(ha) ||\\\n\tIS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n\n#define IS_ZIO_THRESHOLD_CAPABLE(ha) \\\n\t((IS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha)) &&\\\n\t (ha->zio_mode == QLA_ZIO_MODE_6))\n\n\t/* HBA serial number */\n\tuint8_t\t\tserial0;\n\tuint8_t\t\tserial1;\n\tuint8_t\t\tserial2;\n\n\t/* NVRAM configuration data */\n#define MAX_NVRAM_SIZE  4096\n#define VPD_OFFSET      (MAX_NVRAM_SIZE / 2)\n\tuint16_t\tnvram_size;\n\tuint16_t\tnvram_base;\n\tvoid\t\t*nvram;\n\tuint16_t\tvpd_size;\n\tuint16_t\tvpd_base;\n\tvoid\t\t*vpd;\n\n\tuint16_t\tloop_reset_delay;\n\tuint8_t\t\tretry_count;\n\tuint8_t\t\tlogin_timeout;\n\tuint16_t\tr_a_tov;\n\tint\t\tport_down_retry_count;\n\tuint8_t\t\tmbx_count;\n\tuint8_t\t\taen_mbx_count;\n\tatomic_t\tnum_pend_mbx_stage1;\n\tatomic_t\tnum_pend_mbx_stage2;\n\tatomic_t\tnum_pend_mbx_stage3;\n\tuint16_t\tframe_payload_size;\n\n\tuint32_t\tlogin_retry_count;\n\t/* SNS command interfaces. */\n\tms_iocb_entry_t\t\t*ms_iocb;\n\tdma_addr_t\t\tms_iocb_dma;\n\tstruct ct_sns_pkt\t*ct_sns;\n\tdma_addr_t\t\tct_sns_dma;\n\t/* SNS command interfaces for 2200. */\n\tstruct sns_cmd_pkt\t*sns_cmd;\n\tdma_addr_t\t\tsns_cmd_dma;\n\n#define SFP_DEV_SIZE    512\n#define SFP_BLOCK_SIZE  64\n#define SFP_RTDI_LEN\tSFP_BLOCK_SIZE\n\n\tvoid\t\t*sfp_data;\n\tdma_addr_t\tsfp_data_dma;\n\n\tstruct qla_flt_header *flt;\n\tdma_addr_t\tflt_dma;\n\n#define XGMAC_DATA_SIZE\t4096\n\tvoid\t\t*xgmac_data;\n\tdma_addr_t\txgmac_data_dma;\n\n#define DCBX_TLV_DATA_SIZE 4096\n\tvoid\t\t*dcbx_tlv;\n\tdma_addr_t\tdcbx_tlv_dma;\n\n\tstruct task_struct\t*dpc_thread;\n\tuint8_t dpc_active;                  /* DPC routine is active */\n\n\tdma_addr_t\tgid_list_dma;\n\tstruct gid_list_info *gid_list;\n\tint\t\tgid_list_info_size;\n\n\t/* Small DMA pool allocations -- maximum 256 bytes in length. */\n#define DMA_POOL_SIZE   256\n\tstruct dma_pool *s_dma_pool;\n\n\tdma_addr_t\tinit_cb_dma;\n\tinit_cb_t\t*init_cb;\n\tint\t\tinit_cb_size;\n\tdma_addr_t\tex_init_cb_dma;\n\tstruct ex_init_cb_81xx *ex_init_cb;\n\tdma_addr_t\tsf_init_cb_dma;\n\tstruct init_sf_cb *sf_init_cb;\n\n\tvoid\t\t*scm_fpin_els_buff;\n\tuint64_t\tscm_fpin_els_buff_size;\n\tbool\t\tscm_fpin_valid;\n\tbool\t\tscm_fpin_payload_size;\n\n\tvoid\t\t*async_pd;\n\tdma_addr_t\tasync_pd_dma;\n\n#define ENABLE_EXTENDED_LOGIN\tBIT_7\n\n\t/* Extended Logins  */\n\tvoid\t\t*exlogin_buf;\n\tdma_addr_t\texlogin_buf_dma;\n\tuint32_t\texlogin_size;\n\n#define ENABLE_EXCHANGE_OFFLD\tBIT_2\n\n\t/* Exchange Offload */\n\tvoid\t\t*exchoffld_buf;\n\tdma_addr_t\texchoffld_buf_dma;\n\tint\t\texchoffld_size;\n\tint \t\texchoffld_count;\n\n\t/* n2n */\n\tstruct fc_els_flogi plogi_els_payld;\n#define LOGIN_TEMPLATE_SIZE (sizeof(struct fc_els_flogi) - 4)\n\n\tvoid            *swl;\n\n\t/* These are used by mailbox operations. */\n\tuint16_t mailbox_out[MAILBOX_REGISTER_COUNT];\n\tuint32_t mailbox_out32[MAILBOX_REGISTER_COUNT];\n\tuint32_t aenmb[AEN_MAILBOX_REGISTER_COUNT_FX00];\n\n\tmbx_cmd_t\t*mcp;\n\tstruct mbx_cmd_32\t*mcp32;\n\n\tunsigned long\tmbx_cmd_flags;\n#define MBX_INTERRUPT\t\t1\n#define MBX_INTR_WAIT\t\t2\n#define MBX_UPDATE_FLASH_ACTIVE\t3\n\n\tstruct mutex vport_lock;        /* Virtual port synchronization */\n\tspinlock_t vport_slock; /* order is hardware_lock, then vport_slock */\n\tstruct mutex mq_lock;        /* multi-queue synchronization */\n\tstruct completion mbx_cmd_comp; /* Serialize mbx access */\n\tstruct completion mbx_intr_comp;  /* Used for completion notification */\n\tstruct completion dcbx_comp;\t/* For set port config notification */\n\tstruct completion lb_portup_comp; /* Used to wait for link up during\n\t\t\t\t\t   * loopback */\n#define DCBX_COMP_TIMEOUT\t20\n#define LB_PORTUP_COMP_TIMEOUT\t10\n\n\tint notify_dcbx_comp;\n\tint notify_lb_portup_comp;\n\tstruct mutex selflogin_lock;\n\n\t/* Basic firmware related information. */\n\tuint16_t\tfw_major_version;\n\tuint16_t\tfw_minor_version;\n\tuint16_t\tfw_subminor_version;\n\tuint16_t\tfw_attributes;\n\tuint16_t\tfw_attributes_h;\n#define FW_ATTR_H_NVME_FBURST \tBIT_1\n#define FW_ATTR_H_NVME\t\tBIT_10\n#define FW_ATTR_H_NVME_UPDATED  BIT_14\n\n\t/* About firmware SCM support */\n#define FW_ATTR_EXT0_SCM_SUPPORTED\tBIT_12\n\t/* Brocade fabric attached */\n#define FW_ATTR_EXT0_SCM_BROCADE\t0x00001000\n\t/* Cisco fabric attached */\n#define FW_ATTR_EXT0_SCM_CISCO\t\t0x00002000\n#define FW_ATTR_EXT0_NVME2\tBIT_13\n\tuint16_t\tfw_attributes_ext[2];\n\tuint32_t\tfw_memory_size;\n\tuint32_t\tfw_transfer_size;\n\tuint32_t\tfw_srisc_address;\n#define RISC_START_ADDRESS_2100 0x1000\n#define RISC_START_ADDRESS_2300 0x800\n#define RISC_START_ADDRESS_2400 0x100000\n\n\tuint16_t\torig_fw_tgt_xcb_count;\n\tuint16_t\tcur_fw_tgt_xcb_count;\n\tuint16_t\torig_fw_xcb_count;\n\tuint16_t\tcur_fw_xcb_count;\n\tuint16_t\torig_fw_iocb_count;\n\tuint16_t\tcur_fw_iocb_count;\n\tuint16_t\tfw_max_fcf_count;\n\n\tuint32_t\tfw_shared_ram_start;\n\tuint32_t\tfw_shared_ram_end;\n\tuint32_t\tfw_ddr_ram_start;\n\tuint32_t\tfw_ddr_ram_end;\n\n\tuint16_t\tfw_options[16];         /* slots: 1,2,3,10,11 */\n\tuint8_t\t\tfw_seriallink_options[4];\n\t__le16\t\tfw_seriallink_options24[4];\n\n\tuint8_t\t\tserdes_version[3];\n\tuint8_t\t\tmpi_version[3];\n\tuint32_t\tmpi_capabilities;\n\tuint8_t\t\tphy_version[3];\n\tuint8_t\t\tpep_version[3];\n\n\t/* Firmware dump template */\n\tstruct fwdt {\n\t\tvoid *template;\n\t\tulong length;\n\t\tulong dump_size;\n\t} fwdt[2];\n\tstruct qla2xxx_fw_dump *fw_dump;\n\tuint32_t\tfw_dump_len;\n\tu32\t\tfw_dump_alloc_len;\n\tbool\t\tfw_dumped;\n\tunsigned long\tfw_dump_cap_flags;\n#define RISC_PAUSE_CMPL\t\t0\n#define DMA_SHUTDOWN_CMPL\t1\n#define ISP_RESET_CMPL\t\t2\n#define RISC_RDY_AFT_RESET\t3\n#define RISC_SRAM_DUMP_CMPL\t4\n#define RISC_EXT_MEM_DUMP_CMPL\t5\n#define ISP_MBX_RDY\t\t6\n#define ISP_SOFT_RESET_CMPL\t7\n\tint\t\tfw_dump_reading;\n\tvoid\t\t*mpi_fw_dump;\n\tu32\t\tmpi_fw_dump_len;\n\tunsigned int\tmpi_fw_dump_reading:1;\n\tunsigned int\tmpi_fw_dumped:1;\n\tint\t\tprev_minidump_failed;\n\tdma_addr_t\teft_dma;\n\tvoid\t\t*eft;\n/* Current size of mctp dump is 0x086064 bytes */\n#define MCTP_DUMP_SIZE  0x086064\n\tdma_addr_t\tmctp_dump_dma;\n\tvoid\t\t*mctp_dump;\n\tint\t\tmctp_dumped;\n\tint\t\tmctp_dump_reading;\n\tuint32_t\tchain_offset;\n\tstruct dentry *dfs_dir;\n\tstruct dentry *dfs_fce;\n\tstruct dentry *dfs_tgt_counters;\n\tstruct dentry *dfs_fw_resource_cnt;\n\n\tdma_addr_t\tfce_dma;\n\tvoid\t\t*fce;\n\tuint32_t\tfce_bufs;\n\tuint16_t\tfce_mb[8];\n\tuint64_t\tfce_wr, fce_rd;\n\tstruct mutex\tfce_mutex;\n\n\tuint32_t\tpci_attr;\n\tuint16_t\tchip_revision;\n\n\tuint16_t\tproduct_id[4];\n\n\tuint8_t\t\tmodel_number[16+1];\n\tchar\t\tmodel_desc[80];\n\tuint8_t\t\tadapter_id[16+1];\n\n\t/* Option ROM information. */\n\tchar\t\t*optrom_buffer;\n\tuint32_t\toptrom_size;\n\tint\t\toptrom_state;\n#define QLA_SWAITING\t0\n#define QLA_SREADING\t1\n#define QLA_SWRITING\t2\n\tuint32_t\toptrom_region_start;\n\tuint32_t\toptrom_region_size;\n\tstruct mutex\toptrom_mutex;\n\n/* PCI expansion ROM image information. */\n#define ROM_CODE_TYPE_BIOS\t0\n#define ROM_CODE_TYPE_FCODE\t1\n#define ROM_CODE_TYPE_EFI\t3\n\tuint8_t \tbios_revision[2];\n\tuint8_t \tefi_revision[2];\n\tuint8_t \tfcode_revision[16];\n\tuint32_t\tfw_revision[4];\n\n\tuint32_t\tgold_fw_version[4];\n\n\t/* Offsets for flash/nvram access (set to ~0 if not used). */\n\tuint32_t\tflash_conf_off;\n\tuint32_t\tflash_data_off;\n\tuint32_t\tnvram_conf_off;\n\tuint32_t\tnvram_data_off;\n\n\tuint32_t\tfdt_wrt_disable;\n\tuint32_t\tfdt_wrt_enable;\n\tuint32_t\tfdt_erase_cmd;\n\tuint32_t\tfdt_block_size;\n\tuint32_t\tfdt_unprotect_sec_cmd;\n\tuint32_t\tfdt_protect_sec_cmd;\n\tuint32_t\tfdt_wrt_sts_reg_cmd;\n\n\tstruct {\n\t\tuint32_t\tflt_region_flt;\n\t\tuint32_t\tflt_region_fdt;\n\t\tuint32_t\tflt_region_boot;\n\t\tuint32_t\tflt_region_boot_sec;\n\t\tuint32_t\tflt_region_fw;\n\t\tuint32_t\tflt_region_fw_sec;\n\t\tuint32_t\tflt_region_vpd_nvram;\n\t\tuint32_t\tflt_region_vpd_nvram_sec;\n\t\tuint32_t\tflt_region_vpd;\n\t\tuint32_t\tflt_region_vpd_sec;\n\t\tuint32_t\tflt_region_nvram;\n\t\tuint32_t\tflt_region_nvram_sec;\n\t\tuint32_t\tflt_region_npiv_conf;\n\t\tuint32_t\tflt_region_gold_fw;\n\t\tuint32_t\tflt_region_fcp_prio;\n\t\tuint32_t\tflt_region_bootload;\n\t\tuint32_t\tflt_region_img_status_pri;\n\t\tuint32_t\tflt_region_img_status_sec;\n\t\tuint32_t\tflt_region_aux_img_status_pri;\n\t\tuint32_t\tflt_region_aux_img_status_sec;\n\t};\n\tuint8_t         active_image;\n\n\t/* Needed for BEACON */\n\tuint16_t        beacon_blink_led;\n\tuint8_t         beacon_color_state;\n#define QLA_LED_GRN_ON\t\t0x01\n#define QLA_LED_YLW_ON\t\t0x02\n#define QLA_LED_ABR_ON\t\t0x04\n#define QLA_LED_ALL_ON\t\t0x07\t/* yellow, green, amber. */\n\t\t\t\t\t/* ISP2322: red, green, amber. */\n\tuint16_t        zio_mode;\n\tuint16_t        zio_timer;\n\n\tstruct qla_msix_entry *msix_entries;\n\n\tstruct list_head        vp_list;        /* list of VP */\n\tunsigned long   vp_idx_map[(MAX_MULTI_ID_FABRIC / 8) /\n\t\t\tsizeof(unsigned long)];\n\tuint16_t        num_vhosts;     /* number of vports created */\n\tuint16_t        num_vsans;      /* number of vsan created */\n\tuint16_t        max_npiv_vports;        /* 63 or 125 per topoloty */\n\tint             cur_vport_count;\n\n\tstruct qla_chip_state_84xx *cs84xx;\n\tstruct isp_operations *isp_ops;\n\tstruct workqueue_struct *wq;\n\tstruct qlfc_fw fw_buf;\n\n\t/* FCP_CMND priority support */\n\tstruct qla_fcp_prio_cfg *fcp_prio_cfg;\n\n\tstruct dma_pool *dl_dma_pool;\n#define DSD_LIST_DMA_POOL_SIZE  512\n\n\tstruct dma_pool *fcp_cmnd_dma_pool;\n\tmempool_t       *ctx_mempool;\n#define FCP_CMND_DMA_POOL_SIZE 512\n\n\tvoid __iomem\t*nx_pcibase;\t\t/* Base I/O address */\n\tvoid __iomem\t*nxdb_rd_ptr;\t\t/* Doorbell read pointer */\n\tvoid __iomem\t*nxdb_wr_ptr;\t\t/* Door bell write pointer */\n\n\tuint32_t\tcrb_win;\n\tuint32_t\tcurr_window;\n\tuint32_t\tddr_mn_window;\n\tunsigned long\tmn_win_crb;\n\tunsigned long\tms_win_crb;\n\tint\t\tqdr_sn_window;\n\tuint32_t\tfcoe_dev_init_timeout;\n\tuint32_t\tfcoe_reset_timeout;\n\trwlock_t\thw_lock;\n\tuint16_t\tportnum;\t\t/* port number */\n\tint\t\tlink_width;\n\tstruct fw_blob\t*hablob;\n\tstruct qla82xx_legacy_intr_set nx_legacy_intr;\n\n\tuint16_t\tgbl_dsd_inuse;\n\tuint16_t\tgbl_dsd_avail;\n\tstruct list_head gbl_dsd_list;\n#define NUM_DSD_CHAIN 4096\n\n\tuint8_t fw_type;\n\tuint32_t file_prd_off;\t/* File firmware product offset */\n\n\tuint32_t\tmd_template_size;\n\tvoid\t\t*md_tmplt_hdr;\n\tdma_addr_t      md_tmplt_hdr_dma;\n\tvoid            *md_dump;\n\tuint32_t\tmd_dump_size;\n\n\tvoid\t\t*loop_id_map;\n\n\t/* QLA83XX IDC specific fields */\n\tuint32_t\tidc_audit_ts;\n\tuint32_t\tidc_extend_tmo;\n\n\t/* DPC low-priority workqueue */\n\tstruct workqueue_struct *dpc_lp_wq;\n\tstruct work_struct idc_aen;\n\t/* DPC high-priority workqueue */\n\tstruct workqueue_struct *dpc_hp_wq;\n\tstruct work_struct nic_core_reset;\n\tstruct work_struct idc_state_handler;\n\tstruct work_struct nic_core_unrecoverable;\n\tstruct work_struct board_disable;\n\n\tstruct mr_data_fx00 mr;\n\tuint32_t chip_reset;\n\n\tstruct qlt_hw_data tgt;\n\tint\tallow_cna_fw_dump;\n\tuint32_t fw_ability_mask;\n\tuint16_t min_supported_speed;\n\tuint16_t max_supported_speed;\n\n\t/* DMA pool for the DIF bundling buffers */\n\tstruct dma_pool *dif_bundl_pool;\n\t#define DIF_BUNDLING_DMA_POOL_SIZE  1024\n\tstruct {\n\t\tstruct {\n\t\t\tstruct list_head head;\n\t\t\tuint count;\n\t\t} good;\n\t\tstruct {\n\t\t\tstruct list_head head;\n\t\t\tuint count;\n\t\t} unusable;\n\t} pool;\n\n\tunsigned long long dif_bundle_crossed_pages;\n\tunsigned long long dif_bundle_reads;\n\tunsigned long long dif_bundle_writes;\n\tunsigned long long dif_bundle_kallocs;\n\tunsigned long long dif_bundle_dma_allocs;\n\n\tatomic_t        nvme_active_aen_cnt;\n\tuint16_t        nvme_last_rptd_aen;             /* Last recorded aen count */\n\n\tuint8_t fc4_type_priority;\n\n\tatomic_t zio_threshold;\n\tuint16_t last_zio_threshold;\n\n#define DEFAULT_ZIO_THRESHOLD 5\n\n\tstruct qla_hw_data_stat stat;\n};\n\nstruct active_regions {\n\tuint8_t global;\n\tstruct {\n\t\tuint8_t board_config;\n\t\tuint8_t vpd_nvram;\n\t\tuint8_t npiv_config_0_1;\n\t\tuint8_t npiv_config_2_3;\n\t} aux;\n};\n\n#define FW_ABILITY_MAX_SPEED_MASK\t0xFUL\n#define FW_ABILITY_MAX_SPEED_16G\t0x0\n#define FW_ABILITY_MAX_SPEED_32G\t0x1\n#define FW_ABILITY_MAX_SPEED(ha)\t\\\n\t(ha->fw_ability_mask & FW_ABILITY_MAX_SPEED_MASK)\n\n#define QLA_GET_DATA_RATE\t0\n#define QLA_SET_DATA_RATE_NOLR\t1\n#define QLA_SET_DATA_RATE_LR\t2 /* Set speed and initiate LR */\n\n#define QLA_DEFAULT_PAYLOAD_SIZE\t64\n/*\n * This item might be allocated with a size > sizeof(struct purex_item).\n * The \"size\" variable gives the size of the payload (which\n * is variable) starting at \"iocb\".\n */\nstruct purex_item {\n\tstruct list_head list;\n\tstruct scsi_qla_host *vha;\n\tvoid (*process_item)(struct scsi_qla_host *vha,\n\t\t\t     struct purex_item *pkt);\n\tatomic_t in_use;\n\tuint16_t size;\n\tstruct {\n\t\tuint8_t iocb[64];\n\t} iocb;\n};\n\n#define SCM_FLAG_RDF_REJECT\t\t0x00\n#define SCM_FLAG_RDF_COMPLETED\t\t0x01\n\n#define QLA_CON_PRIMITIVE_RECEIVED\t0x1\n#define QLA_CONGESTION_ARB_WARNING\t0x1\n#define QLA_CONGESTION_ARB_ALARM\t0X2\n\n/*\n * Qlogic scsi host structure\n */\ntypedef struct scsi_qla_host {\n\tstruct list_head list;\n\tstruct list_head vp_fcports;\t/* list of fcports */\n\tstruct list_head work_list;\n\tspinlock_t work_lock;\n\tstruct work_struct iocb_work;\n\n\t/* Commonly used flags and state information. */\n\tstruct Scsi_Host *host;\n\tunsigned long\thost_no;\n\tuint8_t\t\thost_str[16];\n\n\tvolatile struct {\n\t\tuint32_t\tinit_done\t\t:1;\n\t\tuint32_t\tonline\t\t\t:1;\n\t\tuint32_t\treset_active\t\t:1;\n\n\t\tuint32_t\tmanagement_server_logged_in :1;\n\t\tuint32_t\tprocess_response_queue\t:1;\n\t\tuint32_t\tdifdix_supported:1;\n\t\tuint32_t\tdelete_progress:1;\n\n\t\tuint32_t\tfw_tgt_reported:1;\n\t\tuint32_t\tbbcr_enable:1;\n\t\tuint32_t\tqpairs_available:1;\n\t\tuint32_t\tqpairs_req_created:1;\n\t\tuint32_t\tqpairs_rsp_created:1;\n\t\tuint32_t\tnvme_enabled:1;\n\t\tuint32_t        nvme_first_burst:1;\n\t\tuint32_t        nvme2_enabled:1;\n\t} flags;\n\n\tatomic_t\tloop_state;\n#define LOOP_TIMEOUT\t1\n#define LOOP_DOWN\t2\n#define LOOP_UP\t\t3\n#define LOOP_UPDATE\t4\n#define LOOP_READY\t5\n#define LOOP_DEAD\t6\n\n\tunsigned long   relogin_jif;\n\tunsigned long   dpc_flags;\n#define RESET_MARKER_NEEDED\t0\t/* Send marker to ISP. */\n#define RESET_ACTIVE\t\t1\n#define ISP_ABORT_NEEDED\t2\t/* Initiate ISP abort. */\n#define ABORT_ISP_ACTIVE\t3\t/* ISP abort in progress. */\n#define LOOP_RESYNC_NEEDED\t4\t/* Device Resync needed. */\n#define LOOP_RESYNC_ACTIVE\t5\n#define LOCAL_LOOP_UPDATE\t6\t/* Perform a local loop update. */\n#define RSCN_UPDATE\t\t7\t/* Perform an RSCN update. */\n#define RELOGIN_NEEDED\t\t8\n#define REGISTER_FC4_NEEDED\t9\t/* SNS FC4 registration required. */\n#define ISP_ABORT_RETRY\t\t10\t/* ISP aborted. */\n#define BEACON_BLINK_NEEDED\t11\n#define REGISTER_FDMI_NEEDED\t12\n#define FCPORT_UPDATE_NEEDED\t13\n#define VP_DPC_NEEDED\t\t14\t/* wake up for VP dpc handling */\n#define UNLOADING\t\t15\n#define NPIV_CONFIG_NEEDED\t16\n#define ISP_UNRECOVERABLE\t17\n#define FCOE_CTX_RESET_NEEDED\t18\t/* Initiate FCoE context reset */\n#define MPI_RESET_NEEDED\t19\t/* Initiate MPI FW reset */\n#define ISP_QUIESCE_NEEDED\t20\t/* Driver need some quiescence */\n#define N2N_LINK_RESET\t\t21\n#define PORT_UPDATE_NEEDED\t22\n#define FX00_RESET_RECOVERY\t23\n#define FX00_TARGET_SCAN\t24\n#define FX00_CRITEMP_RECOVERY\t25\n#define FX00_HOST_INFO_RESEND\t26\n#define QPAIR_ONLINE_CHECK_NEEDED\t27\n#define SET_NVME_ZIO_THRESHOLD_NEEDED\t28\n#define DETECT_SFP_CHANGE\t29\n#define N2N_LOGIN_NEEDED\t30\n#define IOCB_WORK_ACTIVE\t31\n#define SET_ZIO_THRESHOLD_NEEDED 32\n#define ISP_ABORT_TO_ROM\t33\n#define VPORT_DELETE\t\t34\n\n#define PROCESS_PUREX_IOCB\t63\n\n\tunsigned long\tpci_flags;\n#define PFLG_DISCONNECTED\t0\t/* PCI device removed */\n#define PFLG_DRIVER_REMOVING\t1\t/* PCI driver .remove */\n#define PFLG_DRIVER_PROBING\t2\t/* PCI driver .probe */\n\n\tuint32_t\tdevice_flags;\n#define SWITCH_FOUND\t\tBIT_0\n#define DFLG_NO_CABLE\t\tBIT_1\n#define DFLG_DEV_FAILED\t\tBIT_5\n\n\t/* ISP configuration data. */\n\tuint16_t\tloop_id;\t\t/* Host adapter loop id */\n\tuint16_t        self_login_loop_id;     /* host adapter loop id\n\t\t\t\t\t\t * get it on self login\n\t\t\t\t\t\t */\n\tfc_port_t       bidir_fcport;\t\t/* fcport used for bidir cmnds\n\t\t\t\t\t\t * no need of allocating it for\n\t\t\t\t\t\t * each command\n\t\t\t\t\t\t */\n\n\tport_id_t\td_id;\t\t\t/* Host adapter port id */\n\tuint8_t\t\tmarker_needed;\n\tuint16_t\tmgmt_svr_loop_id;\n\n\n\n\t/* Timeout timers. */\n\tuint8_t         loop_down_abort_time;    /* port down timer */\n\tatomic_t        loop_down_timer;         /* loop down timer */\n\tuint8_t         link_down_timeout;       /* link down timeout */\n\n\tuint32_t        timer_active;\n\tstruct timer_list        timer;\n\n\tuint8_t\t\tnode_name[WWN_SIZE];\n\tuint8_t\t\tport_name[WWN_SIZE];\n\tuint8_t\t\tfabric_node_name[WWN_SIZE];\n\tuint8_t\t\tfabric_port_name[WWN_SIZE];\n\n\tstruct\t\tnvme_fc_local_port *nvme_local_port;\n\tstruct completion nvme_del_done;\n\n\tuint16_t\tfcoe_vlan_id;\n\tuint16_t\tfcoe_fcf_idx;\n\tuint8_t\t\tfcoe_vn_port_mac[6];\n\n\t/* list of commands waiting on workqueue */\n\tstruct list_head\tqla_cmd_list;\n\tstruct list_head\tqla_sess_op_cmd_list;\n\tstruct list_head\tunknown_atio_list;\n\tspinlock_t\t\tcmd_list_lock;\n\tstruct delayed_work\tunknown_atio_work;\n\n\t/* Counter to detect races between ELS and RSCN events */\n\tatomic_t\t\tgeneration_tick;\n\t/* Time when global fcport update has been scheduled */\n\tint\t\t\ttotal_fcport_update_gen;\n\t/* List of pending LOGOs, protected by tgt_mutex */\n\tstruct list_head\tlogo_list;\n\t/* List of pending PLOGI acks, protected by hw lock */\n\tstruct list_head\tplogi_ack_list;\n\n\tstruct list_head\tqp_list;\n\n\tuint32_t\tvp_abort_cnt;\n\n\tstruct fc_vport\t*fc_vport;\t/* holds fc_vport * for each vport */\n\tuint16_t        vp_idx;\t\t/* vport ID */\n\tstruct qla_qpair *qpair;\t/* base qpair */\n\n\tunsigned long\t\tvp_flags;\n#define VP_IDX_ACQUIRED\t\t0\t/* bit no 0 */\n#define VP_CREATE_NEEDED\t1\n#define VP_BIND_NEEDED\t\t2\n#define VP_DELETE_NEEDED\t3\n#define VP_SCR_NEEDED\t\t4\t/* State Change Request registration */\n#define VP_CONFIG_OK\t\t5\t/* Flag to cfg VP, if FW is ready */\n\tatomic_t \t\tvp_state;\n#define VP_OFFLINE\t\t0\n#define VP_ACTIVE\t\t1\n#define VP_FAILED\t\t2\n// #define VP_DISABLE\t\t3\n\tuint16_t \tvp_err_state;\n\tuint16_t\tvp_prev_err_state;\n#define VP_ERR_UNKWN\t\t0\n#define VP_ERR_PORTDWN\t\t1\n#define VP_ERR_FAB_UNSUPPORTED\t2\n#define VP_ERR_FAB_NORESOURCES\t3\n#define VP_ERR_FAB_LOGOUT\t4\n#define VP_ERR_ADAP_NORESOURCES\t5\n\tstruct qla_hw_data *hw;\n\tstruct scsi_qlt_host vha_tgt;\n\tstruct req_que *req;\n\tint\t\tfw_heartbeat_counter;\n\tint\t\tseconds_since_last_heartbeat;\n\tstruct fc_host_statistics fc_host_stat;\n\tstruct qla_statistics qla_stats;\n\tstruct bidi_statistics bidi_stats;\n\tatomic_t\tvref_count;\n\tstruct qla8044_reset_template reset_tmplt;\n\tuint16_t\tbbcr;\n\n\tuint16_t u_ql2xexchoffld;\n\tuint16_t u_ql2xiniexchg;\n\tuint16_t qlini_mode;\n\tuint16_t ql2xexchoffld;\n\tuint16_t ql2xiniexchg;\n\n\tstruct dentry *dfs_rport_root;\n\n\tstruct purex_list {\n\t\tstruct list_head head;\n\t\tspinlock_t lock;\n\t} purex_list;\n\tstruct purex_item default_item;\n\n\tstruct name_list_extended gnl;\n\t/* Count of active session/fcport */\n\tint fcport_count;\n\twait_queue_head_t fcport_waitQ;\n\twait_queue_head_t vref_waitq;\n\tuint8_t min_supported_speed;\n\tuint8_t n2n_node_name[WWN_SIZE];\n\tuint8_t n2n_port_name[WWN_SIZE];\n\tuint16_t\tn2n_id;\n\t__le16 dport_data[4];\n\tstruct list_head gpnid_list;\n\tstruct fab_scan scan;\n\tuint8_t\tscm_fabric_connection_flags;\n\n\tunsigned int irq_offset;\n} scsi_qla_host_t;\n\nstruct qla27xx_image_status {\n\tuint8_t image_status_mask;\n\t__le16\tgeneration;\n\tuint8_t ver_major;\n\tuint8_t ver_minor;\n\tuint8_t bitmap;\t\t/* 28xx only */\n\tuint8_t reserved[2];\n\t__le32\tchecksum;\n\t__le32\tsignature;\n} __packed;\n\n/* 28xx aux image status bimap values */\n#define QLA28XX_AUX_IMG_BOARD_CONFIG\t\tBIT_0\n#define QLA28XX_AUX_IMG_VPD_NVRAM\t\tBIT_1\n#define QLA28XX_AUX_IMG_NPIV_CONFIG_0_1\t\tBIT_2\n#define QLA28XX_AUX_IMG_NPIV_CONFIG_2_3\t\tBIT_3\n\n#define SET_VP_IDX\t1\n#define SET_AL_PA\t2\n#define RESET_VP_IDX\t3\n#define RESET_AL_PA\t4\nstruct qla_tgt_vp_map {\n\tuint8_t\tidx;\n\tscsi_qla_host_t *vha;\n};\n\nstruct qla2_sgx {\n\tdma_addr_t\t\tdma_addr;\t/* OUT */\n\tuint32_t\t\tdma_len;\t/* OUT */\n\n\tuint32_t\t\ttot_bytes;\t/* IN */\n\tstruct scatterlist\t*cur_sg;\t/* IN */\n\n\t/* for book keeping, bzero on initial invocation */\n\tuint32_t\t\tbytes_consumed;\n\tuint32_t\t\tnum_bytes;\n\tuint32_t\t\ttot_partial;\n\n\t/* for debugging */\n\tuint32_t\t\tnum_sg;\n\tsrb_t\t\t\t*sp;\n};\n\n#define QLA_FW_STARTED(_ha) {\t\t\t\\\n\tint i;\t\t\t\t\t\\\n\t_ha->flags.fw_started = 1;\t\t\\\n\t_ha->base_qpair->fw_started = 1;\t\\\n\tfor (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\\\n\t_ha->queue_pair_map[i]->fw_started = 1;\t\\\n\t}\t\t\t\t\t\\\n}\n\n#define QLA_FW_STOPPED(_ha) {\t\t\t\\\n\tint i;\t\t\t\t\t\\\n\t_ha->flags.fw_started = 0;\t\t\\\n\t_ha->base_qpair->fw_started = 0;\t\\\n\tfor (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\\\n\t_ha->queue_pair_map[i]->fw_started = 0;\t\\\n\t}\t\t\t\t\t\\\n}\n\n\n#define SFUB_CHECKSUM_SIZE\t4\n\nstruct secure_flash_update_block {\n\tuint32_t\tblock_info;\n\tuint32_t\tsignature_lo;\n\tuint32_t\tsignature_hi;\n\tuint32_t\tsignature_upper[0x3e];\n};\n\nstruct secure_flash_update_block_pk {\n\tuint32_t\tblock_info;\n\tuint32_t\tsignature_lo;\n\tuint32_t\tsignature_hi;\n\tuint32_t\tsignature_upper[0x3e];\n\tuint32_t\tpublic_key[0x41];\n};\n\n/*\n * Macros to help code, maintain, etc.\n */\n#define LOOP_TRANSITION(ha) \\\n\t(test_bit(ISP_ABORT_NEEDED, &ha->dpc_flags) || \\\n\t test_bit(LOOP_RESYNC_NEEDED, &ha->dpc_flags) || \\\n\t atomic_read(&ha->loop_state) == LOOP_DOWN)\n\n#define STATE_TRANSITION(ha) \\\n\t\t(test_bit(ISP_ABORT_NEEDED, &ha->dpc_flags) || \\\n\t\t\t test_bit(LOOP_RESYNC_NEEDED, &ha->dpc_flags))\n\n#define QLA_VHA_MARK_BUSY(__vha, __bail) do {\t\t\\\n\tatomic_inc(&__vha->vref_count);\t\t\t\\\n\tmb();\t\t\t\t\t\t\\\n\tif (__vha->flags.delete_progress) {\t\t\\\n\t\tatomic_dec(&__vha->vref_count);\t\t\\\n\t\twake_up(&__vha->vref_waitq);\t\t\\\n\t\t__bail = 1;\t\t\t\t\\\n\t} else {\t\t\t\t\t\\\n\t\t__bail = 0;\t\t\t\t\\\n\t}\t\t\t\t\t\t\\\n} while (0)\n\n#define QLA_VHA_MARK_NOT_BUSY(__vha) do {\t\t\\\n\tatomic_dec(&__vha->vref_count);\t\t\t\\\n\twake_up(&__vha->vref_waitq);\t\t\t\\\n} while (0)\t\t\t\t\t\t\\\n\n#define QLA_QPAIR_MARK_BUSY(__qpair, __bail) do {\t\\\n\tatomic_inc(&__qpair->ref_count);\t\t\\\n\tmb();\t\t\t\t\t\t\\\n\tif (__qpair->delete_in_progress) {\t\t\\\n\t\tatomic_dec(&__qpair->ref_count);\t\\\n\t\t__bail = 1;\t\t\t\t\\\n\t} else {\t\t\t\t\t\\\n\t       __bail = 0;\t\t\t\t\\\n\t}\t\t\t\t\t\t\\\n} while (0)\n\n#define QLA_QPAIR_MARK_NOT_BUSY(__qpair)\t\t\\\n\tatomic_dec(&__qpair->ref_count);\t\t\\\n\n\n#define QLA_ENA_CONF(_ha) {\\\n    int i;\\\n    _ha->base_qpair->enable_explicit_conf = 1;\t\\\n    for (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\t\\\n\t    _ha->queue_pair_map[i]->enable_explicit_conf = 1; \\\n    }\t\t\t\t\t\t\\\n}\n\n#define QLA_DIS_CONF(_ha) {\\\n    int i;\\\n    _ha->base_qpair->enable_explicit_conf = 0;\t\\\n    for (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\t\\\n\t    _ha->queue_pair_map[i]->enable_explicit_conf = 0; \\\n    }\t\t\t\t\t\t\\\n}\n\n/*\n * qla2x00 local function return status codes\n */\n#define MBS_MASK\t\t0x3fff\n\n#define QLA_SUCCESS\t\t(MBS_COMMAND_COMPLETE & MBS_MASK)\n#define QLA_INVALID_COMMAND\t(MBS_INVALID_COMMAND & MBS_MASK)\n#define QLA_INTERFACE_ERROR\t(MBS_HOST_INTERFACE_ERROR & MBS_MASK)\n#define QLA_TEST_FAILED\t\t(MBS_TEST_FAILED & MBS_MASK)\n#define QLA_COMMAND_ERROR\t(MBS_COMMAND_ERROR & MBS_MASK)\n#define QLA_PARAMETER_ERROR\t(MBS_COMMAND_PARAMETER_ERROR & MBS_MASK)\n#define QLA_PORT_ID_USED\t(MBS_PORT_ID_USED & MBS_MASK)\n#define QLA_LOOP_ID_USED\t(MBS_LOOP_ID_USED & MBS_MASK)\n#define QLA_ALL_IDS_IN_USE\t(MBS_ALL_IDS_IN_USE & MBS_MASK)\n#define QLA_NOT_LOGGED_IN\t(MBS_NOT_LOGGED_IN & MBS_MASK)\n\n#define QLA_FUNCTION_TIMEOUT\t\t0x100\n#define QLA_FUNCTION_PARAMETER_ERROR\t0x101\n#define QLA_FUNCTION_FAILED\t\t0x102\n#define QLA_MEMORY_ALLOC_FAILED\t\t0x103\n#define QLA_LOCK_TIMEOUT\t\t0x104\n#define QLA_ABORTED\t\t\t0x105\n#define QLA_SUSPENDED\t\t\t0x106\n#define QLA_BUSY\t\t\t0x107\n#define QLA_ALREADY_REGISTERED\t\t0x109\n#define QLA_OS_TIMER_EXPIRED\t\t0x10a\n\n#define NVRAM_DELAY()\t\tudelay(10)\n\n/*\n * Flash support definitions\n */\n#define OPTROM_SIZE_2300\t0x20000\n#define OPTROM_SIZE_2322\t0x100000\n#define OPTROM_SIZE_24XX\t0x100000\n#define OPTROM_SIZE_25XX\t0x200000\n#define OPTROM_SIZE_81XX\t0x400000\n#define OPTROM_SIZE_82XX\t0x800000\n#define OPTROM_SIZE_83XX\t0x1000000\n#define OPTROM_SIZE_28XX\t0x2000000\n\n#define OPTROM_BURST_SIZE\t0x1000\n#define OPTROM_BURST_DWORDS\t(OPTROM_BURST_SIZE / 4)\n\n#define\tQLA_DSDS_PER_IOCB\t37\n\n#define CMD_SP(Cmnd)\t\t((Cmnd)->SCp.ptr)\n\n#define QLA_SG_ALL\t1024\n\nenum nexus_wait_type {\n\tWAIT_HOST = 0,\n\tWAIT_TARGET,\n\tWAIT_LUN,\n};\n\n/* Refer to SNIA SFF 8247 */\nstruct sff_8247_a0 {\n\tu8 txid;\t/* transceiver id */\n\tu8 ext_txid;\n\tu8 connector;\n\t/* compliance code */\n\tu8 eth_infi_cc3;\t/* ethernet, inifiband */\n\tu8 sonet_cc4[2];\n\tu8 eth_cc6;\n\t/* link length */\n#define FC_LL_VL BIT_7\t/* very long */\n#define FC_LL_S  BIT_6\t/* Short */\n#define FC_LL_I  BIT_5\t/* Intermidiate*/\n#define FC_LL_L  BIT_4\t/* Long */\n#define FC_LL_M  BIT_3\t/* Medium */\n#define FC_LL_SA BIT_2\t/* ShortWave laser */\n#define FC_LL_LC BIT_1\t/* LongWave laser */\n#define FC_LL_EL BIT_0\t/* Electrical inter enclosure */\n\tu8 fc_ll_cc7;\n\t/* FC technology */\n#define FC_TEC_EL BIT_7\t/* Electrical inter enclosure */\n#define FC_TEC_SN BIT_6\t/* short wave w/o OFC */\n#define FC_TEC_SL BIT_5\t/* short wave with OFC */\n#define FC_TEC_LL BIT_4\t/* Longwave Laser */\n#define FC_TEC_ACT BIT_3\t/* Active cable */\n#define FC_TEC_PAS BIT_2\t/* Passive cable */\n\tu8 fc_tec_cc8;\n\t/* Transmission Media */\n#define FC_MED_TW BIT_7\t/* Twin Ax */\n#define FC_MED_TP BIT_6\t/* Twited Pair */\n#define FC_MED_MI BIT_5\t/* Min Coax */\n#define FC_MED_TV BIT_4\t/* Video Coax */\n#define FC_MED_M6 BIT_3\t/* Multimode, 62.5um */\n#define FC_MED_M5 BIT_2\t/* Multimode, 50um */\n#define FC_MED_SM BIT_0\t/* Single Mode */\n\tu8 fc_med_cc9;\n\t/* speed FC_SP_12: 12*100M = 1200 MB/s */\n#define FC_SP_12 BIT_7\n#define FC_SP_8  BIT_6\n#define FC_SP_16 BIT_5\n#define FC_SP_4  BIT_4\n#define FC_SP_32 BIT_3\n#define FC_SP_2  BIT_2\n#define FC_SP_1  BIT_0\n\tu8 fc_sp_cc10;\n\tu8 encode;\n\tu8 bitrate;\n\tu8 rate_id;\n\tu8 length_km;\t\t/* offset 14/eh */\n\tu8 length_100m;\n\tu8 length_50um_10m;\n\tu8 length_62um_10m;\n\tu8 length_om4_10m;\n\tu8 length_om3_10m;\n#define SFF_VEN_NAME_LEN 16\n\tu8 vendor_name[SFF_VEN_NAME_LEN];\t/* offset 20/14h */\n\tu8 tx_compat;\n\tu8 vendor_oui[3];\n#define SFF_PART_NAME_LEN 16\n\tu8 vendor_pn[SFF_PART_NAME_LEN];\t/* part number */\n\tu8 vendor_rev[4];\n\tu8 wavelength[2];\n\tu8 resv;\n\tu8 cc_base;\n\tu8 options[2];\t/* offset 64 */\n\tu8 br_max;\n\tu8 br_min;\n\tu8 vendor_sn[16];\n\tu8 date_code[8];\n\tu8 diag;\n\tu8 enh_options;\n\tu8 sff_revision;\n\tu8 cc_ext;\n\tu8 vendor_specific[32];\n\tu8 resv2[128];\n};\n\n/* BPM -- Buffer Plus Management support. */\n#define IS_BPM_CAPABLE(ha) \\\n\t(IS_QLA25XX(ha) || IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_BPM_RANGE_CAPABLE(ha) \\\n\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_BPM_ENABLED(vha) \\\n\t(ql2xautodetectsfp && !vha->vp_idx && IS_BPM_CAPABLE(vha->hw))\n\n#define FLASH_SEMAPHORE_REGISTER_ADDR   0x00101016\n\n#define USER_CTRL_IRQ(_ha) (ql2xuctrlirq && QLA_TGT_MODE_ENABLED() && \\\n\t(IS_QLA27XX(_ha) || IS_QLA28XX(_ha) || IS_QLA83XX(_ha)))\n\n#define SAVE_TOPO(_ha) { \\\n\tif (_ha->current_topology)\t\t\t\t\\\n\t\t_ha->prev_topology = _ha->current_topology;     \\\n}\n\n#define N2N_TOPO(ha) \\\n\t((ha->prev_topology == ISP_CFG_N && !ha->current_topology) || \\\n\t ha->current_topology == ISP_CFG_N || \\\n\t !ha->current_topology)\n\n#define QLA_N2N_WAIT_TIME\t5 /* 2 * ra_tov(n2n) + 1 */\n\n#define NVME_TYPE(fcport) \\\n\t(fcport->fc4_type & FS_FC4TYPE_NVME) \\\n\n#define FCP_TYPE(fcport) \\\n\t(fcport->fc4_type & FS_FC4TYPE_FCP) \\\n\n#define NVME_ONLY_TARGET(fcport) \\\n\t(NVME_TYPE(fcport) && !FCP_TYPE(fcport))  \\\n\n#define NVME_FCP_TARGET(fcport) \\\n\t(FCP_TYPE(fcport) && NVME_TYPE(fcport)) \\\n\n#define NVME_TARGET(ha, fcport) \\\n\t((NVME_FCP_TARGET(fcport) && \\\n\t(ha->fc4_type_priority == FC4_PRIORITY_NVME)) || \\\n\tNVME_ONLY_TARGET(fcport)) \\\n\n#define PRLI_PHASE(_cls) \\\n\t((_cls == DSC_LS_PRLI_PEND) || (_cls == DSC_LS_PRLI_COMP))\n\n#include \"qla_target.h\"\n#include \"qla_gbl.h\"\n#include \"qla_dbg.h\"\n#include \"qla_inline.h\"\n#endif\n"}}, "reports": [{"events": [{"location": {"col": 3, "file": 0, "line": 3041}, "message": "WARNING use flexible-array member instead (https://www.kernel.org/doc/html/latest/process/deprecated.html#zero-length-and-one-element-arrays)"}], "macros": [], "notes": [], "path": "/src/drivers/scsi/qla2xxx/qla_def.h", "reportHash": "d28110d5aa732bea31c3ca25d6467b23", "checkerName": "coccinelle", "reviewStatus": null, "severity": "UNSPECIFIED"}]};
      window.onload = function() {
        if (!browserCompatible) {
          setNonCompatibleBrowserMessage();
        } else {
          BugViewer.init(data.files, data.reports);
          BugViewer.create();
          BugViewer.initByUrl();
        }
      };
    </script>
  </head>
  <body>
  <div class="container">
    <div id="content">
      <div id="side-bar">
        <div class="header">
          <a href="index.html" class="button">&#8249; Return to List</a>
        </div>
        <div id="report-nav">
          <div class="header">Reports</div>
        </div>
      </div>
      <div id="editor-wrapper">
        <div class="header">
          <div id="file">
            <span class="label">File:</span>
            <span id="file-path"></span>
          </div>
          <div id="checker">
            <span class="label">Checker name:</span>
            <span id="checker-name"></span>
          </div>
          <div id="review-status-wrapper">
            <span class="label">Review status:</span>
            <span id="review-status"></span>
          </div>
        </div>
        <div id="editor"></div>
      </div>
    </div>
  </div>
  </body>
</html>
