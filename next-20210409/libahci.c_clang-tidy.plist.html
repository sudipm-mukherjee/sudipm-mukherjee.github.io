<!DOCTYPE html>
<html>
  <head>
    <title>Plist HTML Viewer</title>

    <meta charset="UTF-8">

    <style type="text/css">
      .CodeMirror{font-family:monospace;height:300px;color:#000;direction:ltr}.CodeMirror-lines{padding:4px 0}.CodeMirror pre{padding:0 4px}.CodeMirror-gutter-filler,.CodeMirror-scrollbar-filler{background-color:#fff}.CodeMirror-gutters{border-right:1px solid #ddd;background-color:#f7f7f7;white-space:nowrap}.CodeMirror-linenumber{padding:0 3px 0 5px;min-width:20px;text-align:right;color:#999;white-space:nowrap}.CodeMirror-guttermarker{color:#000}.CodeMirror-guttermarker-subtle{color:#999}.CodeMirror-cursor{border-left:1px solid #000;border-right:none;width:0}.CodeMirror div.CodeMirror-secondarycursor{border-left:1px solid silver}.cm-fat-cursor .CodeMirror-cursor{width:auto;border:0!important;background:#7e7}.cm-fat-cursor div.CodeMirror-cursors{z-index:1}.cm-animate-fat-cursor{width:auto;border:0;-webkit-animation:blink 1.06s steps(1) infinite;-moz-animation:blink 1.06s steps(1) infinite;animation:blink 1.06s steps(1) infinite;background-color:#7e7}@-moz-keyframes blink{50%{background-color:transparent}}@-webkit-keyframes blink{50%{background-color:transparent}}@keyframes blink{50%{background-color:transparent}}.cm-tab{display:inline-block;text-decoration:inherit}.CodeMirror-rulers{position:absolute;left:0;right:0;top:-50px;bottom:-20px;overflow:hidden}.CodeMirror-ruler{border-left:1px solid #ccc;top:0;bottom:0;position:absolute}.cm-s-default .cm-header{color:#00f}.cm-s-default .cm-quote{color:#090}.cm-negative{color:#d44}.cm-positive{color:#292}.cm-header,.cm-strong{font-weight:700}.cm-em{font-style:italic}.cm-link{text-decoration:underline}.cm-strikethrough{text-decoration:line-through}.cm-s-default .cm-keyword{color:#708}.cm-s-default .cm-atom{color:#219}.cm-s-default .cm-number{color:#164}.cm-s-default .cm-def{color:#00f}.cm-s-default .cm-variable-2{color:#05a}.cm-s-default .cm-type,.cm-s-default .cm-variable-3{color:#085}.cm-s-default .cm-comment{color:#a50}.cm-s-default .cm-string{color:#a11}.cm-s-default .cm-string-2{color:#f50}.cm-s-default .cm-meta{color:#555}.cm-s-default .cm-qualifier{color:#555}.cm-s-default .cm-builtin{color:#30a}.cm-s-default .cm-bracket{color:#997}.cm-s-default .cm-tag{color:#170}.cm-s-default .cm-attribute{color:#00c}.cm-s-default .cm-hr{color:#999}.cm-s-default .cm-link{color:#00c}.cm-s-default .cm-error{color:red}.cm-invalidchar{color:red}.CodeMirror-composing{border-bottom:2px solid}div.CodeMirror span.CodeMirror-matchingbracket{color:#0f0}div.CodeMirror span.CodeMirror-nonmatchingbracket{color:#f22}.CodeMirror-matchingtag{background:rgba(255,150,0,.3)}.CodeMirror-activeline-background{background:#e8f2ff}.CodeMirror{position:relative;overflow:hidden;background:#fff}.CodeMirror-scroll{overflow:scroll!important;margin-bottom:-30px;margin-right:-30px;padding-bottom:30px;height:100%;outline:0;position:relative}.CodeMirror-sizer{position:relative;border-right:30px solid transparent}.CodeMirror-gutter-filler,.CodeMirror-hscrollbar,.CodeMirror-scrollbar-filler,.CodeMirror-vscrollbar{position:absolute;z-index:6;display:none}.CodeMirror-vscrollbar{right:0;top:0;overflow-x:hidden;overflow-y:scroll}.CodeMirror-hscrollbar{bottom:0;left:0;overflow-y:hidden;overflow-x:scroll}.CodeMirror-scrollbar-filler{right:0;bottom:0}.CodeMirror-gutter-filler{left:0;bottom:0}.CodeMirror-gutters{position:absolute;left:0;top:0;min-height:100%;z-index:3}.CodeMirror-gutter{white-space:normal;height:100%;display:inline-block;vertical-align:top;margin-bottom:-30px}.CodeMirror-gutter-wrapper{position:absolute;z-index:4;background:0 0!important;border:none!important}.CodeMirror-gutter-background{position:absolute;top:0;bottom:0;z-index:4}.CodeMirror-gutter-elt{position:absolute;cursor:default;z-index:4}.CodeMirror-gutter-wrapper ::selection{background-color:transparent}.CodeMirror-gutter-wrapper ::-moz-selection{background-color:transparent}.CodeMirror-lines{cursor:text;min-height:1px}.CodeMirror pre{-moz-border-radius:0;-webkit-border-radius:0;border-radius:0;border-width:0;background:0 0;font-family:inherit;font-size:inherit;margin:0;white-space:pre;word-wrap:normal;line-height:inherit;color:inherit;z-index:2;position:relative;overflow:visible;-webkit-tap-highlight-color:transparent;-webkit-font-variant-ligatures:contextual;font-variant-ligatures:contextual}.CodeMirror-wrap pre{word-wrap:break-word;white-space:pre-wrap;word-break:normal}.CodeMirror-linebackground{position:absolute;left:0;right:0;top:0;bottom:0;z-index:0}.CodeMirror-linewidget{position:relative;z-index:2;overflow:auto}.CodeMirror-rtl pre{direction:rtl}.CodeMirror-code{outline:0}.CodeMirror-gutter,.CodeMirror-gutters,.CodeMirror-linenumber,.CodeMirror-scroll,.CodeMirror-sizer{-moz-box-sizing:content-box;box-sizing:content-box}.CodeMirror-measure{position:absolute;width:100%;height:0;overflow:hidden;visibility:hidden}.CodeMirror-cursor{position:absolute;pointer-events:none}.CodeMirror-measure pre{position:static}div.CodeMirror-cursors{visibility:hidden;position:relative;z-index:3}div.CodeMirror-dragcursors{visibility:visible}.CodeMirror-focused div.CodeMirror-cursors{visibility:visible}.CodeMirror-selected{background:#d9d9d9}.CodeMirror-focused .CodeMirror-selected{background:#d7d4f0}.CodeMirror-crosshair{cursor:crosshair}.CodeMirror-line::selection,.CodeMirror-line>span::selection,.CodeMirror-line>span>span::selection{background:#d7d4f0}.CodeMirror-line::-moz-selection,.CodeMirror-line>span::-moz-selection,.CodeMirror-line>span>span::-moz-selection{background:#d7d4f0}.cm-searching{background-color:#ffa;background-color:rgba(255,255,0,.4)}.cm-force-border{padding-right:.1px}@media print{.CodeMirror div.CodeMirror-cursors{visibility:hidden}}.cm-tab-wrap-hack:after{content:''}span.CodeMirror-selectedtext{background:0 0}
/*# sourceMappingURL=codemirror.min.css.map */

      .severity-low {
  background-color: #669603;
}

.severity-low:after {
  content : 'L';
}

.severity-unspecified {
  background-color: #666666;
}

.severity-unspecified:after {
  content : 'U';
}

.severity-style {
  background-color: #9932cc;
}

.severity-style:after {
  content : 'S';
}

.severity-medium {
  background-color: #a9d323;
  color: black;
}

.severity-medium:after {
  content : 'M';
}

.severity-high {
  background-color: #ffa800;
}

.severity-high:after {
  content : 'H';
}

.severity-critical {
  background-color: #e92625;
}

.severity-critical:after {
  content : 'C';
}

i[class*="severity-"] {
  line-height: normal;
  text-transform: capitalize;
  font-size: 0.8em;
  font-weight: bold;
  color: white;
  display: inline-block;
  width: 16px;
  height: 16px;
  text-align: center;
  font-family: sans-serif;
}

      html, body {
  width: 100%;
  height: 100%;
  padding: 0px;
  margin: 0px;
}

div.container {
  padding: 10px;
}

#content {
  height: 100%;
  display: block;
  overflow: hidden;
}

#content > div {
  margin: 10px;
  overflow: hidden;
  border: 1px solid #ddd;
  border-radius: 3px;
  overflow: hidden;
  height: 97%;
}

.button {
  background-color: #f1f1f1;
  text-decoration: none;
  display: inline-block;
  padding: 8px 16px;
  color: black;
  cursor: pointer;
}

.button:hover {
  background-color: #ddd;
  color: black;
}

.review-status {
  color: white;
  text-align: center;
}

.review-status-confirmed {
  background-color: #e92625;
}

.review-status-false-positive {
  background-color: grey;
}

.review-status-intentional {
  background-color: #669603;
}

      div.container {
  width: 100%;
  height: 100%;
  padding: 0px;
}

#editor-wrapper {
  margin: 10px;
}

#side-bar {
  float: left;
  width: 260px;
  margin: 0px;
}

#report-nav ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
  overflow-y: auto;
  height: 100%;
}

#report-nav ul > li {
  padding: .4em;
  background-color: #fff;
  border-bottom: 1px solid rgba(0,0,0,.125);
  text-align: left;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

#report-nav ul > li.active {
  background-color: #427ea9;
  color: white;
}

#report-nav ul > li:hover {
  background-color: #427ea9;
  color: white;
  cursor: pointer;
}

#report-nav ul a {
  text-decoration: none;
}

#report-nav i[class*="severity-"] {
  margin-right: 5px;
}

.header {
  border-bottom: 1px solid lightgrey;
  font-family: monospace;
  padding: 10px;
  background-color: #fafbfc;
  border-bottom: 1px solid #e1e4e8;
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}

#report-nav .header {
  font-weight: bold;
}

#editor-wrapper .header > div {
  padding-top: 2px;
}

#file-path,
#checker-name {
  color: #195ea2;
}

#review-status {
  padding: 0px 5px;
}

#file-path {
  font-family: monospace;
}

.check-msg {
  display: inline-block;
  padding: 3px 6px;
  margin: 1px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.check-msg.info {
  color: #00546f;
  background-color: #bfdfe9;
  border: 1px solid #87a8b3;
}

.check-msg.error {
  background-color: #f2dede;
  color: #a94442;
  border: 1px solid #ebcccc;
}

.check-msg.macro {
  background-color: #d7dac2;
  color: #4f5c6d;
  border: 1px solid #d7dac2;
}

.check-msg.note {
  background-color: #d7d7d7;
  color: #4f5c6d;
  border: 1px solid #bfbfbf;
}

.check-msg.current {
  border: 2px dashed #3692ff;
}

.check-msg .tag {
  padding: 1px 5px;
  text-align: center;
  border-radius: 2px;
  margin-right: 5px;
  text-decoration: inherit;
}

.check-msg .tag.macro {
  background-color: #83876a;
  color: white;
  text-transform: capitalize;
}

.check-msg .tag.note {
  background-color: #9299a1;
  color: white;
  text-transform: capitalize;
}

.checker-enum {
  color: white;
  padding: 1px 5px;
  text-align: center;
  border-radius: 25px;
  margin-right: 5px;
  text-decoration: inherit;
}

.checker-enum.info {
  background-color: #427ea9;
}

.checker-enum.error {
  background-color: #a94442;
}

.arrow {
  border: solid black;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 3px;
  cursor: pointer;
  margin: 0px 5px;
}

.arrow:hover {
  border: solid #437ea8;
  border-width: 0 3px 3px 0;
}

.left-arrow {
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
}

.right-arrow {
  transform: rotate(-45deg);
  -webkit-transform: rotate(-45deg);
}

    </style>

    <script type="text/javascript">
      function setNonCompatibleBrowserMessage() {
  document.body.innerHTML =
    '<h2 style="margin-left: 20px;">Your browser is not compatible with CodeChecker Viewer!</h2> \
     <p style="margin-left: 20px;">The version required for the following browsers are:</p> \
     <ul style="margin-left: 20px;"> \
     <li>Internet Explorer: version 9 or newer</li> \
     <li>Firefox: version 22.0 or newer</li> \
     </ul>';
}

// http://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser
var browserVersion = (function(){
  var ua = navigator.userAgent, tem,
    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];

  if (/trident/i.test(M[1])) {
    tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
    return 'IE ' + (tem[1] || '');
  }

  if (M[1] === 'Chrome') {
    tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
    if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
  }

  M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
  if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
    return M.join(' ');
})();

var pos = browserVersion.indexOf(' ');
var browser = browserVersion.substr(0, pos);
var version = parseInt(browserVersion.substr(pos + 1));

var browserCompatible
  = browser === 'Firefox'
  ? version >= 22
  : browser === 'IE'
  ? version >= 9
  : true;


      /* MIT License

Copyright (C) 2017 by Marijn Haverbeke <marijnh@gmail.com> and others

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
 */
      !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CodeMirror=t()}(this,function(){"use strict";function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function t(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function r(e,r){return t(e).appendChild(r)}function n(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),"string"==typeof t)i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function i(e,t,r,i){var o=n(e,t,r,i);return o.setAttribute("role","presentation"),o}function o(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function l(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function s(t,r){var n=t.className;e(r).test(n)||(t.className+=(n?" ":"")+r)}function a(t,r){for(var n=t.split(" "),i=0;i<n.length;i++)n[i]&&!e(n[i]).test(r)&&(r+=" "+n[i]);return r}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function c(e,t,r){t||(t={});for(var n in e)!e.hasOwnProperty(n)||!1===r&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function f(e,t,r,n,i){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,l=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t)return l+(t-o);l+=s-o,l+=r-l%r,o=s+1}}function h(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}function d(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);-1==o&&(o=e.length);var l=o-n;if(o==e.length||i+l>=t)return n+Math.min(l,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}function p(e){for(;Kl.length<=e;)Kl.push(g(Kl)+" ");return Kl[e]}function g(e){return e[e.length-1]}function v(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function m(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}function y(){}function b(e,t){var r;return Object.create?r=Object.create(e):(y.prototype=e,r=new y),t&&c(t,r),r}function w(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||jl.test(e))}function x(e,t){return t?!!(t.source.indexOf("\\w")>-1&&w(e))||t.test(e):w(e)}function C(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function S(e){return e.charCodeAt(0)>=768&&Xl.test(e)}function L(e,t,r){for(;(r<0?t>0:t<e.length)&&S(e.charAt(t));)t+=r;return t}function k(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}function T(e,t,r){var o=this;this.input=r,o.scrollbarFiller=n("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=n("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=i("div",null,"CodeMirror-code"),o.selectionDiv=n("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=n("div",null,"CodeMirror-cursors"),o.measure=n("div",null,"CodeMirror-measure"),o.lineMeasure=n("div",null,"CodeMirror-measure"),o.lineSpace=i("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var l=i("div",[o.lineSpace],"CodeMirror-lines");o.mover=n("div",[l],null,"position: relative"),o.sizer=n("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=n("div",null,null,"position: absolute; height: "+Rl+"px; width: 1px;"),o.gutters=n("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=n("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=n("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),gl&&vl<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),ml||fl&&Tl||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,r.init(o)}function M(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function N(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(e){var o=e.text;i==r.line&&(o=o.slice(0,r.ch)),i==t.line&&(o=o.slice(t.ch)),n.push(o),++i}),n}function O(e,t,r){var n=[];return e.iter(t,r,function(e){n.push(e.text)}),n}function A(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function W(e){if(null==e.parent)return null;for(var t=e.parent,r=h(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function D(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var l=0;l<e.lines.length;++l){var s=e.lines[l].height;if(t<s)break;t-=s}return r+l}function H(e,t){return t>=e.first&&t<e.first+e.size}function F(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function E(e,t,r){if(void 0===r&&(r=null),!(this instanceof E))return new E(e,t,r);this.line=e,this.ch=t,this.sticky=r}function P(e,t){return e.line-t.line||e.ch-t.ch}function I(e,t){return e.sticky==t.sticky&&0==P(e,t)}function z(e){return E(e.line,e.ch)}function R(e,t){return P(e,t)<0?t:e}function B(e,t){return P(e,t)<0?e:t}function G(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function U(e,t){if(t.line<e.first)return E(e.first,0);var r=e.first+e.size-1;return t.line>r?E(r,M(e,r).text.length):V(t,M(e,t.line).text.length)}function V(e,t){var r=e.ch;return null==r||r>t?E(e.line,t):r<0?E(e.line,0):e}function K(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=U(e,t[n]);return r}function j(){Yl=!0}function X(){_l=!0}function Y(e,t,r){this.marker=e,this.from=t,this.to=r}function _(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function $(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function q(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Z(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==l.type&&(!r||!o.marker.insertLeft)){var s=null==o.to||(l.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new Y(l,o.from,s?null:o.to))}}return n}function Q(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],l=o.marker;if(null==o.to||(l.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==l.type&&(!r||o.marker.insertLeft)){var s=null==o.from||(l.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new Y(l,s?null:o.from-t,null==o.to?null:o.to-t))}}return n}function J(e,t){if(t.full)return null;var r=H(e,t.from.line)&&M(e,t.from.line).markedSpans,n=H(e,t.to.line)&&M(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,l=0==P(t.from,t.to),s=Z(r,i,l),a=Q(n,o,l),u=1==t.text.length,c=g(t.text).length+(u?i:0);if(s)for(var f=0;f<s.length;++f){var h=s[f];if(null==h.to){var d=_(a,h.marker);d?u&&(h.to=null==d.to?null:d.to+c):h.to=i}}if(a)for(var p=0;p<a.length;++p){var v=a[p];null!=v.to&&(v.to+=c),null==v.from?_(s,v.marker)||(v.from=c,u&&(s||(s=[])).push(v)):(v.from+=c,u&&(s||(s=[])).push(v))}s&&(s=ee(s)),a&&a!=s&&(a=ee(a));var m=[s];if(!u){var y,b=t.text.length-2;if(b>0&&s)for(var w=0;w<s.length;++w)null==s[w].to&&(y||(y=[])).push(new Y(s[w].marker,null,null));for(var x=0;x<b;++x)m.push(y);m.push(a)}return m}function ee(e){for(var t=0;t<e.length;++t){var r=e[t];null!=r.from&&r.from==r.to&&!1!==r.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function te(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;!r.readOnly||n&&-1!=h(n,r)||(n||(n=[])).push(r)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var l=n[o],s=l.find(0),a=0;a<i.length;++a){var u=i[a];if(!(P(u.to,s.from)<0||P(u.from,s.to)>0)){var c=[a,1],f=P(u.from,s.from),d=P(u.to,s.to);(f<0||!l.inclusiveLeft&&!f)&&c.push({from:u.from,to:s.from}),(d>0||!l.inclusiveRight&&!d)&&c.push({from:s.to,to:u.to}),i.splice.apply(i,c),a+=c.length-3}}return i}function re(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function ne(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function ie(e){return e.inclusiveLeft?-1:0}function oe(e){return e.inclusiveRight?1:0}function le(e,t){var r=e.lines.length-t.lines.length;if(0!=r)return r;var n=e.find(),i=t.find(),o=P(n.from,i.from)||ie(e)-ie(t);if(o)return-o;var l=P(n.to,i.to)||oe(e)-oe(t);return l||t.id-e.id}function se(e,t){var r,n=_l&&e.markedSpans;if(n)for(var i=void 0,o=0;o<n.length;++o)(i=n[o]).marker.collapsed&&null==(t?i.from:i.to)&&(!r||le(r,i.marker)<0)&&(r=i.marker);return r}function ae(e){return se(e,!0)}function ue(e){return se(e,!1)}function ce(e,t,r,n,i){var o=M(e,t),l=_l&&o.markedSpans;if(l)for(var s=0;s<l.length;++s){var a=l[s];if(a.marker.collapsed){var u=a.marker.find(0),c=P(u.from,r)||ie(a.marker)-ie(i),f=P(u.to,n)||oe(a.marker)-oe(i);if(!(c>=0&&f<=0||c<=0&&f>=0)&&(c<=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.to,r)>=0:P(u.to,r)>0)||c>=0&&(a.marker.inclusiveRight&&i.inclusiveLeft?P(u.from,n)<=0:P(u.from,n)<0)))return!0}}}function fe(e){for(var t;t=ae(e);)e=t.find(-1,!0).line;return e}function he(e){for(var t;t=ue(e);)e=t.find(1,!0).line;return e}function de(e){for(var t,r;t=ue(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function pe(e,t){var r=M(e,t),n=fe(r);return r==n?t:W(n)}function ge(e,t){if(t>e.lastLine())return t;var r,n=M(e,t);if(!ve(e,n))return t;for(;r=ue(n);)n=r.find(1,!0).line;return W(n)+1}function ve(e,t){var r=_l&&t.markedSpans;if(r)for(var n=void 0,i=0;i<r.length;++i)if((n=r[i]).marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&me(e,t,n))return!0}}function me(e,t,r){if(null==r.to){var n=r.marker.find(1,!0);return me(e,n.line,_(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if((i=t.markedSpans[o]).marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(null==i.to||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&me(e,t,i))return!0}function ye(e){for(var t=0,r=(e=fe(e)).parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var l=0;l<o.children.length;++l){var s=o.children[l];if(s==r)break;t+=s.height}return t}function be(e){if(0==e.height)return 0;for(var t,r=e.text.length,n=e;t=ae(n);){var i=t.find(0,!0);n=i.from.line,r+=i.from.ch-i.to.ch}for(n=e;t=ue(n);){var o=t.find(0,!0);r-=n.text.length-o.from.ch,r+=(n=o.to.line).text.length-o.to.ch}return r}function we(e){var t=e.display,r=e.doc;t.maxLine=M(r,r.first),t.maxLineLength=be(t.maxLine),t.maxLineChanged=!0,r.iter(function(e){var r=be(e);r>t.maxLineLength&&(t.maxLineLength=r,t.maxLine=e)})}function xe(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var l=e[o];(l.from<r&&l.to>t||t==r&&l.to==t)&&(n(Math.max(l.from,t),Math.min(l.to,r),1==l.level?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}function Ce(e,t,r){var n;$l=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&"before"==r?n=i:$l=i),o.from==t&&(o.from!=o.to&&"before"!=r?n=i:$l=i)}return null!=n?n:$l}function Se(e,t){var r=e.order;return null==r&&(r=e.order=ql(e.text,t)),r}function Le(e,t){return e._handlers&&e._handlers[t]||Zl}function ke(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=h(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function Te(e,t){var r=Le(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function Me(e,t,r){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Te(e,r||t.type,e,t),He(t)||t.codemirrorIgnore}function Ne(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==h(r,t[n])&&r.push(t[n])}function Oe(e,t){return Le(e,t).length>0}function Ae(e){e.prototype.on=function(e,t){Ql(this,e,t)},e.prototype.off=function(e,t){ke(this,e,t)}}function We(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function De(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function He(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){We(e),De(e)}function Ee(e){return e.target||e.srcElement}function Pe(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Ml&&e.ctrlKey&&1==t&&(t=3),t}function Ie(e){if(null==Il){var t=n("span","​");r(e,n("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Il=t.offsetWidth<=1&&t.offsetHeight>2&&!(gl&&vl<8))}var i=Il?n("span","​"):n("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function ze(e){if(null!=zl)return zl;var n=r(e,document.createTextNode("AخA")),i=Wl(n,0,1).getBoundingClientRect(),o=Wl(n,1,2).getBoundingClientRect();return t(e),!(!i||i.left==i.right)&&(zl=o.right-i.right<3)}function Re(e){if(null!=ns)return ns;var t=r(e,n("span","x")),i=t.getBoundingClientRect(),o=Wl(t,0,1).getBoundingClientRect();return ns=Math.abs(i.left-o.left)>1}function Be(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),is[e]=t}function Ge(e){if("string"==typeof e&&os.hasOwnProperty(e))e=os[e];else if(e&&"string"==typeof e.name&&os.hasOwnProperty(e.name)){var t=os[e.name];"string"==typeof t&&(t={name:t}),(e=b(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ue(e,t){t=Ge(t);var r=is[t.name];if(!r)return Ue(e,"text/plain");var n=r(e,t);if(ls.hasOwnProperty(t.name)){var i=ls[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var l in t.modeProps)n[l]=t.modeProps[l];return n}function Ve(e,t){c(t,ls.hasOwnProperty(e)?ls[e]:ls[e]={})}function Ke(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function je(e,t){for(var r;e.innerMode&&(r=e.innerMode(t))&&r.mode!=e;)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Xe(e,t,r){return!e.startState||e.startState(t,r)}function Ye(e,t,r,n){var i=[e.state.modeGen],o={};tt(e,t.text,e.doc.mode,r,function(e,t){return i.push(e,t)},o,n);for(var l=r.state,s=0;s<e.state.overlays.length;++s)!function(n){var l=e.state.overlays[n],s=1,a=0;r.state=!0,tt(e,t.text,l.mode,r,function(e,t){for(var r=s;a<e;){var n=i[s];n>e&&i.splice(s,1,e,i[s+1],n),s+=2,a=Math.min(e,n)}if(t)if(l.opaque)i.splice(r,s-r,e,"overlay "+t),s=r+2;else for(;r<s;r+=2){var o=i[r+1];i[r+1]=(o?o+" ":"")+"overlay "+t}},o)}(s);return r.state=l,{styles:i,classes:o.bgClass||o.textClass?o:null}}function _e(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=$e(e,W(t)),i=t.text.length>e.options.maxHighlightLength&&Ke(e.doc.mode,n.state),o=Ye(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function $e(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new us(n,!0,t);var o=rt(e,t,r),l=o>n.first&&M(n,o-1).stateAfter,s=l?us.fromSaved(n,l,o):new us(n,Xe(n.mode),o);return n.iter(o,t,function(r){qe(e,r.text,s);var n=s.line;r.stateAfter=n==t-1||n%5==0||n>=i.viewFrom&&n<i.viewTo?s.save():null,s.nextLine()}),r&&(n.modeFrontier=s.line),s}function qe(e,t,r,n){var i=e.doc.mode,o=new ss(t,e.options.tabSize,r);for(o.start=o.pos=n||0,""==t&&Ze(i,r.state);!o.eol();)Qe(i,o,r.state),o.start=o.pos}function Ze(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=je(e,t);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function Qe(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=je(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function Je(e,t,r,n){var i,o,l=e.doc,s=l.mode,a=M(l,(t=U(l,t)).line),u=$e(e,t.line,r),c=new ss(a.text,e.options.tabSize,u);for(n&&(o=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,i=Qe(s,c,u.state),n&&o.push(new cs(c,i,Ke(l.mode,u.state)));return n?o:new cs(c,i,u.state)}function et(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";null==t[n]?t[n]=r[2]:new RegExp("(?:^|s)"+r[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+r[2])}return e}function tt(e,t,r,n,i,o,l){var s=r.flattenSpans;null==s&&(s=e.options.flattenSpans);var a,u=0,c=null,f=new ss(t,e.options.tabSize,n),h=e.options.addModeClass&&[null];for(""==t&&et(Ze(r,n.state),o);!f.eol();){if(f.pos>e.options.maxHighlightLength?(s=!1,l&&qe(e,t,n,f.pos),f.pos=t.length,a=null):a=et(Qe(r,f,n.state,h),o),h){var d=h[0].name;d&&(a="m-"+(a?d+" "+a:d))}if(!s||c!=a){for(;u<f.start;)i(u=Math.min(f.start,u+5e3),c);c=a}f.start=f.pos}for(;u<f.pos;){var p=Math.min(f.pos,u+5e3);i(p,c),u=p}}function rt(e,t,r){for(var n,i,o=e.doc,l=r?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;s>l;--s){if(s<=o.first)return o.first;var a=M(o,s-1),u=a.stateAfter;if(u&&(!r||s+(u instanceof as?u.lookAhead:0)<=o.modeFrontier))return s;var c=f(a.text,null,e.options.tabSize);(null==i||n>c)&&(i=s-1,n=c)}return i}function nt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=M(e,n).stateAfter;if(i&&(!(i instanceof as)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}function it(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),re(e),ne(e,r);var i=n?n(e):1;i!=e.height&&A(e,i)}function ot(e){e.parent=null,re(e)}function lt(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?ps:ds;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function st(e,t){var r=i("span",null,null,ml?"padding-right: .1px":null),n={pre:i("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(gl||ml)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var l=o?t.rest[o-1]:t.line,s=void 0;n.pos=0,n.addToken=ut,ze(e.display.measure)&&(s=Se(l,e.doc.direction))&&(n.addToken=ft(n.addToken,s)),n.map=[],dt(l,n,_e(e,l,t!=e.display.externalMeasured&&W(l))),l.styleClasses&&(l.styleClasses.bgClass&&(n.bgClass=a(l.styleClasses.bgClass,n.bgClass||"")),l.styleClasses.textClass&&(n.textClass=a(l.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(Ie(e.display.measure))),0==o?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(ml){var u=n.content.lastChild;(/\bcm-tab\b/.test(u.className)||u.querySelector&&u.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Te(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=a(n.pre.className,n.textClass||"")),n}function at(e){var t=n("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function ut(e,t,r,i,o,l,s){if(t){var a,u=e.splitSpaces?ct(t,e.trailingSpace):t,c=e.cm.state.specialChars,f=!1;if(c.test(t)){a=document.createDocumentFragment();for(var h=0;;){c.lastIndex=h;var d=c.exec(t),g=d?d.index-h:t.length-h;if(g){var v=document.createTextNode(u.slice(h,h+g));gl&&vl<9?a.appendChild(n("span",[v])):a.appendChild(v),e.map.push(e.pos,e.pos+g,v),e.col+=g,e.pos+=g}if(!d)break;h+=g+1;var m=void 0;if("\t"==d[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(m=a.appendChild(n("span",p(b),"cm-tab"))).setAttribute("role","presentation"),m.setAttribute("cm-text","\t"),e.col+=b}else"\r"==d[0]||"\n"==d[0]?((m=a.appendChild(n("span","\r"==d[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",d[0]),e.col+=1):((m=e.cm.options.specialCharPlaceholder(d[0])).setAttribute("cm-text",d[0]),gl&&vl<9?a.appendChild(n("span",[m])):a.appendChild(m),e.col+=1);e.map.push(e.pos,e.pos+1,m),e.pos++}}else e.col+=t.length,a=document.createTextNode(u),e.map.push(e.pos,e.pos+t.length,a),gl&&vl<9&&(f=!0),e.pos+=t.length;if(e.trailingSpace=32==u.charCodeAt(t.length-1),r||i||o||f||s){var w=r||"";i&&(w+=i),o&&(w+=o);var x=n("span",[a],w,s);return l&&(x.title=l),e.content.appendChild(x)}e.content.appendChild(a)}}function ct(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);" "!=o||!r||i!=e.length-1&&32!=e.charCodeAt(i+1)||(o=" "),n+=o,r=" "==o}return n}function ft(e,t){return function(r,n,i,o,l,s,a){i=i?i+" cm-force-border":"cm-force-border";for(var u=r.pos,c=u+n.length;;){for(var f=void 0,h=0;h<t.length&&!((f=t[h]).to>u&&f.from<=u);h++);if(f.to>=c)return e(r,n,i,o,l,s,a);e(r,n.slice(0,f.to-u),i,o,null,s,a),o=null,n=n.slice(f.to-u),u=f.to}}}function ht(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function dt(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(n)for(var l,s,a,u,c,f,h,d=i.length,p=0,g=1,v="",m=0;;){if(m==p){a=u=c=f=s="",h=null,m=1/0;for(var y=[],b=void 0,w=0;w<n.length;++w){var x=n[w],C=x.marker;"bookmark"==C.type&&x.from==p&&C.widgetNode?y.push(C):x.from<=p&&(null==x.to||x.to>p||C.collapsed&&x.to==p&&x.from==p)?(null!=x.to&&x.to!=p&&m>x.to&&(m=x.to,u=""),C.className&&(a+=" "+C.className),C.css&&(s=(s?s+";":"")+C.css),C.startStyle&&x.from==p&&(c+=" "+C.startStyle),C.endStyle&&x.to==m&&(b||(b=[])).push(C.endStyle,x.to),C.title&&!f&&(f=C.title),C.collapsed&&(!h||le(h.marker,C)<0)&&(h=x)):x.from>p&&m>x.from&&(m=x.from)}if(b)for(var S=0;S<b.length;S+=2)b[S+1]==m&&(u+=" "+b[S]);if(!h||h.from==p)for(var L=0;L<y.length;++L)ht(t,0,y[L]);if(h&&(h.from||0)==p){if(ht(t,(null==h.to?d+1:h.to)-p,h.marker,null==h.from),null==h.to)return;h.to==p&&(h=!1)}}if(p>=d)break;for(var k=Math.min(d,m);;){if(v){var T=p+v.length;if(!h){var M=T>k?v.slice(0,k-p):v;t.addToken(t,M,l?l+a:a,c,p+M.length==m?u:"",f,s)}if(T>=k){v=v.slice(k-p),p=k;break}p=T,c=""}v=i.slice(o,o=r[g++]),l=lt(r[g++],t.cm.options)}}else for(var N=1;N<r.length;N+=2)t.addToken(t,i.slice(o,o=r[N]),lt(r[N+1],t.cm.options))}function pt(e,t,r){this.line=t,this.rest=de(t),this.size=this.rest?W(g(this.rest))-r+1:1,this.node=this.text=null,this.hidden=ve(e,t)}function gt(e,t,r){for(var n,i=[],o=t;o<r;o=n){var l=new pt(e.doc,M(e.doc,o),o);n=o+l.size,i.push(l)}return i}function vt(e){gs?gs.ops.push(e):e.ownsGroup=gs={ops:[e],delayedCallbacks:[]}}function mt(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function yt(e,t){var r=e.ownsGroup;if(r)try{mt(r)}finally{gs=null,t(r)}}function bt(e,t){var r=Le(e,t);if(r.length){var n,i=Array.prototype.slice.call(arguments,2);gs?n=gs.delayedCallbacks:vs?n=vs:(n=vs=[],setTimeout(wt,0));for(var o=0;o<r.length;++o)!function(e){n.push(function(){return r[e].apply(null,i)})}(o)}}function wt(){var e=vs;vs=null;for(var t=0;t<e.length;++t)e[t]()}function xt(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];"text"==o?kt(e,t):"gutter"==o?Mt(e,t,r,n):"class"==o?Tt(e,t):"widget"==o&&Nt(e,t,n)}t.changes=null}function Ct(e){return e.node==e.text&&(e.node=n("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),gl&&vl<8&&(e.node.style.zIndex=2)),e.node}function St(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var i=Ct(t);t.background=i.insertBefore(n("div",null,r),i.firstChild),e.display.input.setUneditable(t.background)}}function Lt(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):st(e,t)}function kt(e,t){var r=t.text.className,n=Lt(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,Tt(e,t)):r&&(t.text.className=r)}function Tt(e,t){St(e,t),t.line.wrapClass?Ct(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Mt(e,t,r,i){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var o=Ct(t);t.gutterBackground=n("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px; width: "+i.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text)}var l=t.line.gutterMarkers;if(e.options.lineNumbers||l){var s=Ct(t),a=t.gutter=n("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?i.fixedPos:-i.gutterTotalWidth)+"px");if(e.display.input.setUneditable(a),s.insertBefore(a,t.text),t.line.gutterClass&&(a.className+=" "+t.line.gutterClass),!e.options.lineNumbers||l&&l["CodeMirror-linenumbers"]||(t.lineNumber=a.appendChild(n("div",F(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),l)for(var u=0;u<e.options.gutters.length;++u){var c=e.options.gutters[u],f=l.hasOwnProperty(c)&&l[c];f&&a.appendChild(n("div",[f],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}}function Nt(e,t,r){t.alignable&&(t.alignable=null);for(var n=t.node.firstChild,i=void 0;n;n=i)i=n.nextSibling,"CodeMirror-linewidget"==n.className&&t.node.removeChild(n);At(e,t,r)}function Ot(e,t,r,n){var i=Lt(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),Tt(e,t),Mt(e,t,r,n),At(e,t,n),t.node}function At(e,t,r){if(Wt(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)Wt(e,t.rest[n],t,r,!1)}function Wt(e,t,r,i,o){if(t.widgets)for(var l=Ct(r),s=0,a=t.widgets;s<a.length;++s){var u=a[s],c=n("div",[u.node],"CodeMirror-linewidget");u.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Dt(u,c,r,i),e.display.input.setUneditable(c),o&&u.above?l.insertBefore(c,r.gutter||r.text):l.appendChild(c),bt(u,"redraw")}}function Dt(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Ht(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!o(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),r(t.display.measure,n("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Ft(e,t){for(var r=Ee(t);r!=e.wrapper;r=r.parentNode)if(!r||1==r.nodeType&&"true"==r.getAttribute("cm-ignore-events")||r.parentNode==e.sizer&&r!=e.mover)return!0}function Et(e){return e.lineSpace.offsetTop}function Pt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function It(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=r(e.measure,n("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,o={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(e.cachedPaddingH=o),o}function zt(e){return Rl-e.display.nativeBarWidth}function Rt(e){return e.display.scroller.clientWidth-zt(e)-e.display.barWidth}function Bt(e){return e.display.scroller.clientHeight-zt(e)-e.display.barHeight}function Gt(e,t,r){var n=e.options.lineWrapping,i=n&&Rt(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var l=t.text.firstChild.getClientRects(),s=0;s<l.length-1;s++){var a=l[s],u=l[s+1];Math.abs(a.bottom-u.bottom)>2&&o.push((a.bottom+u.top)/2-r.top)}}o.push(r.bottom-r.top)}}function Ut(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(W(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}function Vt(e,t){var n=W(t=fe(t)),i=e.display.externalMeasured=new pt(e.doc,t,n);i.lineN=n;var o=i.built=st(e,i);return i.text=o.pre,r(e.display.lineMeasure,o.pre),i}function Kt(e,t,r,n){return Yt(e,Xt(e,t),r,n)}function jt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Lr(e,t)];var r=e.display.externalMeasured;return r&&t>=r.lineN&&t<r.lineN+r.size?r:void 0}function Xt(e,t){var r=W(t),n=jt(e,r);n&&!n.text?n=null:n&&n.changes&&(xt(e,n,r,br(e)),e.curOp.forceUpdate=!0),n||(n=Vt(e,t));var i=Ut(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function Yt(e,t,r,n,i){t.before&&(r=-1);var o,l=r+(n||"");return t.cache.hasOwnProperty(l)?o=t.cache[l]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Gt(e,t.view,t.rect),t.hasHeights=!0),(o=qt(e,t,r,n)).bogus||(t.cache[l]=o)),{left:o.left,right:o.right,top:i?o.rtop:o.top,bottom:i?o.rbottom:o.bottom}}function _t(e,t,r){for(var n,i,o,l,s,a,u=0;u<e.length;u+=3)if(s=e[u],a=e[u+1],t<s?(i=0,o=1,l="left"):t<a?o=(i=t-s)+1:(u==e.length-3||t==a&&e[u+3]>t)&&(i=(o=a-s)-1,t>=a&&(l="right")),null!=i){if(n=e[u+2],s==a&&r==(n.insertLeft?"left":"right")&&(l=r),"left"==r&&0==i)for(;u&&e[u-2]==e[u-3]&&e[u-1].insertLeft;)n=e[2+(u-=3)],l="left";if("right"==r&&i==a-s)for(;u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft;)n=e[(u+=3)+2],l="right";break}return{node:n,start:i,end:o,collapse:l,coverStart:s,coverEnd:a}}function $t(e,t){var r=ms;if("left"==t)for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function qt(e,t,r,n){var i,o=_t(t.map,r,n),l=o.node,s=o.start,a=o.end,u=o.collapse;if(3==l.nodeType){for(var c=0;c<4;c++){for(;s&&S(t.line.text.charAt(o.coverStart+s));)--s;for(;o.coverStart+a<o.coverEnd&&S(t.line.text.charAt(o.coverStart+a));)++a;if((i=gl&&vl<9&&0==s&&a==o.coverEnd-o.coverStart?l.parentNode.getBoundingClientRect():$t(Wl(l,s,a).getClientRects(),n)).left||i.right||0==s)break;a=s,s-=1,u="right"}gl&&vl<11&&(i=Zt(e.display.measure,i))}else{s>0&&(u=n="right");var f;i=e.options.lineWrapping&&(f=l.getClientRects()).length>1?f["right"==n?f.length-1:0]:l.getBoundingClientRect()}if(gl&&vl<9&&!s&&(!i||!i.left&&!i.right)){var h=l.parentNode.getClientRects()[0];i=h?{left:h.left,right:h.left+yr(e.display),top:h.top,bottom:h.bottom}:ms}for(var d=i.top-t.rect.top,p=i.bottom-t.rect.top,g=(d+p)/2,v=t.view.measure.heights,m=0;m<v.length-1&&!(g<v[m]);m++);var y=m?v[m-1]:0,b=v[m],w={left:("right"==u?i.right:i.left)-t.rect.left,right:("left"==u?i.left:i.right)-t.rect.left,top:y,bottom:b};return i.left||i.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=d,w.rbottom=p),w}function Zt(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Re(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function Qt(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Jt(e){e.display.externalMeasure=null,t(e.display.lineMeasure);for(var r=0;r<e.display.view.length;r++)Qt(e.display.view[r])}function er(e){Jt(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function tr(){return bl&&kl?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function rr(){return bl&&kl?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function nr(e){var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;++r)e.widgets[r].above&&(t+=Ht(e.widgets[r]));return t}function ir(e,t,r,n,i){if(!i){var o=nr(t);r.top+=o,r.bottom+=o}if("line"==n)return r;n||(n="local");var l=ye(t);if("local"==n?l+=Et(e.display):l-=e.display.viewOffset,"page"==n||"window"==n){var s=e.display.lineSpace.getBoundingClientRect();l+=s.top+("window"==n?0:rr());var a=s.left+("window"==n?0:tr());r.left+=a,r.right+=a}return r.top+=l,r.bottom+=l,r}function or(e,t,r){if("div"==r)return t;var n=t.left,i=t.top;if("page"==r)n-=tr(),i-=rr();else if("local"==r||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var l=e.display.lineSpace.getBoundingClientRect();return{left:n-l.left,top:i-l.top}}function lr(e,t,r,n,i){return n||(n=M(e.doc,t.line)),ir(e,n,Kt(e,n,t.ch,i),r)}function sr(e,t,r,n,i,o){function l(t,l){var s=Yt(e,i,t,l?"right":"left",o);return l?s.left=s.right:s.right=s.left,ir(e,n,s,r)}function s(e,t,r){var n=1==a[t].level;return l(r?e-1:e,n!=r)}n=n||M(e.doc,t.line),i||(i=Xt(e,n));var a=Se(n,e.doc.direction),u=t.ch,c=t.sticky;if(u>=n.text.length?(u=n.text.length,c="before"):u<=0&&(u=0,c="after"),!a)return l("before"==c?u-1:u,"before"==c);var f=Ce(a,u,c),h=$l,d=s(u,f,"before"==c);return null!=h&&(d.other=s(u,h,"before"!=c)),d}function ar(e,t){var r=0;t=U(e.doc,t),e.options.lineWrapping||(r=yr(e.display)*t.ch);var n=M(e.doc,t.line),i=ye(n)+Et(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function ur(e,t,r,n,i){var o=E(e,t,r);return o.xRel=i,n&&(o.outside=!0),o}function cr(e,t,r){var n=e.doc;if((r+=e.display.viewOffset)<0)return ur(n.first,0,null,!0,-1);var i=D(n,r),o=n.first+n.size-1;if(i>o)return ur(n.first+n.size-1,M(n,o).text.length,null,!0,1);t<0&&(t=0);for(var l=M(n,i);;){var s=pr(e,l,i,t,r),a=ue(l),u=a&&a.find(0,!0);if(!a||!(s.ch>u.from.ch||s.ch==u.from.ch&&s.xRel>0))return s;i=W(l=u.to.line)}}function fr(e,t,r,n){n-=nr(t);var i=t.text.length,o=k(function(t){return Yt(e,r,t-1).bottom<=n},i,0);return i=k(function(t){return Yt(e,r,t).top>n},o,i),{begin:o,end:i}}function hr(e,t,r,n){return r||(r=Xt(e,t)),fr(e,t,r,ir(e,t,Yt(e,r,n),"line").top)}function dr(e,t,r,n){return!(e.bottom<=r)&&(e.top>r||(n?e.left:e.right)>t)}function pr(e,t,r,n,i){i-=ye(t);var o=Xt(e,t),l=nr(t),s=0,a=t.text.length,u=!0,c=Se(t,e.doc.direction);if(c){var f=(e.options.lineWrapping?vr:gr)(e,t,r,o,c,n,i);s=(u=1!=f.level)?f.from:f.to-1,a=u?f.to:f.from-1}var h,d,p=null,g=null,v=k(function(t){var r=Yt(e,o,t);return r.top+=l,r.bottom+=l,!!dr(r,n,i,!1)&&(r.top<=i&&r.left<=n&&(p=t,g=r),!0)},s,a),m=!1;if(g){var y=n-g.left<g.right-n,b=y==u;v=p+(b?0:1),d=b?"after":"before",h=y?g.left:g.right}else{u||v!=a&&v!=s||v++,d=0==v?"after":v==t.text.length?"before":Yt(e,o,v-(u?1:0)).bottom+l<=i==u?"after":"before";var w=sr(e,E(r,v,d),"line",t,o);h=w.left,m=i<w.top||i>=w.bottom}return v=L(t.text,v,1),ur(r,v,d,m,n-h)}function gr(e,t,r,n,i,o,l){var s=k(function(s){var a=i[s],u=1!=a.level;return dr(sr(e,E(r,u?a.to:a.from,u?"before":"after"),"line",t,n),o,l,!0)},0,i.length-1),a=i[s];if(s>0){var u=1!=a.level,c=sr(e,E(r,u?a.from:a.to,u?"after":"before"),"line",t,n);dr(c,o,l,!0)&&c.top>l&&(a=i[s-1])}return a}function vr(e,t,r,n,i,o,l){for(var s=fr(e,t,n,l),a=s.begin,u=s.end,c=null,f=null,h=0;h<i.length;h++){var d=i[h];if(!(d.from>=u||d.to<=a)){var p=Yt(e,n,1!=d.level?Math.min(u,d.to)-1:Math.max(a,d.from)).right,g=p<o?o-p+1e9:p-o;(!c||f>g)&&(c=d,f=g)}}return c||(c=i[i.length-1]),c.from<a&&(c={from:a,to:c.to,level:c.level}),c.to>u&&(c={from:c.from,to:u,level:c.level}),c}function mr(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==hs){hs=n("pre");for(var i=0;i<49;++i)hs.appendChild(document.createTextNode("x")),hs.appendChild(n("br"));hs.appendChild(document.createTextNode("x"))}r(e.measure,hs);var o=hs.offsetHeight/50;return o>3&&(e.cachedTextHeight=o),t(e.measure),o||1}function yr(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=n("span","xxxxxxxxxx"),i=n("pre",[t]);r(e.measure,i);var o=t.getBoundingClientRect(),l=(o.right-o.left)/10;return l>2&&(e.cachedCharWidth=l),l||10}function br(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,l=0;o;o=o.nextSibling,++l)r[e.options.gutters[l]]=o.offsetLeft+o.clientLeft+i,n[e.options.gutters[l]]=o.clientWidth;return{fixedPos:wr(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function wr(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function xr(e){var t=mr(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/yr(e.display)-3);return function(i){if(ve(e.doc,i))return 0;var o=0;if(i.widgets)for(var l=0;l<i.widgets.length;l++)i.widgets[l].height&&(o+=i.widgets[l].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function Cr(e){var t=e.doc,r=xr(e);t.iter(function(e){var t=r(e);t!=e.height&&A(e,t)})}function Sr(e,t,r,n){var i=e.display;if(!r&&"true"==Ee(t).getAttribute("cm-not-content"))return null;var o,l,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left,l=t.clientY-s.top}catch(t){return null}var a,u=cr(e,o,l);if(n&&1==u.xRel&&(a=M(e.doc,u.line).text).length==u.ch){var c=f(a,a.length,e.options.tabSize)-a.length;u=E(u.line,Math.max(0,Math.round((o-It(e.display).left)/yr(e.display))-c))}return u}function Lr(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var r=e.display.view,n=0;n<r.length;n++)if((t-=r[n].size)<0)return n}function kr(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Tr(e,t){void 0===t&&(t=!0);for(var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),l=0;l<r.sel.ranges.length;l++)if(t||l!=r.sel.primIndex){var s=r.sel.ranges[l];if(!(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom)){var a=s.empty();(a||e.options.showCursorWhenSelecting)&&Mr(e,s.head,i),a||Or(e,s,o)}}return n}function Mr(e,t,r){var i=sr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),o=r.appendChild(n("div"," ","CodeMirror-cursor"));if(o.style.left=i.left+"px",o.style.top=i.top+"px",o.style.height=Math.max(0,i.bottom-i.top)*e.options.cursorHeight+"px",i.other){var l=r.appendChild(n("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=i.other.left+"px",l.style.top=i.other.top+"px",l.style.height=.85*(i.other.bottom-i.other.top)+"px"}}function Nr(e,t){return e.top-t.top||e.left-t.left}function Or(e,t,r){function i(e,t,r,i){t<0&&(t=0),t=Math.round(t),i=Math.round(i),a.appendChild(n("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==r?f-e:r)+"px;\n                             height: "+(i-t)+"px"))}function o(t,r,n){function o(r,n){return lr(e,E(t,r),"div",u,n)}var l,a,u=M(s,t),h=u.text.length,d=Se(u,s.direction);return xe(d,r||0,null==n?h:n,function(t,s,p,g){var v=o(t,"ltr"==p?"left":"right"),m=o(s-1,"ltr"==p?"right":"left");if("ltr"==p){var y=null==r&&0==t?c:v.left,b=null==n&&s==h?f:m.right;m.top-v.top<=3?i(y,m.top,b-y,m.bottom):(i(y,v.top,null,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top),i(c,m.top,m.right,m.bottom))}else if(t<s){var w=null==r&&0==t?f:v.right,x=null==n&&s==h?c:m.left;if(m.top-v.top<=3)i(x,m.top,w-x,m.bottom);else{var C=c;if(g){var S=hr(e,u,null,t).end;C=o(S-(/\s/.test(u.text.charAt(S-1))?2:1),"left").left}i(C,v.top,w-C,v.bottom),v.bottom<m.top&&i(c,v.bottom,null,m.top);var L=null;d.length,L=o(hr(e,u,null,s).begin,"right").right-x,i(x,m.top,L,m.bottom)}}(!l||Nr(v,l)<0)&&(l=v),Nr(m,l)<0&&(l=m),(!a||Nr(v,a)<0)&&(a=v),Nr(m,a)<0&&(a=m)}),{start:l,end:a}}var l=e.display,s=e.doc,a=document.createDocumentFragment(),u=It(e.display),c=u.left,f=Math.max(l.sizerWidth,Rt(e)-l.sizer.offsetLeft)-u.right,h=t.from(),d=t.to();if(h.line==d.line)o(h.line,h.ch,d.ch);else{var p=M(s,h.line),g=M(s,d.line),v=fe(p)==fe(g),m=o(h.line,h.ch,v?p.text.length+1:null).end,y=o(d.line,v?0:null,d.ch).start;v&&(m.top<y.top-2?(i(m.right,m.top,null,m.bottom),i(c,y.top,y.left,y.bottom)):i(m.right,m.top,y.left-m.right,m.bottom)),m.bottom<y.top&&i(c,m.bottom,null,y.top)}r.appendChild(a)}function Ar(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Wr(e){e.state.focused||(e.display.input.focus(),Hr(e))}function Dr(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Fr(e))},100)}function Hr(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Te(e,"focus",e,t),e.state.focused=!0,s(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),ml&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),Ar(e))}function Fr(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Te(e,"blur",e,t),e.state.focused=!1,Fl(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Er(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var i=t.view[n],o=void 0;if(!i.hidden){if(gl&&vl<8){var l=i.node.offsetTop+i.node.offsetHeight;o=l-r,r=l}else{var s=i.node.getBoundingClientRect();o=s.bottom-s.top}var a=i.line.height-o;if(o<2&&(o=mr(t)),(a>.005||a<-.005)&&(A(i.line,o),Pr(i.line),i.rest))for(var u=0;u<i.rest.length;u++)Pr(i.rest[u])}}}function Pr(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Ir(e,t,r){var n=r&&null!=r.top?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Et(e));var i=r&&null!=r.bottom?r.bottom:n+e.wrapper.clientHeight,o=D(t,n),l=D(t,i);if(r&&r.ensure){var s=r.ensure.from.line,a=r.ensure.to.line;s<o?(o=s,l=D(t,ye(M(t,s))+e.wrapper.clientHeight)):Math.min(a,t.lastLine())>=l&&(o=D(t,ye(M(t,a))-e.wrapper.clientHeight),l=a)}return{from:o,to:Math.max(l,o+1)}}function zr(e){var t=e.display,r=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=wr(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",l=0;l<r.length;l++)if(!r[l].hidden){e.options.fixedGutter&&(r[l].gutter&&(r[l].gutter.style.left=o),r[l].gutterBackground&&(r[l].gutterBackground.style.left=o));var s=r[l].alignable;if(s)for(var a=0;a<s.length;a++)s[a].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function Rr(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=F(e.options,t.first+t.size-1),i=e.display;if(r.length!=i.lineNumChars){var o=i.measure.appendChild(n("div",[n("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),l=o.firstChild.offsetWidth,s=o.offsetWidth-l;return i.lineGutter.style.width="",i.lineNumInnerWidth=Math.max(l,i.lineGutter.offsetWidth-s)+1,i.lineNumWidth=i.lineNumInnerWidth+s,i.lineNumChars=i.lineNumInnerWidth?r.length:-1,i.lineGutter.style.width=i.lineNumWidth+"px",Wn(e),!0}return!1}function Br(e,t){if(!Me(e,"scrollCursorIntoView")){var r=e.display,i=r.sizer.getBoundingClientRect(),o=null;if(t.top+i.top<0?o=!0:t.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!Sl){var l=n("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-Et(e.display))+"px;\n                         height: "+(t.bottom-t.top+zt(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(l),l.scrollIntoView(o),e.display.lineSpace.removeChild(l)}}}function Gr(e,t,r,n){null==n&&(n=0);var i;e.options.lineWrapping||t!=r||(r="before"==(t=t.ch?E(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?E(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var l=!1,s=sr(e,t),a=r&&r!=t?sr(e,r):s,u=Vr(e,i={left:Math.min(s.left,a.left),top:Math.min(s.top,a.top)-n,right:Math.max(s.left,a.left),bottom:Math.max(s.bottom,a.bottom)+n}),c=e.doc.scrollTop,f=e.doc.scrollLeft;if(null!=u.scrollTop&&(qr(e,u.scrollTop),Math.abs(e.doc.scrollTop-c)>1&&(l=!0)),null!=u.scrollLeft&&(Qr(e,u.scrollLeft),Math.abs(e.doc.scrollLeft-f)>1&&(l=!0)),!l)break}return i}function Ur(e,t){var r=Vr(e,t);null!=r.scrollTop&&qr(e,r.scrollTop),null!=r.scrollLeft&&Qr(e,r.scrollLeft)}function Vr(e,t){var r=e.display,n=mr(e.display);t.top<0&&(t.top=0);var i=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:r.scroller.scrollTop,o=Bt(e),l={};t.bottom-t.top>o&&(t.bottom=t.top+o);var s=e.doc.height+Pt(r),a=t.top<n,u=t.bottom>s-n;if(t.top<i)l.scrollTop=a?0:t.top;else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);c!=i&&(l.scrollTop=c)}var f=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:r.scroller.scrollLeft,h=Rt(e)-(e.options.fixedGutter?r.gutters.offsetWidth:0),d=t.right-t.left>h;return d&&(t.right=t.left+h),t.left<10?l.scrollLeft=0:t.left<f?l.scrollLeft=Math.max(0,t.left-(d?0:10)):t.right>h+f-3&&(l.scrollLeft=t.right+(d?0:10)-h),l}function Kr(e,t){null!=t&&(_r(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function jr(e){_r(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Xr(e,t,r){null==t&&null==r||_r(e),null!=t&&(e.curOp.scrollLeft=t),null!=r&&(e.curOp.scrollTop=r)}function Yr(e,t){_r(e),e.curOp.scrollToPos=t}function _r(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,$r(e,ar(e,t.from),ar(e,t.to),t.margin))}function $r(e,t,r,n){var i=Vr(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});Xr(e,i.scrollLeft,i.scrollTop)}function qr(e,t){Math.abs(e.doc.scrollTop-t)<2||(fl||On(e,{top:t}),Zr(e,t,!0),fl&&On(e),Cn(e,100))}function Zr(e,t,r){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Qr(e,t,r,n){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n||(e.doc.scrollLeft=t,zr(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Jr(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+Pt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+zt(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}function en(e,t){t||(t=Jr(e));var r=e.display.barWidth,n=e.display.barHeight;tn(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&Er(e),tn(e,Jr(e)),r=e.display.barWidth,n=e.display.barHeight}function tn(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}function rn(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&Fl(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new ws[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Ql(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){"horizontal"==r?Qr(e,t):qr(e,t)},e),e.display.scrollbars.addClass&&s(e.display.wrapper,e.display.scrollbars.addClass)}function nn(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++xs},vt(e.curOp)}function on(e){yt(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;ln(e)})}function ln(e){for(var t=e.ops,r=0;r<t.length;r++)sn(t[r]);for(var n=0;n<t.length;n++)an(t[n]);for(var i=0;i<t.length;i++)un(t[i]);for(var o=0;o<t.length;o++)cn(t[o]);for(var l=0;l<t.length;l++)fn(t[l])}function sn(e){var t=e.cm,r=t.display;Ln(t),e.updateMaxLine&&we(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new Cs(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function an(e){e.updatedDisplay=e.mustUpdate&&Mn(e.cm,e.update)}function un(e){var t=e.cm,r=t.display;e.updatedDisplay&&Er(t),e.barMeasure=Jr(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Kt(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+zt(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-Rt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function cn(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Qr(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==l();e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&en(t,e.barMeasure),e.updatedDisplay&&Dn(t,e.barMeasure),e.selectionChanged&&Ar(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&Wr(e.cm)}function fn(e){var t=e.cm,r=t.display,n=t.doc;e.updatedDisplay&&Nn(t,e.update),null==r.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=e.scrollTop&&Zr(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Qr(t,e.scrollLeft,!0,!0),e.scrollToPos&&Br(t,Gr(t,U(n,e.scrollToPos.from),U(n,e.scrollToPos.to),e.scrollToPos.margin));var i=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(i)for(var l=0;l<i.length;++l)i[l].lines.length||Te(i[l],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&Te(o[s],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Te(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function hn(e,t){if(e.curOp)return t();nn(e);try{return t()}finally{on(e)}}function dn(e,t){return function(){if(e.curOp)return t.apply(e,arguments);nn(e);try{return t.apply(e,arguments)}finally{on(e)}}}function pn(e){return function(){if(this.curOp)return e.apply(this,arguments);nn(this);try{return e.apply(this,arguments)}finally{on(this)}}}function gn(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);nn(t);try{return e.apply(this,arguments)}finally{on(t)}}}function vn(e,t,r,n){null==t&&(t=e.doc.first),null==r&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)_l&&pe(e.doc,t)<i.viewTo&&yn(e);else if(r<=i.viewFrom)_l&&ge(e.doc,r+n)>i.viewFrom?yn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)yn(e);else if(t<=i.viewFrom){var o=bn(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):yn(e)}else if(r>=i.viewTo){var l=bn(e,t,t,-1);l?(i.view=i.view.slice(0,l.index),i.viewTo=l.lineN):yn(e)}else{var s=bn(e,t,t,-1),a=bn(e,r,r+n,1);s&&a?(i.view=i.view.slice(0,s.index).concat(gt(e,s.lineN,a.lineN)).concat(i.view.slice(a.index)),i.viewTo+=n):yn(e)}var u=i.externalMeasured;u&&(r<u.lineN?u.lineN+=n:t<u.lineN+u.size&&(i.externalMeasured=null))}function mn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Lr(e,t)];if(null!=o.node){var l=o.changes||(o.changes=[]);-1==h(l,r)&&l.push(r)}}}function yn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function bn(e,t,r,n){var i,o=Lr(e,t),l=e.display.view;if(!_l||r==e.doc.first+e.doc.size)return{index:o,lineN:r};for(var s=e.display.viewFrom,a=0;a<o;a++)s+=l[a].size;if(s!=t){if(n>0){if(o==l.length-1)return null;i=s+l[o].size-t,o++}else i=s-t;t+=i,r+=i}for(;pe(e.doc,r)!=r;){if(o==(n<0?0:l.length-1))return null;r+=n*l[o-(n<0?1:0)].size,o+=n}return{index:o,lineN:r}}function wn(e,t,r){var n=e.display;0==n.view.length||t>=n.viewTo||r<=n.viewFrom?(n.view=gt(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=gt(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Lr(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(gt(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,Lr(e,r)))),n.viewTo=r}function xn(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];i.hidden||i.node&&!i.changes||++r}return r}function Cn(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,u(Sn,e))}function Sn(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=$e(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var l=o.styles,s=o.text.length>e.options.maxHighlightLength?Ke(t.mode,n.state):null,a=Ye(e,o,n,!0);s&&(n.state=s),o.styles=a.styles;var u=o.styleClasses,c=a.classes;c?o.styleClasses=c:u&&(o.styleClasses=null);for(var f=!l||l.length!=o.styles.length||u!=c&&(!u||!c||u.bgClass!=c.bgClass||u.textClass!=c.textClass),h=0;!f&&h<l.length;++h)f=l[h]!=o.styles[h];f&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&qe(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return Cn(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&hn(e,function(){for(var t=0;t<i.length;t++)mn(e,i[t],"text")})}}function Ln(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=zt(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=zt(e)+"px",t.scrollbarsClipped=!0)}function kn(e){if(e.hasFocus())return null;var t=l();if(!t||!o(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=window.getSelection();n.anchorNode&&n.extend&&o(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}function Tn(e){if(e&&e.activeElt&&e.activeElt!=l()&&(e.activeElt.focus(),e.anchorNode&&o(document.body,e.anchorNode)&&o(document.body,e.focusNode))){var t=window.getSelection(),r=document.createRange();r.setEnd(e.anchorNode,e.anchorOffset),r.collapse(!1),t.removeAllRanges(),t.addRange(r),t.extend(e.focusNode,e.focusOffset)}}function Mn(e,r){var n=e.display,i=e.doc;if(r.editorIsHidden)return yn(e),!1;if(!r.force&&r.visible.from>=n.viewFrom&&r.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==xn(e))return!1;Rr(e)&&(yn(e),r.dims=br(e));var o=i.first+i.size,l=Math.max(r.visible.from-e.options.viewportMargin,i.first),s=Math.min(o,r.visible.to+e.options.viewportMargin);n.viewFrom<l&&l-n.viewFrom<20&&(l=Math.max(i.first,n.viewFrom)),n.viewTo>s&&n.viewTo-s<20&&(s=Math.min(o,n.viewTo)),_l&&(l=pe(e.doc,l),s=ge(e.doc,s));var a=l!=n.viewFrom||s!=n.viewTo||n.lastWrapHeight!=r.wrapperHeight||n.lastWrapWidth!=r.wrapperWidth;wn(e,l,s),n.viewOffset=ye(M(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var u=xn(e);if(!a&&0==u&&!r.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;var c=kn(e);return u>4&&(n.lineDiv.style.display="none"),An(e,n.updateLineNumbers,r.dims),u>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,Tn(c),t(n.cursorDiv),t(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,a&&(n.lastWrapHeight=r.wrapperHeight,n.lastWrapWidth=r.wrapperWidth,Cn(e,400)),n.updateLineNumbers=null,!0}function Nn(e,t){for(var r=t.viewport,n=!0;(n&&e.options.lineWrapping&&t.oldDisplayWidth!=Rt(e)||(r&&null!=r.top&&(r={top:Math.min(e.doc.height+Pt(e.display)-Bt(e),r.top)}),t.visible=Ir(e.display,e.doc,r),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&Mn(e,t);n=!1){Er(e);var i=Jr(e);kr(e),en(e,i),Dn(e,i),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function On(e,t){var r=new Cs(e,t);if(Mn(e,r)){Er(e),Nn(e,r);var n=Jr(e);kr(e),en(e,n),Dn(e,n),r.finish()}}function An(e,r,n){function i(t){var r=t.nextSibling;return ml&&Ml&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),r}for(var o=e.display,l=e.options.lineNumbers,s=o.lineDiv,a=s.firstChild,u=o.view,c=o.viewFrom,f=0;f<u.length;f++){var d=u[f];if(d.hidden);else if(d.node&&d.node.parentNode==s){for(;a!=d.node;)a=i(a);var p=l&&null!=r&&r<=c&&d.lineNumber;d.changes&&(h(d.changes,"gutter")>-1&&(p=!1),xt(e,d,c,n)),p&&(t(d.lineNumber),d.lineNumber.appendChild(document.createTextNode(F(e.options,c)))),a=d.node.nextSibling}else{var g=Ot(e,d,c,n);s.insertBefore(g,a)}c+=d.size}for(;a;)a=i(a)}function Wn(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Dn(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+zt(e)+"px"}function Hn(e){var r=e.display.gutters,i=e.options.gutters;t(r);for(var o=0;o<i.length;++o){var l=i[o],s=r.appendChild(n("div",null,"CodeMirror-gutter "+l));"CodeMirror-linenumbers"==l&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}r.style.display=o?"":"none",Wn(e)}function Fn(e){var t=h(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function En(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==r&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:null==r&&(r=e.wheelDelta),{x:t,y:r}}function Pn(e){var t=En(e);return t.x*=Ls,t.y*=Ls,t}function In(e,t){var r=En(t),n=r.x,i=r.y,o=e.display,l=o.scroller,s=l.scrollWidth>l.clientWidth,a=l.scrollHeight>l.clientHeight;if(n&&s||i&&a){if(i&&Ml&&ml)e:for(var u=t.target,c=o.view;u!=l;u=u.parentNode)for(var f=0;f<c.length;f++)if(c[f].node==u){e.display.currentWheelTarget=u;break e}if(n&&!fl&&!wl&&null!=Ls)return i&&a&&qr(e,Math.max(0,l.scrollTop+i*Ls)),Qr(e,Math.max(0,l.scrollLeft+n*Ls)),(!i||i&&a)&&We(t),void(o.wheelStartX=null);if(i&&null!=Ls){var h=i*Ls,d=e.doc.scrollTop,p=d+o.wrapper.clientHeight;h<0?d=Math.max(0,d+h-50):p=Math.min(e.doc.height,p+h+50),On(e,{top:d,bottom:p})}Ss<20&&(null==o.wheelStartX?(o.wheelStartX=l.scrollLeft,o.wheelStartY=l.scrollTop,o.wheelDX=n,o.wheelDY=i,setTimeout(function(){if(null!=o.wheelStartX){var e=l.scrollLeft-o.wheelStartX,t=l.scrollTop-o.wheelStartY,r=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,r&&(Ls=(Ls*Ss+r)/(Ss+1),++Ss)}},200)):(o.wheelDX+=n,o.wheelDY+=i))}}function zn(e,t){var r=e[t];e.sort(function(e,t){return P(e.from(),t.from())}),t=h(e,r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(P(o.to(),i.from())>=0){var l=B(o.from(),i.from()),s=R(o.to(),i.to()),a=o.empty()?i.from()==i.head:o.from()==o.head;n<=t&&--t,e.splice(--n,2,new Ts(a?s:l,a?l:s))}}return new ks(e,t)}function Rn(e,t){return new ks([new Ts(e,t||e)],0)}function Bn(e){return e.text?E(e.from.line+e.text.length-1,g(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Gn(e,t){if(P(e,t.from)<0)return e;if(P(e,t.to)<=0)return Bn(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=Bn(t).ch-t.to.ch),E(r,n)}function Un(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Ts(Gn(i.anchor,t),Gn(i.head,t)))}return zn(r,e.sel.primIndex)}function Vn(e,t,r){return e.line==t.line?E(r.line,e.ch-t.ch+r.ch):E(r.line+(e.line-t.line),e.ch)}function Kn(e,t,r){for(var n=[],i=E(e.first,0),o=i,l=0;l<t.length;l++){var s=t[l],a=Vn(s.from,i,o),u=Vn(Bn(s),i,o);if(i=s.to,o=u,"around"==r){var c=e.sel.ranges[l],f=P(c.head,c.anchor)<0;n[l]=new Ts(f?u:a,f?a:u)}else n[l]=new Ts(a,a)}return new ks(n,e.sel.primIndex)}function jn(e){e.doc.mode=Ue(e.options,e.doc.modeOption),Xn(e)}function Xn(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Cn(e,100),e.state.modeGen++,e.curOp&&vn(e)}function Yn(e,t){return 0==t.from.ch&&0==t.to.ch&&""==g(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function _n(e,t,r,n){function i(e){return r?r[e]:null}function o(e,r,i){it(e,r,i,n),bt(e,"change",e,t)}function l(e,t){for(var r=[],o=e;o<t;++o)r.push(new fs(u[o],i(o),n));return r}var s=t.from,a=t.to,u=t.text,c=M(e,s.line),f=M(e,a.line),h=g(u),d=i(u.length-1),p=a.line-s.line;if(t.full)e.insert(0,l(0,u.length)),e.remove(u.length,e.size-u.length);else if(Yn(e,t)){var v=l(0,u.length-1);o(f,f.text,d),p&&e.remove(s.line,p),v.length&&e.insert(s.line,v)}else if(c==f)if(1==u.length)o(c,c.text.slice(0,s.ch)+h+c.text.slice(a.ch),d);else{var m=l(1,u.length-1);m.push(new fs(h+c.text.slice(a.ch),d,n)),o(c,c.text.slice(0,s.ch)+u[0],i(0)),e.insert(s.line+1,m)}else if(1==u.length)o(c,c.text.slice(0,s.ch)+u[0]+f.text.slice(a.ch),i(0)),e.remove(s.line+1,p);else{o(c,c.text.slice(0,s.ch)+u[0],i(0)),o(f,h+f.text.slice(a.ch),d);var y=l(1,u.length-1);p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,y)}bt(e,"change",e,t)}function $n(e,t,r){function n(e,i,o){if(e.linked)for(var l=0;l<e.linked.length;++l){var s=e.linked[l];if(s.doc!=i){var a=o&&s.sharedHist;r&&!a||(t(s.doc,a),n(s.doc,e,a))}}}n(e,null,!0)}function qn(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Cr(e),jn(e),Zn(e),e.options.lineWrapping||we(e),e.options.mode=t.modeOption,vn(e)}function Zn(e){("rtl"==e.doc.direction?s:Fl)(e.display.lineDiv,"CodeMirror-rtl")}function Qn(e){hn(e,function(){Zn(e),vn(e)})}function Jn(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function ei(e,t){var r={from:z(t.from),to:Bn(t),text:N(e,t.from,t.to)};return si(e,r,t.from.line,t.to.line+1),$n(e,function(e){return si(e,r,t.from.line,t.to.line+1)},!0),r}function ti(e){for(;e.length&&g(e).ranges;)e.pop()}function ri(e,t){return t?(ti(e.done),g(e.done)):e.done.length&&!g(e.done).ranges?g(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),g(e.done)):void 0}function ni(e,t,r,n){var i=e.history;i.undone.length=0;var o,l,s=+new Date;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&i.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=ri(i,i.lastOp==n)))l=g(o.changes),0==P(t.from,t.to)&&0==P(t.from,l.to)?l.to=Bn(t):o.changes.push(ei(e,t));else{var a=g(i.done);for(a&&a.ranges||li(e.sel,i.done),o={changes:[ei(e,t)],generation:i.generation},i.done.push(o);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=s,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||Te(e,"historyAdded")}function ii(e,t,r,n){var i=t.charAt(0);return"*"==i||"+"==i&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function oi(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||ii(e,o,g(i.done),t))?i.done[i.done.length-1]=t:li(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&!1!==n.clearRedo&&ti(i.undone)}function li(e,t){var r=g(t);r&&r.ranges&&r.equals(e)||t.push(e)}function si(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(r){r.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=r.markedSpans),++o})}function ai(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function ui(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(ai(r[i]));return n}function ci(e,t){var r=ui(e,t),n=J(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],l=n[i];if(o&&l)e:for(var s=0;s<l.length;++s){for(var a=l[s],u=0;u<o.length;++u)if(o[u].marker==a.marker)continue e;o.push(a)}else l&&(r[i]=l)}return r}function fi(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges)n.push(r?ks.prototype.deepCopy.call(o):o);else{var l=o.changes,s=[];n.push({changes:s});for(var a=0;a<l.length;++a){var u=l[a],c=void 0;if(s.push({from:u.from,to:u.to,text:u.text}),t)for(var f in u)(c=f.match(/^spans_(\d+)$/))&&h(t,Number(c[1]))>-1&&(g(s)[f]=u[f],delete u[f])}}}return n}function hi(e,t,r,n){if(n){var i=e.anchor;if(r){var o=P(t,i)<0;o!=P(r,i)<0?(i=t,t=r):o!=P(t,r)<0&&(t=r)}return new Ts(i,t)}return new Ts(r||t,t)}function di(e,t,r,n,i){null==i&&(i=e.cm&&(e.cm.display.shift||e.extend)),bi(e,new ks([hi(e.sel.primary(),t,r,i)],0),n)}function pi(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=hi(e.sel.ranges[o],t[o],null,i);bi(e,zn(n,e.sel.primIndex),r)}function gi(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,bi(e,zn(i,e.sel.primIndex),n)}function vi(e,t,r,n){bi(e,Rn(t,r),n)}function mi(e,t,r){var n={ranges:t.ranges,update:function(t){var r=this;this.ranges=[];for(var n=0;n<t.length;n++)r.ranges[n]=new Ts(U(e,t[n].anchor),U(e,t[n].head))},origin:r&&r.origin};return Te(e,"beforeSelectionChange",e,n),e.cm&&Te(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?zn(n.ranges,n.ranges.length-1):t}function yi(e,t,r){var n=e.history.done,i=g(n);i&&i.ranges?(n[n.length-1]=t,wi(e,t,r)):bi(e,t,r)}function bi(e,t,r){wi(e,t,r),oi(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function wi(e,t,r){(Oe(e,"beforeSelectionChange")||e.cm&&Oe(e.cm,"beforeSelectionChange"))&&(t=mi(e,t,r)),xi(e,Si(e,t,r&&r.bias||(P(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),r&&!1===r.scroll||!e.cm||jr(e.cm)}function xi(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Ne(e.cm)),bt(e,"cursorActivity",e))}function Ci(e){xi(e,Si(e,e.sel,null,!1))}function Si(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var l=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],a=ki(e,l.anchor,s&&s.anchor,r,n),u=ki(e,l.head,s&&s.head,r,n);(i||a!=l.anchor||u!=l.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Ts(a,u))}return i?zn(i,t.primIndex):t}function Li(e,t,r,n,i){var o=M(e,t.line);if(o.markedSpans)for(var l=0;l<o.markedSpans.length;++l){var s=o.markedSpans[l],a=s.marker;if((null==s.from||(a.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(a.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(i&&(Te(a,"beforeCursorEnter"),a.explicitlyCleared)){if(o.markedSpans){--l;continue}break}if(!a.atomic)continue;if(r){var u=a.find(n<0?1:-1),c=void 0;if((n<0?a.inclusiveRight:a.inclusiveLeft)&&(u=Ti(e,u,-n,u&&u.line==t.line?o:null)),u&&u.line==t.line&&(c=P(u,r))&&(n<0?c<0:c>0))return Li(e,u,t,n,i)}var f=a.find(n<0?-1:1);return(n<0?a.inclusiveLeft:a.inclusiveRight)&&(f=Ti(e,f,n,f.line==t.line?o:null)),f?Li(e,f,t,n,i):null}}return t}function ki(e,t,r,n,i){var o=n||1,l=Li(e,t,r,o,i)||!i&&Li(e,t,r,o,!0)||Li(e,t,r,-o,i)||!i&&Li(e,t,r,-o,!0);return l||(e.cantEdit=!0,E(e.first,0))}function Ti(e,t,r,n){return r<0&&0==t.ch?t.line>e.first?U(e,E(t.line-1)):null:r>0&&t.ch==(n||M(e,t.line)).text.length?t.line<e.first+e.size-1?E(t.line+1,0):null:new E(t.line,t.ch+r)}function Mi(e){e.setSelection(E(e.firstLine(),0),E(e.lastLine()),Gl)}function Ni(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(t,r,i,o){t&&(n.from=U(e,t)),r&&(n.to=U(e,r)),i&&(n.text=i),void 0!==o&&(n.origin=o)}),Te(e,"beforeChange",e,n),e.cm&&Te(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Oi(e,t,r){if(e.cm){if(!e.cm.curOp)return dn(e.cm,Oi)(e,t,r);if(e.cm.state.suppressEdits)return}if(!(Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"))||(t=Ni(e,t,!0))){var n=Yl&&!r&&te(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Ai(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Ai(e,t)}}function Ai(e,t){if(1!=t.text.length||""!=t.text[0]||0!=P(t.from,t.to)){var r=Un(e,t);ni(e,t,r,e.cm?e.cm.curOp.id:NaN),Hi(e,t,r,J(e,t));var n=[];$n(e,function(e,r){r||-1!=h(n,e.history)||(zi(e.history,t),n.push(e.history)),Hi(e,t,null,J(e,t))})}}function Wi(e,t,r){if(!e.cm||!e.cm.state.suppressEdits||r){for(var n,i=e.history,o=e.sel,l="undo"==t?i.done:i.undone,s="undo"==t?i.undone:i.done,a=0;a<l.length&&(n=l[a],r?!n.ranges||n.equals(e.sel):n.ranges);a++);if(a!=l.length){for(i.lastOrigin=i.lastSelOrigin=null;(n=l.pop()).ranges;){if(li(n,s),r&&!n.equals(e.sel))return void bi(e,n,{clearRedo:!1});o=n}var u=[];li(o,s),s.push({changes:u,generation:i.generation}),i.generation=n.generation||++i.maxGeneration;for(var c=Oe(e,"beforeChange")||e.cm&&Oe(e.cm,"beforeChange"),f=n.changes.length-1;f>=0;--f){var d=function(r){var i=n.changes[r];if(i.origin=t,c&&!Ni(e,i,!1))return l.length=0,{};u.push(ei(e,i));var o=r?Un(e,i):g(l);Hi(e,i,o,ci(e,i)),!r&&e.cm&&e.cm.scrollIntoView({from:i.from,to:Bn(i)});var s=[];$n(e,function(e,t){t||-1!=h(s,e.history)||(zi(e.history,i),s.push(e.history)),Hi(e,i,null,ci(e,i))})}(f);if(d)return d.v}}}}function Di(e,t){if(0!=t&&(e.first+=t,e.sel=new ks(v(e.sel.ranges,function(e){return new Ts(E(e.anchor.line+t,e.anchor.ch),E(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){vn(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)mn(e.cm,n,"gutter")}}function Hi(e,t,r,n){if(e.cm&&!e.cm.curOp)return dn(e.cm,Hi)(e,t,r,n);if(t.to.line<e.first)Di(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Di(e,i),t={from:E(e.first,0),to:E(t.to.line+i,t.to.ch),text:[g(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:E(o,M(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=N(e,t.from,t.to),r||(r=Un(e,t)),e.cm?Fi(e.cm,t,n):_n(e,t,n),wi(e,r,Gl)}}function Fi(e,t,r){var n=e.doc,i=e.display,o=t.from,l=t.to,s=!1,a=o.line;e.options.lineWrapping||(a=W(fe(M(n,o.line))),n.iter(a,l.line+1,function(e){if(e==i.maxLine)return s=!0,!0})),n.sel.contains(t.from,t.to)>-1&&Ne(e),_n(n,t,r,xr(e)),e.options.lineWrapping||(n.iter(a,o.line+t.text.length,function(e){var t=be(e);t>i.maxLineLength&&(i.maxLine=e,i.maxLineLength=t,i.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0)),nt(n,o.line),Cn(e,400);var u=t.text.length-(l.line-o.line)-1;t.full?vn(e):o.line!=l.line||1!=t.text.length||Yn(e.doc,t)?vn(e,o.line,l.line+1,u):mn(e,o.line,"text");var c=Oe(e,"changes"),f=Oe(e,"change");if(f||c){var h={from:o,to:l,text:t.text,removed:t.removed,origin:t.origin};f&&bt(e,"change",e,h),c&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function Ei(e,t,r,n,i){if(n||(n=r),P(n,r)<0){var o;r=(o=[n,r])[0],n=o[1]}"string"==typeof t&&(t=e.splitLines(t)),Oi(e,{from:r,to:n,text:t,origin:i})}function Pi(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Ii(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],l=!0;if(o.ranges){o.copied||((o=e[i]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)Pi(o.ranges[s].anchor,t,r,n),Pi(o.ranges[s].head,t,r,n)}else{for(var a=0;a<o.changes.length;++a){var u=o.changes[a];if(r<u.from.line)u.from=E(u.from.line+n,u.from.ch),u.to=E(u.to.line+n,u.to.ch);else if(t<=u.to.line){l=!1;break}}l||(e.splice(0,i+1),i=0)}}}function zi(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Ii(e.done,r,n,i),Ii(e.undone,r,n,i)}function Ri(e,t,r,n){var i=t,o=t;return"number"==typeof t?o=M(e,G(e,t)):i=W(t),null==i?null:(n(o,i)&&e.cm&&mn(e.cm,i,r),o)}function Bi(e){var t=this;this.lines=e,this.parent=null;for(var r=0,n=0;n<e.length;++n)e[n].parent=t,r+=e[n].height;this.height=r}function Gi(e){var t=this;this.children=e;for(var r=0,n=0,i=0;i<e.length;++i){var o=e[i];r+=o.chunkSize(),n+=o.height,o.parent=t}this.size=r,this.height=n,this.parent=null}function Ui(e,t,r){ye(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&Kr(e,r)}function Vi(e,t,r,n){var i=new Ms(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),Ri(e,t,"widget",function(t){var r=t.widgets||(t.widgets=[]);if(null==i.insertAt?r.push(i):r.splice(Math.min(r.length-1,Math.max(0,i.insertAt)),0,i),i.line=t,o&&!ve(e,t)){var n=ye(t)<e.scrollTop;A(t,t.height+Ht(i)),n&&Kr(o,i.height),o.curOp.forceUpdate=!0}return!0}),bt(o,"lineWidgetAdded",o,i,"number"==typeof t?t:W(t)),i}function Ki(e,t,r,n,o){if(n&&n.shared)return ji(e,t,r,n,o);if(e.cm&&!e.cm.curOp)return dn(e.cm,Ki)(e,t,r,n,o);var l=new Os(e,o),s=P(t,r);if(n&&c(n,l,!1),s>0||0==s&&!1!==l.clearWhenEmpty)return l;if(l.replacedWith&&(l.collapsed=!0,l.widgetNode=i("span",[l.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||l.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(l.widgetNode.insertLeft=!0)),l.collapsed){if(ce(e,t.line,t,r,l)||t.line!=r.line&&ce(e,r.line,t,r,l))throw new Error("Inserting collapsed marker partially overlapping an existing one");X()}l.addToHistory&&ni(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var a,u=t.line,f=e.cm;if(e.iter(u,r.line+1,function(e){f&&l.collapsed&&!f.options.lineWrapping&&fe(e)==f.display.maxLine&&(a=!0),l.collapsed&&u!=t.line&&A(e,0),q(e,new Y(l,u==t.line?t.ch:null,u==r.line?r.ch:null)),++u}),l.collapsed&&e.iter(t.line,r.line+1,function(t){ve(e,t)&&A(t,0)}),l.clearOnEnter&&Ql(l,"beforeCursorEnter",function(){return l.clear()}),l.readOnly&&(j(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),l.collapsed&&(l.id=++Ns,l.atomic=!0),f){if(a&&(f.curOp.updateMaxLine=!0),l.collapsed)vn(f,t.line,r.line+1);else if(l.className||l.title||l.startStyle||l.endStyle||l.css)for(var h=t.line;h<=r.line;h++)mn(f,h,"text");l.atomic&&Ci(f.doc),bt(f,"markerAdded",f,l)}return l}function ji(e,t,r,n,i){(n=c(n)).shared=!1;var o=[Ki(e,t,r,n,i)],l=o[0],s=n.widgetNode;return $n(e,function(e){s&&(n.widgetNode=s.cloneNode(!0)),o.push(Ki(e,U(e,t),U(e,r),n,i));for(var a=0;a<e.linked.length;++a)if(e.linked[a].isParent)return;l=g(o)}),new As(o,l)}function Xi(e){return e.findMarks(E(e.first,0),e.clipPos(E(e.lastLine())),function(e){return e.parent})}function Yi(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),l=e.clipPos(i.to);if(P(o,l)){var s=Ki(e,o,l,n.primary,n.primary.type);n.markers.push(s),s.parent=n}}}function _i(e){for(var t=0;t<e.length;t++)!function(t){var r=e[t],n=[r.primary.doc];$n(r.primary.doc,function(e){return n.push(e)});for(var i=0;i<r.markers.length;i++){var o=r.markers[i];-1==h(n,o.doc)&&(o.parent=null,r.markers.splice(i--,1))}}(t)}function $i(e){var t=this;if(Qi(t),!Me(t,e)&&!Ft(t.display,e)){We(e),gl&&(Hs=+new Date);var r=Sr(t,e,!0),n=e.dataTransfer.files;if(r&&!t.isReadOnly())if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),l=0,s=0;s<i;++s)!function(e,n){if(!t.options.allowDropFileTypes||-1!=h(t.options.allowDropFileTypes,e.type)){var s=new FileReader;s.onload=dn(t,function(){var e=s.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),o[n]=e,++l==i){var a={from:r=U(t.doc,r),to:r,text:t.doc.splitLines(o.join(t.doc.lineSeparator())),origin:"paste"};Oi(t.doc,a),yi(t.doc,Rn(r,Bn(a)))}}),s.readAsText(e)}}(n[s],s);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var a=e.dataTransfer.getData("Text");if(a){var u;if(t.state.draggingText&&!t.state.draggingText.copy&&(u=t.listSelections()),wi(t.doc,Rn(r,r)),u)for(var c=0;c<u.length;++c)Ei(t.doc,"",u[c].anchor,u[c].head,"drag");t.replaceSelection(a,"around","paste"),t.display.input.focus()}}catch(e){}}}}function qi(e,t){if(gl&&(!e.state.draggingText||+new Date-Hs<100))Fe(t);else if(!Me(e,t)&&!Ft(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!xl)){var r=n("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",wl&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),wl&&r.parentNode.removeChild(r)}}function Zi(e,t){var i=Sr(e,t);if(i){var o=document.createDocumentFragment();Mr(e,i,o),e.display.dragCursor||(e.display.dragCursor=n("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),r(e.display.dragCursor,o)}}function Qi(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Ji(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),r=0;r<t.length;r++){var n=t[r].CodeMirror;n&&e(n)}}function eo(){Fs||(to(),Fs=!0)}function to(){var e;Ql(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Ji(ro)},100))}),Ql(window,"blur",function(){return Ji(Fr)})}function ro(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function no(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var r,n,i,o,l=0;l<t.length-1;l++){var s=t[l];if(/^(cmd|meta|m)$/i.test(s))o=!0;else if(/^a(lt)?$/i.test(s))r=!0;else if(/^(c|ctrl|control)$/i.test(s))n=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);i=!0}}return r&&(e="Alt-"+e),n&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function io(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if("..."==n){delete e[r];continue}for(var i=v(r.split(" "),no),o=0;o<i.length;o++){var l=void 0,s=void 0;o==i.length-1?(s=i.join(" "),l=n):(s=i.slice(0,o+1).join(" "),l="...");var a=t[s];if(a){if(a!=l)throw new Error("Inconsistent bindings for "+s)}else t[s]=l}delete e[r]}for(var u in t)e[u]=t[u];return e}function oo(e,t,r,n){var i=(t=uo(t)).call?t.call(e,n):t[e];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&r(i))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return oo(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var l=oo(e,t.fallthrough[o],r,n);if(l)return l}}}function lo(e){var t="string"==typeof e?e:Es[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function so(e,t,r){var n=e;return t.altKey&&"Alt"!=n&&(e="Alt-"+e),(Dl?t.metaKey:t.ctrlKey)&&"Ctrl"!=n&&(e="Ctrl-"+e),(Dl?t.ctrlKey:t.metaKey)&&"Cmd"!=n&&(e="Cmd-"+e),!r&&t.shiftKey&&"Shift"!=n&&(e="Shift-"+e),e}function ao(e,t){if(wl&&34==e.keyCode&&e.char)return!1;var r=Es[e.keyCode];return null!=r&&!e.altGraphKey&&so(r,e,t)}function uo(e){return"string"==typeof e?Rs[e]:e}function co(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&P(o.from,g(n).to)<=0;){var l=n.pop();if(P(l.from,o.from)<0){o.from=l.from;break}}n.push(o)}hn(e,function(){for(var t=n.length-1;t>=0;t--)Ei(e.doc,"",n[t].from,n[t].to,"+delete");jr(e)})}function fo(e,t,r){var n=L(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ho(e,t,r){var n=fo(e,t.ch,r);return null==n?null:new E(t.line,n,r<0?"after":"before")}function po(e,t,r,n,i){if(e){var o=Se(r,t.doc.direction);if(o){var l,s=i<0?g(o):o[0],a=i<0==(1==s.level)?"after":"before";if(s.level>0){var u=Xt(t,r);l=i<0?r.text.length-1:0;var c=Yt(t,u,l).top;l=k(function(e){return Yt(t,u,e).top==c},i<0==(1==s.level)?s.from:s.to-1,l),"before"==a&&(l=fo(r,l,1))}else l=i<0?s.to:s.from;return new E(n,l,a)}}return new E(n,i<0?r.text.length:0,i<0?"before":"after")}function go(e,t,r,n){var i=Se(t,e.doc.direction);if(!i)return ho(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=Ce(i,r.ch,r.sticky),l=i[o];if("ltr"==e.doc.direction&&l.level%2==0&&(n>0?l.to>r.ch:l.from<r.ch))return ho(t,r,n);var s,a=function(e,r){return fo(t,e instanceof E?e.ch:e,r)},u=function(r){return e.options.lineWrapping?(s=s||Xt(e,t),hr(e,t,s,r)):{begin:0,end:t.text.length}},c=u("before"==r.sticky?a(r,-1):r.ch);if("rtl"==e.doc.direction||1==l.level){var f=1==l.level==n<0,h=a(r,f?1:-1);if(null!=h&&(f?h<=l.to&&h<=c.end:h>=l.from&&h>=c.begin)){var d=f?"before":"after";return new E(r.line,h,d)}}var p=function(e,t,n){for(var o=function(e,t){return t?new E(r.line,a(e,1),"before"):new E(r.line,e,"after")};e>=0&&e<i.length;e+=t){var l=i[e],s=t>0==(1!=l.level),u=s?n.begin:a(n.end,-1);if(l.from<=u&&u<l.to)return o(u,s);if(u=s?l.from:a(l.to,-1),n.begin<=u&&u<n.end)return o(u,s)}},g=p(o+n,n,c);if(g)return g;var v=n>0?c.end:a(c.begin,-1);return null==v||n>0&&v==t.text.length||!(g=p(n>0?0:i.length-1,n,u(v)))?null:g}function vo(e,t){var r=M(e.doc,t),n=fe(r);return n!=r&&(t=W(n)),po(!0,e,n,t,1)}function mo(e,t){var r=M(e.doc,t),n=he(r);return n!=r&&(t=W(n)),po(!0,e,r,t,-1)}function yo(e,t){var r=vo(e,t.line),n=M(e.doc,r.line),i=Se(n,e.doc.direction);if(!i||0==i[0].level){var o=Math.max(0,n.text.search(/\S/)),l=t.line==r.line&&t.ch<=o&&t.ch;return E(r.line,l?0:o,r.sticky)}return r}function bo(e,t,r){if("string"==typeof t&&!(t=Bs[t]))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=Bl}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function wo(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=oo(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&oo(t,e.options.extraKeys,r,e)||oo(t,e.options.keyMap,r,e)}function xo(e,t,r,n){var i=e.state.keySeq;if(i){if(lo(t))return"handled";Gs.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),t=i+" "+t}var o=wo(e,t,n);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&bt(e,"keyHandled",e,t,r),"handled"!=o&&"multi"!=o||(We(r),Ar(e)),i&&!o&&/\'$/.test(t)?(We(r),!0):!!o}function Co(e,t){var r=ao(t,!0);return!!r&&(t.shiftKey&&!e.state.keySeq?xo(e,"Shift-"+r,t,function(t){return bo(e,t,!0)})||xo(e,r,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return bo(e,t)}):xo(e,r,t,function(t){return bo(e,t)}))}function So(e,t,r){return xo(e,"'"+r+"'",t,function(t){return bo(e,t,!0)})}function Lo(e){var t=this;if(t.curOp.focus=l(),!Me(t,e)){gl&&vl<11&&27==e.keyCode&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=16==r||e.shiftKey;var n=Co(t,e);wl&&(Us=n?r:null,!n&&88==r&&!rs&&(Ml?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=r||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ko(t)}}function ko(e){function t(e){18!=e.keyCode&&e.altKey||(Fl(r,"CodeMirror-crosshair"),ke(document,"keyup",t),ke(document,"mouseover",t))}var r=e.display.lineDiv;s(r,"CodeMirror-crosshair"),Ql(document,"keyup",t),Ql(document,"mouseover",t)}function To(e){16==e.keyCode&&(this.doc.sel.shift=!1),Me(this,e)}function Mo(e){var t=this;if(!(Ft(t.display,e)||Me(t,e)||e.ctrlKey&&!e.altKey||Ml&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(wl&&r==Us)return Us=null,void We(e);if(!wl||e.which&&!(e.which<10)||!Co(t,e)){var i=String.fromCharCode(null==n?r:n);"\b"!=i&&(So(t,e,i)||t.display.input.onKeyPress(e))}}}function No(e,t){var r=+new Date;return js&&js.compare(r,e,t)?(Ks=js=null,"triple"):Ks&&Ks.compare(r,e,t)?(js=new Vs(r,e,t),Ks=null,"double"):(Ks=new Vs(r,e,t),js=null,"single")}function Oo(e){var t=this,r=t.display;if(!(Me(t,e)||r.activeTouch&&r.input.supportsTouch()))if(r.input.ensurePolled(),r.shift=e.shiftKey,Ft(r,e))ml||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));else if(!zo(t,e)){var n=Sr(t,e),i=Pe(e),o=n?No(n,i):"single";window.focus(),1==i&&t.state.selectingText&&t.state.selectingText(e),n&&Ao(t,i,n,o,e)||(1==i?n?Do(t,n,o,e):Ee(e)==r.scroller&&We(e):2==i?(n&&di(t.doc,n),setTimeout(function(){return r.input.focus()},20)):3==i&&(Hl?Ro(t,e):Dr(t)))}}function Ao(e,t,r,n,i){var o="Click";return"double"==n?o="Double"+o:"triple"==n&&(o="Triple"+o),o=(1==t?"Left":2==t?"Middle":"Right")+o,xo(e,so(o,i),i,function(t){if("string"==typeof t&&(t=Bs[t]),!t)return!1;var n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n=t(e,r)!=Bl}finally{e.state.suppressEdits=!1}return n})}function Wo(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(null==i.unit){var o=Nl?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==i.extend||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey),null==i.addNew&&(i.addNew=Ml?r.metaKey:r.ctrlKey),null==i.moveOnDrag&&(i.moveOnDrag=!(Ml?r.altKey:r.ctrlKey)),i}function Do(e,t,r,n){gl?setTimeout(u(Wr,e),0):e.curOp.focus=l();var i,o=Wo(e,r,n),s=e.doc.sel;e.options.dragDrop&&Jl&&!e.isReadOnly()&&"single"==r&&(i=s.contains(t))>-1&&(P((i=s.ranges[i]).from(),t)<0||t.xRel>0)&&(P(i.to(),t)>0||t.xRel<0)?Ho(e,n,t,o):Eo(e,n,t,o)}function Ho(e,t,r,n){var i=e.display,o=!1,l=dn(e,function(t){ml&&(i.scroller.draggable=!1),e.state.draggingText=!1,ke(document,"mouseup",l),ke(document,"mousemove",s),ke(i.scroller,"dragstart",a),ke(i.scroller,"drop",l),o||(We(t),n.addNew||di(e.doc,r,null,null,n.extend),ml||gl&&9==vl?setTimeout(function(){document.body.focus(),i.input.focus()},20):i.input.focus())}),s=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},a=function(){return o=!0};ml&&(i.scroller.draggable=!0),e.state.draggingText=l,l.copy=!n.moveOnDrag,i.scroller.dragDrop&&i.scroller.dragDrop(),Ql(document,"mouseup",l),Ql(document,"mousemove",s),Ql(i.scroller,"dragstart",a),Ql(i.scroller,"drop",l),Dr(e),setTimeout(function(){return i.input.focus()},20)}function Fo(e,t,r){if("char"==r)return new Ts(t,t);if("word"==r)return e.findWordAt(t);if("line"==r)return new Ts(E(t.line,0),U(e.doc,E(t.line+1,0)));var n=r(e,t);return new Ts(n.from,n.to)}function Eo(e,t,r,n){function i(t){if(0!=P(m,t))if(m=t,"rectangle"==n.unit){for(var i=[],o=e.options.tabSize,l=f(M(u,r.line).text,r.ch,o),s=f(M(u,t.line).text,t.ch,o),a=Math.min(l,s),g=Math.max(l,s),v=Math.min(r.line,t.line),y=Math.min(e.lastLine(),Math.max(r.line,t.line));v<=y;v++){var b=M(u,v).text,w=d(b,a,o);a==g?i.push(new Ts(E(v,w),E(v,w))):b.length>w&&i.push(new Ts(E(v,w),E(v,d(b,g,o))))}i.length||i.push(new Ts(r,r)),bi(u,zn(p.ranges.slice(0,h).concat(i),h),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var x,C=c,S=Fo(e,t,n.unit),L=C.anchor;P(S.anchor,L)>0?(x=S.head,L=B(C.from(),S.anchor)):(x=S.anchor,L=R(C.to(),S.head));var k=p.ranges.slice(0);k[h]=Po(e,new Ts(U(u,L),x)),bi(u,zn(k,h),Ul)}}function o(t){var r=++b,s=Sr(e,t,!0,"rectangle"==n.unit);if(s)if(0!=P(s,m)){e.curOp.focus=l(),i(s);var c=Ir(a,u);(s.line>=c.to||s.line<c.from)&&setTimeout(dn(e,function(){b==r&&o(t)}),150)}else{var f=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;f&&setTimeout(dn(e,function(){b==r&&(a.scroller.scrollTop+=f,o(t))}),50)}}function s(t){e.state.selectingText=!1,b=1/0,We(t),a.input.focus(),ke(document,"mousemove",w),ke(document,"mouseup",x),u.history.lastSelOrigin=null}var a=e.display,u=e.doc;We(t);var c,h,p=u.sel,g=p.ranges;if(n.addNew&&!n.extend?(h=u.sel.contains(r),c=h>-1?g[h]:new Ts(r,r)):(c=u.sel.primary(),h=u.sel.primIndex),"rectangle"==n.unit)n.addNew||(c=new Ts(r,r)),r=Sr(e,t,!0,!0),h=-1;else{var v=Fo(e,r,n.unit);c=n.extend?hi(c,v.anchor,v.head,n.extend):v}n.addNew?-1==h?(h=g.length,bi(u,zn(g.concat([c]),h),{scroll:!1,origin:"*mouse"})):g.length>1&&g[h].empty()&&"char"==n.unit&&!n.extend?(bi(u,zn(g.slice(0,h).concat(g.slice(h+1)),0),{scroll:!1,origin:"*mouse"}),p=u.sel):gi(u,h,c,Ul):(h=0,bi(u,new ks([c],0),Ul),p=u.sel);var m=r,y=a.wrapper.getBoundingClientRect(),b=0,w=dn(e,function(e){Pe(e)?o(e):s(e)}),x=dn(e,s);e.state.selectingText=x,Ql(document,"mousemove",w),Ql(document,"mouseup",x)}function Po(e,t){var r=t.anchor,n=t.head,i=M(e.doc,r.line);if(0==P(r,n)&&r.sticky==n.sticky)return t;var o=Se(i);if(!o)return t;var l=Ce(o,r.ch,r.sticky),s=o[l];if(s.from!=r.ch&&s.to!=r.ch)return t;var a=l+(s.from==r.ch==(1!=s.level)?0:1);if(0==a||a==o.length)return t;var u;if(n.line!=r.line)u=(n.line-r.line)*("ltr"==e.doc.direction?1:-1)>0;else{var c=Ce(o,n.ch,n.sticky),f=c-l||(n.ch-r.ch)*(1==s.level?-1:1);u=c==a-1||c==a?f<0:f>0}var h=o[a+(u?-1:0)],d=u==(1==h.level),p=d?h.from:h.to,g=d?"after":"before";return r.ch==p&&r.sticky==g?t:new Ts(new E(r.line,p,g),n)}function Io(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch(t){return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&We(t);var l=e.display,s=l.lineDiv.getBoundingClientRect();if(o>s.bottom||!Oe(e,r))return He(t);o-=s.top-l.viewOffset;for(var a=0;a<e.options.gutters.length;++a){var u=l.gutters.childNodes[a];if(u&&u.getBoundingClientRect().right>=i)return Te(e,r,e,D(e.doc,o),e.options.gutters[a],t),He(t)}}function zo(e,t){return Io(e,t,"gutterClick",!0)}function Ro(e,t){Ft(e.display,t)||Bo(e,t)||Me(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Bo(e,t){return!!Oe(e,"gutterContextMenu")&&Io(e,t,"gutterContextMenu",!1)}function Go(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),er(e)}function Uo(e){Hn(e),vn(e),zr(e)}function Vo(e,t,r){if(!t!=!(r&&r!=Xs)){var n=e.display.dragFunctions,i=t?Ql:ke;i(e.display.scroller,"dragstart",n.start),i(e.display.scroller,"dragenter",n.enter),i(e.display.scroller,"dragover",n.over),i(e.display.scroller,"dragleave",n.leave),i(e.display.scroller,"drop",n.drop)}}function Ko(e){e.options.lineWrapping?(s(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Fl(e.display.wrapper,"CodeMirror-wrap"),we(e)),Cr(e),vn(e),er(e),setTimeout(function(){return en(e)},100)}function jo(e,t){var r=this;if(!(this instanceof jo))return new jo(e,t);this.options=t=t?c(t):{},c(Ys,t,!1),Fn(t);var n=t.value;"string"==typeof n&&(n=new Ds(n,t.mode,null,t.lineSeparator,t.direction)),this.doc=n;var i=new jo.inputStyles[t.inputStyle](this),o=this.display=new T(e,n,i);o.wrapper.CodeMirror=this,Hn(this),Go(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),rn(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Pl,keySeq:null,specialChars:null},t.autofocus&&!Tl&&o.input.focus(),gl&&vl<11&&setTimeout(function(){return r.display.input.reset(!0)},20),Xo(this),eo(),nn(this),this.curOp.forceUpdate=!0,qn(this,n),t.autofocus&&!Tl||this.hasFocus()?setTimeout(u(Hr,this),20):Fr(this);for(var l in _s)_s.hasOwnProperty(l)&&_s[l](r,t[l],Xs);Rr(this),t.finishInit&&t.finishInit(this);for(var s=0;s<$s.length;++s)$s[s](r);on(this),ml&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Xo(e){function t(){i.activeTouch&&(o=setTimeout(function(){return i.activeTouch=null},1e3),(l=i.activeTouch).end=+new Date)}function r(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function n(e,t){if(null==t.left)return!0;var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>400}var i=e.display;Ql(i.scroller,"mousedown",dn(e,Oo)),gl&&vl<11?Ql(i.scroller,"dblclick",dn(e,function(t){if(!Me(e,t)){var r=Sr(e,t);if(r&&!zo(e,t)&&!Ft(e.display,t)){We(t);var n=e.findWordAt(r);di(e.doc,n.anchor,n.head)}}})):Ql(i.scroller,"dblclick",function(t){return Me(e,t)||We(t)}),Hl||Ql(i.scroller,"contextmenu",function(t){return Ro(e,t)});var o,l={end:0};Ql(i.scroller,"touchstart",function(t){if(!Me(e,t)&&!r(t)&&!zo(e,t)){i.input.ensurePolled(),clearTimeout(o);var n=+new Date;i.activeTouch={start:n,moved:!1,prev:n-l.end<=300?l:null},1==t.touches.length&&(i.activeTouch.left=t.touches[0].pageX,i.activeTouch.top=t.touches[0].pageY)}}),Ql(i.scroller,"touchmove",function(){i.activeTouch&&(i.activeTouch.moved=!0)}),Ql(i.scroller,"touchend",function(r){var o=i.activeTouch;if(o&&!Ft(i,r)&&null!=o.left&&!o.moved&&new Date-o.start<300){var l,s=e.coordsChar(i.activeTouch,"page");l=!o.prev||n(o,o.prev)?new Ts(s,s):!o.prev.prev||n(o,o.prev.prev)?e.findWordAt(s):new Ts(E(s.line,0),U(e.doc,E(s.line+1,0))),e.setSelection(l.anchor,l.head),e.focus(),We(r)}t()}),Ql(i.scroller,"touchcancel",t),Ql(i.scroller,"scroll",function(){i.scroller.clientHeight&&(qr(e,i.scroller.scrollTop),Qr(e,i.scroller.scrollLeft,!0),Te(e,"scroll",e))}),Ql(i.scroller,"mousewheel",function(t){return In(e,t)}),Ql(i.scroller,"DOMMouseScroll",function(t){return In(e,t)}),Ql(i.wrapper,"scroll",function(){return i.wrapper.scrollTop=i.wrapper.scrollLeft=0}),i.dragFunctions={enter:function(t){Me(e,t)||Fe(t)},over:function(t){Me(e,t)||(Zi(e,t),Fe(t))},start:function(t){return qi(e,t)},drop:dn(e,$i),leave:function(t){Me(e,t)||Qi(e)}};var s=i.input.getField();Ql(s,"keyup",function(t){return To.call(e,t)}),Ql(s,"keydown",dn(e,Lo)),Ql(s,"keypress",dn(e,Mo)),Ql(s,"focus",function(t){return Hr(e,t)}),Ql(s,"blur",function(t){return Fr(e,t)})}function Yo(e,t,r,n){var i,o=e.doc;null==r&&(r="add"),"smart"==r&&(o.mode.indent?i=$e(e,t).state:r="prev");var l=e.options.tabSize,s=M(o,t),a=f(s.text,null,l);s.stateAfter&&(s.stateAfter=null);var u,c=s.text.match(/^\s*/)[0];if(n||/\S/.test(s.text)){if("smart"==r&&((u=o.mode.indent(i,s.text.slice(c.length),s.text))==Bl||u>150)){if(!n)return;r="prev"}}else u=0,r="not";"prev"==r?u=t>o.first?f(M(o,t-1).text,null,l):0:"add"==r?u=a+e.options.indentUnit:"subtract"==r?u=a-e.options.indentUnit:"number"==typeof r&&(u=a+r),u=Math.max(0,u);var h="",d=0;if(e.options.indentWithTabs)for(var g=Math.floor(u/l);g;--g)d+=l,h+="\t";if(d<u&&(h+=p(u-d)),h!=c)return Ei(o,h,E(t,0),E(t,c.length),"+input"),s.stateAfter=null,!0;for(var v=0;v<o.sel.ranges.length;v++){var m=o.sel.ranges[v];if(m.head.line==t&&m.head.ch<c.length){var y=E(t,c.length);gi(o,v,new Ts(y,y));break}}}function _o(e){qs=e}function $o(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var l=e.state.pasteIncoming||"paste"==i,s=es(t),a=null;if(l&&n.ranges.length>1)if(qs&&qs.text.join("\n")==t){if(n.ranges.length%qs.text.length==0){a=[];for(var u=0;u<qs.text.length;u++)a.push(o.splitLines(qs.text[u]))}}else s.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(a=v(s,function(e){return[e]}));for(var c,f=n.ranges.length-1;f>=0;f--){var h=n.ranges[f],d=h.from(),p=h.to();h.empty()&&(r&&r>0?d=E(d.line,d.ch-r):e.state.overwrite&&!l?p=E(p.line,Math.min(M(o,p.line).text.length,p.ch+g(s).length)):qs&&qs.lineWise&&qs.text.join("\n")==t&&(d=p=E(d.line,0))),c=e.curOp.updateInput;var m={from:d,to:p,text:a?a[f%a.length]:s,origin:i||(l?"paste":e.state.cutIncoming?"cut":"+input")};Oi(e.doc,m),bt(e,"inputRead",e,m)}t&&!l&&Zo(e,t),jr(e),e.curOp.updateInput=c,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function qo(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||hn(t,function(){return $o(t,r,0,null,"paste")}),!0}function Zo(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),l=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(t.indexOf(o.electricChars.charAt(s))>-1){l=Yo(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(M(e.doc,i.head.line).text.slice(0,i.head.ch))&&(l=Yo(e,i.head.line,"smart"));l&&bt(e,"electricInput",e,i.head.line)}}}function Qo(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:E(i,0),head:E(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Jo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function el(){var e=n("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=n("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ml?e.style.width="1000px":e.setAttribute("wrap","off"),Ll&&(e.style.border="1px solid black"),Jo(e),t}function tl(e,t,r,n,i){function o(){var n=t.line+r;return!(n<e.first||n>=e.first+e.size)&&(t=new E(n,t.ch,t.sticky),u=M(e,n))}function l(n){var l;if(null==(l=i?go(e.cm,u,t,r):ho(u,t,r))){if(n||!o())return!1;t=po(i,e.cm,u,t.line,r)}else t=l;return!0}var s=t,a=r,u=M(e,t.line);if("char"==n)l();else if("column"==n)l(!0);else if("word"==n||"group"==n)for(var c=null,f="group"==n,h=e.cm&&e.cm.getHelper(t,"wordChars"),d=!0;!(r<0)||l(!d);d=!1){var p=u.text.charAt(t.ch)||"\n",g=x(p,h)?"w":f&&"\n"==p?"n":!f||/\s/.test(p)?null:"p";if(!f||d||g||(g="s"),c&&c!=g){r<0&&(r=1,l(),t.sticky="after");break}if(g&&(c=g),r>0&&!l(!d))break}var v=ki(e,t,s,a,!0);return I(s,v)&&(v.hitSide=!0),v}function rl(e,t,r,n){var i,o=e.doc,l=t.left;if("page"==n){var s=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),a=Math.max(s-.5*mr(e.display),3);i=(r>0?t.bottom:t.top)+r*a}else"line"==n&&(i=r>0?t.bottom+3:t.top-3);for(var u;(u=cr(e,l,i)).outside;){if(r<0?i<=0:i>=o.height){u.hitSide=!0;break}i+=5*r}return u}function nl(e,t){var r=jt(e,t.line);if(!r||r.hidden)return null;var n=M(e.doc,t.line),i=Ut(r,n,t.line),o=Se(n,e.doc.direction),l="left";o&&(l=Ce(o,t.ch)%2?"right":"left");var s=_t(i.map,t.ch,l);return s.offset="right"==s.collapse?s.end:s.start,s}function il(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ol(e,t){return t&&(e.bad=!0),e}function ll(e,t,r,n,i){function o(e){return function(t){return t.id==e}}function l(){c&&(u+=f,c=!1)}function s(e){e&&(l(),u+=e)}function a(t){if(1==t.nodeType){var r=t.getAttribute("cm-text");if(null!=r)return void s(r||t.textContent.replace(/\u200b/g,""));var u,h=t.getAttribute("cm-marker");if(h){var d=e.findMarks(E(n,0),E(i+1,0),o(+h));return void(d.length&&(u=d[0].find(0))&&s(N(e.doc,u.from,u.to).join(f)))}if("false"==t.getAttribute("contenteditable"))return;var p=/^(pre|div|p)$/i.test(t.nodeName);p&&l();for(var g=0;g<t.childNodes.length;g++)a(t.childNodes[g]);p&&(c=!0)}else 3==t.nodeType&&s(t.nodeValue)}for(var u="",c=!1,f=e.doc.lineSeparator();a(t),t!=r;)t=t.nextSibling;return u}function sl(e,t,r){var n;if(t==e.display.lineDiv){if(!(n=e.display.lineDiv.childNodes[r]))return ol(e.clipPos(E(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return al(o,t,r)}}function al(e,t,r){function n(t,r,n){for(var i=-1;i<(f?f.length:0);i++)for(var o=i<0?c.map:f[i],l=0;l<o.length;l+=3){var s=o[l+2];if(s==t||s==r){var a=W(i<0?e.line:e.rest[i]),u=o[l]+n;return(n<0||s!=t)&&(u=o[l+(n?1:0)]),E(a,u)}}}var i=e.text.firstChild,l=!1;if(!t||!o(i,t))return ol(E(W(e.line),0),!0);if(t==i&&(l=!0,t=i.childNodes[r],r=0,!t)){var s=e.rest?g(e.rest):e.line;return ol(E(W(s),s.text.length),l)}var a=3==t.nodeType?t:null,u=t;for(a||1!=t.childNodes.length||3!=t.firstChild.nodeType||(a=t.firstChild,r&&(r=a.nodeValue.length));u.parentNode!=i;)u=u.parentNode;var c=e.measure,f=c.maps,h=n(a,u,r);if(h)return ol(h,l);for(var d=u.nextSibling,p=a?a.nodeValue.length-r:0;d;d=d.nextSibling){if(h=n(d,d.firstChild,0))return ol(E(h.line,h.ch-p),l);p+=d.textContent.length}for(var v=u.previousSibling,m=r;v;v=v.previousSibling){if(h=n(v,v.firstChild,-1))return ol(E(h.line,h.ch+m),l);m+=v.textContent.length}}var ul=navigator.userAgent,cl=navigator.platform,fl=/gecko\/\d/i.test(ul),hl=/MSIE \d/.test(ul),dl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ul),pl=/Edge\/(\d+)/.exec(ul),gl=hl||dl||pl,vl=gl&&(hl?document.documentMode||6:+(pl||dl)[1]),ml=!pl&&/WebKit\//.test(ul),yl=ml&&/Qt\/\d+\.\d+/.test(ul),bl=!pl&&/Chrome\//.test(ul),wl=/Opera\//.test(ul),xl=/Apple Computer/.test(navigator.vendor),Cl=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(ul),Sl=/PhantomJS/.test(ul),Ll=!pl&&/AppleWebKit/.test(ul)&&/Mobile\/\w+/.test(ul),kl=/Android/.test(ul),Tl=Ll||kl||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(ul),Ml=Ll||/Mac/.test(cl),Nl=/\bCrOS\b/.test(ul),Ol=/win/i.test(cl),Al=wl&&ul.match(/Version\/(\d*\.\d*)/);Al&&(Al=Number(Al[1])),Al&&Al>=15&&(wl=!1,ml=!0);var Wl,Dl=Ml&&(yl||wl&&(null==Al||Al<12.11)),Hl=fl||gl&&vl>=9,Fl=function(t,r){var n=t.className,i=e(r).exec(n);if(i){var o=n.slice(i.index+i[0].length);t.className=n.slice(0,i.index)+(o?i[1]+o:"")}};Wl=document.createRange?function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};var El=function(e){e.select()};Ll?El=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:gl&&(El=function(e){try{e.select()}catch(e){}});var Pl=function(){this.id=null};Pl.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Il,zl,Rl=30,Bl={toString:function(){return"CodeMirror.Pass"}},Gl={scroll:!1},Ul={origin:"*mouse"},Vl={origin:"+move"},Kl=[""],jl=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Xl=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Yl=!1,_l=!1,$l=null,ql=function(){function e(e){return e<=247?r.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?n.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function t(e,t,r){this.level=e,this.from=t,this.to=r}var r="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",i=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,l=/[LRr]/,s=/[Lb1n]/,a=/[1n]/;return function(r,n){var u="ltr"==n?"L":"R";if(0==r.length||"ltr"==n&&!i.test(r))return!1;for(var c=r.length,f=[],h=0;h<c;++h)f.push(e(r.charCodeAt(h)));for(var d=0,p=u;d<c;++d){var v=f[d];"m"==v?f[d]=p:p=v}for(var m=0,y=u;m<c;++m){var b=f[m];"1"==b&&"r"==y?f[m]="n":l.test(b)&&(y=b,"r"==b&&(f[m]="R"))}for(var w=1,x=f[0];w<c-1;++w){var C=f[w];"+"==C&&"1"==x&&"1"==f[w+1]?f[w]="1":","!=C||x!=f[w+1]||"1"!=x&&"n"!=x||(f[w]=x),x=C}for(var S=0;S<c;++S){var L=f[S];if(","==L)f[S]="N";else if("%"==L){var k=void 0;for(k=S+1;k<c&&"%"==f[k];++k);for(var T=S&&"!"==f[S-1]||k<c&&"1"==f[k]?"1":"N",M=S;M<k;++M)f[M]=T;S=k-1}}for(var N=0,O=u;N<c;++N){var A=f[N];"L"==O&&"1"==A?f[N]="L":l.test(A)&&(O=A)}for(var W=0;W<c;++W)if(o.test(f[W])){var D=void 0;for(D=W+1;D<c&&o.test(f[D]);++D);for(var H="L"==(W?f[W-1]:u),F=H==("L"==(D<c?f[D]:u))?H?"L":"R":u,E=W;E<D;++E)f[E]=F;W=D-1}for(var P,I=[],z=0;z<c;)if(s.test(f[z])){var R=z;for(++z;z<c&&s.test(f[z]);++z);I.push(new t(0,R,z))}else{var B=z,G=I.length;for(++z;z<c&&"L"!=f[z];++z);for(var U=B;U<z;)if(a.test(f[U])){B<U&&I.splice(G,0,new t(1,B,U));var V=U;for(++U;U<z&&a.test(f[U]);++U);I.splice(G,0,new t(2,V,U)),B=U}else++U;B<z&&I.splice(G,0,new t(1,B,z))}return 1==I[0].level&&(P=r.match(/^\s+/))&&(I[0].from=P[0].length,I.unshift(new t(0,0,P[0].length))),1==g(I).level&&(P=r.match(/\s+$/))&&(g(I).to-=P[0].length,I.push(new t(0,c-P[0].length,c))),"rtl"==n?I.reverse():I}}(),Zl=[],Ql=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Zl).concat(r)}},Jl=function(){if(gl&&vl<9)return!1;var e=n("div");return"draggable"in e||"dragDrop"in e}(),es=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf("\n",t);-1==i&&(i=e.length);var o=e.slice(t,"\r"==e.charAt(i-1)?i-1:i),l=o.indexOf("\r");-1!=l?(r.push(o.slice(0,l)),t+=l+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},ts=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},rs=function(){var e=n("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),ns=null,is={},os={},ls={},ss=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};ss.prototype.eol=function(){return this.pos>=this.string.length},ss.prototype.sol=function(){return this.pos==this.lineStart},ss.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ss.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ss.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},ss.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},ss.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},ss.prototype.skipToEnd=function(){this.pos=this.string.length},ss.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},ss.prototype.backUp=function(e){this.pos-=e},ss.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=f(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.indentation=function(){return f(this.string,null,this.tabSize)-(this.lineStart?f(this.string,this.lineStart,this.tabSize):0)},ss.prototype.match=function(e,t,r){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}var i=function(e){return r?e.toLowerCase():e};if(i(this.string.substr(this.pos,e.length))==i(e))return!1!==t&&(this.pos+=e.length),!0},ss.prototype.current=function(){return this.string.slice(this.start,this.pos)},ss.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},ss.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var as=function(e,t){this.state=e,this.lookAhead=t},us=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0};us.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},us.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},us.fromSaved=function(e,t,r){return t instanceof as?new us(e,Ke(e.mode,t.state),r,t.lookAhead):new us(e,Ke(e.mode,t),r)},us.prototype.save=function(e){var t=!1!==e?Ke(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new as(t,this.maxLookAhead):t};var cs=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r},fs=function(e,t,r){this.text=e,ne(this,t),this.height=r?r(this):1};fs.prototype.lineNo=function(){return W(this)},Ae(fs);var hs,ds={},ps={},gs=null,vs=null,ms={left:0,right:0,top:0,bottom:0},ys=function(e,t,r){this.cm=r;var i=this.vert=n("div",[n("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=n("div",[n("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(i),e(o),Ql(i,"scroll",function(){i.clientHeight&&t(i.scrollTop,"vertical")}),Ql(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,gl&&vl<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};ys.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==n&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},ys.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},ys.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},ys.prototype.zeroWidthHack=function(){var e=Ml&&!Cl?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Pl,this.disableVert=new Pl},ys.prototype.enableZeroWidthBar=function(e,t,r){function n(){var i=e.getBoundingClientRect();("vert"==r?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,n)}e.style.pointerEvents="auto",t.set(1e3,n)},ys.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var bs=function(){};bs.prototype.update=function(){return{bottom:0,right:0}},bs.prototype.setScrollLeft=function(){},bs.prototype.setScrollTop=function(){},bs.prototype.clear=function(){};var ws={native:ys,null:bs},xs=0,Cs=function(e,t,r){var n=e.display;this.viewport=t,this.visible=Ir(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=Rt(e),this.force=r,this.dims=br(e),this.events=[]};Cs.prototype.signal=function(e,t){Oe(e,t)&&this.events.push(arguments)},Cs.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Te.apply(null,e.events[t])};var Ss=0,Ls=null;gl?Ls=-.53:fl?Ls=15:bl?Ls=-.7:xl&&(Ls=-1/3);var ks=function(e,t){this.ranges=e,this.primIndex=t};ks.prototype.primary=function(){return this.ranges[this.primIndex]},ks.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var r=0;r<this.ranges.length;r++){var n=t.ranges[r],i=e.ranges[r];if(!I(n.anchor,i.anchor)||!I(n.head,i.head))return!1}return!0},ks.prototype.deepCopy=function(){for(var e=this,t=[],r=0;r<this.ranges.length;r++)t[r]=new Ts(z(e.ranges[r].anchor),z(e.ranges[r].head));return new ks(t,this.primIndex)},ks.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},ks.prototype.contains=function(e,t){var r=this;t||(t=e);for(var n=0;n<this.ranges.length;n++){var i=r.ranges[n];if(P(t,i.from())>=0&&P(e,i.to())<=0)return n}return-1};var Ts=function(e,t){this.anchor=e,this.head=t};Ts.prototype.from=function(){return B(this.anchor,this.head)},Ts.prototype.to=function(){return R(this.anchor,this.head)},Ts.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Bi.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=this,n=e,i=e+t;n<i;++n){var o=r.lines[n];r.height-=o.height,ot(o),bt(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){var n=this;this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var i=0;i<t.length;++i)t[i].parent=n},iterN:function(e,t,r){for(var n=this,i=e+t;e<i;++e)if(r(n.lines[e]))return!0}},Gi.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var r=this;this.size-=t;for(var n=0;n<this.children.length;++n){var i=r.children[n],o=i.chunkSize();if(e<o){var l=Math.min(t,o-e),s=i.height;if(i.removeInner(e,l),r.height-=s-i.height,o==l&&(r.children.splice(n--,1),i.parent=null),0==(t-=l))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof Bi))){var a=[];this.collapse(a),this.children=[new Bi(a)],this.children[0].parent=this}},collapse:function(e){for(var t=this,r=0;r<this.children.length;++r)t.children[r].collapse(e)},insertInner:function(e,t,r){var n=this;this.size+=t.length,this.height+=r;for(var i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<=l){if(o.insertInner(e,t,r),o.lines&&o.lines.length>50){for(var s=o.lines.length%25+25,a=s;a<o.lines.length;){var u=new Bi(o.lines.slice(a,a+=25));o.height-=u.height,n.children.splice(++i,0,u),u.parent=n}o.lines=o.lines.slice(0,s),n.maybeSpill()}break}e-=l}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Gi(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var r=h(e.parent.children,e);e.parent.children.splice(r+1,0,t)}else{var n=new Gi(e.children);n.parent=e,e.children=[n,t],e=n}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=this,i=0;i<this.children.length;++i){var o=n.children[i],l=o.chunkSize();if(e<l){var s=Math.min(t,l-e);if(o.iterN(e,s,r))return!0;if(0==(t-=s))break;e=0}else e-=l}}};var Ms=function(e,t,r){var n=this;if(r)for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);this.doc=e,this.node=t};Ms.prototype.clear=function(){var e=this,t=this.doc.cm,r=this.line.widgets,n=this.line,i=W(n);if(null!=i&&r){for(var o=0;o<r.length;++o)r[o]==e&&r.splice(o--,1);r.length||(n.widgets=null);var l=Ht(this);A(n,Math.max(0,n.height-l)),t&&(hn(t,function(){Ui(t,n,-l),mn(t,i,"widget")}),bt(t,"lineWidgetCleared",t,this,i))}},Ms.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Ht(this)-t;i&&(A(n,n.height+i),r&&hn(r,function(){r.curOp.forceUpdate=!0,Ui(r,n,i),bt(r,"lineWidgetChanged",r,e,W(n))}))},Ae(Ms);var Ns=0,Os=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ns};Os.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,r=t&&!t.curOp;if(r&&nn(t),Oe(this,"clear")){var n=this.find();n&&bt(this,"clear",n.from,n.to)}for(var i=null,o=null,l=0;l<this.lines.length;++l){var s=e.lines[l],a=_(s.markedSpans,e);t&&!e.collapsed?mn(t,W(s),"text"):t&&(null!=a.to&&(o=W(s)),null!=a.from&&(i=W(s))),s.markedSpans=$(s.markedSpans,a),null==a.from&&e.collapsed&&!ve(e.doc,s)&&t&&A(s,mr(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var u=0;u<this.lines.length;++u){var c=fe(e.lines[u]),f=be(c);f>t.display.maxLineLength&&(t.display.maxLine=c,t.display.maxLineLength=f,t.display.maxLineChanged=!0)}null!=i&&t&&this.collapsed&&vn(t,i,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ci(t.doc)),t&&bt(t,"markerCleared",t,this,i,o),r&&on(t),this.parent&&this.parent.clear()}},Os.prototype.find=function(e,t){var r=this;null==e&&"bookmark"==this.type&&(e=1);for(var n,i,o=0;o<this.lines.length;++o){var l=r.lines[o],s=_(l.markedSpans,r);if(null!=s.from&&(n=E(t?l:W(l),s.from),-1==e))return n;if(null!=s.to&&(i=E(t?l:W(l),s.to),1==e))return i}return n&&{from:n,to:i}},Os.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;t&&n&&hn(n,function(){var i=t.line,o=W(t.line),l=jt(n,o);if(l&&(Qt(l),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!ve(r.doc,i)&&null!=r.height){var s=r.height;r.height=null;var a=Ht(r)-s;a&&A(i,i.height+a)}bt(n,"markerChanged",n,e)})},Os.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=h(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Os.prototype.detachLine=function(e){if(this.lines.splice(h(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Ae(Os);var As=function(e,t){var r=this;this.markers=e,this.primary=t;for(var n=0;n<e.length;++n)e[n].parent=r};As.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();bt(this,"clear")}},As.prototype.find=function(e,t){return this.primary.find(e,t)},Ae(As);var Ws=0,Ds=function(e,t,r,n,i){if(!(this instanceof Ds))return new Ds(e,t,r,n,i);null==r&&(r=0),Gi.call(this,[new Bi([new fs("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=E(r,0);this.sel=Rn(o),this.history=new Jn(null),this.id=++Ws,this.modeOption=t,this.lineSep=n,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),_n(this,{from:o,to:o,text:e}),bi(this,Rn(o),Gl)};Ds.prototype=b(Gi.prototype,{constructor:Ds,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=O(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:gn(function(e){var t=E(this.first,0),r=this.first+this.size-1;Oi(this,{from:t,to:E(r,M(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Xr(this.cm,0,0),bi(this,Rn(t),Gl)}),replaceRange:function(e,t,r,n){Ei(this,e,t=U(this,t),r=r?U(this,r):t,n)},getRange:function(e,t,r){var n=N(this,U(this,e),U(this,t));return!1===r?n:n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(H(this,e))return M(this,e)},getLineNumber:function(e){return W(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=M(this,e)),fe(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return U(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:gn(function(e,t,r){vi(this,U(this,"number"==typeof e?E(e,t||0):e),null,r)}),setSelection:gn(function(e,t,r){vi(this,U(this,e),U(this,t||e),r)}),extendSelection:gn(function(e,t,r){di(this,U(this,e),t&&U(this,t),r)}),extendSelections:gn(function(e,t){pi(this,K(this,e),t)}),extendSelectionsBy:gn(function(e,t){pi(this,K(this,v(this.sel.ranges,e)),t)}),setSelections:gn(function(e,t,r){var n=this;if(e.length){for(var i=[],o=0;o<e.length;o++)i[o]=new Ts(U(n,e[o].anchor),U(n,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),bi(this,zn(i,t),r)}}),addSelection:gn(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Ts(U(this,e),U(this,t||e))),bi(this,zn(n,n.length-1),r)}),getSelection:function(e){for(var t,r=this,n=this.sel.ranges,i=0;i<n.length;i++){var o=N(r,n[i].from(),n[i].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,r=[],n=this.sel.ranges,i=0;i<n.length;i++){var o=N(t,n[i].from(),n[i].to());!1!==e&&(o=o.join(e||t.lineSeparator())),r[i]=o}return r},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:gn(function(e,t,r){for(var n=this,i=[],o=this.sel,l=0;l<o.ranges.length;l++){var s=o.ranges[l];i[l]={from:s.from(),to:s.to(),text:n.splitLines(e[l]),origin:r}}for(var a=t&&"end"!=t&&Kn(this,i,t),u=i.length-1;u>=0;u--)Oi(n,i[u]);a?yi(this,a):this.cm&&jr(this.cm)}),undo:gn(function(){Wi(this,"undo")}),redo:gn(function(){Wi(this,"redo")}),undoSelection:gn(function(){Wi(this,"undo",!0)}),redoSelection:gn(function(){Wi(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){this.history=new Jn(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:fi(this.history.done),undone:fi(this.history.undone)}},setHistory:function(e){var t=this.history=new Jn(this.history.maxGeneration);t.done=fi(e.done.slice(0),null,!0),t.undone=fi(e.undone.slice(0),null,!0)},setGutterMarker:gn(function(e,t,r){return Ri(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=r,!r&&C(n)&&(e.gutterMarkers=null),!0})}),clearGutter:gn(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&Ri(t,r,"gutter",function(){return r.gutterMarkers[e]=null,C(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!H(this,e))return null;if(t=e,!(e=M(this,e)))return null}else if(null==(t=W(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass";if(t[i]){if(e(n).test(t[i]))return!1;t[i]+=" "+n}else t[i]=n;return!0})}),removeLineClass:gn(function(t,r,n){return Ri(this,t,"gutter"==r?"gutter":"class",function(t){var i="text"==r?"textClass":"background"==r?"bgClass":"gutter"==r?"gutterClass":"wrapClass",o=t[i];if(!o)return!1;if(null==n)t[i]=null;else{var l=o.match(e(n));if(!l)return!1;var s=l.index+l[0].length;t[i]=o.slice(0,l.index)+(l.index&&s!=o.length?" ":"")+o.slice(s)||null}return!0})}),addLineWidget:gn(function(e,t,r){return Vi(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return Ki(this,U(this,e),U(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=U(this,e),Ki(this,e,e,r,"bookmark")},findMarksAt:function(e){var t=[],r=M(this,(e=U(this,e)).line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(null==i.from||i.from<=e.ch)&&(null==i.to||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=U(this,e),t=U(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var l=o.markedSpans;if(l)for(var s=0;s<l.length;s++){var a=l[s];null!=a.to&&i==e.line&&e.ch>=a.to||null==a.from&&i!=e.line||null!=a.from&&i==t.line&&a.from>=t.ch||r&&!r(a.marker)||n.push(a.marker.parent||a.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)null!=r[n].from&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),U(this,E(r,t))},indexFromPos:function(e){var t=(e=U(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+r}),t},copy:function(e){var t=new Ds(O(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<r&&(r=e.to);var n=new Ds(O(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Yi(n,Xi(this)),n},unlinkDoc:function(e){var t=this;if(e instanceof jo&&(e=e.doc),this.linked)for(var r=0;r<this.linked.length;++r)if(t.linked[r].doc==e){t.linked.splice(r,1),e.unlinkDoc(t),_i(Xi(t));break}if(e.history==this.history){var n=[e.id];$n(e,function(e){return n.push(e.id)},!0),e.history=new Jn(null),e.history.done=fi(this.history.done,n),e.history.undone=fi(this.history.undone,n)}},iterLinkedDocs:function(e){$n(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):es(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:gn(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Qn(this.cm))})}),Ds.prototype.eachLine=Ds.prototype.iter;for(var Hs=0,Fs=!1,Es={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ps=0;Ps<10;Ps++)Es[Ps+48]=Es[Ps+96]=String(Ps);for(var Is=65;Is<=90;Is++)Es[Is]=String.fromCharCode(Is);for(var zs=1;zs<=12;zs++)Es[zs+111]=Es[zs+63235]="F"+zs;var Rs={};Rs.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Rs.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Rs.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Rs.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Rs.default=Ml?Rs.macDefault:Rs.pcDefault;var Bs={selectAll:Mi,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Gl)},killLine:function(e){return co(e,function(t){if(t.empty()){var r=M(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:E(t.head.line+1,0)}:{from:t.head,to:E(t.head.line,r)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return co(e,function(t){return{from:E(t.from().line,0),to:U(e.doc,E(t.to().line+1,0))}})},delLineLeft:function(e){return co(e,function(e){return{from:E(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:r},"div"),to:t.from()}})},delWrappedLineRight:function(e){return co(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(E(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(E(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return vo(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return yo(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return mo(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},Vl)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},Vl)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?yo(e,t.head):n},Vl)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),l=f(e.getLine(o.line),o.ch,n);t.push(p(n-l%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return hn(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=M(e.doc,i.line).text;if(o)if(i.ch==o.length&&(i=new E(i.line,i.ch-1)),i.ch>0)i=new E(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),E(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var l=M(e.doc,i.line-1).text;l&&(i=new E(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+l.charAt(l.length-1),E(i.line-1,l.length-1),i,"+transpose"))}r.push(new Ts(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return hn(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);jr(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Gs=new Pl,Us=null,Vs=function(e,t,r){this.time=e,this.pos=t,this.button=r};Vs.prototype.compare=function(e,t,r){return this.time+400>e&&0==P(t,this.pos)&&r==this.button};var Ks,js,Xs={toString:function(){return"CodeMirror.Init"}},Ys={},_s={};jo.defaults=Ys,jo.optionHandlers=_s;var $s=[];jo.defineInitHook=function(e){return $s.push(e)};var qs=null,Zs=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Pl,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Zs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()}),"cut"==e.type&&i.replaceSelection("",null,"cut");else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type&&i.operation(function(){i.setSelections(t.ranges,0,Gl),i.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var r=qs.text.join("\n");if(e.clipboardData.setData("Text",r),e.clipboardData.getData("Text")==r)return void e.preventDefault()}var l=el(),s=l.firstChild;i.display.lineSpace.insertBefore(l,i.display.lineSpace.firstChild),s.value=qs.text.join("\n");var a=document.activeElement;El(s),setTimeout(function(){i.display.lineSpace.removeChild(l),a.focus(),a==o&&n.showPrimarySelection()},50)}}var r=this,n=this,i=n.cm,o=n.div=e.lineDiv;Jo(o,i.options.spellcheck),Ql(o,"paste",function(e){Me(i,e)||qo(e,i)||vl<=11&&setTimeout(dn(i,function(){return r.updateFromDOM()}),20)}),Ql(o,"compositionstart",function(e){r.composing={data:e.data,done:!1}}),Ql(o,"compositionupdate",function(e){r.composing||(r.composing={data:e.data,done:!1})}),Ql(o,"compositionend",function(e){r.composing&&(e.data!=r.composing.data&&r.readFromDOMSoon(),r.composing.done=!0)}),Ql(o,"touchstart",function(){return n.forceCompositionEnd()}),Ql(o,"input",function(){r.composing||r.readFromDOMSoon()}),Ql(o,"copy",t),Ql(o,"cut",t)},Zs.prototype.prepareSelection=function(){var e=Tr(this.cm,!1);return e.focus=this.cm.state.focused,e},Zs.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Zs.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom)e.removeAllRanges();else{var o=sl(t,e.anchorNode,e.anchorOffset),l=sl(t,e.focusNode,e.focusOffset);if(!o||o.bad||!l||l.bad||0!=P(B(o,l),n)||0!=P(R(o,l),i)){var s=t.display.view,a=n.line>=t.display.viewFrom&&nl(t,n)||{node:s[0].measure.map[2],offset:0},u=i.line<t.display.viewTo&&nl(t,i);if(!u){var c=s[s.length-1].measure,f=c.maps?c.maps[c.maps.length-1]:c.map;u={node:f[f.length-1],offset:f[f.length-2]-f[f.length-3]}}if(a&&u){var h,d=e.rangeCount&&e.getRangeAt(0);try{h=Wl(a.node,a.offset,u.offset,u.node)}catch(e){}h&&(!fl&&t.state.focused?(e.collapse(a.node,a.offset),h.collapsed||(e.removeAllRanges(),e.addRange(h))):(e.removeAllRanges(),e.addRange(h)),d&&null==e.anchorNode?e.addRange(d):fl&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Zs.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Zs.prototype.showMultipleSelections=function(e){r(this.cm.display.cursorDiv,e.cursors),r(this.cm.display.selectionDiv,e.selection)},Zs.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Zs.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return o(this.div,t)},Zs.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Zs.prototype.blur=function(){this.div.blur()},Zs.prototype.getField=function(){return this.div},Zs.prototype.supportsTouch=function(){return!0},Zs.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():hn(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Zs.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Zs.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(kl&&bl&&this.cm.options.gutters.length&&il(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var r=sl(t,e.anchorNode,e.anchorOffset),n=sl(t,e.focusNode,e.focusOffset);r&&n&&hn(t,function(){bi(t.doc,Rn(r,n),Gl),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},Zs.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,r=e.doc.sel.primary(),n=r.from(),i=r.to();if(0==n.ch&&n.line>e.firstLine()&&(n=E(n.line-1,M(e.doc,n.line-1).length)),i.ch==M(e.doc,i.line).text.length&&i.line<e.lastLine()&&(i=E(i.line+1,0)),n.line<t.viewFrom||i.line>t.viewTo-1)return!1;var o,l,s;n.line==t.viewFrom||0==(o=Lr(e,n.line))?(l=W(t.view[0].line),s=t.view[0].node):(l=W(t.view[o].line),s=t.view[o-1].node.nextSibling);var a,u,c=Lr(e,i.line);if(c==t.view.length-1?(a=t.viewTo-1,u=t.lineDiv.lastChild):(a=W(t.view[c+1].line)-1,u=t.view[c+1].node.previousSibling),!s)return!1;for(var f=e.doc.splitLines(ll(e,s,u,l,a)),h=N(e.doc,E(l,0),E(a,M(e.doc,a).text.length));f.length>1&&h.length>1;)if(g(f)==g(h))f.pop(),h.pop(),a--;else{if(f[0]!=h[0])break;f.shift(),h.shift(),l++}for(var d=0,p=0,v=f[0],m=h[0],y=Math.min(v.length,m.length);d<y&&v.charCodeAt(d)==m.charCodeAt(d);)++d;for(var b=g(f),w=g(h),x=Math.min(b.length-(1==f.length?d:0),w.length-(1==h.length?d:0));p<x&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)++p;if(1==f.length&&1==h.length&&l==n.line)for(;d&&d>n.ch&&b.charCodeAt(b.length-p-1)==w.charCodeAt(w.length-p-1);)d--,p++;f[f.length-1]=b.slice(0,b.length-p).replace(/^\u200b+/,""),f[0]=f[0].slice(d).replace(/\u200b+$/,"");var C=E(l,d),S=E(a,h.length?g(h).length-p:0);return f.length>1||f[0]||P(C,S)?(Ei(e.doc,f,C,S,"+input"),!0):void 0},Zs.prototype.ensurePolled=function(){this.forceCompositionEnd()},Zs.prototype.reset=function(){this.forceCompositionEnd()},Zs.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Zs.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Zs.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||hn(this.cm,function(){return vn(e.cm)})},Zs.prototype.setUneditable=function(e){e.contentEditable="false"},Zs.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||dn(this.cm,$o)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Zs.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Zs.prototype.onContextMenu=function(){},Zs.prototype.resetPosition=function(){},Zs.prototype.needsContentAttribute=!0;var Qs=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Pl,this.hasSelection=!1,this.composing=null};Qs.prototype.init=function(e){function t(e){if(!Me(i,e)){if(i.somethingSelected())_o({lineWise:!1,text:i.getSelections()});else{if(!i.options.lineWiseCopyCut)return;var t=Qo(i);_o({lineWise:!0,text:t.text}),"cut"==e.type?i.setSelections(t.ranges,null,Gl):(n.prevInput="",l.value=t.text.join("\n"),El(l))}"cut"==e.type&&(i.state.cutIncoming=!0)}}var r=this,n=this,i=this.cm,o=this.wrapper=el(),l=this.textarea=o.firstChild;e.wrapper.insertBefore(o,e.wrapper.firstChild),Ll&&(l.style.width="0px"),Ql(l,"input",function(){gl&&vl>=9&&r.hasSelection&&(r.hasSelection=null),n.poll()}),Ql(l,"paste",function(e){Me(i,e)||qo(e,i)||(i.state.pasteIncoming=!0,n.fastPoll())}),Ql(l,"cut",t),Ql(l,"copy",t),Ql(e.scroller,"paste",function(t){Ft(e,t)||Me(i,t)||(i.state.pasteIncoming=!0,n.focus())}),Ql(e.lineSpace,"selectstart",function(t){Ft(e,t)||We(t)}),Ql(l,"compositionstart",function(){var e=i.getCursor("from");n.composing&&n.composing.range.clear(),n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}}),Ql(l,"compositionend",function(){n.composing&&(n.poll(),n.composing.range.clear(),n.composing=null)})},Qs.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=Tr(e);if(e.options.moveInputWithCursor){var i=sr(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),l=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+l.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+l.left-o.left))}return n},Qs.prototype.showSelection=function(e){var t=this.cm.display;r(t.cursorDiv,e.cursors),r(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Qs.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&El(this.textarea),gl&&vl>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",gl&&vl>=9&&(this.hasSelection=null))}},Qs.prototype.getField=function(){return this.textarea},Qs.prototype.supportsTouch=function(){return!1},Qs.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Tl||l()!=this.textarea))try{this.textarea.focus()}catch(e){}},Qs.prototype.blur=function(){this.textarea.blur()},Qs.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Qs.prototype.receivedFocus=function(){this.slowPoll()},Qs.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Qs.prototype.fastPoll=function(){function e(){r.poll()||t?(r.pollingFast=!1,r.slowPoll()):(t=!0,r.polling.set(60,e))}var t=!1,r=this;r.pollingFast=!0,r.polling.set(20,e)},Qs.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||ts(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(gl&&vl>=9&&this.hasSelection===i||Ml&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(8203!=o||n||(n="​"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var l=0,s=Math.min(n.length,i.length);l<s&&n.charCodeAt(l)==i.charCodeAt(l);)++l;return hn(t,function(){$o(t,i.slice(l),n.length-l,null,e.composing?"*compose":null),i.length>1e3||i.indexOf("\n")>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Qs.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Qs.prototype.onKeyPress=function(){gl&&vl>=9&&(this.hasSelection=null),this.fastPoll()},Qs.prototype.onContextMenu=function(e){function t(){if(null!=l.selectionStart){var e=i.somethingSelected(),t="​"+(e?l.value:"");l.value="⇚",l.value=t,n.prevInput=e?"":"​",l.selectionStart=1,l.selectionEnd=t.length,o.selForContextMenu=i.doc.sel}}function r(){if(n.contextMenuPending=!1,n.wrapper.style.cssText=c,l.style.cssText=u,gl&&vl<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=a),null!=l.selectionStart){(!gl||gl&&vl<9)&&t();var e=0,r=function(){o.selForContextMenu==i.doc.sel&&0==l.selectionStart&&l.selectionEnd>0&&"​"==n.prevInput?dn(i,Mi)(i):e++<10?o.detectingSelectAll=setTimeout(r,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(r,200)}}var n=this,i=n.cm,o=i.display,l=n.textarea,s=Sr(i,e),a=o.scroller.scrollTop;if(s&&!wl){i.options.resetSelectionOnContextMenu&&-1==i.doc.sel.contains(s)&&dn(i,bi)(i.doc,Rn(s),Gl);var u=l.style.cssText,c=n.wrapper.style.cssText;n.wrapper.style.cssText="position: absolute";var f=n.wrapper.getBoundingClientRect();l.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-f.top-5)+"px; left: "+(e.clientX-f.left-5)+"px;\n      z-index: 1000; background: "+(gl?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var h;if(ml&&(h=window.scrollY),o.input.focus(),ml&&window.scrollTo(null,h),o.input.reset(),i.somethingSelected()||(l.value=n.prevInput=" "),n.contextMenuPending=!0,o.selForContextMenu=i.doc.sel,clearTimeout(o.detectingSelectAll),gl&&vl>=9&&t(),Hl){Fe(e);var d=function(){ke(window,"mouseup",d),setTimeout(r,20)};Ql(window,"mouseup",d)}else setTimeout(r,50)}},Qs.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Qs.prototype.setUneditable=function(){},Qs.prototype.needsContentAttribute=!1,function(e){function t(t,n,i,o){e.defaults[t]=n,i&&(r[t]=o?function(e,t,r){r!=Xs&&i(e,t,r)}:i)}var r=e.optionHandlers;e.defineOption=t,e.Init=Xs,t("value","",function(e,t){return e.setValue(t)},!0),t("mode",null,function(e,t){e.doc.modeOption=t,jn(e)},!0),t("indentUnit",2,jn,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(e){Xn(e),er(e),vn(e)},!0),t("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var r=[],n=e.doc.first;e.doc.iter(function(e){for(var i=0;;){var o=e.text.indexOf(t,i);if(-1==o)break;i=o+t.length,r.push(E(n,o))}n++});for(var i=r.length-1;i>=0;i--)Ei(e.doc,t,r[i],E(r[i].line,r[i].ch+t.length))}}),t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),r!=Xs&&e.refresh()}),t("specialCharPlaceholder",at,function(e){return e.refresh()},!0),t("electricChars",!0),t("inputStyle",Tl?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),t("rtlMoveVisually",!Ol),t("wholeLineUpdateBefore",!0),t("theme","default",function(e){Go(e),Uo(e)},!0),t("keyMap","default",function(e,t,r){var n=uo(t),i=r!=Xs&&uo(r);i&&i.detach&&i.detach(e,n),n.attach&&n.attach(e,i||null)}),t("extraKeys",null),t("configureMouse",null),t("lineWrapping",!1,Ko,!0),t("gutters",[],function(e){Fn(e.options),Uo(e)},!0),t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?wr(e.display)+"px":"0",e.refresh()},!0),t("coverGutterNextToScrollbar",!1,function(e){return en(e)},!0),t("scrollbarStyle","native",function(e){rn(e),en(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),t("lineNumbers",!1,function(e){Fn(e.options),Uo(e)},!0),t("firstLineNumber",1,Uo,!0),t("lineNumberFormatter",function(e){return e},Uo,!0),t("showCursorWhenSelecting",!1,kr,!0),t("resetSelectionOnContextMenu",!0),t("lineWiseCopyCut",!0),t("pasteLinesPerSelection",!0),t("readOnly",!1,function(e,t){"nocursor"==t&&(Fr(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),t("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),t("dragDrop",!0,Vo),t("allowDropFileTypes",null),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1,kr,!0),t("singleCursorHeightPerLine",!0,kr,!0),t("workTime",100),t("workDelay",100),t("flattenSpans",!0,Xn,!0),t("addModeClass",!1,Xn,!0),t("pollInterval",100),t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),t("historyEventDelay",1250),t("viewportMargin",10,function(e){return e.refresh()},!0),t("maxHighlightLength",1e4,Xn,!0),t("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),t("autofocus",null),t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}(jo),function(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,r){var n=this.options,i=n[e];n[e]==r&&"mode"!=e||(n[e]=r,t.hasOwnProperty(e)&&dn(this,t[e])(this,r,i),Te(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](uo(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,r=0;r<t.length;++r)if(t[r]==e||t[r].name==e)return t.splice(r,1),!0},addOverlay:pn(function(t,r){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");m(this.state.overlays,{mode:n,modeSpec:t,opaque:r&&r.opaque,priority:r&&r.priority||0},function(e){return e.priority}),this.state.modeGen++,vn(this)}),removeOverlay:pn(function(e){for(var t=this,r=this.state.overlays,n=0;n<r.length;++n){var i=r[n].modeSpec;if(i==e||"string"==typeof e&&i.name==e)return r.splice(n,1),t.state.modeGen++,void vn(t)}}),indentLine:pn(function(e,t,r){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),H(this.doc,e)&&Yo(this,e,t,r)}),indentSelection:pn(function(e){for(var t=this,r=this.doc.sel.ranges,n=-1,i=0;i<r.length;i++){var o=r[i];if(o.empty())o.head.line>n&&(Yo(t,o.head.line,e,!0),n=o.head.line,i==t.doc.sel.primIndex&&jr(t));else{var l=o.from(),s=o.to(),a=Math.max(n,l.line);n=Math.min(t.lastLine(),s.line-(s.ch?0:1))+1;for(var u=a;u<n;++u)Yo(t,u,e);var c=t.doc.sel.ranges;0==l.ch&&r.length==c.length&&c[i].from().ch>0&&gi(t.doc,i,new Ts(l,c[i].to()),Gl)}}}),getTokenAt:function(e,t){return Je(this,e,t)},getLineTokens:function(e,t){return Je(this,E(e),t,!0)},getTokenTypeAt:function(e){e=U(this.doc,e);var t,r=_e(this,M(this.doc,e.line)),n=0,i=(r.length-1)/2,o=e.ch;if(0==o)t=r[2];else for(;;){var l=n+i>>1;if((l?r[2*l-1]:0)>=o)i=l;else{if(!(r[2*l+1]<o)){t=r[2*l+2];break}n=l+1}}var s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(t){var r=this.doc.mode;return r.innerMode?e.innerMode(r,this.getTokenAt(t).state).mode:r},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var n=this,i=[];if(!r.hasOwnProperty(t))return i;var o=r[t],l=this.getModeAt(e);if("string"==typeof l[t])o[l[t]]&&i.push(o[l[t]]);else if(l[t])for(var s=0;s<l[t].length;s++){var a=o[l[t][s]];a&&i.push(a)}else l.helperType&&o[l.helperType]?i.push(o[l.helperType]):o[l.name]&&i.push(o[l.name]);for(var u=0;u<o._global.length;u++){var c=o._global[u];c.pred(l,n)&&-1==h(i,c.val)&&i.push(c.val)}return i},getStateAfter:function(e,t){var r=this.doc;return e=G(r,null==e?r.first+r.size-1:e),$e(this,e+1,t).state},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();return r=null==e?n.head:"object"==typeof e?U(this.doc,e):e?n.from():n.to(),sr(this,r,t||"page")},charCoords:function(e,t){return lr(this,U(this.doc,e),t||"page")},coordsChar:function(e,t){return e=or(this,e,t||"page"),cr(this,e.left,e.top)},lineAtHeight:function(e,t){return e=or(this,{top:e,left:0},t||"page").top,D(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n,i=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,i=!0),n=M(this.doc,e)}else n=e;return ir(this,n,{top:0,left:0},t||"page",r||i).top+(i?this.doc.height-ye(n):0)},defaultTextHeight:function(){return mr(this.display)},defaultCharWidth:function(){return yr(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o=this.display,l=(e=sr(this,U(this.doc,e))).bottom,s=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==n)l=e.top;else if("above"==n||"near"==n){var a=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>a)&&e.top>t.offsetHeight?l=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=a&&(l=e.bottom),s+t.offsetWidth>u&&(s=u-t.offsetWidth)}t.style.top=l+"px",t.style.left=t.style.right="","right"==i?(s=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==i?s=0:"middle"==i&&(s=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),r&&Ur(this,{left:s,top:l,right:s+t.offsetWidth,bottom:l+t.offsetHeight})},triggerOnKeyDown:pn(Lo),triggerOnKeyPress:pn(Mo),triggerOnKeyUp:To,triggerOnMouseDown:pn(Oo),execCommand:function(e){if(Bs.hasOwnProperty(e))return Bs[e].call(null,this)},triggerElectric:pn(function(e){Zo(this,e)}),findPosH:function(e,t,r,n){var i=this,o=1;t<0&&(o=-1,t=-t);for(var l=U(this.doc,e),s=0;s<t&&!(l=tl(i.doc,l,o,r,n)).hitSide;++s);return l},moveH:pn(function(e,t){var r=this;this.extendSelectionsBy(function(n){return r.display.shift||r.doc.extend||n.empty()?tl(r.doc,n.head,e,t,r.options.rtlMoveVisually):e<0?n.from():n.to()},Vl)}),deleteH:pn(function(e,t){var r=this.doc.sel,n=this.doc;r.somethingSelected()?n.replaceSelection("",null,"+delete"):co(this,function(r){var i=tl(n,r.head,e,t,!1);return e<0?{from:i,to:r.head}:{from:r.head,to:i}})}),findPosV:function(e,t,r,n){var i=this,o=1,l=n;t<0&&(o=-1,t=-t);for(var s=U(this.doc,e),a=0;a<t;++a){var u=sr(i,s,"div");if(null==l?l=u.left:u.left=l,(s=rl(i,u,o,r)).hitSide)break}return s},moveV:pn(function(e,t){var r=this,n=this.doc,i=[],o=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(l){if(o)return e<0?l.from():l.to();var s=sr(r,l.head,"div");null!=l.goalColumn&&(s.left=l.goalColumn),i.push(s.left);var a=rl(r,s,e,t);return"page"==t&&l==n.sel.primary()&&Kr(r,lr(r,a,"div").top-s.top),a},Vl),i.length)for(var l=0;l<n.sel.ranges.length;l++)n.sel.ranges[l].goalColumn=i[l]}),findWordAt:function(e){var t=M(this.doc,e.line).text,r=e.ch,n=e.ch;if(t){var i=this.getHelper(e,"wordChars");"before"!=e.sticky&&n!=t.length||!r?++n:--r;for(var o=t.charAt(r),l=x(o,i)?function(e){return x(e,i)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!x(e)};r>0&&l(t.charAt(r-1));)--r;for(;n<t.length&&l(t.charAt(n));)++n}return new Ts(E(e.line,r),E(e.line,n))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?s(this.display.cursorDiv,"CodeMirror-overwrite"):Fl(this.display.cursorDiv,"CodeMirror-overwrite"),Te(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==l()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pn(function(e,t){Xr(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-zt(this)-this.display.barHeight,width:e.scrollWidth-zt(this)-this.display.barWidth,clientHeight:Bt(this),clientWidth:Rt(this)}},scrollIntoView:pn(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:E(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Yr(this,e):$r(this,e.from,e.to,e.margin)}),setSize:pn(function(e,t){var r=this,n=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=n(e)),null!=t&&(this.display.wrapper.style.height=n(t)),this.options.lineWrapping&&Jt(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){mn(r,i,"widget");break}++i}),this.curOp.forceUpdate=!0,Te(this,"refresh",this)}),operation:function(e){return hn(this,e)},startOperation:function(){return nn(this)},endOperation:function(){return on(this)},refresh:pn(function(){var e=this.display.cachedTextHeight;vn(this),this.curOp.forceUpdate=!0,er(this),Xr(this,this.doc.scrollLeft,this.doc.scrollTop),Wn(this),(null==e||Math.abs(e-mr(this.display))>.5)&&Cr(this),Te(this,"refresh",this)}),swapDoc:pn(function(e){var t=this.doc;return t.cm=null,qn(this,e),er(this),this.display.input.reset(),Xr(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,bt(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ae(e),e.registerHelper=function(t,n,i){r.hasOwnProperty(t)||(r[t]=e[t]={_global:[]}),r[t][n]=i},e.registerGlobalHelper=function(t,n,i,o){e.registerHelper(t,n,o),r[t]._global.push({pred:i,val:o})}}(jo);var Js="iter insert remove copy getEditor constructor".split(" ");for(var ea in Ds.prototype)Ds.prototype.hasOwnProperty(ea)&&h(Js,ea)<0&&(jo.prototype[ea]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ds.prototype[ea]));return Ae(Ds),jo.inputStyles={textarea:Qs,contenteditable:Zs},jo.defineMode=function(e){jo.defaults.mode||"null"==e||(jo.defaults.mode=e),Be.apply(this,arguments)},jo.defineMIME=function(e,t){os[e]=t},jo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),jo.defineMIME("text/plain","null"),jo.defineExtension=function(e,t){jo.prototype[e]=t},jo.defineDocExtension=function(e,t){Ds.prototype[e]=t},jo.fromTextArea=function(e,t){function r(){e.value=a.getValue()}if(t=t?c(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var n=l();t.autofocus=n==e||null!=e.getAttribute("autofocus")&&n==document.body}var i;if(e.form&&(Ql(e.form,"submit",r),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var s=o.submit=function(){r(),o.submit=i,o.submit(),o.submit=s}}catch(e){}}t.finishInit=function(t){t.save=r,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,r(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(ke(e.form,"submit",r),"function"==typeof e.form.submit&&(e.form.submit=i))}},e.style.display="none";var a=jo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return a},function(e){e.off=ke,e.on=Ql,e.wheelEventPixels=Pn,e.Doc=Ds,e.splitLines=es,e.countColumn=f,e.findColumn=d,e.isWordChar=w,e.Pass=Bl,e.signal=Te,e.Line=fs,e.changeEnd=Bn,e.scrollbarModel=ws,e.Pos=E,e.cmpPos=P,e.modes=is,e.mimeModes=os,e.resolveMode=Ge,e.getMode=Ue,e.modeExtensions=ls,e.extendMode=Ve,e.copyState=Ke,e.startState=Xe,e.innerMode=je,e.commands=Bs,e.keyMap=Rs,e.keyName=ao,e.isModifierKey=lo,e.lookupKey=oo,e.normalizeKeyMap=io,e.StringStream=ss,e.SharedTextMarker=As,e.TextMarker=Os,e.LineWidget=Ms,e.e_preventDefault=We,e.e_stopPropagation=De,e.e_stop=Fe,e.addClass=s,e.contains=o,e.rmClass=Fl,e.keyNames=Es}(jo),jo.version="5.30.0",jo});
      !function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t,n,r,o,a){this.indented=e,this.column=t,this.type=n,this.info=r,this.align=o,this.prev=a}function n(e,n,r,o){var a=e.indented;return e.context&&"statement"==e.context.type&&"statement"!=r&&(a=e.context.indented),e.context=new t(a,n,r,o,null,e.context)}function r(e){var t=e.context.type;return")"!=t&&"]"!=t&&"}"!=t||(e.indented=e.context.indented),e.context=e.context.prev}function o(e,t,n){return"variable"==t.prevToken||"type"==t.prevToken||(!!/\S(?:[^- ]>|[*\]])\s*$|\*$/.test(e.string.slice(0,n))||(!(!t.typeAtEndOfLine||e.column()!=e.indentation())||void 0))}function a(e){for(;;){if(!e||"top"==e.type)return!0;if("}"==e.type&&"namespace"!=e.prev.info)return!1;e=e.prev}}function i(e){for(var t={},n=e.split(" "),r=0;r<n.length;++r)t[n[r]]=!0;return t}function l(e,t){return"function"==typeof e?e(t):e.propertyIsEnumerable(t)}function s(e,t){if(!t.startOfLine)return!1;for(var n,r=null;n=e.peek();){if("\\"==n&&e.match(/^.$/)){r=s;break}if("/"==n&&e.match(/^\/[\/\*]/,!1))break;e.next()}return t.tokenize=r,"meta"}function c(e,t){return"type"==t.prevToken&&"type"}function u(e){return e.eatWhile(/[\w\.']/),"number"}function d(e,t){if(e.backUp(1),e.match(/(R|u8R|uR|UR|LR)/)){var n=e.match(/"([^\s\\()]{0,16})\(/);return!!n&&(t.cpp11RawStringDelim=n[1],t.tokenize=m,m(e,t))}return e.match(/(u8|u|U|L)/)?!!e.match(/["']/,!1)&&"string":(e.next(),!1)}function f(e){var t=/(\w+)::~?(\w+)$/.exec(e);return t&&t[1]==t[2]}function p(e,t){for(var n;null!=(n=e.next());)if('"'==n&&!e.eat('"')){t.tokenize=null;break}return"string"}function m(e,t){var n=t.cpp11RawStringDelim.replace(/[^\w\s]/g,"\\$&");return e.match(new RegExp(".*?\\)"+n+'"'))?t.tokenize=null:e.skipToEnd(),"string"}function h(t,n){function r(e){if(e)for(var t in e)e.hasOwnProperty(t)&&o.push(t)}"string"==typeof t&&(t=[t]);var o=[];r(n.keywords),r(n.types),r(n.builtin),r(n.atoms),o.length&&(n.helperType=t[0],e.registerHelper("hintWords",t[0],o));for(var a=0;a<t.length;++a)e.defineMIME(t[a],n)}function g(e,t){for(var n=!1;!e.eol();){if(!n&&e.match('"""')){t.tokenize=null;break}n="\\"==e.next()&&!n}return"string"}function y(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!e&&!o&&t.match('"')){a=!0;break}if(e&&t.match('"""')){a=!0;break}r=t.next(),!o&&"$"==r&&t.match("{")&&t.skipTo("}"),o=!o&&"\\"==r&&!e}return!a&&e||(n.tokenize=null),"string"}}function x(e){return function(t,n){for(var r,o=!1,a=!1;!t.eol();){if(!o&&t.match('"')&&("single"==e||t.match('""'))){a=!0;break}if(!o&&t.match("``")){w=x(e),a=!0;break}r=t.next(),o="single"==e&&!o&&"\\"==r}return a&&(n.tokenize=null),"string"}}e.defineMode("clike",function(i,s){function c(e,t){var n=e.next();if(S[n]){var r=S[n](e,t);if(!1!==r)return r}if('"'==n||"'"==n)return t.tokenize=u(n),t.tokenize(e,t);if(D.test(n))return p=n,null;if(L.test(n)){if(e.backUp(1),e.match(I))return"number";e.next()}if("/"==n){if(e.eat("*"))return t.tokenize=d,d(e,t);if(e.eat("/"))return e.skipToEnd(),"comment"}if(F.test(n)){for(;!e.match(/^\/[\/*]/,!1)&&e.eat(F););return"operator"}if(e.eatWhile(z),P)for(;e.match(P);)e.eatWhile(z);var o=e.current();return l(x,o)?(l(w,o)&&(p="newstatement"),l(v,o)&&(m=!0),"keyword"):l(b,o)?"type":l(k,o)?(l(w,o)&&(p="newstatement"),"builtin"):l(_,o)?"atom":"variable"}function u(e){return function(t,n){for(var r,o=!1,a=!1;null!=(r=t.next());){if(r==e&&!o){a=!0;break}o=!o&&"\\"==r}return(a||!o&&!C)&&(n.tokenize=null),"string"}}function d(e,t){for(var n,r=!1;n=e.next();){if("/"==n&&r){t.tokenize=null;break}r="*"==n}return"comment"}function f(e,t){s.typeFirstDefinitions&&e.eol()&&a(t.context)&&(t.typeAtEndOfLine=o(e,t,e.pos))}var p,m,h=i.indentUnit,g=s.statementIndentUnit||h,y=s.dontAlignCalls,x=s.keywords||{},b=s.types||{},k=s.builtin||{},w=s.blockKeywords||{},v=s.defKeywords||{},_=s.atoms||{},S=s.hooks||{},C=s.multiLineStrings,T=!1!==s.indentStatements,M=!1!==s.indentSwitch,P=s.namespaceSeparator,D=s.isPunctuationChar||/[\[\]{}\(\),;\:\.]/,L=s.numberStart||/[\d\.]/,I=s.number||/^(?:0x[a-f\d]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[-+]?\d+)?)(u|ll?|l|f)?/i,F=s.isOperatorChar||/[+\-*&%=<>!?|\/]/,z=s.isIdentifierChar||/[\w\$_\xa1-\uffff]/;return{startState:function(e){return{tokenize:null,context:new t((e||0)-h,0,"top",null,!1),indented:0,startOfLine:!0,prevToken:null}},token:function(e,t){var i=t.context;if(e.sol()&&(null==i.align&&(i.align=!1),t.indented=e.indentation(),t.startOfLine=!0),e.eatSpace())return f(e,t),null;p=m=null;var l=(t.tokenize||c)(e,t);if("comment"==l||"meta"==l)return l;if(null==i.align&&(i.align=!0),";"==p||":"==p||","==p&&e.match(/^\s*(?:\/\/.*)?$/,!1))for(;"statement"==t.context.type;)r(t);else if("{"==p)n(t,e.column(),"}");else if("["==p)n(t,e.column(),"]");else if("("==p)n(t,e.column(),")");else if("}"==p){for(;"statement"==i.type;)i=r(t);for("}"==i.type&&(i=r(t));"statement"==i.type;)i=r(t)}else p==i.type?r(t):T&&(("}"==i.type||"top"==i.type)&&";"!=p||"statement"==i.type&&"newstatement"==p)&&n(t,e.column(),"statement",e.current());if("variable"==l&&("def"==t.prevToken||s.typeFirstDefinitions&&o(e,t,e.start)&&a(t.context)&&e.match(/^\s*\(/,!1))&&(l="def"),S.token){var u=S.token(e,t,l);void 0!==u&&(l=u)}return"def"==l&&!1===s.styleDefs&&(l="variable"),t.startOfLine=!1,t.prevToken=m?"def":l||p,f(e,t),l},indent:function(t,n){if(t.tokenize!=c&&null!=t.tokenize||t.typeAtEndOfLine)return e.Pass;var r=t.context,o=n&&n.charAt(0);if("statement"==r.type&&"}"==o&&(r=r.prev),s.dontIndentStatements)for(;"statement"==r.type&&s.dontIndentStatements.test(r.info);)r=r.prev;if(S.indent){var a=S.indent(t,r,n);if("number"==typeof a)return a}var i=o==r.type,l=r.prev&&"switch"==r.prev.info;if(s.allmanIndentation&&/[{(]/.test(o)){for(;"top"!=r.type&&"}"!=r.type;)r=r.prev;return r.indented}return"statement"==r.type?r.indented+("{"==o?0:g):!r.align||y&&")"==r.type?")"!=r.type||i?r.indented+(i?0:h)+(i||!l||/^(?:case|default)\b/.test(n)?0:h):r.indented+g:r.column+(i?0:1)},electricInput:M?/^\s*(?:case .*?:|default:|\{\}?|\})$/:/^\s*[{}]$/,blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//",fold:"brace"}});var b="auto if break case register continue return default do sizeof static else struct switch extern typedef union for goto while enum const volatile",k="int long char short double float unsigned signed void size_t ptrdiff_t";h(["text/x-csrc","text/x-c","text/x-chdr"],{name:"clike",keywords:i(b),types:i(k+" bool _Complex _Bool float_t double_t intptr_t intmax_t int8_t int16_t int32_t int64_t uintptr_t uintmax_t uint8_t uint16_t uint32_t uint64_t"),blockKeywords:i("case do else for if switch while struct"),defKeywords:i("struct"),typeFirstDefinitions:!0,atoms:i("null true false"),hooks:{"#":s,"*":c},modeProps:{fold:["brace","include"]}}),h(["text/x-c++src","text/x-c++hdr"],{name:"clike",keywords:i(b+" asm dynamic_cast namespace reinterpret_cast try explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected alignas alignof constexpr decltype nullptr noexcept thread_local final static_assert override"),types:i(k+" bool wchar_t"),blockKeywords:i("catch class do else finally for if struct switch try while"),defKeywords:i("class namespace struct enum union"),typeFirstDefinitions:!0,atoms:i("true false null"),dontIndentStatements:/^template$/,isIdentifierChar:/[\w\$_~\xa1-\uffff]/,hooks:{"#":s,"*":c,u:d,U:d,L:d,R:d,0:u,1:u,2:u,3:u,4:u,5:u,6:u,7:u,8:u,9:u,token:function(e,t,n){if("variable"==n&&"("==e.peek()&&(";"==t.prevToken||null==t.prevToken||"}"==t.prevToken)&&f(e.current()))return"def"}},namespaceSeparator:"::",modeProps:{fold:["brace","include"]}}),h("text/x-java",{name:"clike",keywords:i("abstract assert break case catch class const continue default do else enum extends final finally float for goto if implements import instanceof interface native new package private protected public return static strictfp super switch synchronized this throw throws transient try volatile while @interface"),types:i("byte short int long float double boolean char void Boolean Byte Character Double Float Integer Long Number Object Short String StringBuffer StringBuilder Void"),blockKeywords:i("catch class do else finally for if switch try while"),defKeywords:i("class interface package enum @interface"),typeFirstDefinitions:!0,atoms:i("true false null"),number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,hooks:{"@":function(e){return!e.match("interface",!1)&&(e.eatWhile(/[\w\$_]/),"meta")}},modeProps:{fold:["brace","import"]}}),h("text/x-csharp",{name:"clike",keywords:i("abstract as async await base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in interface internal is lock namespace new operator out override params private protected public readonly ref return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),types:i("Action Boolean Byte Char DateTime DateTimeOffset Decimal Double Func Guid Int16 Int32 Int64 Object SByte Single String Task TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),blockKeywords:i("catch class do else finally for foreach if struct switch try while"),defKeywords:i("class interface namespace struct var"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"@":function(e,t){return e.eat('"')?(t.tokenize=p,p(e,t)):(e.eatWhile(/[\w\$_]/),"meta")}}}),h("text/x-scala",{name:"clike",keywords:i("abstract case catch class def do else extends final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try type val var while with yield _ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble"),types:i("AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Int Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),multiLineStrings:!0,blockKeywords:i("catch class enum do else finally for forSome if match switch try while"),defKeywords:i("class enum def object package trait type val var"),atoms:i("true false null"),indentStatements:!1,indentSwitch:!1,isOperatorChar:/[+\-*&%=<>!?|\/#:@]/,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return!!e.match('""')&&(t.tokenize=g,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},"=":function(e,n){var r=n.context;return!("}"!=r.type||!r.align||!e.eat(">"))&&(n.context=new t(r.indented,r.column,r.type,r.info,null,r.prev),"operator")}},modeProps:{closeBrackets:{triples:'"'}}}),h("text/x-kotlin",{name:"clike",keywords:i("package as typealias class interface this super val var fun for is in This throw return break continue object if else while do try when !in !is as? file import where by get set abstract enum open inner override private public internal protected catch finally out final vararg reified dynamic companion constructor init sealed field property receiver param sparam lateinit data inline noinline tailrec external annotation crossinline const operator infix suspend"),types:i("Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),intendSwitch:!1,indentStatements:!1,multiLineStrings:!0,number:/^(?:0x[a-f\d_]+|0b[01_]+|(?:[\d_]+\.?\d*|\.\d+)(?:e[-+]?[\d_]+)?)(u|ll?|l|f)?/i,blockKeywords:i("catch class do else finally for if where try while enum"),defKeywords:i("class val var object package interface fun"),atoms:i("true false null this"),hooks:{'"':function(e,t){return t.tokenize=y(e.match('""')),t.tokenize(e,t)}},modeProps:{closeBrackets:{triples:'"'}}}),h(["x-shader/x-vertex","x-shader/x-fragment"],{name:"clike",keywords:i("sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),types:i("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4"),blockKeywords:i("for while do if else struct"),builtin:i("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),atoms:i("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TexureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),indentSwitch:!1,hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-nesc",{name:"clike",keywords:i(b+"as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),types:i(k),blockKeywords:i("case do else for if switch while struct"),atoms:i("null true false"),hooks:{"#":s},modeProps:{fold:["brace","include"]}}),h("text/x-objectivec",{name:"clike",keywords:i(b+"inline restrict _Bool _Complex _Imaginary BOOL Class bycopy byref id IMP in inout nil oneway out Protocol SEL self super atomic nonatomic retain copy readwrite readonly"),types:i(k),atoms:i("YES NO NULL NILL ON OFF true false"),hooks:{"@":function(e){return e.eatWhile(/[\w\$]/),"keyword"},"#":s,indent:function(e,t,n){if("statement"==t.type&&/^@\w/.test(n))return t.indented}},modeProps:{fold:"brace"}}),h("text/x-squirrel",{name:"clike",keywords:i("base break clone continue const default delete enum extends function in class foreach local resume return this throw typeof yield constructor instanceof static"),types:i(k),blockKeywords:i("case catch class else for foreach if switch try while"),defKeywords:i("function local class"),typeFirstDefinitions:!0,atoms:i("true false null"),hooks:{"#":s},modeProps:{fold:["brace","include"]}});var w=null;h("text/x-ceylon",{name:"clike",keywords:i("abstracts alias assembly assert assign break case catch class continue dynamic else exists extends finally for function given if import in interface is let module new nonempty object of out outer package return satisfies super switch then this throw try value void while"),types:function(e){var t=e.charAt(0);return t===t.toUpperCase()&&t!==t.toLowerCase()},blockKeywords:i("case catch class dynamic else finally for function if interface module new object switch try while"),defKeywords:i("class dynamic function interface module object package value"),builtin:i("abstract actual aliased annotation by default deprecated doc final formal late license native optional sealed see serializable shared suppressWarnings tagged throws variable"),isPunctuationChar:/[\[\]{}\(\),;\:\.`]/,isOperatorChar:/[+\-*&%=<>!?|^~:\/]/,numberStart:/[\d#$]/,number:/^(?:#[\da-fA-F_]+|\$[01_]+|[\d_]+[kMGTPmunpf]?|[\d_]+\.[\d_]+(?:[eE][-+]?\d+|[kMGTPmunpf]|)|)/i,multiLineStrings:!0,typeFirstDefinitions:!0,atoms:i("true false null larger smaller equal empty finished"),indentSwitch:!1,styleDefs:!1,hooks:{"@":function(e){return e.eatWhile(/[\w\$_]/),"meta"},'"':function(e,t){return t.tokenize=x(e.match('""')?"triple":"single"),t.tokenize(e,t)},"`":function(e,t){return!(!w||!e.match("`"))&&(t.tokenize=w,w=null,t.tokenize(e,t))},"'":function(e){return e.eatWhile(/[\w\$_\xa1-\uffff]/),"atom"},token:function(e,t,n){if(("variable"==n||"type"==n)&&"."==t.prevToken)return"variable-2"}},modeProps:{fold:["brace","import"],closeBrackets:{triples:'"'}}})});
      // -------------------------------------------------------------------------
//  Part of the CodeChecker project, under the Apache License v2.0 with
//  LLVM Exceptions. See LICENSE for license information.
//  SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
// -------------------------------------------------------------------------

var BugViewer = {
  _files : [],
  _reports : [],
  _lineWidgets : [],
  _navigationMenuItems : [],
  _sourceFileData : null,
  _currentReport : null,
  _lastBugEvent  : null,

  init : function (files, reports) {
    this._files = files;
    this._reports = reports;

    this.initEscapeChars();
  },

  initEscapeChars : function () {
    this.escapeChars = {
      ' ' : 'nbsp',
      '<' : 'lt',
      '>' : 'gt',
      '"' : 'quot',
      '&' : 'amp'
    };

    var regexString = '[';
    for (var key in this.escapeChars) {
      regexString += key;
    }
    regexString += ']';

    this.escapeRegExp = new RegExp( regexString, 'g');
  },

  escapeHTML : function (str) {
    var that = this;

    return str.replace(this.escapeRegExp, function (m) {
      return '&' + that.escapeChars[m] + ';';
    });
  },

  initByUrl : function () {
    if (!this._reports) return;

    var state = {};
    window.location.hash.substr(1).split('&').forEach(function (s) {
      var parts = s.split('=');
      state[parts[0]] = parts[1];
    });

    for (var key in this._reports) {
      var report = this._reports[key];
      if (report.reportHash === state['reportHash']) {
        this.navigate(report);
        return;
      }
    }

    this.navigate(this._reports[0]);
  },

  create : function () {
    this._content = document.getElementById('editor-wrapper');
    this._filepath = document.getElementById('file-path');
    this._checkerName = document.getElementById('checker-name');
    this._reviewStatusWrapper =
      document.getElementById('review-status-wrapper');
    this._reviewStatus = document.getElementById('review-status');
    this._editor = document.getElementById('editor');

    this._codeMirror = CodeMirror(this._editor, {
      mode: 'text/x-c++src',
      matchBrackets : true,
      lineNumbers : true,
      readOnly : true,
      foldGutter : true,
      extraKeys : {},
      viewportMargin : 100
    });

    this._createNavigationMenu();
  },

  navigate : function (report, item) {
    if (!item) {
      var items = this._navigationMenuItems.filter(function (navItem) {
        return navItem.report.reportHash === report.reportHash;
      });

      if (!items.length) return;

      item = items[0].widget;
    }

    this._selectedReport.classList.remove('active');
    this._selectedReport = item;
    this._selectedReport.classList.add('active');
    this.setReport(report);
  },

  _createNavigationMenu : function () {
    var that = this;

    var nav = document.getElementById('report-nav');
    var list = document.createElement('ul');
    this._reports.forEach(function (report) {
      var events = report['events'];
      var lastBugEvent = events[events.length - 1];
      var item = document.createElement('li');

      var severity = document.createElement('i');
      severity.className = 'severity-' + report.severity.toLowerCase();

      item.appendChild(severity);
      item.appendChild(document.createTextNode(lastBugEvent.message));

      item.addEventListener('click', function () {
        that.navigate(report, item);
      })
      list.appendChild(item);
      that._navigationMenuItems.push({ report : report, widget : item });
    });

    if (!this._selectedReport && list.childNodes.length) {
      this._selectedReport = list.childNodes[0];
      this._selectedReport.classList.add('active');
    }

    nav.appendChild(list);
  },

  setReport : function (report) {
    this._currentReport = report;
    var events = report['events'];
    var lastBugEvent = events[events.length - 1];
    this.setCurrentBugEvent(lastBugEvent, events.length - 1);
    this.setCheckerName(report.checkerName);
    this.setReviewStatus(report.reviewStatus);

    window.location.hash = '#reportHash=' + report.reportHash;
  },

  setCurrentBugEvent : function (event, idx) {
    this._currentBugEvent = event;
    this.setSourceFileData(this._files[event.location.file]);
    this.drawBugPath();

    this.jumpTo(event.location.line, 0);
    this.highlightBugEvent(event, idx);
  },

  highlightBugEvent : function (event, idx) {
    this._lineWidgets.forEach(function (widget) {
      var lineIdx = widget.node.getAttribute('idx');
      if (parseInt(lineIdx) === idx) {
        widget.node.classList.add('current');
      }
    });
  },

  setCheckerName : function (checkerName) {
    this._checkerName.innerHTML = checkerName;
  },

  setReviewStatus : function (status) {
    if (status) {
      var className =
        'review-status-' + status.toLowerCase().split(' ').join('-');
      this._reviewStatus.className = "review-status " + className;

      this._reviewStatus.innerHTML = status;
      this._reviewStatusWrapper.style.display = 'block';
    } else {
      this._reviewStatusWrapper.style.display = 'none';
    }
  },

  setSourceFileData : function (file) {
    if (this._sourceFileData && file.id === this._sourceFileData.id) {
      return;
    }

    this._sourceFileData = file;
    this._filepath.innerHTML = file.path;
    this._codeMirror.doc.setValue(file.content);
    this._refresh();
  },

  _refresh : function () {
    var that = this;
    setTimeout(function () {
      var fullHeight = parseInt(that._content.clientHeight);
      var headerHeight = that._filepath.clientHeight;

      that._codeMirror.setSize('auto', fullHeight - headerHeight);
      that._codeMirror.refresh();
    }, 200);
  },

  clearBubbles : function () {
    this._lineWidgets.forEach(function (widget) { widget.clear(); });
    this._lineWidgets = [];
  },

  getMessage : function (event, kind) {
    if (kind === 'macro') {
      var name = 'macro expansion' + (event.name ? ': ' + event.name : '');

      return '<span class="tag macro">' + name + '</span>'
        + this.escapeHTML(event.expansion).replace(/(?:\r\n|\r|\n)/g, '<br>');
    } else if (kind === 'note') {
      return '<span class="tag note">note</span>'
        +  this.escapeHTML(event.message).replace(/(?:\r\n|\r|\n)/g, '<br>');
    }
  },

  addExtraPathEvents : function (events, kind) {
    var that = this;

    if (!events) {
      return;
    }

    events.forEach(function (event) {
      if (event.location.file !== that._currentBugEvent.location.file) {
        return;
      }

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + kind);

      var msg = document.createElement('span');
      msg.innerHTML = that.getMessage(event, kind);
      element.appendChild(msg);

      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  drawBugPath : function () {
    var that = this;

    this.clearBubbles();

    this.addExtraPathEvents(this._currentReport.macros, 'macro');
    this.addExtraPathEvents(this._currentReport.notes, 'note');

    // Processing bug path events.
    var currentEvents = this._currentReport.events;
    currentEvents.forEach(function (event, step) {
      if (event.location.file !== that._currentBugEvent.location.file)
        return;

      var left =
        that._codeMirror.defaultCharWidth() * event.location.col + 'px';
      var type = step === currentEvents.length - 1 ? 'error' : 'info';

      var element = document.createElement('div');
      element.setAttribute('style', 'margin-left: ' + left);
      element.setAttribute('class', 'check-msg ' + type);
      element.setAttribute('idx', step);

      var enumeration = document.createElement('span');
      enumeration.setAttribute('class', 'checker-enum ' + type);
      enumeration.innerHTML = step + 1;

      if (currentEvents.length > 1)
        element.appendChild(enumeration);

      var prevBugEvent = step - 1;
      if (step > 0) {
        var prevBug = document.createElement('span');
        prevBug.setAttribute('class', 'arrow left-arrow');
        prevBug.addEventListener('click', function () {
          var event = currentEvents[prevBugEvent];
          that.setCurrentBugEvent(event, prevBugEvent);
        });
        element.appendChild(prevBug);
      }

      var msg = document.createElement('span');
      msg.innerHTML = that.escapeHTML(event.message)
        .replace(/(?:\r\n|\r|\n)/g, '<br>');

      element.appendChild(msg);

      var nextBugEvent = step + 1;
      if (nextBugEvent < currentEvents.length) {
        var nextBug = document.createElement('span');
        nextBug.setAttribute('class', 'arrow right-arrow');
        nextBug.addEventListener('click', function () {
          var event = currentEvents[nextBugEvent];
          that.setCurrentBugEvent(event, nextBugEvent);
        });
        element.appendChild(nextBug);
      }


      that._lineWidgets.push(that._codeMirror.addLineWidget(
        event.location.line - 1, element));
    });
  },

  jumpTo : function (line, column) {
    var that = this;

    setTimeout(function () {
      var selPosPixel
        = that._codeMirror.charCoords({ line : line, ch : column }, 'local');
      var editorSize = {
        width  : that._editor.clientWidth,
        height : that._editor.clientHeight
      };

      that._codeMirror.scrollIntoView({
        top    : selPosPixel.top - 100,
        bottom : selPosPixel.top + editorSize.height - 150,
        left   : selPosPixel.left < editorSize.width - 100
               ? 0
               : selPosPixel.left - 50,
        right  : selPosPixel.left < editorSize.width - 100
               ? 10
               : selPosPixel.left + editorSize.width - 100
      });
    }, 0);
  }
}


      var data = {"files": {"0": {"id": 0, "path": "/src/drivers/ata/libahci.c", "content": "// SPDX-License-Identifier: GPL-2.0-or-later\n/*\n *  libahci.c - Common AHCI SATA low-level routines\n *\n *  Maintained by:  Tejun Heo <tj@kernel.org>\n *    \t\t    Please ALWAYS copy linux-ide@vger.kernel.org\n *\t\t    on emails.\n *\n *  Copyright 2004-2005 Red Hat, Inc.\n *\n * libata documentation is available via 'make {ps|pdf}docs',\n * as Documentation/driver-api/libata.rst\n *\n * AHCI hardware documentation:\n * http://www.intel.com/technology/serialata/pdf/rev1_0.pdf\n * http://www.intel.com/technology/serialata/pdf/rev1_1.pdf\n */\n\n#include <linux/kernel.h>\n#include <linux/gfp.h>\n#include <linux/module.h>\n#include <linux/nospec.h>\n#include <linux/blkdev.h>\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n#include <linux/dma-mapping.h>\n#include <linux/device.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_cmnd.h>\n#include <linux/libata.h>\n#include <linux/pci.h>\n#include \"ahci.h\"\n#include \"libata.h\"\n\nstatic int ahci_skip_host_reset;\nint ahci_ignore_sss;\nEXPORT_SYMBOL_GPL(ahci_ignore_sss);\n\nmodule_param_named(skip_host_reset, ahci_skip_host_reset, int, 0444);\nMODULE_PARM_DESC(skip_host_reset, \"skip global host reset (0=don't skip, 1=skip)\");\n\nmodule_param_named(ignore_sss, ahci_ignore_sss, int, 0444);\nMODULE_PARM_DESC(ignore_sss, \"Ignore staggered spinup flag (0=don't ignore, 1=ignore)\");\n\nstatic int ahci_set_lpm(struct ata_link *link, enum ata_lpm_policy policy,\n\t\t\tunsigned hints);\nstatic ssize_t ahci_led_show(struct ata_port *ap, char *buf);\nstatic ssize_t ahci_led_store(struct ata_port *ap, const char *buf,\n\t\t\t      size_t size);\nstatic ssize_t ahci_transmit_led_message(struct ata_port *ap, u32 state,\n\t\t\t\t\tssize_t size);\n\n\n\nstatic int ahci_scr_read(struct ata_link *link, unsigned int sc_reg, u32 *val);\nstatic int ahci_scr_write(struct ata_link *link, unsigned int sc_reg, u32 val);\nstatic bool ahci_qc_fill_rtf(struct ata_queued_cmd *qc);\nstatic int ahci_port_start(struct ata_port *ap);\nstatic void ahci_port_stop(struct ata_port *ap);\nstatic enum ata_completion_errors ahci_qc_prep(struct ata_queued_cmd *qc);\nstatic int ahci_pmp_qc_defer(struct ata_queued_cmd *qc);\nstatic void ahci_freeze(struct ata_port *ap);\nstatic void ahci_thaw(struct ata_port *ap);\nstatic void ahci_set_aggressive_devslp(struct ata_port *ap, bool sleep);\nstatic void ahci_enable_fbs(struct ata_port *ap);\nstatic void ahci_disable_fbs(struct ata_port *ap);\nstatic void ahci_pmp_attach(struct ata_port *ap);\nstatic void ahci_pmp_detach(struct ata_port *ap);\nstatic int ahci_softreset(struct ata_link *link, unsigned int *class,\n\t\t\t  unsigned long deadline);\nstatic int ahci_pmp_retry_softreset(struct ata_link *link, unsigned int *class,\n\t\t\t  unsigned long deadline);\nstatic int ahci_hardreset(struct ata_link *link, unsigned int *class,\n\t\t\t  unsigned long deadline);\nstatic void ahci_postreset(struct ata_link *link, unsigned int *class);\nstatic void ahci_post_internal_cmd(struct ata_queued_cmd *qc);\nstatic void ahci_dev_config(struct ata_device *dev);\n#ifdef CONFIG_PM\nstatic int ahci_port_suspend(struct ata_port *ap, pm_message_t mesg);\n#endif\nstatic ssize_t ahci_activity_show(struct ata_device *dev, char *buf);\nstatic ssize_t ahci_activity_store(struct ata_device *dev,\n\t\t\t\t   enum sw_activity val);\nstatic void ahci_init_sw_activity(struct ata_link *link);\n\nstatic ssize_t ahci_show_host_caps(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf);\nstatic ssize_t ahci_show_host_cap2(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf);\nstatic ssize_t ahci_show_host_version(struct device *dev,\n\t\t\t\t      struct device_attribute *attr, char *buf);\nstatic ssize_t ahci_show_port_cmd(struct device *dev,\n\t\t\t\t  struct device_attribute *attr, char *buf);\nstatic ssize_t ahci_read_em_buffer(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf);\nstatic ssize_t ahci_store_em_buffer(struct device *dev,\n\t\t\t\t    struct device_attribute *attr,\n\t\t\t\t    const char *buf, size_t size);\nstatic ssize_t ahci_show_em_supported(struct device *dev,\n\t\t\t\t      struct device_attribute *attr, char *buf);\nstatic irqreturn_t ahci_single_level_irq_intr(int irq, void *dev_instance);\n\nstatic DEVICE_ATTR(ahci_host_caps, S_IRUGO, ahci_show_host_caps, NULL);\nstatic DEVICE_ATTR(ahci_host_cap2, S_IRUGO, ahci_show_host_cap2, NULL);\nstatic DEVICE_ATTR(ahci_host_version, S_IRUGO, ahci_show_host_version, NULL);\nstatic DEVICE_ATTR(ahci_port_cmd, S_IRUGO, ahci_show_port_cmd, NULL);\nstatic DEVICE_ATTR(em_buffer, S_IWUSR | S_IRUGO,\n\t\t   ahci_read_em_buffer, ahci_store_em_buffer);\nstatic DEVICE_ATTR(em_message_supported, S_IRUGO, ahci_show_em_supported, NULL);\n\nstruct device_attribute *ahci_shost_attrs[] = {\n\t&dev_attr_link_power_management_policy,\n\t&dev_attr_em_message_type,\n\t&dev_attr_em_message,\n\t&dev_attr_ahci_host_caps,\n\t&dev_attr_ahci_host_cap2,\n\t&dev_attr_ahci_host_version,\n\t&dev_attr_ahci_port_cmd,\n\t&dev_attr_em_buffer,\n\t&dev_attr_em_message_supported,\n\tNULL\n};\nEXPORT_SYMBOL_GPL(ahci_shost_attrs);\n\nstruct device_attribute *ahci_sdev_attrs[] = {\n\t&dev_attr_sw_activity,\n\t&dev_attr_unload_heads,\n\t&dev_attr_ncq_prio_enable,\n\tNULL\n};\nEXPORT_SYMBOL_GPL(ahci_sdev_attrs);\n\nstruct ata_port_operations ahci_ops = {\n\t.inherits\t\t= &sata_pmp_port_ops,\n\n\t.qc_defer\t\t= ahci_pmp_qc_defer,\n\t.qc_prep\t\t= ahci_qc_prep,\n\t.qc_issue\t\t= ahci_qc_issue,\n\t.qc_fill_rtf\t\t= ahci_qc_fill_rtf,\n\n\t.freeze\t\t\t= ahci_freeze,\n\t.thaw\t\t\t= ahci_thaw,\n\t.softreset\t\t= ahci_softreset,\n\t.hardreset\t\t= ahci_hardreset,\n\t.postreset\t\t= ahci_postreset,\n\t.pmp_softreset\t\t= ahci_softreset,\n\t.error_handler\t\t= ahci_error_handler,\n\t.post_internal_cmd\t= ahci_post_internal_cmd,\n\t.dev_config\t\t= ahci_dev_config,\n\n\t.scr_read\t\t= ahci_scr_read,\n\t.scr_write\t\t= ahci_scr_write,\n\t.pmp_attach\t\t= ahci_pmp_attach,\n\t.pmp_detach\t\t= ahci_pmp_detach,\n\n\t.set_lpm\t\t= ahci_set_lpm,\n\t.em_show\t\t= ahci_led_show,\n\t.em_store\t\t= ahci_led_store,\n\t.sw_activity_show\t= ahci_activity_show,\n\t.sw_activity_store\t= ahci_activity_store,\n\t.transmit_led_message\t= ahci_transmit_led_message,\n#ifdef CONFIG_PM\n\t.port_suspend\t\t= ahci_port_suspend,\n\t.port_resume\t\t= ahci_port_resume,\n#endif\n\t.port_start\t\t= ahci_port_start,\n\t.port_stop\t\t= ahci_port_stop,\n};\nEXPORT_SYMBOL_GPL(ahci_ops);\n\nstruct ata_port_operations ahci_pmp_retry_srst_ops = {\n\t.inherits\t\t= &ahci_ops,\n\t.softreset\t\t= ahci_pmp_retry_softreset,\n};\nEXPORT_SYMBOL_GPL(ahci_pmp_retry_srst_ops);\n\nstatic bool ahci_em_messages __read_mostly = true;\nmodule_param(ahci_em_messages, bool, 0444);\n/* add other LED protocol types when they become supported */\nMODULE_PARM_DESC(ahci_em_messages,\n\t\"AHCI Enclosure Management Message control (0 = off, 1 = on)\");\n\n/* device sleep idle timeout in ms */\nstatic int devslp_idle_timeout __read_mostly = 1000;\nmodule_param(devslp_idle_timeout, int, 0644);\nMODULE_PARM_DESC(devslp_idle_timeout, \"device sleep idle timeout\");\n\nstatic void ahci_enable_ahci(void __iomem *mmio)\n{\n\tint i;\n\tu32 tmp;\n\n\t/* turn on AHCI_EN */\n\ttmp = readl(mmio + HOST_CTL);\n\tif (tmp & HOST_AHCI_EN)\n\t\treturn;\n\n\t/* Some controllers need AHCI_EN to be written multiple times.\n\t * Try a few times before giving up.\n\t */\n\tfor (i = 0; i < 5; i++) {\n\t\ttmp |= HOST_AHCI_EN;\n\t\twritel(tmp, mmio + HOST_CTL);\n\t\ttmp = readl(mmio + HOST_CTL);\t/* flush && sanity check */\n\t\tif (tmp & HOST_AHCI_EN)\n\t\t\treturn;\n\t\tmsleep(10);\n\t}\n\n\tWARN_ON(1);\n}\n\n/**\n *\tahci_rpm_get_port - Make sure the port is powered on\n *\t@ap: Port to power on\n *\n *\tWhenever there is need to access the AHCI host registers outside of\n *\tnormal execution paths, call this function to make sure the host is\n *\tactually powered on.\n */\nstatic int ahci_rpm_get_port(struct ata_port *ap)\n{\n\treturn pm_runtime_get_sync(ap->dev);\n}\n\n/**\n *\tahci_rpm_put_port - Undoes ahci_rpm_get_port()\n *\t@ap: Port to power down\n *\n *\tUndoes ahci_rpm_get_port() and possibly powers down the AHCI host\n *\tif it has no more active users.\n */\nstatic void ahci_rpm_put_port(struct ata_port *ap)\n{\n\tpm_runtime_put(ap->dev);\n}\n\nstatic ssize_t ahci_show_host_caps(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\treturn sprintf(buf, \"%x\\n\", hpriv->cap);\n}\n\nstatic ssize_t ahci_show_host_cap2(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\treturn sprintf(buf, \"%x\\n\", hpriv->cap2);\n}\n\nstatic ssize_t ahci_show_host_version(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\treturn sprintf(buf, \"%x\\n\", hpriv->version);\n}\n\nstatic ssize_t ahci_show_port_cmd(struct device *dev,\n\t\t\t\t  struct device_attribute *attr, char *buf)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tssize_t ret;\n\n\tahci_rpm_get_port(ap);\n\tret = sprintf(buf, \"%x\\n\", readl(port_mmio + PORT_CMD));\n\tahci_rpm_put_port(ap);\n\n\treturn ret;\n}\n\nstatic ssize_t ahci_read_em_buffer(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tvoid __iomem *em_mmio = mmio + hpriv->em_loc;\n\tu32 em_ctl, msg;\n\tunsigned long flags;\n\tsize_t count;\n\tint i;\n\n\tahci_rpm_get_port(ap);\n\tspin_lock_irqsave(ap->lock, flags);\n\n\tem_ctl = readl(mmio + HOST_EM_CTL);\n\tif (!(ap->flags & ATA_FLAG_EM) || em_ctl & EM_CTL_XMT ||\n\t    !(hpriv->em_msg_type & EM_MSG_TYPE_SGPIO)) {\n\t\tspin_unlock_irqrestore(ap->lock, flags);\n\t\tahci_rpm_put_port(ap);\n\t\treturn -EINVAL;\n\t}\n\n\tif (!(em_ctl & EM_CTL_MR)) {\n\t\tspin_unlock_irqrestore(ap->lock, flags);\n\t\tahci_rpm_put_port(ap);\n\t\treturn -EAGAIN;\n\t}\n\n\tif (!(em_ctl & EM_CTL_SMB))\n\t\tem_mmio += hpriv->em_buf_sz;\n\n\tcount = hpriv->em_buf_sz;\n\n\t/* the count should not be larger than PAGE_SIZE */\n\tif (count > PAGE_SIZE) {\n\t\tif (printk_ratelimit())\n\t\t\tata_port_warn(ap,\n\t\t\t\t      \"EM read buffer size too large: \"\n\t\t\t\t      \"buffer size %u, page size %lu\\n\",\n\t\t\t\t      hpriv->em_buf_sz, PAGE_SIZE);\n\t\tcount = PAGE_SIZE;\n\t}\n\n\tfor (i = 0; i < count; i += 4) {\n\t\tmsg = readl(em_mmio + i);\n\t\tbuf[i] = msg & 0xff;\n\t\tbuf[i + 1] = (msg >> 8) & 0xff;\n\t\tbuf[i + 2] = (msg >> 16) & 0xff;\n\t\tbuf[i + 3] = (msg >> 24) & 0xff;\n\t}\n\n\tspin_unlock_irqrestore(ap->lock, flags);\n\tahci_rpm_put_port(ap);\n\n\treturn i;\n}\n\nstatic ssize_t ahci_store_em_buffer(struct device *dev,\n\t\t\t\t    struct device_attribute *attr,\n\t\t\t\t    const char *buf, size_t size)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tvoid __iomem *em_mmio = mmio + hpriv->em_loc;\n\tconst unsigned char *msg_buf = buf;\n\tu32 em_ctl, msg;\n\tunsigned long flags;\n\tint i;\n\n\t/* check size validity */\n\tif (!(ap->flags & ATA_FLAG_EM) ||\n\t    !(hpriv->em_msg_type & EM_MSG_TYPE_SGPIO) ||\n\t    size % 4 || size > hpriv->em_buf_sz)\n\t\treturn -EINVAL;\n\n\tahci_rpm_get_port(ap);\n\tspin_lock_irqsave(ap->lock, flags);\n\n\tem_ctl = readl(mmio + HOST_EM_CTL);\n\tif (em_ctl & EM_CTL_TM) {\n\t\tspin_unlock_irqrestore(ap->lock, flags);\n\t\tahci_rpm_put_port(ap);\n\t\treturn -EBUSY;\n\t}\n\n\tfor (i = 0; i < size; i += 4) {\n\t\tmsg = msg_buf[i] | msg_buf[i + 1] << 8 |\n\t\t      msg_buf[i + 2] << 16 | msg_buf[i + 3] << 24;\n\t\twritel(msg, em_mmio + i);\n\t}\n\n\twritel(em_ctl | EM_CTL_TM, mmio + HOST_EM_CTL);\n\n\tspin_unlock_irqrestore(ap->lock, flags);\n\tahci_rpm_put_port(ap);\n\n\treturn size;\n}\n\nstatic ssize_t ahci_show_em_supported(struct device *dev,\n\t\t\t\t      struct device_attribute *attr, char *buf)\n{\n\tstruct Scsi_Host *shost = class_to_shost(dev);\n\tstruct ata_port *ap = ata_shost_to_port(shost);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tu32 em_ctl;\n\n\tahci_rpm_get_port(ap);\n\tem_ctl = readl(mmio + HOST_EM_CTL);\n\tahci_rpm_put_port(ap);\n\n\treturn sprintf(buf, \"%s%s%s%s\\n\",\n\t\t       em_ctl & EM_CTL_LED ? \"led \" : \"\",\n\t\t       em_ctl & EM_CTL_SAFTE ? \"saf-te \" : \"\",\n\t\t       em_ctl & EM_CTL_SES ? \"ses-2 \" : \"\",\n\t\t       em_ctl & EM_CTL_SGPIO ? \"sgpio \" : \"\");\n}\n\n/**\n *\tahci_save_initial_config - Save and fixup initial config values\n *\t@dev: target AHCI device\n *\t@hpriv: host private area to store config values\n *\n *\tSome registers containing configuration info might be setup by\n *\tBIOS and might be cleared on reset.  This function saves the\n *\tinitial values of those registers into @hpriv such that they\n *\tcan be restored after controller reset.\n *\n *\tIf inconsistent, config values are fixed up by this function.\n *\n *\tIf it is not set already this function sets hpriv->start_engine to\n *\tahci_start_engine.\n *\n *\tLOCKING:\n *\tNone.\n */\nvoid ahci_save_initial_config(struct device *dev, struct ahci_host_priv *hpriv)\n{\n\tvoid __iomem *mmio = hpriv->mmio;\n\tu32 cap, cap2, vers, port_map;\n\tint i;\n\n\t/* make sure AHCI mode is enabled before accessing CAP */\n\tahci_enable_ahci(mmio);\n\n\t/* Values prefixed with saved_ are written back to host after\n\t * reset.  Values without are used for driver operation.\n\t */\n\thpriv->saved_cap = cap = readl(mmio + HOST_CAP);\n\thpriv->saved_port_map = port_map = readl(mmio + HOST_PORTS_IMPL);\n\n\t/* CAP2 register is only defined for AHCI 1.2 and later */\n\tvers = readl(mmio + HOST_VERSION);\n\tif ((vers >> 16) > 1 ||\n\t   ((vers >> 16) == 1 && (vers & 0xFFFF) >= 0x200))\n\t\thpriv->saved_cap2 = cap2 = readl(mmio + HOST_CAP2);\n\telse\n\t\thpriv->saved_cap2 = cap2 = 0;\n\n\t/* some chips have errata preventing 64bit use */\n\tif ((cap & HOST_CAP_64) && (hpriv->flags & AHCI_HFLAG_32BIT_ONLY)) {\n\t\tdev_info(dev, \"controller can't do 64bit DMA, forcing 32bit\\n\");\n\t\tcap &= ~HOST_CAP_64;\n\t}\n\n\tif ((cap & HOST_CAP_NCQ) && (hpriv->flags & AHCI_HFLAG_NO_NCQ)) {\n\t\tdev_info(dev, \"controller can't do NCQ, turning off CAP_NCQ\\n\");\n\t\tcap &= ~HOST_CAP_NCQ;\n\t}\n\n\tif (!(cap & HOST_CAP_NCQ) && (hpriv->flags & AHCI_HFLAG_YES_NCQ)) {\n\t\tdev_info(dev, \"controller can do NCQ, turning on CAP_NCQ\\n\");\n\t\tcap |= HOST_CAP_NCQ;\n\t}\n\n\tif ((cap & HOST_CAP_PMP) && (hpriv->flags & AHCI_HFLAG_NO_PMP)) {\n\t\tdev_info(dev, \"controller can't do PMP, turning off CAP_PMP\\n\");\n\t\tcap &= ~HOST_CAP_PMP;\n\t}\n\n\tif ((cap & HOST_CAP_SNTF) && (hpriv->flags & AHCI_HFLAG_NO_SNTF)) {\n\t\tdev_info(dev,\n\t\t\t \"controller can't do SNTF, turning off CAP_SNTF\\n\");\n\t\tcap &= ~HOST_CAP_SNTF;\n\t}\n\n\tif ((cap2 & HOST_CAP2_SDS) && (hpriv->flags & AHCI_HFLAG_NO_DEVSLP)) {\n\t\tdev_info(dev,\n\t\t\t \"controller can't do DEVSLP, turning off\\n\");\n\t\tcap2 &= ~HOST_CAP2_SDS;\n\t\tcap2 &= ~HOST_CAP2_SADM;\n\t}\n\n\tif (!(cap & HOST_CAP_FBS) && (hpriv->flags & AHCI_HFLAG_YES_FBS)) {\n\t\tdev_info(dev, \"controller can do FBS, turning on CAP_FBS\\n\");\n\t\tcap |= HOST_CAP_FBS;\n\t}\n\n\tif ((cap & HOST_CAP_FBS) && (hpriv->flags & AHCI_HFLAG_NO_FBS)) {\n\t\tdev_info(dev, \"controller can't do FBS, turning off CAP_FBS\\n\");\n\t\tcap &= ~HOST_CAP_FBS;\n\t}\n\n\tif (!(cap & HOST_CAP_ALPM) && (hpriv->flags & AHCI_HFLAG_YES_ALPM)) {\n\t\tdev_info(dev, \"controller can do ALPM, turning on CAP_ALPM\\n\");\n\t\tcap |= HOST_CAP_ALPM;\n\t}\n\n\tif ((cap & HOST_CAP_SXS) && (hpriv->flags & AHCI_HFLAG_NO_SXS)) {\n\t\tdev_info(dev, \"controller does not support SXS, disabling CAP_SXS\\n\");\n\t\tcap &= ~HOST_CAP_SXS;\n\t}\n\n\tif (hpriv->force_port_map && port_map != hpriv->force_port_map) {\n\t\tdev_info(dev, \"forcing port_map 0x%x -> 0x%x\\n\",\n\t\t\t port_map, hpriv->force_port_map);\n\t\tport_map = hpriv->force_port_map;\n\t\thpriv->saved_port_map = port_map;\n\t}\n\n\tif (hpriv->mask_port_map) {\n\t\tdev_warn(dev, \"masking port_map 0x%x -> 0x%x\\n\",\n\t\t\tport_map,\n\t\t\tport_map & hpriv->mask_port_map);\n\t\tport_map &= hpriv->mask_port_map;\n\t}\n\n\t/* cross check port_map and cap.n_ports */\n\tif (port_map) {\n\t\tint map_ports = 0;\n\n\t\tfor (i = 0; i < AHCI_MAX_PORTS; i++)\n\t\t\tif (port_map & (1 << i))\n\t\t\t\tmap_ports++;\n\n\t\t/* If PI has more ports than n_ports, whine, clear\n\t\t * port_map and let it be generated from n_ports.\n\t\t */\n\t\tif (map_ports > ahci_nr_ports(cap)) {\n\t\t\tdev_warn(dev,\n\t\t\t\t \"implemented port map (0x%x) contains more ports than nr_ports (%u), using nr_ports\\n\",\n\t\t\t\t port_map, ahci_nr_ports(cap));\n\t\t\tport_map = 0;\n\t\t}\n\t}\n\n\t/* fabricate port_map from cap.nr_ports for < AHCI 1.3 */\n\tif (!port_map && vers < 0x10300) {\n\t\tport_map = (1 << ahci_nr_ports(cap)) - 1;\n\t\tdev_warn(dev, \"forcing PORTS_IMPL to 0x%x\\n\", port_map);\n\n\t\t/* write the fixed up value to the PI register */\n\t\thpriv->saved_port_map = port_map;\n\t}\n\n\t/* record values to use during operation */\n\thpriv->cap = cap;\n\thpriv->cap2 = cap2;\n\thpriv->version = readl(mmio + HOST_VERSION);\n\thpriv->port_map = port_map;\n\n\tif (!hpriv->start_engine)\n\t\thpriv->start_engine = ahci_start_engine;\n\n\tif (!hpriv->stop_engine)\n\t\thpriv->stop_engine = ahci_stop_engine;\n\n\tif (!hpriv->irq_handler)\n\t\thpriv->irq_handler = ahci_single_level_irq_intr;\n}\nEXPORT_SYMBOL_GPL(ahci_save_initial_config);\n\n/**\n *\tahci_restore_initial_config - Restore initial config\n *\t@host: target ATA host\n *\n *\tRestore initial config stored by ahci_save_initial_config().\n *\n *\tLOCKING:\n *\tNone.\n */\nstatic void ahci_restore_initial_config(struct ata_host *host)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\n\twritel(hpriv->saved_cap, mmio + HOST_CAP);\n\tif (hpriv->saved_cap2)\n\t\twritel(hpriv->saved_cap2, mmio + HOST_CAP2);\n\twritel(hpriv->saved_port_map, mmio + HOST_PORTS_IMPL);\n\t(void) readl(mmio + HOST_PORTS_IMPL);\t/* flush */\n}\n\nstatic unsigned ahci_scr_offset(struct ata_port *ap, unsigned int sc_reg)\n{\n\tstatic const int offset[] = {\n\t\t[SCR_STATUS]\t\t= PORT_SCR_STAT,\n\t\t[SCR_CONTROL]\t\t= PORT_SCR_CTL,\n\t\t[SCR_ERROR]\t\t= PORT_SCR_ERR,\n\t\t[SCR_ACTIVE]\t\t= PORT_SCR_ACT,\n\t\t[SCR_NOTIFICATION]\t= PORT_SCR_NTF,\n\t};\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\tif (sc_reg < ARRAY_SIZE(offset) &&\n\t    (sc_reg != SCR_NOTIFICATION || (hpriv->cap & HOST_CAP_SNTF)))\n\t\treturn offset[sc_reg];\n\treturn 0;\n}\n\nstatic int ahci_scr_read(struct ata_link *link, unsigned int sc_reg, u32 *val)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(link->ap);\n\tint offset = ahci_scr_offset(link->ap, sc_reg);\n\n\tif (offset) {\n\t\t*val = readl(port_mmio + offset);\n\t\treturn 0;\n\t}\n\treturn -EINVAL;\n}\n\nstatic int ahci_scr_write(struct ata_link *link, unsigned int sc_reg, u32 val)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(link->ap);\n\tint offset = ahci_scr_offset(link->ap, sc_reg);\n\n\tif (offset) {\n\t\twritel(val, port_mmio + offset);\n\t\treturn 0;\n\t}\n\treturn -EINVAL;\n}\n\nvoid ahci_start_engine(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 tmp;\n\n\t/* start DMA */\n\ttmp = readl(port_mmio + PORT_CMD);\n\ttmp |= PORT_CMD_START;\n\twritel(tmp, port_mmio + PORT_CMD);\n\treadl(port_mmio + PORT_CMD); /* flush */\n}\nEXPORT_SYMBOL_GPL(ahci_start_engine);\n\nint ahci_stop_engine(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tu32 tmp;\n\n\t/*\n\t * On some controllers, stopping a port's DMA engine while the port\n\t * is in ALPM state (partial or slumber) results in failures on\n\t * subsequent DMA engine starts.  For those controllers, put the\n\t * port back in active state before stopping its DMA engine.\n\t */\n\tif ((hpriv->flags & AHCI_HFLAG_WAKE_BEFORE_STOP) &&\n\t    (ap->link.lpm_policy > ATA_LPM_MAX_POWER) &&\n\t    ahci_set_lpm(&ap->link, ATA_LPM_MAX_POWER, ATA_LPM_WAKE_ONLY)) {\n\t\tdev_err(ap->host->dev, \"Failed to wake up port before engine stop\\n\");\n\t\treturn -EIO;\n\t}\n\n\ttmp = readl(port_mmio + PORT_CMD);\n\n\t/* check if the HBA is idle */\n\tif ((tmp & (PORT_CMD_START | PORT_CMD_LIST_ON)) == 0)\n\t\treturn 0;\n\n\t/*\n\t * Don't try to issue commands but return with ENODEV if the\n\t * AHCI controller not available anymore (e.g. due to PCIe hot\n\t * unplugging). Otherwise a 500ms delay for each port is added.\n\t */\n\tif (tmp == 0xffffffff) {\n\t\tdev_err(ap->host->dev, \"AHCI controller unavailable!\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\t/* setting HBA to idle */\n\ttmp &= ~PORT_CMD_START;\n\twritel(tmp, port_mmio + PORT_CMD);\n\n\t/* wait for engine to stop. This could be as long as 500 msec */\n\ttmp = ata_wait_register(ap, port_mmio + PORT_CMD,\n\t\t\t\tPORT_CMD_LIST_ON, PORT_CMD_LIST_ON, 1, 500);\n\tif (tmp & PORT_CMD_LIST_ON)\n\t\treturn -EIO;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ahci_stop_engine);\n\nvoid ahci_start_fis_rx(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tu32 tmp;\n\n\t/* set FIS registers */\n\tif (hpriv->cap & HOST_CAP_64)\n\t\twritel((pp->cmd_slot_dma >> 16) >> 16,\n\t\t       port_mmio + PORT_LST_ADDR_HI);\n\twritel(pp->cmd_slot_dma & 0xffffffff, port_mmio + PORT_LST_ADDR);\n\n\tif (hpriv->cap & HOST_CAP_64)\n\t\twritel((pp->rx_fis_dma >> 16) >> 16,\n\t\t       port_mmio + PORT_FIS_ADDR_HI);\n\twritel(pp->rx_fis_dma & 0xffffffff, port_mmio + PORT_FIS_ADDR);\n\n\t/* enable FIS reception */\n\ttmp = readl(port_mmio + PORT_CMD);\n\ttmp |= PORT_CMD_FIS_RX;\n\twritel(tmp, port_mmio + PORT_CMD);\n\n\t/* flush */\n\treadl(port_mmio + PORT_CMD);\n}\nEXPORT_SYMBOL_GPL(ahci_start_fis_rx);\n\nstatic int ahci_stop_fis_rx(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 tmp;\n\n\t/* disable FIS reception */\n\ttmp = readl(port_mmio + PORT_CMD);\n\ttmp &= ~PORT_CMD_FIS_RX;\n\twritel(tmp, port_mmio + PORT_CMD);\n\n\t/* wait for completion, spec says 500ms, give it 1000 */\n\ttmp = ata_wait_register(ap, port_mmio + PORT_CMD, PORT_CMD_FIS_ON,\n\t\t\t\tPORT_CMD_FIS_ON, 10, 1000);\n\tif (tmp & PORT_CMD_FIS_ON)\n\t\treturn -EBUSY;\n\n\treturn 0;\n}\n\nstatic void ahci_power_up(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 cmd;\n\n\tcmd = readl(port_mmio + PORT_CMD) & ~PORT_CMD_ICC_MASK;\n\n\t/* spin up device */\n\tif (hpriv->cap & HOST_CAP_SSS) {\n\t\tcmd |= PORT_CMD_SPIN_UP;\n\t\twritel(cmd, port_mmio + PORT_CMD);\n\t}\n\n\t/* wake up link */\n\twritel(cmd | PORT_CMD_ICC_ACTIVE, port_mmio + PORT_CMD);\n}\n\nstatic int ahci_set_lpm(struct ata_link *link, enum ata_lpm_policy policy,\n\t\t\tunsigned int hints)\n{\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\n\tif (policy != ATA_LPM_MAX_POWER) {\n\t\t/* wakeup flag only applies to the max power policy */\n\t\thints &= ~ATA_LPM_WAKE_ONLY;\n\n\t\t/*\n\t\t * Disable interrupts on Phy Ready. This keeps us from\n\t\t * getting woken up due to spurious phy ready\n\t\t * interrupts.\n\t\t */\n\t\tpp->intr_mask &= ~PORT_IRQ_PHYRDY;\n\t\twritel(pp->intr_mask, port_mmio + PORT_IRQ_MASK);\n\n\t\tsata_link_scr_lpm(link, policy, false);\n\t}\n\n\tif (hpriv->cap & HOST_CAP_ALPM) {\n\t\tu32 cmd = readl(port_mmio + PORT_CMD);\n\n\t\tif (policy == ATA_LPM_MAX_POWER || !(hints & ATA_LPM_HIPM)) {\n\t\t\tif (!(hints & ATA_LPM_WAKE_ONLY))\n\t\t\t\tcmd &= ~(PORT_CMD_ASP | PORT_CMD_ALPE);\n\t\t\tcmd |= PORT_CMD_ICC_ACTIVE;\n\n\t\t\twritel(cmd, port_mmio + PORT_CMD);\n\t\t\treadl(port_mmio + PORT_CMD);\n\n\t\t\t/* wait 10ms to be sure we've come out of LPM state */\n\t\t\tata_msleep(ap, 10);\n\n\t\t\tif (hints & ATA_LPM_WAKE_ONLY)\n\t\t\t\treturn 0;\n\t\t} else {\n\t\t\tcmd |= PORT_CMD_ALPE;\n\t\t\tif (policy == ATA_LPM_MIN_POWER)\n\t\t\t\tcmd |= PORT_CMD_ASP;\n\t\t\telse if (policy == ATA_LPM_MIN_POWER_WITH_PARTIAL)\n\t\t\t\tcmd &= ~PORT_CMD_ASP;\n\n\t\t\t/* write out new cmd value */\n\t\t\twritel(cmd, port_mmio + PORT_CMD);\n\t\t}\n\t}\n\n\t/* set aggressive device sleep */\n\tif ((hpriv->cap2 & HOST_CAP2_SDS) &&\n\t    (hpriv->cap2 & HOST_CAP2_SADM) &&\n\t    (link->device->flags & ATA_DFLAG_DEVSLP)) {\n\t\tif (policy == ATA_LPM_MIN_POWER ||\n\t\t    policy == ATA_LPM_MIN_POWER_WITH_PARTIAL)\n\t\t\tahci_set_aggressive_devslp(ap, true);\n\t\telse\n\t\t\tahci_set_aggressive_devslp(ap, false);\n\t}\n\n\tif (policy == ATA_LPM_MAX_POWER) {\n\t\tsata_link_scr_lpm(link, policy, false);\n\n\t\t/* turn PHYRDY IRQ back on */\n\t\tpp->intr_mask |= PORT_IRQ_PHYRDY;\n\t\twritel(pp->intr_mask, port_mmio + PORT_IRQ_MASK);\n\t}\n\n\treturn 0;\n}\n\n#ifdef CONFIG_PM\nstatic void ahci_power_down(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 cmd, scontrol;\n\n\tif (!(hpriv->cap & HOST_CAP_SSS))\n\t\treturn;\n\n\t/* put device into listen mode, first set PxSCTL.DET to 0 */\n\tscontrol = readl(port_mmio + PORT_SCR_CTL);\n\tscontrol &= ~0xf;\n\twritel(scontrol, port_mmio + PORT_SCR_CTL);\n\n\t/* then set PxCMD.SUD to 0 */\n\tcmd = readl(port_mmio + PORT_CMD) & ~PORT_CMD_ICC_MASK;\n\tcmd &= ~PORT_CMD_SPIN_UP;\n\twritel(cmd, port_mmio + PORT_CMD);\n}\n#endif\n\nstatic void ahci_start_port(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ata_link *link;\n\tstruct ahci_em_priv *emp;\n\tssize_t rc;\n\tint i;\n\n\t/* enable FIS reception */\n\tahci_start_fis_rx(ap);\n\n\t/* enable DMA */\n\tif (!(hpriv->flags & AHCI_HFLAG_DELAY_ENGINE))\n\t\thpriv->start_engine(ap);\n\n\t/* turn on LEDs */\n\tif (ap->flags & ATA_FLAG_EM) {\n\t\tata_for_each_link(link, ap, EDGE) {\n\t\t\temp = &pp->em_priv[link->pmp];\n\n\t\t\t/* EM Transmit bit maybe busy during init */\n\t\t\tfor (i = 0; i < EM_MAX_RETRY; i++) {\n\t\t\t\trc = ap->ops->transmit_led_message(ap,\n\t\t\t\t\t\t\t       emp->led_state,\n\t\t\t\t\t\t\t       4);\n\t\t\t\t/*\n\t\t\t\t * If busy, give a breather but do not\n\t\t\t\t * release EH ownership by using msleep()\n\t\t\t\t * instead of ata_msleep().  EM Transmit\n\t\t\t\t * bit is busy for the whole host and\n\t\t\t\t * releasing ownership will cause other\n\t\t\t\t * ports to fail the same way.\n\t\t\t\t */\n\t\t\t\tif (rc == -EBUSY)\n\t\t\t\t\tmsleep(1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (ap->flags & ATA_FLAG_SW_ACTIVITY)\n\t\tata_for_each_link(link, ap, EDGE)\n\t\t\tahci_init_sw_activity(link);\n\n}\n\nstatic int ahci_deinit_port(struct ata_port *ap, const char **emsg)\n{\n\tint rc;\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\t/* disable DMA */\n\trc = hpriv->stop_engine(ap);\n\tif (rc) {\n\t\t*emsg = \"failed to stop engine\";\n\t\treturn rc;\n\t}\n\n\t/* disable FIS reception */\n\trc = ahci_stop_fis_rx(ap);\n\tif (rc) {\n\t\t*emsg = \"failed stop FIS RX\";\n\t\treturn rc;\n\t}\n\n\treturn 0;\n}\n\nint ahci_reset_controller(struct ata_host *host)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tu32 tmp;\n\n\t/* we must be in AHCI mode, before using anything\n\t * AHCI-specific, such as HOST_RESET.\n\t */\n\tahci_enable_ahci(mmio);\n\n\t/* global controller reset */\n\tif (!ahci_skip_host_reset) {\n\t\ttmp = readl(mmio + HOST_CTL);\n\t\tif ((tmp & HOST_RESET) == 0) {\n\t\t\twritel(tmp | HOST_RESET, mmio + HOST_CTL);\n\t\t\treadl(mmio + HOST_CTL); /* flush */\n\t\t}\n\n\t\t/*\n\t\t * to perform host reset, OS should set HOST_RESET\n\t\t * and poll until this bit is read to be \"0\".\n\t\t * reset must complete within 1 second, or\n\t\t * the hardware should be considered fried.\n\t\t */\n\t\ttmp = ata_wait_register(NULL, mmio + HOST_CTL, HOST_RESET,\n\t\t\t\t\tHOST_RESET, 10, 1000);\n\n\t\tif (tmp & HOST_RESET) {\n\t\t\tdev_err(host->dev, \"controller reset failed (0x%x)\\n\",\n\t\t\t\ttmp);\n\t\t\treturn -EIO;\n\t\t}\n\n\t\t/* turn on AHCI mode */\n\t\tahci_enable_ahci(mmio);\n\n\t\t/* Some registers might be cleared on reset.  Restore\n\t\t * initial values.\n\t\t */\n\t\tif (!(hpriv->flags & AHCI_HFLAG_NO_WRITE_TO_RO))\n\t\t\tahci_restore_initial_config(host);\n\t} else\n\t\tdev_info(host->dev, \"skipping global host reset\\n\");\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ahci_reset_controller);\n\nstatic void ahci_sw_activity(struct ata_link *link)\n{\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_em_priv *emp = &pp->em_priv[link->pmp];\n\n\tif (!(link->flags & ATA_LFLAG_SW_ACTIVITY))\n\t\treturn;\n\n\temp->activity++;\n\tif (!timer_pending(&emp->timer))\n\t\tmod_timer(&emp->timer, jiffies + msecs_to_jiffies(10));\n}\n\nstatic void ahci_sw_activity_blink(struct timer_list *t)\n{\n\tstruct ahci_em_priv *emp = from_timer(emp, t, timer);\n\tstruct ata_link *link = emp->link;\n\tstruct ata_port *ap = link->ap;\n\n\tunsigned long led_message = emp->led_state;\n\tu32 activity_led_state;\n\tunsigned long flags;\n\n\tled_message &= EM_MSG_LED_VALUE;\n\tled_message |= ap->port_no | (link->pmp << 8);\n\n\t/* check to see if we've had activity.  If so,\n\t * toggle state of LED and reset timer.  If not,\n\t * turn LED to desired idle state.\n\t */\n\tspin_lock_irqsave(ap->lock, flags);\n\tif (emp->saved_activity != emp->activity) {\n\t\temp->saved_activity = emp->activity;\n\t\t/* get the current LED state */\n\t\tactivity_led_state = led_message & EM_MSG_LED_VALUE_ON;\n\n\t\tif (activity_led_state)\n\t\t\tactivity_led_state = 0;\n\t\telse\n\t\t\tactivity_led_state = 1;\n\n\t\t/* clear old state */\n\t\tled_message &= ~EM_MSG_LED_VALUE_ACTIVITY;\n\n\t\t/* toggle state */\n\t\tled_message |= (activity_led_state << 16);\n\t\tmod_timer(&emp->timer, jiffies + msecs_to_jiffies(100));\n\t} else {\n\t\t/* switch to idle */\n\t\tled_message &= ~EM_MSG_LED_VALUE_ACTIVITY;\n\t\tif (emp->blink_policy == BLINK_OFF)\n\t\t\tled_message |= (1 << 16);\n\t}\n\tspin_unlock_irqrestore(ap->lock, flags);\n\tap->ops->transmit_led_message(ap, led_message, 4);\n}\n\nstatic void ahci_init_sw_activity(struct ata_link *link)\n{\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_em_priv *emp = &pp->em_priv[link->pmp];\n\n\t/* init activity stats, setup timer */\n\temp->saved_activity = emp->activity = 0;\n\temp->link = link;\n\ttimer_setup(&emp->timer, ahci_sw_activity_blink, 0);\n\n\t/* check our blink policy and set flag for link if it's enabled */\n\tif (emp->blink_policy)\n\t\tlink->flags |= ATA_LFLAG_SW_ACTIVITY;\n}\n\nint ahci_reset_em(struct ata_host *host)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tu32 em_ctl;\n\n\tem_ctl = readl(mmio + HOST_EM_CTL);\n\tif ((em_ctl & EM_CTL_TM) || (em_ctl & EM_CTL_RST))\n\t\treturn -EINVAL;\n\n\twritel(em_ctl | EM_CTL_RST, mmio + HOST_EM_CTL);\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ahci_reset_em);\n\nstatic ssize_t ahci_transmit_led_message(struct ata_port *ap, u32 state,\n\t\t\t\t\tssize_t size)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tu32 em_ctl;\n\tu32 message[] = {0, 0};\n\tunsigned long flags;\n\tint pmp;\n\tstruct ahci_em_priv *emp;\n\n\t/* get the slot number from the message */\n\tpmp = (state & EM_MSG_LED_PMP_SLOT) >> 8;\n\tif (pmp < EM_MAX_SLOTS)\n\t\temp = &pp->em_priv[pmp];\n\telse\n\t\treturn -EINVAL;\n\n\tahci_rpm_get_port(ap);\n\tspin_lock_irqsave(ap->lock, flags);\n\n\t/*\n\t * if we are still busy transmitting a previous message,\n\t * do not allow\n\t */\n\tem_ctl = readl(mmio + HOST_EM_CTL);\n\tif (em_ctl & EM_CTL_TM) {\n\t\tspin_unlock_irqrestore(ap->lock, flags);\n\t\tahci_rpm_put_port(ap);\n\t\treturn -EBUSY;\n\t}\n\n\tif (hpriv->em_msg_type & EM_MSG_TYPE_LED) {\n\t\t/*\n\t\t * create message header - this is all zero except for\n\t\t * the message size, which is 4 bytes.\n\t\t */\n\t\tmessage[0] |= (4 << 8);\n\n\t\t/* ignore 0:4 of byte zero, fill in port info yourself */\n\t\tmessage[1] = ((state & ~EM_MSG_LED_HBA_PORT) | ap->port_no);\n\n\t\t/* write message to EM_LOC */\n\t\twritel(message[0], mmio + hpriv->em_loc);\n\t\twritel(message[1], mmio + hpriv->em_loc+4);\n\n\t\t/*\n\t\t * tell hardware to transmit the message\n\t\t */\n\t\twritel(em_ctl | EM_CTL_TM, mmio + HOST_EM_CTL);\n\t}\n\n\t/* save off new led state for port/slot */\n\temp->led_state = state;\n\n\tspin_unlock_irqrestore(ap->lock, flags);\n\tahci_rpm_put_port(ap);\n\n\treturn size;\n}\n\nstatic ssize_t ahci_led_show(struct ata_port *ap, char *buf)\n{\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ata_link *link;\n\tstruct ahci_em_priv *emp;\n\tint rc = 0;\n\n\tata_for_each_link(link, ap, EDGE) {\n\t\temp = &pp->em_priv[link->pmp];\n\t\trc += sprintf(buf, \"%lx\\n\", emp->led_state);\n\t}\n\treturn rc;\n}\n\nstatic ssize_t ahci_led_store(struct ata_port *ap, const char *buf,\n\t\t\t\tsize_t size)\n{\n\tunsigned int state;\n\tint pmp;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_em_priv *emp;\n\n\tif (kstrtouint(buf, 0, &state) < 0)\n\t\treturn -EINVAL;\n\n\t/* get the slot number from the message */\n\tpmp = (state & EM_MSG_LED_PMP_SLOT) >> 8;\n\tif (pmp < EM_MAX_SLOTS) {\n\t\tpmp = array_index_nospec(pmp, EM_MAX_SLOTS);\n\t\temp = &pp->em_priv[pmp];\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\t/* mask off the activity bits if we are in sw_activity\n\t * mode, user should turn off sw_activity before setting\n\t * activity led through em_message\n\t */\n\tif (emp->blink_policy)\n\t\tstate &= ~EM_MSG_LED_VALUE_ACTIVITY;\n\n\treturn ap->ops->transmit_led_message(ap, state, size);\n}\n\nstatic ssize_t ahci_activity_store(struct ata_device *dev, enum sw_activity val)\n{\n\tstruct ata_link *link = dev->link;\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_em_priv *emp = &pp->em_priv[link->pmp];\n\tu32 port_led_state = emp->led_state;\n\n\t/* save the desired Activity LED behavior */\n\tif (val == OFF) {\n\t\t/* clear LFLAG */\n\t\tlink->flags &= ~(ATA_LFLAG_SW_ACTIVITY);\n\n\t\t/* set the LED to OFF */\n\t\tport_led_state &= EM_MSG_LED_VALUE_OFF;\n\t\tport_led_state |= (ap->port_no | (link->pmp << 8));\n\t\tap->ops->transmit_led_message(ap, port_led_state, 4);\n\t} else {\n\t\tlink->flags |= ATA_LFLAG_SW_ACTIVITY;\n\t\tif (val == BLINK_OFF) {\n\t\t\t/* set LED to ON for idle */\n\t\t\tport_led_state &= EM_MSG_LED_VALUE_OFF;\n\t\t\tport_led_state |= (ap->port_no | (link->pmp << 8));\n\t\t\tport_led_state |= EM_MSG_LED_VALUE_ON; /* check this */\n\t\t\tap->ops->transmit_led_message(ap, port_led_state, 4);\n\t\t}\n\t}\n\temp->blink_policy = val;\n\treturn 0;\n}\n\nstatic ssize_t ahci_activity_show(struct ata_device *dev, char *buf)\n{\n\tstruct ata_link *link = dev->link;\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_em_priv *emp = &pp->em_priv[link->pmp];\n\n\t/* display the saved value of activity behavior for this\n\t * disk.\n\t */\n\treturn sprintf(buf, \"%d\\n\", emp->blink_policy);\n}\n\nstatic void ahci_port_init(struct device *dev, struct ata_port *ap,\n\t\t\t   int port_no, void __iomem *mmio,\n\t\t\t   void __iomem *port_mmio)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tconst char *emsg = NULL;\n\tint rc;\n\tu32 tmp;\n\n\t/* make sure port is not active */\n\trc = ahci_deinit_port(ap, &emsg);\n\tif (rc)\n\t\tdev_warn(dev, \"%s (%d)\\n\", emsg, rc);\n\n\t/* clear SError */\n\ttmp = readl(port_mmio + PORT_SCR_ERR);\n\tVPRINTK(\"PORT_SCR_ERR 0x%x\\n\", tmp);\n\twritel(tmp, port_mmio + PORT_SCR_ERR);\n\n\t/* clear port IRQ */\n\ttmp = readl(port_mmio + PORT_IRQ_STAT);\n\tVPRINTK(\"PORT_IRQ_STAT 0x%x\\n\", tmp);\n\tif (tmp)\n\t\twritel(tmp, port_mmio + PORT_IRQ_STAT);\n\n\twritel(1 << port_no, mmio + HOST_IRQ_STAT);\n\n\t/* mark esata ports */\n\ttmp = readl(port_mmio + PORT_CMD);\n\tif ((tmp & PORT_CMD_ESP) && (hpriv->cap & HOST_CAP_SXS))\n\t\tap->pflags |= ATA_PFLAG_EXTERNAL;\n}\n\nvoid ahci_init_controller(struct ata_host *host)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tint i;\n\tvoid __iomem *port_mmio;\n\tu32 tmp;\n\n\tfor (i = 0; i < host->n_ports; i++) {\n\t\tstruct ata_port *ap = host->ports[i];\n\n\t\tport_mmio = ahci_port_base(ap);\n\t\tif (ata_port_is_dummy(ap))\n\t\t\tcontinue;\n\n\t\tahci_port_init(host->dev, ap, i, mmio, port_mmio);\n\t}\n\n\ttmp = readl(mmio + HOST_CTL);\n\tVPRINTK(\"HOST_CTL 0x%x\\n\", tmp);\n\twritel(tmp | HOST_IRQ_EN, mmio + HOST_CTL);\n\ttmp = readl(mmio + HOST_CTL);\n\tVPRINTK(\"HOST_CTL 0x%x\\n\", tmp);\n}\nEXPORT_SYMBOL_GPL(ahci_init_controller);\n\nstatic void ahci_dev_config(struct ata_device *dev)\n{\n\tstruct ahci_host_priv *hpriv = dev->link->ap->host->private_data;\n\n\tif (hpriv->flags & AHCI_HFLAG_SECT255) {\n\t\tdev->max_sectors = 255;\n\t\tata_dev_info(dev,\n\t\t\t     \"SB600 AHCI: limiting to 255 sectors per cmd\\n\");\n\t}\n}\n\nunsigned int ahci_dev_classify(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ata_taskfile tf;\n\tu32 tmp;\n\n\ttmp = readl(port_mmio + PORT_SIG);\n\ttf.lbah\t\t= (tmp >> 24)\t& 0xff;\n\ttf.lbam\t\t= (tmp >> 16)\t& 0xff;\n\ttf.lbal\t\t= (tmp >> 8)\t& 0xff;\n\ttf.nsect\t= (tmp)\t\t& 0xff;\n\n\treturn ata_dev_classify(&tf);\n}\nEXPORT_SYMBOL_GPL(ahci_dev_classify);\n\nvoid ahci_fill_cmd_slot(struct ahci_port_priv *pp, unsigned int tag,\n\t\t\tu32 opts)\n{\n\tdma_addr_t cmd_tbl_dma;\n\n\tcmd_tbl_dma = pp->cmd_tbl_dma + tag * AHCI_CMD_TBL_SZ;\n\n\tpp->cmd_slot[tag].opts = cpu_to_le32(opts);\n\tpp->cmd_slot[tag].status = 0;\n\tpp->cmd_slot[tag].tbl_addr = cpu_to_le32(cmd_tbl_dma & 0xffffffff);\n\tpp->cmd_slot[tag].tbl_addr_hi = cpu_to_le32((cmd_tbl_dma >> 16) >> 16);\n}\nEXPORT_SYMBOL_GPL(ahci_fill_cmd_slot);\n\nint ahci_kick_engine(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tu8 status = readl(port_mmio + PORT_TFDATA) & 0xFF;\n\tu32 tmp;\n\tint busy, rc;\n\n\t/* stop engine */\n\trc = hpriv->stop_engine(ap);\n\tif (rc)\n\t\tgoto out_restart;\n\n\t/* need to do CLO?\n\t * always do CLO if PMP is attached (AHCI-1.3 9.2)\n\t */\n\tbusy = status & (ATA_BUSY | ATA_DRQ);\n\tif (!busy && !sata_pmp_attached(ap)) {\n\t\trc = 0;\n\t\tgoto out_restart;\n\t}\n\n\tif (!(hpriv->cap & HOST_CAP_CLO)) {\n\t\trc = -EOPNOTSUPP;\n\t\tgoto out_restart;\n\t}\n\n\t/* perform CLO */\n\ttmp = readl(port_mmio + PORT_CMD);\n\ttmp |= PORT_CMD_CLO;\n\twritel(tmp, port_mmio + PORT_CMD);\n\n\trc = 0;\n\ttmp = ata_wait_register(ap, port_mmio + PORT_CMD,\n\t\t\t\tPORT_CMD_CLO, PORT_CMD_CLO, 1, 500);\n\tif (tmp & PORT_CMD_CLO)\n\t\trc = -EIO;\n\n\t/* restart engine */\n out_restart:\n\thpriv->start_engine(ap);\n\treturn rc;\n}\nEXPORT_SYMBOL_GPL(ahci_kick_engine);\n\nstatic int ahci_exec_polled_cmd(struct ata_port *ap, int pmp,\n\t\t\t\tstruct ata_taskfile *tf, int is_cmd, u16 flags,\n\t\t\t\tunsigned long timeout_msec)\n{\n\tconst u32 cmd_fis_len = 5; /* five dwords */\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu8 *fis = pp->cmd_tbl;\n\tu32 tmp;\n\n\t/* prep the command */\n\tata_tf_to_fis(tf, pmp, is_cmd, fis);\n\tahci_fill_cmd_slot(pp, 0, cmd_fis_len | flags | (pmp << 12));\n\n\t/* set port value for softreset of Port Multiplier */\n\tif (pp->fbs_enabled && pp->fbs_last_dev != pmp) {\n\t\ttmp = readl(port_mmio + PORT_FBS);\n\t\ttmp &= ~(PORT_FBS_DEV_MASK | PORT_FBS_DEC);\n\t\ttmp |= pmp << PORT_FBS_DEV_OFFSET;\n\t\twritel(tmp, port_mmio + PORT_FBS);\n\t\tpp->fbs_last_dev = pmp;\n\t}\n\n\t/* issue & wait */\n\twritel(1, port_mmio + PORT_CMD_ISSUE);\n\n\tif (timeout_msec) {\n\t\ttmp = ata_wait_register(ap, port_mmio + PORT_CMD_ISSUE,\n\t\t\t\t\t0x1, 0x1, 1, timeout_msec);\n\t\tif (tmp & 0x1) {\n\t\t\tahci_kick_engine(ap);\n\t\t\treturn -EBUSY;\n\t\t}\n\t} else\n\t\treadl(port_mmio + PORT_CMD_ISSUE);\t/* flush */\n\n\treturn 0;\n}\n\nint ahci_do_softreset(struct ata_link *link, unsigned int *class,\n\t\t      int pmp, unsigned long deadline,\n\t\t      int (*check_ready)(struct ata_link *link))\n{\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tconst char *reason = NULL;\n\tunsigned long now, msecs;\n\tstruct ata_taskfile tf;\n\tbool fbs_disabled = false;\n\tint rc;\n\n\tDPRINTK(\"ENTER\\n\");\n\n\t/* prepare for SRST (AHCI-1.1 10.4.1) */\n\trc = ahci_kick_engine(ap);\n\tif (rc && rc != -EOPNOTSUPP)\n\t\tata_link_warn(link, \"failed to reset engine (errno=%d)\\n\", rc);\n\n\t/*\n\t * According to AHCI-1.2 9.3.9: if FBS is enable, software shall\n\t * clear PxFBS.EN to '0' prior to issuing software reset to devices\n\t * that is attached to port multiplier.\n\t */\n\tif (!ata_is_host_link(link) && pp->fbs_enabled) {\n\t\tahci_disable_fbs(ap);\n\t\tfbs_disabled = true;\n\t}\n\n\tata_tf_init(link->device, &tf);\n\n\t/* issue the first H2D Register FIS */\n\tmsecs = 0;\n\tnow = jiffies;\n\tif (time_after(deadline, now))\n\t\tmsecs = jiffies_to_msecs(deadline - now);\n\n\ttf.ctl |= ATA_SRST;\n\tif (ahci_exec_polled_cmd(ap, pmp, &tf, 0,\n\t\t\t\t AHCI_CMD_RESET | AHCI_CMD_CLR_BUSY, msecs)) {\n\t\trc = -EIO;\n\t\treason = \"1st FIS failed\";\n\t\tgoto fail;\n\t}\n\n\t/* spec says at least 5us, but be generous and sleep for 1ms */\n\tata_msleep(ap, 1);\n\n\t/* issue the second H2D Register FIS */\n\ttf.ctl &= ~ATA_SRST;\n\tahci_exec_polled_cmd(ap, pmp, &tf, 0, 0, 0);\n\n\t/* wait for link to become ready */\n\trc = ata_wait_after_reset(link, deadline, check_ready);\n\tif (rc == -EBUSY && hpriv->flags & AHCI_HFLAG_SRST_TOUT_IS_OFFLINE) {\n\t\t/*\n\t\t * Workaround for cases where link online status can't\n\t\t * be trusted.  Treat device readiness timeout as link\n\t\t * offline.\n\t\t */\n\t\tata_link_info(link, \"device not ready, treating as offline\\n\");\n\t\t*class = ATA_DEV_NONE;\n\t} else if (rc) {\n\t\t/* link occupied, -ENODEV too is an error */\n\t\treason = \"device not ready\";\n\t\tgoto fail;\n\t} else\n\t\t*class = ahci_dev_classify(ap);\n\n\t/* re-enable FBS if disabled before */\n\tif (fbs_disabled)\n\t\tahci_enable_fbs(ap);\n\n\tDPRINTK(\"EXIT, class=%u\\n\", *class);\n\treturn 0;\n\n fail:\n\tata_link_err(link, \"softreset failed (%s)\\n\", reason);\n\treturn rc;\n}\n\nint ahci_check_ready(struct ata_link *link)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(link->ap);\n\tu8 status = readl(port_mmio + PORT_TFDATA) & 0xFF;\n\n\treturn ata_check_ready(status);\n}\nEXPORT_SYMBOL_GPL(ahci_check_ready);\n\nstatic int ahci_softreset(struct ata_link *link, unsigned int *class,\n\t\t\t  unsigned long deadline)\n{\n\tint pmp = sata_srst_pmp(link);\n\n\tDPRINTK(\"ENTER\\n\");\n\n\treturn ahci_do_softreset(link, class, pmp, deadline, ahci_check_ready);\n}\nEXPORT_SYMBOL_GPL(ahci_do_softreset);\n\nstatic int ahci_bad_pmp_check_ready(struct ata_link *link)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(link->ap);\n\tu8 status = readl(port_mmio + PORT_TFDATA) & 0xFF;\n\tu32 irq_status = readl(port_mmio + PORT_IRQ_STAT);\n\n\t/*\n\t * There is no need to check TFDATA if BAD PMP is found due to HW bug,\n\t * which can save timeout delay.\n\t */\n\tif (irq_status & PORT_IRQ_BAD_PMP)\n\t\treturn -EIO;\n\n\treturn ata_check_ready(status);\n}\n\nstatic int ahci_pmp_retry_softreset(struct ata_link *link, unsigned int *class,\n\t\t\t\t    unsigned long deadline)\n{\n\tstruct ata_port *ap = link->ap;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tint pmp = sata_srst_pmp(link);\n\tint rc;\n\tu32 irq_sts;\n\n\tDPRINTK(\"ENTER\\n\");\n\n\trc = ahci_do_softreset(link, class, pmp, deadline,\n\t\t\t       ahci_bad_pmp_check_ready);\n\n\t/*\n\t * Soft reset fails with IPMS set when PMP is enabled but\n\t * SATA HDD/ODD is connected to SATA port, do soft reset\n\t * again to port 0.\n\t */\n\tif (rc == -EIO) {\n\t\tirq_sts = readl(port_mmio + PORT_IRQ_STAT);\n\t\tif (irq_sts & PORT_IRQ_BAD_PMP) {\n\t\t\tata_link_warn(link,\n\t\t\t\t\t\"applying PMP SRST workaround \"\n\t\t\t\t\t\"and retrying\\n\");\n\t\t\trc = ahci_do_softreset(link, class, 0, deadline,\n\t\t\t\t\t       ahci_check_ready);\n\t\t}\n\t}\n\n\treturn rc;\n}\n\nint ahci_do_hardreset(struct ata_link *link, unsigned int *class,\n\t\t      unsigned long deadline, bool *online)\n{\n\tconst unsigned long *timing = sata_ehc_deb_timing(&link->eh_context);\n\tstruct ata_port *ap = link->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tu8 *d2h_fis = pp->rx_fis + RX_FIS_D2H_REG;\n\tstruct ata_taskfile tf;\n\tint rc;\n\n\tDPRINTK(\"ENTER\\n\");\n\n\thpriv->stop_engine(ap);\n\n\t/* clear D2H reception area to properly wait for D2H FIS */\n\tata_tf_init(link->device, &tf);\n\ttf.command = ATA_BUSY;\n\tata_tf_to_fis(&tf, 0, 0, d2h_fis);\n\n\trc = sata_link_hardreset(link, timing, deadline, online,\n\t\t\t\t ahci_check_ready);\n\n\thpriv->start_engine(ap);\n\n\tif (*online)\n\t\t*class = ahci_dev_classify(ap);\n\n\tDPRINTK(\"EXIT, rc=%d, class=%u\\n\", rc, *class);\n\treturn rc;\n}\nEXPORT_SYMBOL_GPL(ahci_do_hardreset);\n\nstatic int ahci_hardreset(struct ata_link *link, unsigned int *class,\n\t\t\t  unsigned long deadline)\n{\n\tbool online;\n\n\treturn ahci_do_hardreset(link, class, deadline, &online);\n}\n\nstatic void ahci_postreset(struct ata_link *link, unsigned int *class)\n{\n\tstruct ata_port *ap = link->ap;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 new_tmp, tmp;\n\n\tata_std_postreset(link, class);\n\n\t/* Make sure port's ATAPI bit is set appropriately */\n\tnew_tmp = tmp = readl(port_mmio + PORT_CMD);\n\tif (*class == ATA_DEV_ATAPI)\n\t\tnew_tmp |= PORT_CMD_ATAPI;\n\telse\n\t\tnew_tmp &= ~PORT_CMD_ATAPI;\n\tif (new_tmp != tmp) {\n\t\twritel(new_tmp, port_mmio + PORT_CMD);\n\t\treadl(port_mmio + PORT_CMD); /* flush */\n\t}\n}\n\nstatic unsigned int ahci_fill_sg(struct ata_queued_cmd *qc, void *cmd_tbl)\n{\n\tstruct scatterlist *sg;\n\tstruct ahci_sg *ahci_sg = cmd_tbl + AHCI_CMD_TBL_HDR_SZ;\n\tunsigned int si;\n\n\tVPRINTK(\"ENTER\\n\");\n\n\t/*\n\t * Next, the S/G list.\n\t */\n\tfor_each_sg(qc->sg, sg, qc->n_elem, si) {\n\t\tdma_addr_t addr = sg_dma_address(sg);\n\t\tu32 sg_len = sg_dma_len(sg);\n\n\t\tahci_sg[si].addr = cpu_to_le32(addr & 0xffffffff);\n\t\tahci_sg[si].addr_hi = cpu_to_le32((addr >> 16) >> 16);\n\t\tahci_sg[si].flags_size = cpu_to_le32(sg_len - 1);\n\t}\n\n\treturn si;\n}\n\nstatic int ahci_pmp_qc_defer(struct ata_queued_cmd *qc)\n{\n\tstruct ata_port *ap = qc->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\n\tif (!sata_pmp_attached(ap) || pp->fbs_enabled)\n\t\treturn ata_std_qc_defer(qc);\n\telse\n\t\treturn sata_pmp_qc_defer_cmd_switch(qc);\n}\n\nstatic enum ata_completion_errors ahci_qc_prep(struct ata_queued_cmd *qc)\n{\n\tstruct ata_port *ap = qc->ap;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tint is_atapi = ata_is_atapi(qc->tf.protocol);\n\tvoid *cmd_tbl;\n\tu32 opts;\n\tconst u32 cmd_fis_len = 5; /* five dwords */\n\tunsigned int n_elem;\n\n\t/*\n\t * Fill in command table information.  First, the header,\n\t * a SATA Register - Host to Device command FIS.\n\t */\n\tcmd_tbl = pp->cmd_tbl + qc->hw_tag * AHCI_CMD_TBL_SZ;\n\n\tata_tf_to_fis(&qc->tf, qc->dev->link->pmp, 1, cmd_tbl);\n\tif (is_atapi) {\n\t\tmemset(cmd_tbl + AHCI_CMD_TBL_CDB, 0, 32);\n\t\tmemcpy(cmd_tbl + AHCI_CMD_TBL_CDB, qc->cdb, qc->dev->cdb_len);\n\t}\n\n\tn_elem = 0;\n\tif (qc->flags & ATA_QCFLAG_DMAMAP)\n\t\tn_elem = ahci_fill_sg(qc, cmd_tbl);\n\n\t/*\n\t * Fill in command slot information.\n\t */\n\topts = cmd_fis_len | n_elem << 16 | (qc->dev->link->pmp << 12);\n\tif (qc->tf.flags & ATA_TFLAG_WRITE)\n\t\topts |= AHCI_CMD_WRITE;\n\tif (is_atapi)\n\t\topts |= AHCI_CMD_ATAPI | AHCI_CMD_PREFETCH;\n\n\tahci_fill_cmd_slot(pp, qc->hw_tag, opts);\n\n\treturn AC_ERR_OK;\n}\n\nstatic void ahci_fbs_dec_intr(struct ata_port *ap)\n{\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 fbs = readl(port_mmio + PORT_FBS);\n\tint retries = 3;\n\n\tDPRINTK(\"ENTER\\n\");\n\tBUG_ON(!pp->fbs_enabled);\n\n\t/* time to wait for DEC is not specified by AHCI spec,\n\t * add a retry loop for safety.\n\t */\n\twritel(fbs | PORT_FBS_DEC, port_mmio + PORT_FBS);\n\tfbs = readl(port_mmio + PORT_FBS);\n\twhile ((fbs & PORT_FBS_DEC) && retries--) {\n\t\tudelay(1);\n\t\tfbs = readl(port_mmio + PORT_FBS);\n\t}\n\n\tif (fbs & PORT_FBS_DEC)\n\t\tdev_err(ap->host->dev, \"failed to clear device error\\n\");\n}\n\nstatic void ahci_error_intr(struct ata_port *ap, u32 irq_stat)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ata_eh_info *host_ehi = &ap->link.eh_info;\n\tstruct ata_link *link = NULL;\n\tstruct ata_queued_cmd *active_qc;\n\tstruct ata_eh_info *active_ehi;\n\tbool fbs_need_dec = false;\n\tu32 serror;\n\n\t/* determine active link with error */\n\tif (pp->fbs_enabled) {\n\t\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\t\tu32 fbs = readl(port_mmio + PORT_FBS);\n\t\tint pmp = fbs >> PORT_FBS_DWE_OFFSET;\n\n\t\tif ((fbs & PORT_FBS_SDE) && (pmp < ap->nr_pmp_links)) {\n\t\t\tlink = &ap->pmp_link[pmp];\n\t\t\tfbs_need_dec = true;\n\t\t}\n\n\t} else\n\t\tata_for_each_link(link, ap, EDGE)\n\t\t\tif (ata_link_active(link))\n\t\t\t\tbreak;\n\n\tif (!link)\n\t\tlink = &ap->link;\n\n\tactive_qc = ata_qc_from_tag(ap, link->active_tag);\n\tactive_ehi = &link->eh_info;\n\n\t/* record irq stat */\n\tata_ehi_clear_desc(host_ehi);\n\tata_ehi_push_desc(host_ehi, \"irq_stat 0x%08x\", irq_stat);\n\n\t/* AHCI needs SError cleared; otherwise, it might lock up */\n\tahci_scr_read(&ap->link, SCR_ERROR, &serror);\n\tahci_scr_write(&ap->link, SCR_ERROR, serror);\n\thost_ehi->serror |= serror;\n\n\t/* some controllers set IRQ_IF_ERR on device errors, ignore it */\n\tif (hpriv->flags & AHCI_HFLAG_IGN_IRQ_IF_ERR)\n\t\tirq_stat &= ~PORT_IRQ_IF_ERR;\n\n\tif (irq_stat & PORT_IRQ_TF_ERR) {\n\t\t/* If qc is active, charge it; otherwise, the active\n\t\t * link.  There's no active qc on NCQ errors.  It will\n\t\t * be determined by EH by reading log page 10h.\n\t\t */\n\t\tif (active_qc)\n\t\t\tactive_qc->err_mask |= AC_ERR_DEV;\n\t\telse\n\t\t\tactive_ehi->err_mask |= AC_ERR_DEV;\n\n\t\tif (hpriv->flags & AHCI_HFLAG_IGN_SERR_INTERNAL)\n\t\t\thost_ehi->serror &= ~SERR_INTERNAL;\n\t}\n\n\tif (irq_stat & PORT_IRQ_UNK_FIS) {\n\t\tu32 *unk = pp->rx_fis + RX_FIS_UNK;\n\n\t\tactive_ehi->err_mask |= AC_ERR_HSM;\n\t\tactive_ehi->action |= ATA_EH_RESET;\n\t\tata_ehi_push_desc(active_ehi,\n\t\t\t\t  \"unknown FIS %08x %08x %08x %08x\" ,\n\t\t\t\t  unk[0], unk[1], unk[2], unk[3]);\n\t}\n\n\tif (sata_pmp_attached(ap) && (irq_stat & PORT_IRQ_BAD_PMP)) {\n\t\tactive_ehi->err_mask |= AC_ERR_HSM;\n\t\tactive_ehi->action |= ATA_EH_RESET;\n\t\tata_ehi_push_desc(active_ehi, \"incorrect PMP\");\n\t}\n\n\tif (irq_stat & (PORT_IRQ_HBUS_ERR | PORT_IRQ_HBUS_DATA_ERR)) {\n\t\thost_ehi->err_mask |= AC_ERR_HOST_BUS;\n\t\thost_ehi->action |= ATA_EH_RESET;\n\t\tata_ehi_push_desc(host_ehi, \"host bus error\");\n\t}\n\n\tif (irq_stat & PORT_IRQ_IF_ERR) {\n\t\tif (fbs_need_dec)\n\t\t\tactive_ehi->err_mask |= AC_ERR_DEV;\n\t\telse {\n\t\t\thost_ehi->err_mask |= AC_ERR_ATA_BUS;\n\t\t\thost_ehi->action |= ATA_EH_RESET;\n\t\t}\n\n\t\tata_ehi_push_desc(host_ehi, \"interface fatal error\");\n\t}\n\n\tif (irq_stat & (PORT_IRQ_CONNECT | PORT_IRQ_PHYRDY)) {\n\t\tata_ehi_hotplugged(host_ehi);\n\t\tata_ehi_push_desc(host_ehi, \"%s\",\n\t\t\tirq_stat & PORT_IRQ_CONNECT ?\n\t\t\t\"connection status changed\" : \"PHY RDY changed\");\n\t}\n\n\t/* okay, let's hand over to EH */\n\n\tif (irq_stat & PORT_IRQ_FREEZE)\n\t\tata_port_freeze(ap);\n\telse if (fbs_need_dec) {\n\t\tata_link_abort(link);\n\t\tahci_fbs_dec_intr(ap);\n\t} else\n\t\tata_port_abort(ap);\n}\n\nstatic void ahci_handle_port_interrupt(struct ata_port *ap,\n\t\t\t\t       void __iomem *port_mmio, u32 status)\n{\n\tstruct ata_eh_info *ehi = &ap->link.eh_info;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tint resetting = !!(ap->pflags & ATA_PFLAG_RESETTING);\n\tu32 qc_active = 0;\n\tint rc;\n\n\t/* ignore BAD_PMP while resetting */\n\tif (unlikely(resetting))\n\t\tstatus &= ~PORT_IRQ_BAD_PMP;\n\n\tif (sata_lpm_ignore_phy_events(&ap->link)) {\n\t\tstatus &= ~PORT_IRQ_PHYRDY;\n\t\tahci_scr_write(&ap->link, SCR_ERROR, SERR_PHYRDY_CHG);\n\t}\n\n\tif (unlikely(status & PORT_IRQ_ERROR)) {\n\t\tahci_error_intr(ap, status);\n\t\treturn;\n\t}\n\n\tif (status & PORT_IRQ_SDB_FIS) {\n\t\t/* If SNotification is available, leave notification\n\t\t * handling to sata_async_notification().  If not,\n\t\t * emulate it by snooping SDB FIS RX area.\n\t\t *\n\t\t * Snooping FIS RX area is probably cheaper than\n\t\t * poking SNotification but some constrollers which\n\t\t * implement SNotification, ICH9 for example, don't\n\t\t * store AN SDB FIS into receive area.\n\t\t */\n\t\tif (hpriv->cap & HOST_CAP_SNTF)\n\t\t\tsata_async_notification(ap);\n\t\telse {\n\t\t\t/* If the 'N' bit in word 0 of the FIS is set,\n\t\t\t * we just received asynchronous notification.\n\t\t\t * Tell libata about it.\n\t\t\t *\n\t\t\t * Lack of SNotification should not appear in\n\t\t\t * ahci 1.2, so the workaround is unnecessary\n\t\t\t * when FBS is enabled.\n\t\t\t */\n\t\t\tif (pp->fbs_enabled)\n\t\t\t\tWARN_ON_ONCE(1);\n\t\t\telse {\n\t\t\t\tconst __le32 *f = pp->rx_fis + RX_FIS_SDB;\n\t\t\t\tu32 f0 = le32_to_cpu(f[0]);\n\t\t\t\tif (f0 & (1 << 15))\n\t\t\t\t\tsata_async_notification(ap);\n\t\t\t}\n\t\t}\n\t}\n\n\t/* pp->active_link is not reliable once FBS is enabled, both\n\t * PORT_SCR_ACT and PORT_CMD_ISSUE should be checked because\n\t * NCQ and non-NCQ commands may be in flight at the same time.\n\t */\n\tif (pp->fbs_enabled) {\n\t\tif (ap->qc_active) {\n\t\t\tqc_active = readl(port_mmio + PORT_SCR_ACT);\n\t\t\tqc_active |= readl(port_mmio + PORT_CMD_ISSUE);\n\t\t}\n\t} else {\n\t\t/* pp->active_link is valid iff any command is in flight */\n\t\tif (ap->qc_active && pp->active_link->sactive)\n\t\t\tqc_active = readl(port_mmio + PORT_SCR_ACT);\n\t\telse\n\t\t\tqc_active = readl(port_mmio + PORT_CMD_ISSUE);\n\t}\n\n\n\trc = ata_qc_complete_multiple(ap, qc_active);\n\n\t/* while resetting, invalid completions are expected */\n\tif (unlikely(rc < 0 && !resetting)) {\n\t\tehi->err_mask |= AC_ERR_HSM;\n\t\tehi->action |= ATA_EH_RESET;\n\t\tata_port_freeze(ap);\n\t}\n}\n\nstatic void ahci_port_intr(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 status;\n\n\tstatus = readl(port_mmio + PORT_IRQ_STAT);\n\twritel(status, port_mmio + PORT_IRQ_STAT);\n\n\tahci_handle_port_interrupt(ap, port_mmio, status);\n}\n\nstatic irqreturn_t ahci_multi_irqs_intr_hard(int irq, void *dev_instance)\n{\n\tstruct ata_port *ap = dev_instance;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 status;\n\n\tVPRINTK(\"ENTER\\n\");\n\n\tstatus = readl(port_mmio + PORT_IRQ_STAT);\n\twritel(status, port_mmio + PORT_IRQ_STAT);\n\n\tspin_lock(ap->lock);\n\tahci_handle_port_interrupt(ap, port_mmio, status);\n\tspin_unlock(ap->lock);\n\n\tVPRINTK(\"EXIT\\n\");\n\n\treturn IRQ_HANDLED;\n}\n\nu32 ahci_handle_port_intr(struct ata_host *host, u32 irq_masked)\n{\n\tunsigned int i, handled = 0;\n\n\tfor (i = 0; i < host->n_ports; i++) {\n\t\tstruct ata_port *ap;\n\n\t\tif (!(irq_masked & (1 << i)))\n\t\t\tcontinue;\n\n\t\tap = host->ports[i];\n\t\tif (ap) {\n\t\t\tahci_port_intr(ap);\n\t\t\tVPRINTK(\"port %u\\n\", i);\n\t\t} else {\n\t\t\tVPRINTK(\"port %u (no irq)\\n\", i);\n\t\t\tif (ata_ratelimit())\n\t\t\t\tdev_warn(host->dev,\n\t\t\t\t\t \"interrupt on disabled port %u\\n\", i);\n\t\t}\n\n\t\thandled = 1;\n\t}\n\n\treturn handled;\n}\nEXPORT_SYMBOL_GPL(ahci_handle_port_intr);\n\nstatic irqreturn_t ahci_single_level_irq_intr(int irq, void *dev_instance)\n{\n\tstruct ata_host *host = dev_instance;\n\tstruct ahci_host_priv *hpriv;\n\tunsigned int rc = 0;\n\tvoid __iomem *mmio;\n\tu32 irq_stat, irq_masked;\n\n\tVPRINTK(\"ENTER\\n\");\n\n\thpriv = host->private_data;\n\tmmio = hpriv->mmio;\n\n\t/* sigh.  0xffffffff is a valid return from h/w */\n\tirq_stat = readl(mmio + HOST_IRQ_STAT);\n\tif (!irq_stat)\n\t\treturn IRQ_NONE;\n\n\tirq_masked = irq_stat & hpriv->port_map;\n\n\tspin_lock(&host->lock);\n\n\trc = ahci_handle_port_intr(host, irq_masked);\n\n\t/* HOST_IRQ_STAT behaves as level triggered latch meaning that\n\t * it should be cleared after all the port events are cleared;\n\t * otherwise, it will raise a spurious interrupt after each\n\t * valid one.  Please read section 10.6.2 of ahci 1.1 for more\n\t * information.\n\t *\n\t * Also, use the unmasked value to clear interrupt as spurious\n\t * pending event on a dummy port might cause screaming IRQ.\n\t */\n\twritel(irq_stat, mmio + HOST_IRQ_STAT);\n\n\tspin_unlock(&host->lock);\n\n\tVPRINTK(\"EXIT\\n\");\n\n\treturn IRQ_RETVAL(rc);\n}\n\nunsigned int ahci_qc_issue(struct ata_queued_cmd *qc)\n{\n\tstruct ata_port *ap = qc->ap;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ahci_port_priv *pp = ap->private_data;\n\n\t/* Keep track of the currently active link.  It will be used\n\t * in completion path to determine whether NCQ phase is in\n\t * progress.\n\t */\n\tpp->active_link = qc->dev->link;\n\n\tif (ata_is_ncq(qc->tf.protocol))\n\t\twritel(1 << qc->hw_tag, port_mmio + PORT_SCR_ACT);\n\n\tif (pp->fbs_enabled && pp->fbs_last_dev != qc->dev->link->pmp) {\n\t\tu32 fbs = readl(port_mmio + PORT_FBS);\n\t\tfbs &= ~(PORT_FBS_DEV_MASK | PORT_FBS_DEC);\n\t\tfbs |= qc->dev->link->pmp << PORT_FBS_DEV_OFFSET;\n\t\twritel(fbs, port_mmio + PORT_FBS);\n\t\tpp->fbs_last_dev = qc->dev->link->pmp;\n\t}\n\n\twritel(1 << qc->hw_tag, port_mmio + PORT_CMD_ISSUE);\n\n\tahci_sw_activity(qc->dev->link);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ahci_qc_issue);\n\nstatic bool ahci_qc_fill_rtf(struct ata_queued_cmd *qc)\n{\n\tstruct ahci_port_priv *pp = qc->ap->private_data;\n\tu8 *rx_fis = pp->rx_fis;\n\n\tif (pp->fbs_enabled)\n\t\trx_fis += qc->dev->link->pmp * AHCI_RX_FIS_SZ;\n\n\t/*\n\t * After a successful execution of an ATA PIO data-in command,\n\t * the device doesn't send D2H Reg FIS to update the TF and\n\t * the host should take TF and E_Status from the preceding PIO\n\t * Setup FIS.\n\t */\n\tif (qc->tf.protocol == ATA_PROT_PIO && qc->dma_dir == DMA_FROM_DEVICE &&\n\t    !(qc->flags & ATA_QCFLAG_FAILED)) {\n\t\tata_tf_from_fis(rx_fis + RX_FIS_PIO_SETUP, &qc->result_tf);\n\t\tqc->result_tf.command = (rx_fis + RX_FIS_PIO_SETUP)[15];\n\t} else\n\t\tata_tf_from_fis(rx_fis + RX_FIS_D2H_REG, &qc->result_tf);\n\n\treturn true;\n}\n\nstatic void ahci_freeze(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\n\t/* turn IRQ off */\n\twritel(0, port_mmio + PORT_IRQ_MASK);\n}\n\nstatic void ahci_thaw(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 tmp;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\n\t/* clear IRQ */\n\ttmp = readl(port_mmio + PORT_IRQ_STAT);\n\twritel(tmp, port_mmio + PORT_IRQ_STAT);\n\twritel(1 << ap->port_no, mmio + HOST_IRQ_STAT);\n\n\t/* turn IRQ back on */\n\twritel(pp->intr_mask, port_mmio + PORT_IRQ_MASK);\n}\n\nvoid ahci_error_handler(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\tif (!(ap->pflags & ATA_PFLAG_FROZEN)) {\n\t\t/* restart engine */\n\t\thpriv->stop_engine(ap);\n\t\thpriv->start_engine(ap);\n\t}\n\n\tsata_pmp_error_handler(ap);\n\n\tif (!ata_dev_enabled(ap->link.device))\n\t\thpriv->stop_engine(ap);\n}\nEXPORT_SYMBOL_GPL(ahci_error_handler);\n\nstatic void ahci_post_internal_cmd(struct ata_queued_cmd *qc)\n{\n\tstruct ata_port *ap = qc->ap;\n\n\t/* make DMA engine forget about the failed command */\n\tif (qc->flags & ATA_QCFLAG_FAILED)\n\t\tahci_kick_engine(ap);\n}\n\nstatic void ahci_set_aggressive_devslp(struct ata_port *ap, bool sleep)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ata_device *dev = ap->link.device;\n\tu32 devslp, dm, dito, mdat, deto, dito_conf;\n\tint rc;\n\tunsigned int err_mask;\n\n\tdevslp = readl(port_mmio + PORT_DEVSLP);\n\tif (!(devslp & PORT_DEVSLP_DSP)) {\n\t\tdev_info(ap->host->dev, \"port does not support device sleep\\n\");\n\t\treturn;\n\t}\n\n\t/* disable device sleep */\n\tif (!sleep) {\n\t\tif (devslp & PORT_DEVSLP_ADSE) {\n\t\t\twritel(devslp & ~PORT_DEVSLP_ADSE,\n\t\t\t       port_mmio + PORT_DEVSLP);\n\t\t\terr_mask = ata_dev_set_feature(dev,\n\t\t\t\t\t\t       SETFEATURES_SATA_DISABLE,\n\t\t\t\t\t\t       SATA_DEVSLP);\n\t\t\tif (err_mask && err_mask != AC_ERR_DEV)\n\t\t\t\tata_dev_warn(dev, \"failed to disable DEVSLP\\n\");\n\t\t}\n\t\treturn;\n\t}\n\n\tdm = (devslp & PORT_DEVSLP_DM_MASK) >> PORT_DEVSLP_DM_OFFSET;\n\tdito = devslp_idle_timeout / (dm + 1);\n\tif (dito > 0x3ff)\n\t\tdito = 0x3ff;\n\n\tdito_conf = (devslp >> PORT_DEVSLP_DITO_OFFSET) & 0x3FF;\n\n\t/* device sleep was already enabled and same dito */\n\tif ((devslp & PORT_DEVSLP_ADSE) && (dito_conf == dito))\n\t\treturn;\n\n\t/* set DITO, MDAT, DETO and enable DevSlp, need to stop engine first */\n\trc = hpriv->stop_engine(ap);\n\tif (rc)\n\t\treturn;\n\n\t/* Use the nominal value 10 ms if the read MDAT is zero,\n\t * the nominal value of DETO is 20 ms.\n\t */\n\tif (dev->devslp_timing[ATA_LOG_DEVSLP_VALID] &\n\t    ATA_LOG_DEVSLP_VALID_MASK) {\n\t\tmdat = dev->devslp_timing[ATA_LOG_DEVSLP_MDAT] &\n\t\t       ATA_LOG_DEVSLP_MDAT_MASK;\n\t\tif (!mdat)\n\t\t\tmdat = 10;\n\t\tdeto = dev->devslp_timing[ATA_LOG_DEVSLP_DETO];\n\t\tif (!deto)\n\t\t\tdeto = 20;\n\t} else {\n\t\tmdat = 10;\n\t\tdeto = 20;\n\t}\n\n\t/* Make dito, mdat, deto bits to 0s */\n\tdevslp &= ~GENMASK_ULL(24, 2);\n\tdevslp |= ((dito << PORT_DEVSLP_DITO_OFFSET) |\n\t\t   (mdat << PORT_DEVSLP_MDAT_OFFSET) |\n\t\t   (deto << PORT_DEVSLP_DETO_OFFSET) |\n\t\t   PORT_DEVSLP_ADSE);\n\twritel(devslp, port_mmio + PORT_DEVSLP);\n\n\thpriv->start_engine(ap);\n\n\t/* enable device sleep feature for the drive */\n\terr_mask = ata_dev_set_feature(dev,\n\t\t\t\t       SETFEATURES_SATA_ENABLE,\n\t\t\t\t       SATA_DEVSLP);\n\tif (err_mask && err_mask != AC_ERR_DEV)\n\t\tata_dev_warn(dev, \"failed to enable DEVSLP\\n\");\n}\n\nstatic void ahci_enable_fbs(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 fbs;\n\tint rc;\n\n\tif (!pp->fbs_supported)\n\t\treturn;\n\n\tfbs = readl(port_mmio + PORT_FBS);\n\tif (fbs & PORT_FBS_EN) {\n\t\tpp->fbs_enabled = true;\n\t\tpp->fbs_last_dev = -1; /* initialization */\n\t\treturn;\n\t}\n\n\trc = hpriv->stop_engine(ap);\n\tif (rc)\n\t\treturn;\n\n\twritel(fbs | PORT_FBS_EN, port_mmio + PORT_FBS);\n\tfbs = readl(port_mmio + PORT_FBS);\n\tif (fbs & PORT_FBS_EN) {\n\t\tdev_info(ap->host->dev, \"FBS is enabled\\n\");\n\t\tpp->fbs_enabled = true;\n\t\tpp->fbs_last_dev = -1; /* initialization */\n\t} else\n\t\tdev_err(ap->host->dev, \"Failed to enable FBS\\n\");\n\n\thpriv->start_engine(ap);\n}\n\nstatic void ahci_disable_fbs(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tu32 fbs;\n\tint rc;\n\n\tif (!pp->fbs_supported)\n\t\treturn;\n\n\tfbs = readl(port_mmio + PORT_FBS);\n\tif ((fbs & PORT_FBS_EN) == 0) {\n\t\tpp->fbs_enabled = false;\n\t\treturn;\n\t}\n\n\trc = hpriv->stop_engine(ap);\n\tif (rc)\n\t\treturn;\n\n\twritel(fbs & ~PORT_FBS_EN, port_mmio + PORT_FBS);\n\tfbs = readl(port_mmio + PORT_FBS);\n\tif (fbs & PORT_FBS_EN)\n\t\tdev_err(ap->host->dev, \"Failed to disable FBS\\n\");\n\telse {\n\t\tdev_info(ap->host->dev, \"FBS is disabled\\n\");\n\t\tpp->fbs_enabled = false;\n\t}\n\n\thpriv->start_engine(ap);\n}\n\nstatic void ahci_pmp_attach(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tu32 cmd;\n\n\tcmd = readl(port_mmio + PORT_CMD);\n\tcmd |= PORT_CMD_PMP;\n\twritel(cmd, port_mmio + PORT_CMD);\n\n\tahci_enable_fbs(ap);\n\n\tpp->intr_mask |= PORT_IRQ_BAD_PMP;\n\n\t/*\n\t * We must not change the port interrupt mask register if the\n\t * port is marked frozen, the value in pp->intr_mask will be\n\t * restored later when the port is thawed.\n\t *\n\t * Note that during initialization, the port is marked as\n\t * frozen since the irq handler is not yet registered.\n\t */\n\tif (!(ap->pflags & ATA_PFLAG_FROZEN))\n\t\twritel(pp->intr_mask, port_mmio + PORT_IRQ_MASK);\n}\n\nstatic void ahci_pmp_detach(struct ata_port *ap)\n{\n\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\tstruct ahci_port_priv *pp = ap->private_data;\n\tu32 cmd;\n\n\tahci_disable_fbs(ap);\n\n\tcmd = readl(port_mmio + PORT_CMD);\n\tcmd &= ~PORT_CMD_PMP;\n\twritel(cmd, port_mmio + PORT_CMD);\n\n\tpp->intr_mask &= ~PORT_IRQ_BAD_PMP;\n\n\t/* see comment above in ahci_pmp_attach() */\n\tif (!(ap->pflags & ATA_PFLAG_FROZEN))\n\t\twritel(pp->intr_mask, port_mmio + PORT_IRQ_MASK);\n}\n\nint ahci_port_resume(struct ata_port *ap)\n{\n\tahci_rpm_get_port(ap);\n\n\tahci_power_up(ap);\n\tahci_start_port(ap);\n\n\tif (sata_pmp_attached(ap))\n\t\tahci_pmp_attach(ap);\n\telse\n\t\tahci_pmp_detach(ap);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ahci_port_resume);\n\n#ifdef CONFIG_PM\nstatic int ahci_port_suspend(struct ata_port *ap, pm_message_t mesg)\n{\n\tconst char *emsg = NULL;\n\tint rc;\n\n\trc = ahci_deinit_port(ap, &emsg);\n\tif (rc == 0)\n\t\tahci_power_down(ap);\n\telse {\n\t\tata_port_err(ap, \"%s (%d)\\n\", emsg, rc);\n\t\tata_port_freeze(ap);\n\t}\n\n\tahci_rpm_put_port(ap);\n\treturn rc;\n}\n#endif\n\nstatic int ahci_port_start(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tstruct device *dev = ap->host->dev;\n\tstruct ahci_port_priv *pp;\n\tvoid *mem;\n\tdma_addr_t mem_dma;\n\tsize_t dma_sz, rx_fis_sz;\n\n\tpp = devm_kzalloc(dev, sizeof(*pp), GFP_KERNEL);\n\tif (!pp)\n\t\treturn -ENOMEM;\n\n\tif (ap->host->n_ports > 1) {\n\t\tpp->irq_desc = devm_kzalloc(dev, 8, GFP_KERNEL);\n\t\tif (!pp->irq_desc) {\n\t\t\tdevm_kfree(dev, pp);\n\t\t\treturn -ENOMEM;\n\t\t}\n\t\tsnprintf(pp->irq_desc, 8,\n\t\t\t \"%s%d\", dev_driver_string(dev), ap->port_no);\n\t}\n\n\t/* check FBS capability */\n\tif ((hpriv->cap & HOST_CAP_FBS) && sata_pmp_supported(ap)) {\n\t\tvoid __iomem *port_mmio = ahci_port_base(ap);\n\t\tu32 cmd = readl(port_mmio + PORT_CMD);\n\t\tif (cmd & PORT_CMD_FBSCP)\n\t\t\tpp->fbs_supported = true;\n\t\telse if (hpriv->flags & AHCI_HFLAG_YES_FBS) {\n\t\t\tdev_info(dev, \"port %d can do FBS, forcing FBSCP\\n\",\n\t\t\t\t ap->port_no);\n\t\t\tpp->fbs_supported = true;\n\t\t} else\n\t\t\tdev_warn(dev, \"port %d is not capable of FBS\\n\",\n\t\t\t\t ap->port_no);\n\t}\n\n\tif (pp->fbs_supported) {\n\t\tdma_sz = AHCI_PORT_PRIV_FBS_DMA_SZ;\n\t\trx_fis_sz = AHCI_RX_FIS_SZ * 16;\n\t} else {\n\t\tdma_sz = AHCI_PORT_PRIV_DMA_SZ;\n\t\trx_fis_sz = AHCI_RX_FIS_SZ;\n\t}\n\n\tmem = dmam_alloc_coherent(dev, dma_sz, &mem_dma, GFP_KERNEL);\n\tif (!mem)\n\t\treturn -ENOMEM;\n\n\t/*\n\t * First item in chunk of DMA memory: 32-slot command table,\n\t * 32 bytes each in size\n\t */\n\tpp->cmd_slot = mem;\n\tpp->cmd_slot_dma = mem_dma;\n\n\tmem += AHCI_CMD_SLOT_SZ;\n\tmem_dma += AHCI_CMD_SLOT_SZ;\n\n\t/*\n\t * Second item: Received-FIS area\n\t */\n\tpp->rx_fis = mem;\n\tpp->rx_fis_dma = mem_dma;\n\n\tmem += rx_fis_sz;\n\tmem_dma += rx_fis_sz;\n\n\t/*\n\t * Third item: data area for storing a single command\n\t * and its scatter-gather table\n\t */\n\tpp->cmd_tbl = mem;\n\tpp->cmd_tbl_dma = mem_dma;\n\n\t/*\n\t * Save off initial list of interrupts to be enabled.\n\t * This could be changed later\n\t */\n\tpp->intr_mask = DEF_PORT_IRQ;\n\n\t/*\n\t * Switch to per-port locking in case each port has its own MSI vector.\n\t */\n\tif (hpriv->flags & AHCI_HFLAG_MULTI_MSI) {\n\t\tspin_lock_init(&pp->lock);\n\t\tap->lock = &pp->lock;\n\t}\n\n\tap->private_data = pp;\n\n\t/* engage engines, captain */\n\treturn ahci_port_resume(ap);\n}\n\nstatic void ahci_port_stop(struct ata_port *ap)\n{\n\tconst char *emsg = NULL;\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\tvoid __iomem *host_mmio = hpriv->mmio;\n\tint rc;\n\n\t/* de-initialize port */\n\trc = ahci_deinit_port(ap, &emsg);\n\tif (rc)\n\t\tata_port_warn(ap, \"%s (%d)\\n\", emsg, rc);\n\n\t/*\n\t * Clear GHC.IS to prevent stuck INTx after disabling MSI and\n\t * re-enabling INTx.\n\t */\n\twritel(1 << ap->port_no, host_mmio + HOST_IRQ_STAT);\n\n\tahci_rpm_put_port(ap);\n}\n\nvoid ahci_print_info(struct ata_host *host, const char *scc_s)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tu32 vers, cap, cap2, impl, speed;\n\tconst char *speed_s;\n\n\tvers = hpriv->version;\n\tcap = hpriv->cap;\n\tcap2 = hpriv->cap2;\n\timpl = hpriv->port_map;\n\n\tspeed = (cap >> 20) & 0xf;\n\tif (speed == 1)\n\t\tspeed_s = \"1.5\";\n\telse if (speed == 2)\n\t\tspeed_s = \"3\";\n\telse if (speed == 3)\n\t\tspeed_s = \"6\";\n\telse\n\t\tspeed_s = \"?\";\n\n\tdev_info(host->dev,\n\t\t\"AHCI %02x%02x.%02x%02x \"\n\t\t\"%u slots %u ports %s Gbps 0x%x impl %s mode\\n\"\n\t\t,\n\n\t\t(vers >> 24) & 0xff,\n\t\t(vers >> 16) & 0xff,\n\t\t(vers >> 8) & 0xff,\n\t\tvers & 0xff,\n\n\t\t((cap >> 8) & 0x1f) + 1,\n\t\t(cap & 0x1f) + 1,\n\t\tspeed_s,\n\t\timpl,\n\t\tscc_s);\n\n\tdev_info(host->dev,\n\t\t\"flags: \"\n\t\t\"%s%s%s%s%s%s%s\"\n\t\t\"%s%s%s%s%s%s%s\"\n\t\t\"%s%s%s%s%s%s%s\"\n\t\t\"%s%s\\n\"\n\t\t,\n\n\t\tcap & HOST_CAP_64 ? \"64bit \" : \"\",\n\t\tcap & HOST_CAP_NCQ ? \"ncq \" : \"\",\n\t\tcap & HOST_CAP_SNTF ? \"sntf \" : \"\",\n\t\tcap & HOST_CAP_MPS ? \"ilck \" : \"\",\n\t\tcap & HOST_CAP_SSS ? \"stag \" : \"\",\n\t\tcap & HOST_CAP_ALPM ? \"pm \" : \"\",\n\t\tcap & HOST_CAP_LED ? \"led \" : \"\",\n\t\tcap & HOST_CAP_CLO ? \"clo \" : \"\",\n\t\tcap & HOST_CAP_ONLY ? \"only \" : \"\",\n\t\tcap & HOST_CAP_PMP ? \"pmp \" : \"\",\n\t\tcap & HOST_CAP_FBS ? \"fbs \" : \"\",\n\t\tcap & HOST_CAP_PIO_MULTI ? \"pio \" : \"\",\n\t\tcap & HOST_CAP_SSC ? \"slum \" : \"\",\n\t\tcap & HOST_CAP_PART ? \"part \" : \"\",\n\t\tcap & HOST_CAP_CCC ? \"ccc \" : \"\",\n\t\tcap & HOST_CAP_EMS ? \"ems \" : \"\",\n\t\tcap & HOST_CAP_SXS ? \"sxs \" : \"\",\n\t\tcap2 & HOST_CAP2_DESO ? \"deso \" : \"\",\n\t\tcap2 & HOST_CAP2_SADM ? \"sadm \" : \"\",\n\t\tcap2 & HOST_CAP2_SDS ? \"sds \" : \"\",\n\t\tcap2 & HOST_CAP2_APST ? \"apst \" : \"\",\n\t\tcap2 & HOST_CAP2_NVMHCI ? \"nvmp \" : \"\",\n\t\tcap2 & HOST_CAP2_BOH ? \"boh \" : \"\"\n\t\t);\n}\nEXPORT_SYMBOL_GPL(ahci_print_info);\n\nvoid ahci_set_em_messages(struct ahci_host_priv *hpriv,\n\t\t\t  struct ata_port_info *pi)\n{\n\tu8 messages;\n\tvoid __iomem *mmio = hpriv->mmio;\n\tu32 em_loc = readl(mmio + HOST_EM_LOC);\n\tu32 em_ctl = readl(mmio + HOST_EM_CTL);\n\n\tif (!ahci_em_messages || !(hpriv->cap & HOST_CAP_EMS))\n\t\treturn;\n\n\tmessages = (em_ctl & EM_CTRL_MSG_TYPE) >> 16;\n\n\tif (messages) {\n\t\t/* store em_loc */\n\t\thpriv->em_loc = ((em_loc >> 16) * 4);\n\t\thpriv->em_buf_sz = ((em_loc & 0xff) * 4);\n\t\thpriv->em_msg_type = messages;\n\t\tpi->flags |= ATA_FLAG_EM;\n\t\tif (!(em_ctl & EM_CTL_ALHD))\n\t\t\tpi->flags |= ATA_FLAG_SW_ACTIVITY;\n\t}\n}\nEXPORT_SYMBOL_GPL(ahci_set_em_messages);\n\nstatic int ahci_host_activate_multi_irqs(struct ata_host *host,\n\t\t\t\t\t struct scsi_host_template *sht)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tint i, rc;\n\n\trc = ata_host_start(host);\n\tif (rc)\n\t\treturn rc;\n\t/*\n\t * Requests IRQs according to AHCI-1.1 when multiple MSIs were\n\t * allocated. That is one MSI per port, starting from @irq.\n\t */\n\tfor (i = 0; i < host->n_ports; i++) {\n\t\tstruct ahci_port_priv *pp = host->ports[i]->private_data;\n\t\tint irq = hpriv->get_irq_vector(host, i);\n\n\t\t/* Do not receive interrupts sent by dummy ports */\n\t\tif (!pp) {\n\t\t\tdisable_irq(irq);\n\t\t\tcontinue;\n\t\t}\n\n\t\trc = devm_request_irq(host->dev, irq, ahci_multi_irqs_intr_hard,\n\t\t\t\t0, pp->irq_desc, host->ports[i]);\n\n\t\tif (rc)\n\t\t\treturn rc;\n\t\tata_port_desc(host->ports[i], \"irq %d\", irq);\n\t}\n\n\treturn ata_host_register(host, sht);\n}\n\n/**\n *\tahci_host_activate - start AHCI host, request IRQs and register it\n *\t@host: target ATA host\n *\t@sht: scsi_host_template to use when registering the host\n *\n *\tLOCKING:\n *\tInherited from calling layer (may sleep).\n *\n *\tRETURNS:\n *\t0 on success, -errno otherwise.\n */\nint ahci_host_activate(struct ata_host *host, struct scsi_host_template *sht)\n{\n\tstruct ahci_host_priv *hpriv = host->private_data;\n\tint irq = hpriv->irq;\n\tint rc;\n\n\tif (hpriv->flags & AHCI_HFLAG_MULTI_MSI) {\n\t\tif (hpriv->irq_handler &&\n\t\t    hpriv->irq_handler != ahci_single_level_irq_intr)\n\t\t\tdev_warn(host->dev,\n\t\t\t         \"both AHCI_HFLAG_MULTI_MSI flag set and custom irq handler implemented\\n\");\n\t\tif (!hpriv->get_irq_vector) {\n\t\t\tdev_err(host->dev,\n\t\t\t\t\"AHCI_HFLAG_MULTI_MSI requires ->get_irq_vector!\\n\");\n\t\t\treturn -EIO;\n\t\t}\n\n\t\trc = ahci_host_activate_multi_irqs(host, sht);\n\t} else {\n\t\trc = ata_host_activate(host, irq, hpriv->irq_handler,\n\t\t\t\t       IRQF_SHARED, sht);\n\t}\n\n\n\treturn rc;\n}\nEXPORT_SYMBOL_GPL(ahci_host_activate);\n\nMODULE_AUTHOR(\"Jeff Garzik\");\nMODULE_DESCRIPTION(\"Common AHCI SATA low-level routines\");\nMODULE_LICENSE(\"GPL\");\n"}, "1": {"id": 1, "path": "/src/include/linux/compiler.h", "content": "/* SPDX-License-Identifier: GPL-2.0 */\n#ifndef __LINUX_COMPILER_H\n#define __LINUX_COMPILER_H\n\n#include <linux/compiler_types.h>\n\n#ifndef __ASSEMBLY__\n\n#ifdef __KERNEL__\n\n/*\n * Note: DISABLE_BRANCH_PROFILING can be used by special lowlevel code\n * to disable branch tracing on a per file basis.\n */\n#if defined(CONFIG_TRACE_BRANCH_PROFILING) \\\n    && !defined(DISABLE_BRANCH_PROFILING) && !defined(__CHECKER__)\nvoid ftrace_likely_update(struct ftrace_likely_data *f, int val,\n\t\t\t  int expect, int is_constant);\n\n#define likely_notrace(x)\t__builtin_expect(!!(x), 1)\n#define unlikely_notrace(x)\t__builtin_expect(!!(x), 0)\n\n#define __branch_check__(x, expect, is_constant) ({\t\t\t\\\n\t\t\tlong ______r;\t\t\t\t\t\\\n\t\t\tstatic struct ftrace_likely_data\t\t\\\n\t\t\t\t__aligned(4)\t\t\t\t\\\n\t\t\t\t__section(\"_ftrace_annotated_branch\")\t\\\n\t\t\t\t______f = {\t\t\t\t\\\n\t\t\t\t.data.func = __func__,\t\t\t\\\n\t\t\t\t.data.file = __FILE__,\t\t\t\\\n\t\t\t\t.data.line = __LINE__,\t\t\t\\\n\t\t\t};\t\t\t\t\t\t\\\n\t\t\t______r = __builtin_expect(!!(x), expect);\t\\\n\t\t\tftrace_likely_update(&______f, ______r,\t\t\\\n\t\t\t\t\t     expect, is_constant);\t\\\n\t\t\t______r;\t\t\t\t\t\\\n\t\t})\n\n/*\n * Using __builtin_constant_p(x) to ignore cases where the return\n * value is always the same.  This idea is taken from a similar patch\n * written by Daniel Walker.\n */\n# ifndef likely\n#  define likely(x)\t(__branch_check__(x, 1, __builtin_constant_p(x)))\n# endif\n# ifndef unlikely\n#  define unlikely(x)\t(__branch_check__(x, 0, __builtin_constant_p(x)))\n# endif\n\n#ifdef CONFIG_PROFILE_ALL_BRANCHES\n/*\n * \"Define 'is'\", Bill Clinton\n * \"Define 'if'\", Steven Rostedt\n */\n#define if(cond, ...) if ( __trace_if_var( !!(cond , ## __VA_ARGS__) ) )\n\n#define __trace_if_var(cond) (__builtin_constant_p(cond) ? (cond) : __trace_if_value(cond))\n\n#define __trace_if_value(cond) ({\t\t\t\\\n\tstatic struct ftrace_branch_data\t\t\\\n\t\t__aligned(4)\t\t\t\t\\\n\t\t__section(\"_ftrace_branch\")\t\t\\\n\t\t__if_trace = {\t\t\t\t\\\n\t\t\t.func = __func__,\t\t\\\n\t\t\t.file = __FILE__,\t\t\\\n\t\t\t.line = __LINE__,\t\t\\\n\t\t};\t\t\t\t\t\\\n\t(cond) ?\t\t\t\t\t\\\n\t\t(__if_trace.miss_hit[1]++,1) :\t\t\\\n\t\t(__if_trace.miss_hit[0]++,0);\t\t\\\n})\n\n#endif /* CONFIG_PROFILE_ALL_BRANCHES */\n\n#else\n# define likely(x)\t__builtin_expect(!!(x), 1)\n# define unlikely(x)\t__builtin_expect(!!(x), 0)\n# define likely_notrace(x)\tlikely(x)\n# define unlikely_notrace(x)\tunlikely(x)\n#endif\n\n/* Optimization barrier */\n#ifndef barrier\n/* The \"volatile\" is due to gcc bugs */\n# define barrier() __asm__ __volatile__(\"\": : :\"memory\")\n#endif\n\n#ifndef barrier_data\n/*\n * This version is i.e. to prevent dead stores elimination on @ptr\n * where gcc and llvm may behave differently when otherwise using\n * normal barrier(): while gcc behavior gets along with a normal\n * barrier(), llvm needs an explicit input variable to be assumed\n * clobbered. The issue is as follows: while the inline asm might\n * access any memory it wants, the compiler could have fit all of\n * @ptr into memory registers instead, and since @ptr never escaped\n * from that, it proved that the inline asm wasn't touching any of\n * it. This version works well with both compilers, i.e. we're telling\n * the compiler that the inline asm absolutely may see the contents\n * of @ptr. See also: https://llvm.org/bugs/show_bug.cgi?id=15495\n */\n# define barrier_data(ptr) __asm__ __volatile__(\"\": :\"r\"(ptr) :\"memory\")\n#endif\n\n/* workaround for GCC PR82365 if needed */\n#ifndef barrier_before_unreachable\n# define barrier_before_unreachable() do { } while (0)\n#endif\n\n/* Unreachable code */\n#ifdef CONFIG_STACK_VALIDATION\n/*\n * These macros help objtool understand GCC code flow for unreachable code.\n * The __COUNTER__ based labels are a hack to make each instance of the macros\n * unique, to convince GCC not to merge duplicate inline asm statements.\n */\n#define annotate_reachable() ({\t\t\t\t\t\t\\\n\tasm volatile(\"%c0:\\n\\t\"\t\t\t\t\t\t\\\n\t\t     \".pushsection .discard.reachable\\n\\t\"\t\t\\\n\t\t     \".long %c0b - .\\n\\t\"\t\t\t\t\\\n\t\t     \".popsection\\n\\t\" : : \"i\" (__COUNTER__));\t\t\\\n})\n#define annotate_unreachable() ({\t\t\t\t\t\\\n\tasm volatile(\"%c0:\\n\\t\"\t\t\t\t\t\t\\\n\t\t     \".pushsection .discard.unreachable\\n\\t\"\t\t\\\n\t\t     \".long %c0b - .\\n\\t\"\t\t\t\t\\\n\t\t     \".popsection\\n\\t\" : : \"i\" (__COUNTER__));\t\t\\\n})\n#define ASM_UNREACHABLE\t\t\t\t\t\t\t\\\n\t\"999:\\n\\t\"\t\t\t\t\t\t\t\\\n\t\".pushsection .discard.unreachable\\n\\t\"\t\t\t\t\\\n\t\".long 999b - .\\n\\t\"\t\t\t\t\t\t\\\n\t\".popsection\\n\\t\"\n\n/* Annotate a C jump table to allow objtool to follow the code flow */\n#define __annotate_jump_table __section(\".rodata..c_jump_table\")\n\n#else\n#define annotate_reachable()\n#define annotate_unreachable()\n#define __annotate_jump_table\n#endif\n\n#ifndef ASM_UNREACHABLE\n# define ASM_UNREACHABLE\n#endif\n#ifndef unreachable\n# define unreachable() do {\t\t\\\n\tannotate_unreachable();\t\t\\\n\t__builtin_unreachable();\t\\\n} while (0)\n#endif\n\n/*\n * KENTRY - kernel entry point\n * This can be used to annotate symbols (functions or data) that are used\n * without their linker symbol being referenced explicitly. For example,\n * interrupt vector handlers, or functions in the kernel image that are found\n * programatically.\n *\n * Not required for symbols exported with EXPORT_SYMBOL, or initcalls. Those\n * are handled in their own way (with KEEP() in linker scripts).\n *\n * KENTRY can be avoided if the symbols in question are marked as KEEP() in the\n * linker script. For example an architecture could KEEP() its entire\n * boot/exception vector code rather than annotate each function and data.\n */\n#ifndef KENTRY\n# define KENTRY(sym)\t\t\t\t\t\t\\\n\textern typeof(sym) sym;\t\t\t\t\t\\\n\tstatic const unsigned long __kentry_##sym\t\t\\\n\t__used\t\t\t\t\t\t\t\\\n\t__attribute__((__section__(\"___kentry+\" #sym)))\t\t\\\n\t= (unsigned long)&sym;\n#endif\n\n#ifndef RELOC_HIDE\n# define RELOC_HIDE(ptr, off)\t\t\t\t\t\\\n  ({ unsigned long __ptr;\t\t\t\t\t\\\n     __ptr = (unsigned long) (ptr);\t\t\t\t\\\n    (typeof(ptr)) (__ptr + (off)); })\n#endif\n\n#ifndef OPTIMIZER_HIDE_VAR\n/* Make the optimizer believe the variable can be manipulated arbitrarily. */\n#define OPTIMIZER_HIDE_VAR(var)\t\t\t\t\t\t\\\n\t__asm__ (\"\" : \"=r\" (var) : \"0\" (var))\n#endif\n\n/* Not-quite-unique ID. */\n#ifndef __UNIQUE_ID\n# define __UNIQUE_ID(prefix) __PASTE(__PASTE(__UNIQUE_ID_, prefix), __LINE__)\n#endif\n\n/**\n * data_race - mark an expression as containing intentional data races\n *\n * This data_race() macro is useful for situations in which data races\n * should be forgiven.  One example is diagnostic code that accesses\n * shared variables but is not a part of the core synchronization design.\n *\n * This macro *does not* affect normal code generation, but is a hint\n * to tooling that data races here are to be ignored.\n */\n#define data_race(expr)\t\t\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\t__unqual_scalar_typeof(({ expr; })) __v = ({\t\t\t\\\n\t\t__kcsan_disable_current();\t\t\t\t\\\n\t\texpr;\t\t\t\t\t\t\t\\\n\t});\t\t\t\t\t\t\t\t\\\n\t__kcsan_enable_current();\t\t\t\t\t\\\n\t__v;\t\t\t\t\t\t\t\t\\\n})\n\n#endif /* __KERNEL__ */\n\n/*\n * Force the compiler to emit 'sym' as a symbol, so that we can reference\n * it from inline assembler. Necessary in case 'sym' could be inlined\n * otherwise, or eliminated entirely due to lack of references that are\n * visible to the compiler.\n */\n#define __ADDRESSABLE(sym) \\\n\tstatic void * __section(\".discard.addressable\") __used \\\n\t\t__UNIQUE_ID(__PASTE(__addressable_,sym)) = (void *)&sym;\n\n/**\n * offset_to_ptr - convert a relative memory offset to an absolute pointer\n * @off:\tthe address of the 32-bit offset value\n */\nstatic inline void *offset_to_ptr(const int *off)\n{\n\treturn (void *)((unsigned long)off + *off);\n}\n\n#endif /* __ASSEMBLY__ */\n\n/* &a[0] degrades to a pointer: a different type from an array */\n#define __must_be_array(a)\tBUILD_BUG_ON_ZERO(__same_type((a), &(a)[0]))\n\n/*\n * This is needed in functions which generate the stack canary, see\n * arch/x86/kernel/smpboot.c::start_secondary() for an example.\n */\n#define prevent_tail_call_optimization()\tmb()\n\n#include <asm/rwonce.h>\n\n#endif /* __LINUX_COMPILER_H */\n"}, "2": {"id": 2, "path": "/src/include/linux/libata.h", "content": "/* SPDX-License-Identifier: GPL-2.0-or-later */\n/*\n *  Copyright 2003-2005 Red Hat, Inc.  All rights reserved.\n *  Copyright 2003-2005 Jeff Garzik\n *\n *  libata documentation is available via 'make {ps|pdf}docs',\n *  as Documentation/driver-api/libata.rst\n */\n\n#ifndef __LINUX_LIBATA_H__\n#define __LINUX_LIBATA_H__\n\n#include <linux/delay.h>\n#include <linux/jiffies.h>\n#include <linux/interrupt.h>\n#include <linux/dma-mapping.h>\n#include <linux/scatterlist.h>\n#include <linux/io.h>\n#include <linux/ata.h>\n#include <linux/workqueue.h>\n#include <scsi/scsi_host.h>\n#include <linux/acpi.h>\n#include <linux/cdrom.h>\n#include <linux/sched.h>\n#include <linux/async.h>\n\n/*\n * Define if arch has non-standard setup.  This is a _PCI_ standard\n * not a legacy or ISA standard.\n */\n#ifdef CONFIG_ATA_NONSTANDARD\n#include <asm/libata-portmap.h>\n#else\n#define ATA_PRIMARY_IRQ(dev)\t14\n#define ATA_SECONDARY_IRQ(dev)\t15\n#endif\n\n/*\n * compile-time options: to be removed as soon as all the drivers are\n * converted to the new debugging mechanism\n */\n#undef ATA_DEBUG\t\t/* debugging output */\n#undef ATA_VERBOSE_DEBUG\t/* yet more debugging output */\n#undef ATA_IRQ_TRAP\t\t/* define to ack screaming irqs */\n#undef ATA_NDEBUG\t\t/* define to disable quick runtime checks */\n\n\n/* note: prints function name for you */\n#ifdef ATA_DEBUG\n#define DPRINTK(fmt, args...) printk(KERN_ERR \"%s: \" fmt, __func__, ## args)\n#ifdef ATA_VERBOSE_DEBUG\n#define VPRINTK(fmt, args...) printk(KERN_ERR \"%s: \" fmt, __func__, ## args)\n#else\n#define VPRINTK(fmt, args...)\n#endif\t/* ATA_VERBOSE_DEBUG */\n#else\n#define DPRINTK(fmt, args...)\n#define VPRINTK(fmt, args...)\n#endif\t/* ATA_DEBUG */\n\n#define ata_print_version_once(dev, version)\t\t\t\\\n({\t\t\t\t\t\t\t\t\\\n\tstatic bool __print_once;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\\\n\tif (!__print_once) {\t\t\t\t\t\\\n\t\t__print_once = true;\t\t\t\t\\\n\t\tata_print_version(dev, version);\t\t\\\n\t}\t\t\t\t\t\t\t\\\n})\n\n/* NEW: debug levels */\n#define HAVE_LIBATA_MSG 1\n\nenum {\n\tATA_MSG_DRV\t= 0x0001,\n\tATA_MSG_INFO\t= 0x0002,\n\tATA_MSG_PROBE\t= 0x0004,\n\tATA_MSG_WARN\t= 0x0008,\n\tATA_MSG_MALLOC\t= 0x0010,\n\tATA_MSG_CTL\t= 0x0020,\n\tATA_MSG_INTR\t= 0x0040,\n\tATA_MSG_ERR\t= 0x0080,\n};\n\n#define ata_msg_drv(p)    ((p)->msg_enable & ATA_MSG_DRV)\n#define ata_msg_info(p)   ((p)->msg_enable & ATA_MSG_INFO)\n#define ata_msg_probe(p)  ((p)->msg_enable & ATA_MSG_PROBE)\n#define ata_msg_warn(p)   ((p)->msg_enable & ATA_MSG_WARN)\n#define ata_msg_malloc(p) ((p)->msg_enable & ATA_MSG_MALLOC)\n#define ata_msg_ctl(p)    ((p)->msg_enable & ATA_MSG_CTL)\n#define ata_msg_intr(p)   ((p)->msg_enable & ATA_MSG_INTR)\n#define ata_msg_err(p)    ((p)->msg_enable & ATA_MSG_ERR)\n\nstatic inline u32 ata_msg_init(int dval, int default_msg_enable_bits)\n{\n\tif (dval < 0 || dval >= (sizeof(u32) * 8))\n\t\treturn default_msg_enable_bits; /* should be 0x1 - only driver info msgs */\n\tif (!dval)\n\t\treturn 0;\n\treturn (1 << dval) - 1;\n}\n\n/* defines only for the constants which don't work well as enums */\n#define ATA_TAG_POISON\t\t0xfafbfcfdU\n\nenum {\n\t/* various global constants */\n\tLIBATA_MAX_PRD\t\t= ATA_MAX_PRD / 2,\n\tLIBATA_DUMB_MAX_PRD\t= ATA_MAX_PRD / 4,\t/* Worst case */\n\tATA_DEF_QUEUE\t\t= 1,\n\tATA_MAX_QUEUE\t\t= 32,\n\tATA_TAG_INTERNAL\t= ATA_MAX_QUEUE,\n\tATA_SHORT_PAUSE\t\t= 16,\n\n\tATAPI_MAX_DRAIN\t\t= 16 << 10,\n\n\tATA_ALL_DEVICES\t\t= (1 << ATA_MAX_DEVICES) - 1,\n\n\tATA_SHT_EMULATED\t= 1,\n\tATA_SHT_THIS_ID\t\t= -1,\n\n\t/* struct ata_taskfile flags */\n\tATA_TFLAG_LBA48\t\t= (1 << 0), /* enable 48-bit LBA and \"HOB\" */\n\tATA_TFLAG_ISADDR\t= (1 << 1), /* enable r/w to nsect/lba regs */\n\tATA_TFLAG_DEVICE\t= (1 << 2), /* enable r/w to device reg */\n\tATA_TFLAG_WRITE\t\t= (1 << 3), /* data dir: host->dev==1 (write) */\n\tATA_TFLAG_LBA\t\t= (1 << 4), /* enable LBA */\n\tATA_TFLAG_FUA\t\t= (1 << 5), /* enable FUA */\n\tATA_TFLAG_POLLING\t= (1 << 6), /* set nIEN to 1 and use polling */\n\n\t/* struct ata_device stuff */\n\tATA_DFLAG_LBA\t\t= (1 << 0), /* device supports LBA */\n\tATA_DFLAG_LBA48\t\t= (1 << 1), /* device supports LBA48 */\n\tATA_DFLAG_CDB_INTR\t= (1 << 2), /* device asserts INTRQ when ready for CDB */\n\tATA_DFLAG_NCQ\t\t= (1 << 3), /* device supports NCQ */\n\tATA_DFLAG_FLUSH_EXT\t= (1 << 4), /* do FLUSH_EXT instead of FLUSH */\n\tATA_DFLAG_ACPI_PENDING\t= (1 << 5), /* ACPI resume action pending */\n\tATA_DFLAG_ACPI_FAILED\t= (1 << 6), /* ACPI on devcfg has failed */\n\tATA_DFLAG_AN\t\t= (1 << 7), /* AN configured */\n\tATA_DFLAG_TRUSTED\t= (1 << 8), /* device supports trusted send/recv */\n\tATA_DFLAG_DMADIR\t= (1 << 10), /* device requires DMADIR */\n\tATA_DFLAG_CFG_MASK\t= (1 << 12) - 1,\n\n\tATA_DFLAG_PIO\t\t= (1 << 12), /* device limited to PIO mode */\n\tATA_DFLAG_NCQ_OFF\t= (1 << 13), /* device limited to non-NCQ mode */\n\tATA_DFLAG_SLEEPING\t= (1 << 15), /* device is sleeping */\n\tATA_DFLAG_DUBIOUS_XFER\t= (1 << 16), /* data transfer not verified */\n\tATA_DFLAG_NO_UNLOAD\t= (1 << 17), /* device doesn't support unload */\n\tATA_DFLAG_UNLOCK_HPA\t= (1 << 18), /* unlock HPA */\n\tATA_DFLAG_NCQ_SEND_RECV = (1 << 19), /* device supports NCQ SEND and RECV */\n\tATA_DFLAG_NCQ_PRIO\t= (1 << 20), /* device supports NCQ priority */\n\tATA_DFLAG_NCQ_PRIO_ENABLE = (1 << 21), /* Priority cmds sent to dev */\n\tATA_DFLAG_INIT_MASK\t= (1 << 24) - 1,\n\n\tATA_DFLAG_DETACH\t= (1 << 24),\n\tATA_DFLAG_DETACHED\t= (1 << 25),\n\n\tATA_DFLAG_DA\t\t= (1 << 26), /* device supports Device Attention */\n\tATA_DFLAG_DEVSLP\t= (1 << 27), /* device supports Device Sleep */\n\tATA_DFLAG_ACPI_DISABLED = (1 << 28), /* ACPI for the device is disabled */\n\tATA_DFLAG_D_SENSE\t= (1 << 29), /* Descriptor sense requested */\n\tATA_DFLAG_ZAC\t\t= (1 << 30), /* ZAC device */\n\n\tATA_DEV_UNKNOWN\t\t= 0,\t/* unknown device */\n\tATA_DEV_ATA\t\t= 1,\t/* ATA device */\n\tATA_DEV_ATA_UNSUP\t= 2,\t/* ATA device (unsupported) */\n\tATA_DEV_ATAPI\t\t= 3,\t/* ATAPI device */\n\tATA_DEV_ATAPI_UNSUP\t= 4,\t/* ATAPI device (unsupported) */\n\tATA_DEV_PMP\t\t= 5,\t/* SATA port multiplier */\n\tATA_DEV_PMP_UNSUP\t= 6,\t/* SATA port multiplier (unsupported) */\n\tATA_DEV_SEMB\t\t= 7,\t/* SEMB */\n\tATA_DEV_SEMB_UNSUP\t= 8,\t/* SEMB (unsupported) */\n\tATA_DEV_ZAC\t\t= 9,\t/* ZAC device */\n\tATA_DEV_ZAC_UNSUP\t= 10,\t/* ZAC device (unsupported) */\n\tATA_DEV_NONE\t\t= 11,\t/* no device */\n\n\t/* struct ata_link flags */\n\t/* NOTE: struct ata_force_param currently stores lflags in u16 */\n\tATA_LFLAG_NO_HRST\t= (1 << 1), /* avoid hardreset */\n\tATA_LFLAG_NO_SRST\t= (1 << 2), /* avoid softreset */\n\tATA_LFLAG_ASSUME_ATA\t= (1 << 3), /* assume ATA class */\n\tATA_LFLAG_ASSUME_SEMB\t= (1 << 4), /* assume SEMB class */\n\tATA_LFLAG_ASSUME_CLASS\t= ATA_LFLAG_ASSUME_ATA | ATA_LFLAG_ASSUME_SEMB,\n\tATA_LFLAG_NO_RETRY\t= (1 << 5), /* don't retry this link */\n\tATA_LFLAG_DISABLED\t= (1 << 6), /* link is disabled */\n\tATA_LFLAG_SW_ACTIVITY\t= (1 << 7), /* keep activity stats */\n\tATA_LFLAG_NO_LPM\t= (1 << 8), /* disable LPM on this link */\n\tATA_LFLAG_RST_ONCE\t= (1 << 9), /* limit recovery to one reset */\n\tATA_LFLAG_CHANGED\t= (1 << 10), /* LPM state changed on this link */\n\tATA_LFLAG_NO_DB_DELAY\t= (1 << 11), /* no debounce delay on link resume */\n\n\t/* struct ata_port flags */\n\tATA_FLAG_SLAVE_POSS\t= (1 << 0), /* host supports slave dev */\n\t\t\t\t\t    /* (doesn't imply presence) */\n\tATA_FLAG_SATA\t\t= (1 << 1),\n\tATA_FLAG_NO_LPM\t\t= (1 << 2), /* host not happy with LPM */\n\tATA_FLAG_NO_LOG_PAGE\t= (1 << 5), /* do not issue log page read */\n\tATA_FLAG_NO_ATAPI\t= (1 << 6), /* No ATAPI support */\n\tATA_FLAG_PIO_DMA\t= (1 << 7), /* PIO cmds via DMA */\n\tATA_FLAG_PIO_LBA48\t= (1 << 8), /* Host DMA engine is LBA28 only */\n\tATA_FLAG_PIO_POLLING\t= (1 << 9), /* use polling PIO if LLD\n\t\t\t\t\t     * doesn't handle PIO interrupts */\n\tATA_FLAG_NCQ\t\t= (1 << 10), /* host supports NCQ */\n\tATA_FLAG_NO_POWEROFF_SPINDOWN = (1 << 11), /* don't spindown before poweroff */\n\tATA_FLAG_NO_HIBERNATE_SPINDOWN = (1 << 12), /* don't spindown before hibernation */\n\tATA_FLAG_DEBUGMSG\t= (1 << 13),\n\tATA_FLAG_FPDMA_AA\t\t= (1 << 14), /* driver supports Auto-Activate */\n\tATA_FLAG_IGN_SIMPLEX\t= (1 << 15), /* ignore SIMPLEX */\n\tATA_FLAG_NO_IORDY\t= (1 << 16), /* controller lacks iordy */\n\tATA_FLAG_ACPI_SATA\t= (1 << 17), /* need native SATA ACPI layout */\n\tATA_FLAG_AN\t\t= (1 << 18), /* controller supports AN */\n\tATA_FLAG_PMP\t\t= (1 << 19), /* controller supports PMP */\n\tATA_FLAG_FPDMA_AUX\t= (1 << 20), /* controller supports H2DFIS aux field */\n\tATA_FLAG_EM\t\t= (1 << 21), /* driver supports enclosure\n\t\t\t\t\t      * management */\n\tATA_FLAG_SW_ACTIVITY\t= (1 << 22), /* driver supports sw activity\n\t\t\t\t\t      * led */\n\tATA_FLAG_NO_DIPM\t= (1 << 23), /* host not happy with DIPM */\n\tATA_FLAG_SAS_HOST\t= (1 << 24), /* SAS host */\n\n\t/* bits 24:31 of ap->flags are reserved for LLD specific flags */\n\n\n\t/* struct ata_port pflags */\n\tATA_PFLAG_EH_PENDING\t= (1 << 0), /* EH pending */\n\tATA_PFLAG_EH_IN_PROGRESS = (1 << 1), /* EH in progress */\n\tATA_PFLAG_FROZEN\t= (1 << 2), /* port is frozen */\n\tATA_PFLAG_RECOVERED\t= (1 << 3), /* recovery action performed */\n\tATA_PFLAG_LOADING\t= (1 << 4), /* boot/loading probe */\n\tATA_PFLAG_SCSI_HOTPLUG\t= (1 << 6), /* SCSI hotplug scheduled */\n\tATA_PFLAG_INITIALIZING\t= (1 << 7), /* being initialized, don't touch */\n\tATA_PFLAG_RESETTING\t= (1 << 8), /* reset in progress */\n\tATA_PFLAG_UNLOADING\t= (1 << 9), /* driver is being unloaded */\n\tATA_PFLAG_UNLOADED\t= (1 << 10), /* driver is unloaded */\n\n\tATA_PFLAG_SUSPENDED\t= (1 << 17), /* port is suspended (power) */\n\tATA_PFLAG_PM_PENDING\t= (1 << 18), /* PM operation pending */\n\tATA_PFLAG_INIT_GTM_VALID = (1 << 19), /* initial gtm data valid */\n\n\tATA_PFLAG_PIO32\t\t= (1 << 20),  /* 32bit PIO */\n\tATA_PFLAG_PIO32CHANGE\t= (1 << 21),  /* 32bit PIO can be turned on/off */\n\tATA_PFLAG_EXTERNAL\t= (1 << 22),  /* eSATA/external port */\n\n\t/* struct ata_queued_cmd flags */\n\tATA_QCFLAG_ACTIVE\t= (1 << 0), /* cmd not yet ack'd to scsi lyer */\n\tATA_QCFLAG_DMAMAP\t= (1 << 1), /* SG table is DMA mapped */\n\tATA_QCFLAG_IO\t\t= (1 << 3), /* standard IO command */\n\tATA_QCFLAG_RESULT_TF\t= (1 << 4), /* result TF requested */\n\tATA_QCFLAG_CLEAR_EXCL\t= (1 << 5), /* clear excl_link on completion */\n\tATA_QCFLAG_QUIET\t= (1 << 6), /* don't report device error */\n\tATA_QCFLAG_RETRY\t= (1 << 7), /* retry after failure */\n\n\tATA_QCFLAG_FAILED\t= (1 << 16), /* cmd failed and is owned by EH */\n\tATA_QCFLAG_SENSE_VALID\t= (1 << 17), /* sense data valid */\n\tATA_QCFLAG_EH_SCHEDULED = (1 << 18), /* EH scheduled (obsolete) */\n\n\t/* host set flags */\n\tATA_HOST_SIMPLEX\t= (1 << 0),\t/* Host is simplex, one DMA channel per host only */\n\tATA_HOST_STARTED\t= (1 << 1),\t/* Host started */\n\tATA_HOST_PARALLEL_SCAN\t= (1 << 2),\t/* Ports on this host can be scanned in parallel */\n\tATA_HOST_IGNORE_ATA\t= (1 << 3),\t/* Ignore ATA devices on this host. */\n\n\t/* bits 24:31 of host->flags are reserved for LLD specific flags */\n\n\t/* various lengths of time */\n\tATA_TMOUT_BOOT\t\t= 30000,\t/* heuristic */\n\tATA_TMOUT_BOOT_QUICK\t=  7000,\t/* heuristic */\n\tATA_TMOUT_INTERNAL_QUICK = 5000,\n\tATA_TMOUT_MAX_PARK\t= 30000,\n\n\t/*\n\t * GoVault needs 2s and iVDR disk HHD424020F7SV00 800ms.  2s\n\t * is too much without parallel probing.  Use 2s if parallel\n\t * probing is available, 800ms otherwise.\n\t */\n\tATA_TMOUT_FF_WAIT_LONG\t=  2000,\n\tATA_TMOUT_FF_WAIT\t=   800,\n\n\t/* Spec mandates to wait for \">= 2ms\" before checking status\n\t * after reset.  We wait 150ms, because that was the magic\n\t * delay used for ATAPI devices in Hale Landis's ATADRVR, for\n\t * the period of time between when the ATA command register is\n\t * written, and then status is checked.  Because waiting for\n\t * \"a while\" before checking status is fine, post SRST, we\n\t * perform this magic delay here as well.\n\t *\n\t * Old drivers/ide uses the 2mS rule and then waits for ready.\n\t */\n\tATA_WAIT_AFTER_RESET\t=  150,\n\n\t/* If PMP is supported, we have to do follow-up SRST.  As some\n\t * PMPs don't send D2H Reg FIS after hardreset, LLDs are\n\t * advised to wait only for the following duration before\n\t * doing SRST.\n\t */\n\tATA_TMOUT_PMP_SRST_WAIT\t= 5000,\n\n\t/* When the LPM policy is set to ATA_LPM_MAX_POWER, there might\n\t * be a spurious PHY event, so ignore the first PHY event that\n\t * occurs within 10s after the policy change.\n\t */\n\tATA_TMOUT_SPURIOUS_PHY\t= 10000,\n\n\t/* ATA bus states */\n\tBUS_UNKNOWN\t\t= 0,\n\tBUS_DMA\t\t\t= 1,\n\tBUS_IDLE\t\t= 2,\n\tBUS_NOINTR\t\t= 3,\n\tBUS_NODATA\t\t= 4,\n\tBUS_TIMER\t\t= 5,\n\tBUS_PIO\t\t\t= 6,\n\tBUS_EDD\t\t\t= 7,\n\tBUS_IDENTIFY\t\t= 8,\n\tBUS_PACKET\t\t= 9,\n\n\t/* SATA port states */\n\tPORT_UNKNOWN\t\t= 0,\n\tPORT_ENABLED\t\t= 1,\n\tPORT_DISABLED\t\t= 2,\n\n\t/* encoding various smaller bitmaps into a single\n\t * unsigned long bitmap\n\t */\n\tATA_NR_PIO_MODES\t= 7,\n\tATA_NR_MWDMA_MODES\t= 5,\n\tATA_NR_UDMA_MODES\t= 8,\n\n\tATA_SHIFT_PIO\t\t= 0,\n\tATA_SHIFT_MWDMA\t\t= ATA_SHIFT_PIO + ATA_NR_PIO_MODES,\n\tATA_SHIFT_UDMA\t\t= ATA_SHIFT_MWDMA + ATA_NR_MWDMA_MODES,\n\tATA_SHIFT_PRIO\t\t= 6,\n\n\tATA_PRIO_HIGH\t\t= 2,\n\t/* size of buffer to pad xfers ending on unaligned boundaries */\n\tATA_DMA_PAD_SZ\t\t= 4,\n\n\t/* ering size */\n\tATA_ERING_SIZE\t\t= 32,\n\n\t/* return values for ->qc_defer */\n\tATA_DEFER_LINK\t\t= 1,\n\tATA_DEFER_PORT\t\t= 2,\n\n\t/* desc_len for ata_eh_info and context */\n\tATA_EH_DESC_LEN\t\t= 80,\n\n\t/* reset / recovery action types */\n\tATA_EH_REVALIDATE\t= (1 << 0),\n\tATA_EH_SOFTRESET\t= (1 << 1), /* meaningful only in ->prereset */\n\tATA_EH_HARDRESET\t= (1 << 2), /* meaningful only in ->prereset */\n\tATA_EH_RESET\t\t= ATA_EH_SOFTRESET | ATA_EH_HARDRESET,\n\tATA_EH_ENABLE_LINK\t= (1 << 3),\n\tATA_EH_PARK\t\t= (1 << 5), /* unload heads and stop I/O */\n\n\tATA_EH_PERDEV_MASK\t= ATA_EH_REVALIDATE | ATA_EH_PARK,\n\tATA_EH_ALL_ACTIONS\t= ATA_EH_REVALIDATE | ATA_EH_RESET |\n\t\t\t\t  ATA_EH_ENABLE_LINK,\n\n\t/* ata_eh_info->flags */\n\tATA_EHI_HOTPLUGGED\t= (1 << 0),  /* could have been hotplugged */\n\tATA_EHI_NO_AUTOPSY\t= (1 << 2),  /* no autopsy */\n\tATA_EHI_QUIET\t\t= (1 << 3),  /* be quiet */\n\tATA_EHI_NO_RECOVERY\t= (1 << 4),  /* no recovery */\n\n\tATA_EHI_DID_SOFTRESET\t= (1 << 16), /* already soft-reset this port */\n\tATA_EHI_DID_HARDRESET\t= (1 << 17), /* already soft-reset this port */\n\tATA_EHI_PRINTINFO\t= (1 << 18), /* print configuration info */\n\tATA_EHI_SETMODE\t\t= (1 << 19), /* configure transfer mode */\n\tATA_EHI_POST_SETMODE\t= (1 << 20), /* revalidating after setmode */\n\n\tATA_EHI_DID_RESET\t= ATA_EHI_DID_SOFTRESET | ATA_EHI_DID_HARDRESET,\n\n\t/* mask of flags to transfer *to* the slave link */\n\tATA_EHI_TO_SLAVE_MASK\t= ATA_EHI_NO_AUTOPSY | ATA_EHI_QUIET,\n\n\t/* max tries if error condition is still set after ->error_handler */\n\tATA_EH_MAX_TRIES\t= 5,\n\n\t/* sometimes resuming a link requires several retries */\n\tATA_LINK_RESUME_TRIES\t= 5,\n\n\t/* how hard are we gonna try to probe/recover devices */\n\tATA_PROBE_MAX_TRIES\t= 3,\n\tATA_EH_DEV_TRIES\t= 3,\n\tATA_EH_PMP_TRIES\t= 5,\n\tATA_EH_PMP_LINK_TRIES\t= 3,\n\n\tSATA_PMP_RW_TIMEOUT\t= 3000,\t\t/* PMP read/write timeout */\n\n\t/* This should match the actual table size of\n\t * ata_eh_cmd_timeout_table in libata-eh.c.\n\t */\n\tATA_EH_CMD_TIMEOUT_TABLE_SIZE = 6,\n\n\t/* Horkage types. May be set by libata or controller on drives\n\t   (some horkage may be drive/controller pair dependent */\n\n\tATA_HORKAGE_DIAGNOSTIC\t= (1 << 0),\t/* Failed boot diag */\n\tATA_HORKAGE_NODMA\t= (1 << 1),\t/* DMA problems */\n\tATA_HORKAGE_NONCQ\t= (1 << 2),\t/* Don't use NCQ */\n\tATA_HORKAGE_MAX_SEC_128\t= (1 << 3),\t/* Limit max sects to 128 */\n\tATA_HORKAGE_BROKEN_HPA\t= (1 << 4),\t/* Broken HPA */\n\tATA_HORKAGE_DISABLE\t= (1 << 5),\t/* Disable it */\n\tATA_HORKAGE_HPA_SIZE\t= (1 << 6),\t/* native size off by one */\n\tATA_HORKAGE_IVB\t\t= (1 << 8),\t/* cbl det validity bit bugs */\n\tATA_HORKAGE_STUCK_ERR\t= (1 << 9),\t/* stuck ERR on next PACKET */\n\tATA_HORKAGE_BRIDGE_OK\t= (1 << 10),\t/* no bridge limits */\n\tATA_HORKAGE_ATAPI_MOD16_DMA = (1 << 11), /* use ATAPI DMA for commands\n\t\t\t\t\t\t    not multiple of 16 bytes */\n\tATA_HORKAGE_FIRMWARE_WARN = (1 << 12),\t/* firmware update warning */\n\tATA_HORKAGE_1_5_GBPS\t= (1 << 13),\t/* force 1.5 Gbps */\n\tATA_HORKAGE_NOSETXFER\t= (1 << 14),\t/* skip SETXFER, SATA only */\n\tATA_HORKAGE_BROKEN_FPDMA_AA\t= (1 << 15),\t/* skip AA */\n\tATA_HORKAGE_DUMP_ID\t= (1 << 16),\t/* dump IDENTIFY data */\n\tATA_HORKAGE_MAX_SEC_LBA48 = (1 << 17),\t/* Set max sects to 65535 */\n\tATA_HORKAGE_ATAPI_DMADIR = (1 << 18),\t/* device requires dmadir */\n\tATA_HORKAGE_NO_NCQ_TRIM\t= (1 << 19),\t/* don't use queued TRIM */\n\tATA_HORKAGE_NOLPM\t= (1 << 20),\t/* don't use LPM */\n\tATA_HORKAGE_WD_BROKEN_LPM = (1 << 21),\t/* some WDs have broken LPM */\n\tATA_HORKAGE_ZERO_AFTER_TRIM = (1 << 22),/* guarantees zero after trim */\n\tATA_HORKAGE_NO_DMA_LOG\t= (1 << 23),\t/* don't use DMA for log read */\n\tATA_HORKAGE_NOTRIM\t= (1 << 24),\t/* don't use TRIM */\n\tATA_HORKAGE_MAX_SEC_1024 = (1 << 25),\t/* Limit max sects to 1024 */\n\tATA_HORKAGE_MAX_TRIM_128M = (1 << 26),\t/* Limit max trim size to 128M */\n\n\t /* DMA mask for user DMA control: User visible values; DO NOT\n\t    renumber */\n\tATA_DMA_MASK_ATA\t= (1 << 0),\t/* DMA on ATA Disk */\n\tATA_DMA_MASK_ATAPI\t= (1 << 1),\t/* DMA on ATAPI */\n\tATA_DMA_MASK_CFA\t= (1 << 2),\t/* DMA on CF Card */\n\n\t/* ATAPI command types */\n\tATAPI_READ\t\t= 0,\t\t/* READs */\n\tATAPI_WRITE\t\t= 1,\t\t/* WRITEs */\n\tATAPI_READ_CD\t\t= 2,\t\t/* READ CD [MSF] */\n\tATAPI_PASS_THRU\t\t= 3,\t\t/* SAT pass-thru */\n\tATAPI_MISC\t\t= 4,\t\t/* the rest */\n\n\t/* Timing constants */\n\tATA_TIMING_SETUP\t= (1 << 0),\n\tATA_TIMING_ACT8B\t= (1 << 1),\n\tATA_TIMING_REC8B\t= (1 << 2),\n\tATA_TIMING_CYC8B\t= (1 << 3),\n\tATA_TIMING_8BIT\t\t= ATA_TIMING_ACT8B | ATA_TIMING_REC8B |\n\t\t\t\t  ATA_TIMING_CYC8B,\n\tATA_TIMING_ACTIVE\t= (1 << 4),\n\tATA_TIMING_RECOVER\t= (1 << 5),\n\tATA_TIMING_DMACK_HOLD\t= (1 << 6),\n\tATA_TIMING_CYCLE\t= (1 << 7),\n\tATA_TIMING_UDMA\t\t= (1 << 8),\n\tATA_TIMING_ALL\t\t= ATA_TIMING_SETUP | ATA_TIMING_ACT8B |\n\t\t\t\t  ATA_TIMING_REC8B | ATA_TIMING_CYC8B |\n\t\t\t\t  ATA_TIMING_ACTIVE | ATA_TIMING_RECOVER |\n\t\t\t\t  ATA_TIMING_DMACK_HOLD | ATA_TIMING_CYCLE |\n\t\t\t\t  ATA_TIMING_UDMA,\n\n\t/* ACPI constants */\n\tATA_ACPI_FILTER_SETXFER\t= 1 << 0,\n\tATA_ACPI_FILTER_LOCK\t= 1 << 1,\n\tATA_ACPI_FILTER_DIPM\t= 1 << 2,\n\tATA_ACPI_FILTER_FPDMA_OFFSET = 1 << 3,\t/* FPDMA non-zero offset */\n\tATA_ACPI_FILTER_FPDMA_AA = 1 << 4,\t/* FPDMA auto activate */\n\n\tATA_ACPI_FILTER_DEFAULT\t= ATA_ACPI_FILTER_SETXFER |\n\t\t\t\t  ATA_ACPI_FILTER_LOCK |\n\t\t\t\t  ATA_ACPI_FILTER_DIPM,\n};\n\nenum ata_xfer_mask {\n\tATA_MASK_PIO\t\t= ((1LU << ATA_NR_PIO_MODES) - 1)\n\t\t\t\t\t<< ATA_SHIFT_PIO,\n\tATA_MASK_MWDMA\t\t= ((1LU << ATA_NR_MWDMA_MODES) - 1)\n\t\t\t\t\t<< ATA_SHIFT_MWDMA,\n\tATA_MASK_UDMA\t\t= ((1LU << ATA_NR_UDMA_MODES) - 1)\n\t\t\t\t\t<< ATA_SHIFT_UDMA,\n};\n\nenum hsm_task_states {\n\tHSM_ST_IDLE,\t\t/* no command on going */\n\tHSM_ST_FIRST,\t\t/* (waiting the device to)\n\t\t\t\t   write CDB or first data block */\n\tHSM_ST,\t\t\t/* (waiting the device to) transfer data */\n\tHSM_ST_LAST,\t\t/* (waiting the device to) complete command */\n\tHSM_ST_ERR,\t\t/* error */\n};\n\nenum ata_completion_errors {\n\tAC_ERR_OK\t\t= 0,\t    /* no error */\n\tAC_ERR_DEV\t\t= (1 << 0), /* device reported error */\n\tAC_ERR_HSM\t\t= (1 << 1), /* host state machine violation */\n\tAC_ERR_TIMEOUT\t\t= (1 << 2), /* timeout */\n\tAC_ERR_MEDIA\t\t= (1 << 3), /* media error */\n\tAC_ERR_ATA_BUS\t\t= (1 << 4), /* ATA bus error */\n\tAC_ERR_HOST_BUS\t\t= (1 << 5), /* host bus error */\n\tAC_ERR_SYSTEM\t\t= (1 << 6), /* system error */\n\tAC_ERR_INVALID\t\t= (1 << 7), /* invalid argument */\n\tAC_ERR_OTHER\t\t= (1 << 8), /* unknown */\n\tAC_ERR_NODEV_HINT\t= (1 << 9), /* polling device detection hint */\n\tAC_ERR_NCQ\t\t= (1 << 10), /* marker for offending NCQ qc */\n};\n\n/*\n * Link power management policy: If you alter this, you also need to\n * alter libata-scsi.c (for the ascii descriptions)\n */\nenum ata_lpm_policy {\n\tATA_LPM_UNKNOWN,\n\tATA_LPM_MAX_POWER,\n\tATA_LPM_MED_POWER,\n\tATA_LPM_MED_POWER_WITH_DIPM, /* Med power + DIPM as win IRST does */\n\tATA_LPM_MIN_POWER_WITH_PARTIAL, /* Min Power + partial and slumber */\n\tATA_LPM_MIN_POWER, /* Min power + no partial (slumber only) */\n};\n\nenum ata_lpm_hints {\n\tATA_LPM_EMPTY\t\t= (1 << 0), /* port empty/probing */\n\tATA_LPM_HIPM\t\t= (1 << 1), /* may use HIPM */\n\tATA_LPM_WAKE_ONLY\t= (1 << 2), /* only wake up link */\n};\n\n/* forward declarations */\nstruct scsi_device;\nstruct ata_port_operations;\nstruct ata_port;\nstruct ata_link;\nstruct ata_queued_cmd;\n\n/* typedefs */\ntypedef void (*ata_qc_cb_t) (struct ata_queued_cmd *qc);\ntypedef int (*ata_prereset_fn_t)(struct ata_link *link, unsigned long deadline);\ntypedef int (*ata_reset_fn_t)(struct ata_link *link, unsigned int *classes,\n\t\t\t      unsigned long deadline);\ntypedef void (*ata_postreset_fn_t)(struct ata_link *link, unsigned int *classes);\n\nextern struct device_attribute dev_attr_unload_heads;\n#ifdef CONFIG_SATA_HOST\nextern struct device_attribute dev_attr_link_power_management_policy;\nextern struct device_attribute dev_attr_ncq_prio_enable;\nextern struct device_attribute dev_attr_em_message_type;\nextern struct device_attribute dev_attr_em_message;\nextern struct device_attribute dev_attr_sw_activity;\n#endif\n\nenum sw_activity {\n\tOFF,\n\tBLINK_ON,\n\tBLINK_OFF,\n};\n\nstruct ata_taskfile {\n\tunsigned long\t\tflags;\t\t/* ATA_TFLAG_xxx */\n\tu8\t\t\tprotocol;\t/* ATA_PROT_xxx */\n\n\tu8\t\t\tctl;\t\t/* control reg */\n\n\tu8\t\t\thob_feature;\t/* additional data */\n\tu8\t\t\thob_nsect;\t/* to support LBA48 */\n\tu8\t\t\thob_lbal;\n\tu8\t\t\thob_lbam;\n\tu8\t\t\thob_lbah;\n\n\tu8\t\t\tfeature;\n\tu8\t\t\tnsect;\n\tu8\t\t\tlbal;\n\tu8\t\t\tlbam;\n\tu8\t\t\tlbah;\n\n\tu8\t\t\tdevice;\n\n\tu8\t\t\tcommand;\t/* IO operation */\n\n\tu32\t\t\tauxiliary;\t/* auxiliary field */\n\t\t\t\t\t\t/* from SATA 3.1 and */\n\t\t\t\t\t\t/* ATA-8 ACS-3 */\n};\n\n#ifdef CONFIG_ATA_SFF\nstruct ata_ioports {\n\tvoid __iomem\t\t*cmd_addr;\n\tvoid __iomem\t\t*data_addr;\n\tvoid __iomem\t\t*error_addr;\n\tvoid __iomem\t\t*feature_addr;\n\tvoid __iomem\t\t*nsect_addr;\n\tvoid __iomem\t\t*lbal_addr;\n\tvoid __iomem\t\t*lbam_addr;\n\tvoid __iomem\t\t*lbah_addr;\n\tvoid __iomem\t\t*device_addr;\n\tvoid __iomem\t\t*status_addr;\n\tvoid __iomem\t\t*command_addr;\n\tvoid __iomem\t\t*altstatus_addr;\n\tvoid __iomem\t\t*ctl_addr;\n#ifdef CONFIG_ATA_BMDMA\n\tvoid __iomem\t\t*bmdma_addr;\n#endif /* CONFIG_ATA_BMDMA */\n\tvoid __iomem\t\t*scr_addr;\n};\n#endif /* CONFIG_ATA_SFF */\n\nstruct ata_host {\n\tspinlock_t\t\tlock;\n\tstruct device \t\t*dev;\n\tvoid __iomem * const\t*iomap;\n\tunsigned int\t\tn_ports;\n\tunsigned int\t\tn_tags;\t\t\t/* nr of NCQ tags */\n\tvoid\t\t\t*private_data;\n\tstruct ata_port_operations *ops;\n\tunsigned long\t\tflags;\n\tstruct kref\t\tkref;\n\n\tstruct mutex\t\teh_mutex;\n\tstruct task_struct\t*eh_owner;\n\n\tstruct ata_port\t\t*simplex_claimed;\t/* channel owning the DMA */\n\tstruct ata_port\t\t*ports[];\n};\n\nstruct ata_queued_cmd {\n\tstruct ata_port\t\t*ap;\n\tstruct ata_device\t*dev;\n\n\tstruct scsi_cmnd\t*scsicmd;\n\tvoid\t\t\t(*scsidone)(struct scsi_cmnd *);\n\n\tstruct ata_taskfile\ttf;\n\tu8\t\t\tcdb[ATAPI_CDB_LEN];\n\n\tunsigned long\t\tflags;\t\t/* ATA_QCFLAG_xxx */\n\tunsigned int\t\ttag;\t\t/* libata core tag */\n\tunsigned int\t\thw_tag;\t\t/* driver tag */\n\tunsigned int\t\tn_elem;\n\tunsigned int\t\torig_n_elem;\n\n\tint\t\t\tdma_dir;\n\n\tunsigned int\t\tsect_size;\n\n\tunsigned int\t\tnbytes;\n\tunsigned int\t\textrabytes;\n\tunsigned int\t\tcurbytes;\n\n\tstruct scatterlist\tsgent;\n\n\tstruct scatterlist\t*sg;\n\n\tstruct scatterlist\t*cursg;\n\tunsigned int\t\tcursg_ofs;\n\n\tunsigned int\t\terr_mask;\n\tstruct ata_taskfile\tresult_tf;\n\tata_qc_cb_t\t\tcomplete_fn;\n\n\tvoid\t\t\t*private_data;\n\tvoid\t\t\t*lldd_task;\n};\n\nstruct ata_port_stats {\n\tunsigned long\t\tunhandled_irq;\n\tunsigned long\t\tidle_irq;\n\tunsigned long\t\trw_reqbuf;\n};\n\nstruct ata_ering_entry {\n\tunsigned int\t\teflags;\n\tunsigned int\t\terr_mask;\n\tu64\t\t\ttimestamp;\n};\n\nstruct ata_ering {\n\tint\t\t\tcursor;\n\tstruct ata_ering_entry\tring[ATA_ERING_SIZE];\n};\n\nstruct ata_device {\n\tstruct ata_link\t\t*link;\n\tunsigned int\t\tdevno;\t\t/* 0 or 1 */\n\tunsigned int\t\thorkage;\t/* List of broken features */\n\tunsigned long\t\tflags;\t\t/* ATA_DFLAG_xxx */\n\tstruct scsi_device\t*sdev;\t\t/* attached SCSI device */\n\tvoid\t\t\t*private_data;\n#ifdef CONFIG_ATA_ACPI\n\tunion acpi_object\t*gtf_cache;\n\tunsigned int\t\tgtf_filter;\n#endif\n#ifdef CONFIG_SATA_ZPODD\n\tvoid\t\t\t*zpodd;\n#endif\n\tstruct device\t\ttdev;\n\t/* n_sector is CLEAR_BEGIN, read comment above CLEAR_BEGIN */\n\tu64\t\t\tn_sectors;\t/* size of device, if ATA */\n\tu64\t\t\tn_native_sectors; /* native size, if ATA */\n\tunsigned int\t\tclass;\t\t/* ATA_DEV_xxx */\n\tunsigned long\t\tunpark_deadline;\n\n\tu8\t\t\tpio_mode;\n\tu8\t\t\tdma_mode;\n\tu8\t\t\txfer_mode;\n\tunsigned int\t\txfer_shift;\t/* ATA_SHIFT_xxx */\n\n\tunsigned int\t\tmulti_count;\t/* sectors count for\n\t\t\t\t\t\t   READ/WRITE MULTIPLE */\n\tunsigned int\t\tmax_sectors;\t/* per-device max sectors */\n\tunsigned int\t\tcdb_len;\n\n\t/* per-dev xfer mask */\n\tunsigned long\t\tpio_mask;\n\tunsigned long\t\tmwdma_mask;\n\tunsigned long\t\tudma_mask;\n\n\t/* for CHS addressing */\n\tu16\t\t\tcylinders;\t/* Number of cylinders */\n\tu16\t\t\theads;\t\t/* Number of heads */\n\tu16\t\t\tsectors;\t/* Number of sectors per track */\n\n\tunion {\n\t\tu16\t\tid[ATA_ID_WORDS]; /* IDENTIFY xxx DEVICE data */\n\t\tu32\t\tgscr[SATA_PMP_GSCR_DWORDS]; /* PMP GSCR block */\n\t} ____cacheline_aligned;\n\n\t/* DEVSLP Timing Variables from Identify Device Data Log */\n\tu8\t\t\tdevslp_timing[ATA_LOG_DEVSLP_SIZE];\n\n\t/* NCQ send and receive log subcommand support */\n\tu8\t\t\tncq_send_recv_cmds[ATA_LOG_NCQ_SEND_RECV_SIZE];\n\tu8\t\t\tncq_non_data_cmds[ATA_LOG_NCQ_NON_DATA_SIZE];\n\n\t/* ZAC zone configuration */\n\tu32\t\t\tzac_zoned_cap;\n\tu32\t\t\tzac_zones_optimal_open;\n\tu32\t\t\tzac_zones_optimal_nonseq;\n\tu32\t\t\tzac_zones_max_open;\n\n\t/* error history */\n\tint\t\t\tspdn_cnt;\n\t/* ering is CLEAR_END, read comment above CLEAR_END */\n\tstruct ata_ering\tering;\n};\n\n/* Fields between ATA_DEVICE_CLEAR_BEGIN and ATA_DEVICE_CLEAR_END are\n * cleared to zero on ata_dev_init().\n */\n#define ATA_DEVICE_CLEAR_BEGIN\t\toffsetof(struct ata_device, n_sectors)\n#define ATA_DEVICE_CLEAR_END\t\toffsetof(struct ata_device, ering)\n\nstruct ata_eh_info {\n\tstruct ata_device\t*dev;\t\t/* offending device */\n\tu32\t\t\tserror;\t\t/* SError from LLDD */\n\tunsigned int\t\terr_mask;\t/* port-wide err_mask */\n\tunsigned int\t\taction;\t\t/* ATA_EH_* action mask */\n\tunsigned int\t\tdev_action[ATA_MAX_DEVICES]; /* dev EH action */\n\tunsigned int\t\tflags;\t\t/* ATA_EHI_* flags */\n\n\tunsigned int\t\tprobe_mask;\n\n\tchar\t\t\tdesc[ATA_EH_DESC_LEN];\n\tint\t\t\tdesc_len;\n};\n\nstruct ata_eh_context {\n\tstruct ata_eh_info\ti;\n\tint\t\t\ttries[ATA_MAX_DEVICES];\n\tint\t\t\tcmd_timeout_idx[ATA_MAX_DEVICES]\n\t\t\t\t\t       [ATA_EH_CMD_TIMEOUT_TABLE_SIZE];\n\tunsigned int\t\tclasses[ATA_MAX_DEVICES];\n\tunsigned int\t\tdid_probe_mask;\n\tunsigned int\t\tunloaded_mask;\n\tunsigned int\t\tsaved_ncq_enabled;\n\tu8\t\t\tsaved_xfer_mode[ATA_MAX_DEVICES];\n\t/* timestamp for the last reset attempt or success */\n\tunsigned long\t\tlast_reset;\n};\n\nstruct ata_acpi_drive\n{\n\tu32 pio;\n\tu32 dma;\n} __packed;\n\nstruct ata_acpi_gtm {\n\tstruct ata_acpi_drive drive[2];\n\tu32 flags;\n} __packed;\n\nstruct ata_link {\n\tstruct ata_port\t\t*ap;\n\tint\t\t\tpmp;\t\t/* port multiplier port # */\n\n\tstruct device\t\ttdev;\n\tunsigned int\t\tactive_tag;\t/* active tag on this link */\n\tu32\t\t\tsactive;\t/* active NCQ commands */\n\n\tunsigned int\t\tflags;\t\t/* ATA_LFLAG_xxx */\n\n\tu32\t\t\tsaved_scontrol;\t/* SControl on probe */\n\tunsigned int\t\thw_sata_spd_limit;\n\tunsigned int\t\tsata_spd_limit;\n\tunsigned int\t\tsata_spd;\t/* current SATA PHY speed */\n\tenum ata_lpm_policy\tlpm_policy;\n\n\t/* record runtime error info, protected by host_set lock */\n\tstruct ata_eh_info\teh_info;\n\t/* EH context */\n\tstruct ata_eh_context\teh_context;\n\n\tstruct ata_device\tdevice[ATA_MAX_DEVICES];\n\n\tunsigned long\t\tlast_lpm_change; /* when last LPM change happened */\n};\n#define ATA_LINK_CLEAR_BEGIN\t\toffsetof(struct ata_link, active_tag)\n#define ATA_LINK_CLEAR_END\t\toffsetof(struct ata_link, device[0])\n\nstruct ata_port {\n\tstruct Scsi_Host\t*scsi_host; /* our co-allocated scsi host */\n\tstruct ata_port_operations *ops;\n\tspinlock_t\t\t*lock;\n\t/* Flags owned by the EH context. Only EH should touch these once the\n\t   port is active */\n\tunsigned long\t\tflags;\t/* ATA_FLAG_xxx */\n\t/* Flags that change dynamically, protected by ap->lock */\n\tunsigned int\t\tpflags; /* ATA_PFLAG_xxx */\n\tunsigned int\t\tprint_id; /* user visible unique port ID */\n\tunsigned int            local_port_no; /* host local port num */\n\tunsigned int\t\tport_no; /* 0 based port no. inside the host */\n\n#ifdef CONFIG_ATA_SFF\n\tstruct ata_ioports\tioaddr;\t/* ATA cmd/ctl/dma register blocks */\n\tu8\t\t\tctl;\t/* cache of ATA control register */\n\tu8\t\t\tlast_ctl;\t/* Cache last written value */\n\tstruct ata_link*\tsff_pio_task_link; /* link currently used */\n\tstruct delayed_work\tsff_pio_task;\n#ifdef CONFIG_ATA_BMDMA\n\tstruct ata_bmdma_prd\t*bmdma_prd;\t/* BMDMA SG list */\n\tdma_addr_t\t\tbmdma_prd_dma;\t/* and its DMA mapping */\n#endif /* CONFIG_ATA_BMDMA */\n#endif /* CONFIG_ATA_SFF */\n\n\tunsigned int\t\tpio_mask;\n\tunsigned int\t\tmwdma_mask;\n\tunsigned int\t\tudma_mask;\n\tunsigned int\t\tcbl;\t/* cable type; ATA_CBL_xxx */\n\n\tstruct ata_queued_cmd\tqcmd[ATA_MAX_QUEUE + 1];\n\tunsigned long\t\tsas_tag_allocated; /* for sas tag allocation only */\n\tu64\t\t\tqc_active;\n\tint\t\t\tnr_active_links; /* #links with active qcs */\n\tunsigned int\t\tsas_last_tag;\t/* track next tag hw expects */\n\n\tstruct ata_link\t\tlink;\t\t/* host default link */\n\tstruct ata_link\t\t*slave_link;\t/* see ata_slave_link_init() */\n\n\tint\t\t\tnr_pmp_links;\t/* nr of available PMP links */\n\tstruct ata_link\t\t*pmp_link;\t/* array of PMP links */\n\tstruct ata_link\t\t*excl_link;\t/* for PMP qc exclusion */\n\n\tstruct ata_port_stats\tstats;\n\tstruct ata_host\t\t*host;\n\tstruct device \t\t*dev;\n\tstruct device\t\ttdev;\n\n\tstruct mutex\t\tscsi_scan_mutex;\n\tstruct delayed_work\thotplug_task;\n\tstruct work_struct\tscsi_rescan_task;\n\n\tunsigned int\t\thsm_task_state;\n\n\tu32\t\t\tmsg_enable;\n\tstruct list_head\teh_done_q;\n\twait_queue_head_t\teh_wait_q;\n\tint\t\t\teh_tries;\n\tstruct completion\tpark_req_pending;\n\n\tpm_message_t\t\tpm_mesg;\n\tenum ata_lpm_policy\ttarget_lpm_policy;\n\n\tstruct timer_list\tfastdrain_timer;\n\tunsigned long\t\tfastdrain_cnt;\n\n\tasync_cookie_t\t\tcookie;\n\n\tint\t\t\tem_message_type;\n\tvoid\t\t\t*private_data;\n\n#ifdef CONFIG_ATA_ACPI\n\tstruct ata_acpi_gtm\t__acpi_init_gtm; /* use ata_acpi_init_gtm() */\n#endif\n\t/* owned by EH */\n\tu8\t\t\tsector_buf[ATA_SECT_SIZE] ____cacheline_aligned;\n};\n\n/* The following initializer overrides a method to NULL whether one of\n * its parent has the method defined or not.  This is equivalent to\n * ERR_PTR(-ENOENT).  Unfortunately, ERR_PTR doesn't render a constant\n * expression and thus can't be used as an initializer.\n */\n#define ATA_OP_NULL\t\t(void *)(unsigned long)(-ENOENT)\n\nstruct ata_port_operations {\n\t/*\n\t * Command execution\n\t */\n\tint (*qc_defer)(struct ata_queued_cmd *qc);\n\tint (*check_atapi_dma)(struct ata_queued_cmd *qc);\n\tenum ata_completion_errors (*qc_prep)(struct ata_queued_cmd *qc);\n\tunsigned int (*qc_issue)(struct ata_queued_cmd *qc);\n\tbool (*qc_fill_rtf)(struct ata_queued_cmd *qc);\n\n\t/*\n\t * Configuration and exception handling\n\t */\n\tint  (*cable_detect)(struct ata_port *ap);\n\tunsigned long (*mode_filter)(struct ata_device *dev, unsigned long xfer_mask);\n\tvoid (*set_piomode)(struct ata_port *ap, struct ata_device *dev);\n\tvoid (*set_dmamode)(struct ata_port *ap, struct ata_device *dev);\n\tint  (*set_mode)(struct ata_link *link, struct ata_device **r_failed_dev);\n\tunsigned int (*read_id)(struct ata_device *dev, struct ata_taskfile *tf, u16 *id);\n\n\tvoid (*dev_config)(struct ata_device *dev);\n\n\tvoid (*freeze)(struct ata_port *ap);\n\tvoid (*thaw)(struct ata_port *ap);\n\tata_prereset_fn_t\tprereset;\n\tata_reset_fn_t\t\tsoftreset;\n\tata_reset_fn_t\t\thardreset;\n\tata_postreset_fn_t\tpostreset;\n\tata_prereset_fn_t\tpmp_prereset;\n\tata_reset_fn_t\t\tpmp_softreset;\n\tata_reset_fn_t\t\tpmp_hardreset;\n\tata_postreset_fn_t\tpmp_postreset;\n\tvoid (*error_handler)(struct ata_port *ap);\n\tvoid (*lost_interrupt)(struct ata_port *ap);\n\tvoid (*post_internal_cmd)(struct ata_queued_cmd *qc);\n\tvoid (*sched_eh)(struct ata_port *ap);\n\tvoid (*end_eh)(struct ata_port *ap);\n\n\t/*\n\t * Optional features\n\t */\n\tint  (*scr_read)(struct ata_link *link, unsigned int sc_reg, u32 *val);\n\tint  (*scr_write)(struct ata_link *link, unsigned int sc_reg, u32 val);\n\tvoid (*pmp_attach)(struct ata_port *ap);\n\tvoid (*pmp_detach)(struct ata_port *ap);\n\tint  (*set_lpm)(struct ata_link *link, enum ata_lpm_policy policy,\n\t\t\tunsigned hints);\n\n\t/*\n\t * Start, stop, suspend and resume\n\t */\n\tint  (*port_suspend)(struct ata_port *ap, pm_message_t mesg);\n\tint  (*port_resume)(struct ata_port *ap);\n\tint  (*port_start)(struct ata_port *ap);\n\tvoid (*port_stop)(struct ata_port *ap);\n\tvoid (*host_stop)(struct ata_host *host);\n\n#ifdef CONFIG_ATA_SFF\n\t/*\n\t * SFF / taskfile oriented ops\n\t */\n\tvoid (*sff_dev_select)(struct ata_port *ap, unsigned int device);\n\tvoid (*sff_set_devctl)(struct ata_port *ap, u8 ctl);\n\tu8   (*sff_check_status)(struct ata_port *ap);\n\tu8   (*sff_check_altstatus)(struct ata_port *ap);\n\tvoid (*sff_tf_load)(struct ata_port *ap, const struct ata_taskfile *tf);\n\tvoid (*sff_tf_read)(struct ata_port *ap, struct ata_taskfile *tf);\n\tvoid (*sff_exec_command)(struct ata_port *ap,\n\t\t\t\t const struct ata_taskfile *tf);\n\tunsigned int (*sff_data_xfer)(struct ata_queued_cmd *qc,\n\t\t\tunsigned char *buf, unsigned int buflen, int rw);\n\tvoid (*sff_irq_on)(struct ata_port *);\n\tbool (*sff_irq_check)(struct ata_port *);\n\tvoid (*sff_irq_clear)(struct ata_port *);\n\tvoid (*sff_drain_fifo)(struct ata_queued_cmd *qc);\n\n#ifdef CONFIG_ATA_BMDMA\n\tvoid (*bmdma_setup)(struct ata_queued_cmd *qc);\n\tvoid (*bmdma_start)(struct ata_queued_cmd *qc);\n\tvoid (*bmdma_stop)(struct ata_queued_cmd *qc);\n\tu8   (*bmdma_status)(struct ata_port *ap);\n#endif /* CONFIG_ATA_BMDMA */\n#endif /* CONFIG_ATA_SFF */\n\n\tssize_t (*em_show)(struct ata_port *ap, char *buf);\n\tssize_t (*em_store)(struct ata_port *ap, const char *message,\n\t\t\t    size_t size);\n\tssize_t (*sw_activity_show)(struct ata_device *dev, char *buf);\n\tssize_t (*sw_activity_store)(struct ata_device *dev,\n\t\t\t\t     enum sw_activity val);\n\tssize_t (*transmit_led_message)(struct ata_port *ap, u32 state,\n\t\t\t\t\tssize_t size);\n\n\t/*\n\t * Obsolete\n\t */\n\tvoid (*phy_reset)(struct ata_port *ap);\n\tvoid (*eng_timeout)(struct ata_port *ap);\n\n\t/*\n\t * ->inherits must be the last field and all the preceding\n\t * fields must be pointers.\n\t */\n\tconst struct ata_port_operations\t*inherits;\n};\n\nstruct ata_port_info {\n\tunsigned long\t\tflags;\n\tunsigned long\t\tlink_flags;\n\tunsigned long\t\tpio_mask;\n\tunsigned long\t\tmwdma_mask;\n\tunsigned long\t\tudma_mask;\n\tstruct ata_port_operations *port_ops;\n\tvoid \t\t\t*private_data;\n};\n\nstruct ata_timing {\n\tunsigned short mode;\t\t/* ATA mode */\n\tunsigned short setup;\t\t/* t1 */\n\tunsigned short act8b;\t\t/* t2 for 8-bit I/O */\n\tunsigned short rec8b;\t\t/* t2i for 8-bit I/O */\n\tunsigned short cyc8b;\t\t/* t0 for 8-bit I/O */\n\tunsigned short active;\t\t/* t2 or tD */\n\tunsigned short recover;\t\t/* t2i or tK */\n\tunsigned short dmack_hold;\t/* tj */\n\tunsigned short cycle;\t\t/* t0 */\n\tunsigned short udma;\t\t/* t2CYCTYP/2 */\n};\n\n/*\n * Core layer - drivers/ata/libata-core.c\n */\nextern struct ata_port_operations ata_dummy_port_ops;\nextern const struct ata_port_info ata_dummy_port_info;\n\nstatic inline bool ata_is_atapi(u8 prot)\n{\n\treturn prot & ATA_PROT_FLAG_ATAPI;\n}\n\nstatic inline bool ata_is_pio(u8 prot)\n{\n\treturn prot & ATA_PROT_FLAG_PIO;\n}\n\nstatic inline bool ata_is_dma(u8 prot)\n{\n\treturn prot & ATA_PROT_FLAG_DMA;\n}\n\nstatic inline bool ata_is_ncq(u8 prot)\n{\n\treturn prot & ATA_PROT_FLAG_NCQ;\n}\n\nstatic inline bool ata_is_data(u8 prot)\n{\n\treturn prot & (ATA_PROT_FLAG_PIO | ATA_PROT_FLAG_DMA);\n}\n\nstatic inline int is_multi_taskfile(struct ata_taskfile *tf)\n{\n\treturn (tf->command == ATA_CMD_READ_MULTI) ||\n\t       (tf->command == ATA_CMD_WRITE_MULTI) ||\n\t       (tf->command == ATA_CMD_READ_MULTI_EXT) ||\n\t       (tf->command == ATA_CMD_WRITE_MULTI_EXT) ||\n\t       (tf->command == ATA_CMD_WRITE_MULTI_FUA_EXT);\n}\n\nstatic inline int ata_port_is_dummy(struct ata_port *ap)\n{\n\treturn ap->ops == &ata_dummy_port_ops;\n}\n\nextern int ata_std_prereset(struct ata_link *link, unsigned long deadline);\nextern int ata_wait_after_reset(struct ata_link *link, unsigned long deadline,\n\t\t\t\tint (*check_ready)(struct ata_link *link));\nextern int sata_std_hardreset(struct ata_link *link, unsigned int *class,\n\t\t\t      unsigned long deadline);\nextern void ata_std_postreset(struct ata_link *link, unsigned int *classes);\n\nextern struct ata_host *ata_host_alloc(struct device *dev, int max_ports);\nextern struct ata_host *ata_host_alloc_pinfo(struct device *dev,\n\t\t\tconst struct ata_port_info * const * ppi, int n_ports);\nextern void ata_host_get(struct ata_host *host);\nextern void ata_host_put(struct ata_host *host);\nextern int ata_host_start(struct ata_host *host);\nextern int ata_host_register(struct ata_host *host,\n\t\t\t     struct scsi_host_template *sht);\nextern int ata_host_activate(struct ata_host *host, int irq,\n\t\t\t     irq_handler_t irq_handler, unsigned long irq_flags,\n\t\t\t     struct scsi_host_template *sht);\nextern void ata_host_detach(struct ata_host *host);\nextern void ata_host_init(struct ata_host *, struct device *, struct ata_port_operations *);\nextern int ata_scsi_detect(struct scsi_host_template *sht);\nextern int ata_scsi_ioctl(struct scsi_device *dev, unsigned int cmd,\n\t\t\t  void __user *arg);\n#ifdef CONFIG_COMPAT\n#define ATA_SCSI_COMPAT_IOCTL .compat_ioctl = ata_scsi_ioctl,\n#else\n#define ATA_SCSI_COMPAT_IOCTL /* empty */\n#endif\nextern int ata_scsi_queuecmd(struct Scsi_Host *h, struct scsi_cmnd *cmd);\n#if IS_REACHABLE(CONFIG_ATA)\nbool ata_scsi_dma_need_drain(struct request *rq);\n#else\n#define ata_scsi_dma_need_drain NULL\n#endif\nextern int ata_sas_scsi_ioctl(struct ata_port *ap, struct scsi_device *dev,\n\t\t\t    unsigned int cmd, void __user *arg);\nextern bool ata_link_online(struct ata_link *link);\nextern bool ata_link_offline(struct ata_link *link);\n#ifdef CONFIG_PM\nextern int ata_host_suspend(struct ata_host *host, pm_message_t mesg);\nextern void ata_host_resume(struct ata_host *host);\nextern void ata_sas_port_suspend(struct ata_port *ap);\nextern void ata_sas_port_resume(struct ata_port *ap);\n#else\nstatic inline void ata_sas_port_suspend(struct ata_port *ap)\n{\n}\nstatic inline void ata_sas_port_resume(struct ata_port *ap)\n{\n}\n#endif\nextern int ata_ratelimit(void);\nextern void ata_msleep(struct ata_port *ap, unsigned int msecs);\nextern u32 ata_wait_register(struct ata_port *ap, void __iomem *reg, u32 mask,\n\t\t\tu32 val, unsigned long interval, unsigned long timeout);\nextern int atapi_cmd_type(u8 opcode);\nextern unsigned long ata_pack_xfermask(unsigned long pio_mask,\n\t\t\tunsigned long mwdma_mask, unsigned long udma_mask);\nextern void ata_unpack_xfermask(unsigned long xfer_mask,\n\t\t\tunsigned long *pio_mask, unsigned long *mwdma_mask,\n\t\t\tunsigned long *udma_mask);\nextern u8 ata_xfer_mask2mode(unsigned long xfer_mask);\nextern unsigned long ata_xfer_mode2mask(u8 xfer_mode);\nextern int ata_xfer_mode2shift(unsigned long xfer_mode);\nextern const char *ata_mode_string(unsigned long xfer_mask);\nextern unsigned long ata_id_xfermask(const u16 *id);\nextern int ata_std_qc_defer(struct ata_queued_cmd *qc);\nextern enum ata_completion_errors ata_noop_qc_prep(struct ata_queued_cmd *qc);\nextern void ata_sg_init(struct ata_queued_cmd *qc, struct scatterlist *sg,\n\t\t unsigned int n_elem);\nextern unsigned int ata_dev_classify(const struct ata_taskfile *tf);\nextern void ata_dev_disable(struct ata_device *adev);\nextern void ata_id_string(const u16 *id, unsigned char *s,\n\t\t\t  unsigned int ofs, unsigned int len);\nextern void ata_id_c_string(const u16 *id, unsigned char *s,\n\t\t\t    unsigned int ofs, unsigned int len);\nextern unsigned int ata_do_dev_read_id(struct ata_device *dev,\n\t\t\t\t\tstruct ata_taskfile *tf, u16 *id);\nextern void ata_qc_complete(struct ata_queued_cmd *qc);\nextern u64 ata_qc_get_active(struct ata_port *ap);\nextern void ata_scsi_simulate(struct ata_device *dev, struct scsi_cmnd *cmd);\nextern int ata_std_bios_param(struct scsi_device *sdev,\n\t\t\t      struct block_device *bdev,\n\t\t\t      sector_t capacity, int geom[]);\nextern void ata_scsi_unlock_native_capacity(struct scsi_device *sdev);\nextern int ata_scsi_slave_config(struct scsi_device *sdev);\nextern void ata_scsi_slave_destroy(struct scsi_device *sdev);\nextern int ata_scsi_change_queue_depth(struct scsi_device *sdev,\n\t\t\t\t       int queue_depth);\nextern int __ata_change_queue_depth(struct ata_port *ap, struct scsi_device *sdev,\n\t\t\t\t    int queue_depth);\nextern struct ata_device *ata_dev_pair(struct ata_device *adev);\nextern int ata_do_set_mode(struct ata_link *link, struct ata_device **r_failed_dev);\nextern void ata_scsi_port_error_handler(struct Scsi_Host *host, struct ata_port *ap);\nextern void ata_scsi_cmd_error_handler(struct Scsi_Host *host, struct ata_port *ap, struct list_head *eh_q);\n\n/*\n * SATA specific code - drivers/ata/libata-sata.c\n */\n#ifdef CONFIG_SATA_HOST\nextern const unsigned long sata_deb_timing_normal[];\nextern const unsigned long sata_deb_timing_hotplug[];\nextern const unsigned long sata_deb_timing_long[];\n\nstatic inline const unsigned long *\nsata_ehc_deb_timing(struct ata_eh_context *ehc)\n{\n\tif (ehc->i.flags & ATA_EHI_HOTPLUGGED)\n\t\treturn sata_deb_timing_hotplug;\n\telse\n\t\treturn sata_deb_timing_normal;\n}\n\nextern int sata_scr_valid(struct ata_link *link);\nextern int sata_scr_read(struct ata_link *link, int reg, u32 *val);\nextern int sata_scr_write(struct ata_link *link, int reg, u32 val);\nextern int sata_scr_write_flush(struct ata_link *link, int reg, u32 val);\nextern int sata_set_spd(struct ata_link *link);\nextern int sata_link_hardreset(struct ata_link *link,\n\t\t\tconst unsigned long *timing, unsigned long deadline,\n\t\t\tbool *online, int (*check_ready)(struct ata_link *));\nextern int sata_link_resume(struct ata_link *link, const unsigned long *params,\n\t\t\t    unsigned long deadline);\nextern void ata_eh_analyze_ncq_error(struct ata_link *link);\n#else\nstatic inline const unsigned long *\nsata_ehc_deb_timing(struct ata_eh_context *ehc)\n{\n\treturn NULL;\n}\nstatic inline int sata_scr_valid(struct ata_link *link) { return 0; }\nstatic inline int sata_scr_read(struct ata_link *link, int reg, u32 *val)\n{\n\treturn -EOPNOTSUPP;\n}\nstatic inline int sata_scr_write(struct ata_link *link, int reg, u32 val)\n{\n\treturn -EOPNOTSUPP;\n}\nstatic inline int sata_scr_write_flush(struct ata_link *link, int reg, u32 val)\n{\n\treturn -EOPNOTSUPP;\n}\nstatic inline int sata_set_spd(struct ata_link *link) { return -EOPNOTSUPP; }\nstatic inline int sata_link_hardreset(struct ata_link *link,\n\t\t\t\t      const unsigned long *timing,\n\t\t\t\t      unsigned long deadline,\n\t\t\t\t      bool *online,\n\t\t\t\t      int (*check_ready)(struct ata_link *))\n{\n\tif (online)\n\t\t*online = false;\n\treturn -EOPNOTSUPP;\n}\nstatic inline int sata_link_resume(struct ata_link *link,\n\t\t\t\t   const unsigned long *params,\n\t\t\t\t   unsigned long deadline)\n{\n\treturn -EOPNOTSUPP;\n}\nstatic inline void ata_eh_analyze_ncq_error(struct ata_link *link) { }\n#endif\nextern int sata_link_debounce(struct ata_link *link,\n\t\t\tconst unsigned long *params, unsigned long deadline);\nextern int sata_link_scr_lpm(struct ata_link *link, enum ata_lpm_policy policy,\n\t\t\t     bool spm_wakeup);\nextern int ata_slave_link_init(struct ata_port *ap);\nextern void ata_sas_port_destroy(struct ata_port *);\nextern struct ata_port *ata_sas_port_alloc(struct ata_host *,\n\t\t\t\t\t   struct ata_port_info *, struct Scsi_Host *);\nextern void ata_sas_async_probe(struct ata_port *ap);\nextern int ata_sas_sync_probe(struct ata_port *ap);\nextern int ata_sas_port_init(struct ata_port *);\nextern int ata_sas_port_start(struct ata_port *ap);\nextern int ata_sas_tport_add(struct device *parent, struct ata_port *ap);\nextern void ata_sas_tport_delete(struct ata_port *ap);\nextern void ata_sas_port_stop(struct ata_port *ap);\nextern int ata_sas_slave_configure(struct scsi_device *, struct ata_port *);\nextern int ata_sas_queuecmd(struct scsi_cmnd *cmd, struct ata_port *ap);\nextern void ata_tf_to_fis(const struct ata_taskfile *tf,\n\t\t\t  u8 pmp, int is_cmd, u8 *fis);\nextern void ata_tf_from_fis(const u8 *fis, struct ata_taskfile *tf);\nextern int ata_qc_complete_multiple(struct ata_port *ap, u64 qc_active);\nextern bool sata_lpm_ignore_phy_events(struct ata_link *link);\nextern int sata_async_notification(struct ata_port *ap);\n\nextern int ata_cable_40wire(struct ata_port *ap);\nextern int ata_cable_80wire(struct ata_port *ap);\nextern int ata_cable_sata(struct ata_port *ap);\nextern int ata_cable_ignore(struct ata_port *ap);\nextern int ata_cable_unknown(struct ata_port *ap);\n\n/* Timing helpers */\nextern unsigned int ata_pio_need_iordy(const struct ata_device *);\nextern u8 ata_timing_cycle2mode(unsigned int xfer_shift, int cycle);\n\n/* PCI */\n#ifdef CONFIG_PCI\nstruct pci_dev;\n\nstruct pci_bits {\n\tunsigned int\t\treg;\t/* PCI config register to read */\n\tunsigned int\t\twidth;\t/* 1 (8 bit), 2 (16 bit), 4 (32 bit) */\n\tunsigned long\t\tmask;\n\tunsigned long\t\tval;\n};\n\nextern int pci_test_config_bits(struct pci_dev *pdev, const struct pci_bits *bits);\nextern void ata_pci_shutdown_one(struct pci_dev *pdev);\nextern void ata_pci_remove_one(struct pci_dev *pdev);\n\n#ifdef CONFIG_PM\nextern void ata_pci_device_do_suspend(struct pci_dev *pdev, pm_message_t mesg);\nextern int __must_check ata_pci_device_do_resume(struct pci_dev *pdev);\nextern int ata_pci_device_suspend(struct pci_dev *pdev, pm_message_t mesg);\nextern int ata_pci_device_resume(struct pci_dev *pdev);\n#endif /* CONFIG_PM */\n#endif /* CONFIG_PCI */\n\nstruct platform_device;\n\nextern int ata_platform_remove_one(struct platform_device *pdev);\n\n/*\n * ACPI - drivers/ata/libata-acpi.c\n */\n#ifdef CONFIG_ATA_ACPI\nstatic inline const struct ata_acpi_gtm *ata_acpi_init_gtm(struct ata_port *ap)\n{\n\tif (ap->pflags & ATA_PFLAG_INIT_GTM_VALID)\n\t\treturn &ap->__acpi_init_gtm;\n\treturn NULL;\n}\nint ata_acpi_stm(struct ata_port *ap, const struct ata_acpi_gtm *stm);\nint ata_acpi_gtm(struct ata_port *ap, struct ata_acpi_gtm *stm);\nunsigned long ata_acpi_gtm_xfermask(struct ata_device *dev,\n\t\t\t\t    const struct ata_acpi_gtm *gtm);\nint ata_acpi_cbl_80wire(struct ata_port *ap, const struct ata_acpi_gtm *gtm);\n#else\nstatic inline const struct ata_acpi_gtm *ata_acpi_init_gtm(struct ata_port *ap)\n{\n\treturn NULL;\n}\n\nstatic inline int ata_acpi_stm(const struct ata_port *ap,\n\t\t\t       struct ata_acpi_gtm *stm)\n{\n\treturn -ENOSYS;\n}\n\nstatic inline int ata_acpi_gtm(const struct ata_port *ap,\n\t\t\t       struct ata_acpi_gtm *stm)\n{\n\treturn -ENOSYS;\n}\n\nstatic inline unsigned int ata_acpi_gtm_xfermask(struct ata_device *dev,\n\t\t\t\t\tconst struct ata_acpi_gtm *gtm)\n{\n\treturn 0;\n}\n\nstatic inline int ata_acpi_cbl_80wire(struct ata_port *ap,\n\t\t\t\t      const struct ata_acpi_gtm *gtm)\n{\n\treturn 0;\n}\n#endif\n\n/*\n * EH - drivers/ata/libata-eh.c\n */\nextern void ata_port_schedule_eh(struct ata_port *ap);\nextern void ata_port_wait_eh(struct ata_port *ap);\nextern int ata_link_abort(struct ata_link *link);\nextern int ata_port_abort(struct ata_port *ap);\nextern int ata_port_freeze(struct ata_port *ap);\n\nextern void ata_eh_freeze_port(struct ata_port *ap);\nextern void ata_eh_thaw_port(struct ata_port *ap);\n\nextern void ata_eh_qc_complete(struct ata_queued_cmd *qc);\nextern void ata_eh_qc_retry(struct ata_queued_cmd *qc);\n\nextern void ata_do_eh(struct ata_port *ap, ata_prereset_fn_t prereset,\n\t\t      ata_reset_fn_t softreset, ata_reset_fn_t hardreset,\n\t\t      ata_postreset_fn_t postreset);\nextern void ata_std_error_handler(struct ata_port *ap);\nextern void ata_std_sched_eh(struct ata_port *ap);\nextern void ata_std_end_eh(struct ata_port *ap);\nextern int ata_link_nr_enabled(struct ata_link *link);\n\n/*\n * Base operations to inherit from and initializers for sht\n *\n * Operations\n *\n * base  : Common to all libata drivers.\n * sata  : SATA controllers w/ native interface.\n * pmp   : SATA controllers w/ PMP support.\n * sff   : SFF ATA controllers w/o BMDMA support.\n * bmdma : SFF ATA controllers w/ BMDMA support.\n *\n * sht initializers\n *\n * BASE  : Common to all libata drivers.  The user must set\n *\t   sg_tablesize and dma_boundary.\n * PIO   : SFF ATA controllers w/ only PIO support.\n * BMDMA : SFF ATA controllers w/ BMDMA support.  sg_tablesize and\n *\t   dma_boundary are set to BMDMA limits.\n * NCQ   : SATA controllers supporting NCQ.  The user must set\n *\t   sg_tablesize, dma_boundary and can_queue.\n */\nextern const struct ata_port_operations ata_base_port_ops;\nextern const struct ata_port_operations sata_port_ops;\nextern struct device_attribute *ata_common_sdev_attrs[];\n\n/*\n * All sht initializers (BASE, PIO, BMDMA, NCQ) must be instantiated\n * by the edge drivers.  Because the 'module' field of sht must be the\n * edge driver's module reference, otherwise the driver can be unloaded\n * even if the scsi_device is being accessed.\n */\n#define __ATA_BASE_SHT(drv_name)\t\t\t\t\\\n\t.module\t\t\t= THIS_MODULE,\t\t\t\\\n\t.name\t\t\t= drv_name,\t\t\t\\\n\t.ioctl\t\t\t= ata_scsi_ioctl,\t\t\\\n\tATA_SCSI_COMPAT_IOCTL\t\t\t\t\t\\\n\t.queuecommand\t\t= ata_scsi_queuecmd,\t\t\\\n\t.dma_need_drain\t\t= ata_scsi_dma_need_drain,\t\\\n\t.can_queue\t\t= ATA_DEF_QUEUE,\t\t\\\n\t.tag_alloc_policy\t= BLK_TAG_ALLOC_RR,\t\t\\\n\t.this_id\t\t= ATA_SHT_THIS_ID,\t\t\\\n\t.emulated\t\t= ATA_SHT_EMULATED,\t\t\\\n\t.proc_name\t\t= drv_name,\t\t\t\\\n\t.slave_configure\t= ata_scsi_slave_config,\t\\\n\t.slave_destroy\t\t= ata_scsi_slave_destroy,\t\\\n\t.bios_param\t\t= ata_std_bios_param,\t\t\\\n\t.unlock_native_capacity\t= ata_scsi_unlock_native_capacity\n\n#define ATA_BASE_SHT(drv_name)\t\t\t\t\t\\\n\t__ATA_BASE_SHT(drv_name),\t\t\t\t\\\n\t.sdev_attrs\t\t= ata_common_sdev_attrs\n\n#ifdef CONFIG_SATA_HOST\nextern struct device_attribute *ata_ncq_sdev_attrs[];\n\n#define ATA_NCQ_SHT(drv_name)\t\t\t\t\t\\\n\t__ATA_BASE_SHT(drv_name),\t\t\t\t\\\n\t.sdev_attrs\t\t= ata_ncq_sdev_attrs,\t\t\\\n\t.change_queue_depth\t= ata_scsi_change_queue_depth\n#endif\n\n/*\n * PMP helpers\n */\n#ifdef CONFIG_SATA_PMP\nstatic inline bool sata_pmp_supported(struct ata_port *ap)\n{\n\treturn ap->flags & ATA_FLAG_PMP;\n}\n\nstatic inline bool sata_pmp_attached(struct ata_port *ap)\n{\n\treturn ap->nr_pmp_links != 0;\n}\n\nstatic inline bool ata_is_host_link(const struct ata_link *link)\n{\n\treturn link == &link->ap->link || link == link->ap->slave_link;\n}\n#else /* CONFIG_SATA_PMP */\nstatic inline bool sata_pmp_supported(struct ata_port *ap)\n{\n\treturn false;\n}\n\nstatic inline bool sata_pmp_attached(struct ata_port *ap)\n{\n\treturn false;\n}\n\nstatic inline bool ata_is_host_link(const struct ata_link *link)\n{\n\treturn 1;\n}\n#endif /* CONFIG_SATA_PMP */\n\nstatic inline int sata_srst_pmp(struct ata_link *link)\n{\n\tif (sata_pmp_supported(link->ap) && ata_is_host_link(link))\n\t\treturn SATA_PMP_CTRL_PORT;\n\treturn link->pmp;\n}\n\n/*\n * printk helpers\n */\n__printf(3, 4)\nvoid ata_port_printk(const struct ata_port *ap, const char *level,\n\t\t     const char *fmt, ...);\n__printf(3, 4)\nvoid ata_link_printk(const struct ata_link *link, const char *level,\n\t\t     const char *fmt, ...);\n__printf(3, 4)\nvoid ata_dev_printk(const struct ata_device *dev, const char *level,\n\t\t    const char *fmt, ...);\n\n#define ata_port_err(ap, fmt, ...)\t\t\t\t\\\n\tata_port_printk(ap, KERN_ERR, fmt, ##__VA_ARGS__)\n#define ata_port_warn(ap, fmt, ...)\t\t\t\t\\\n\tata_port_printk(ap, KERN_WARNING, fmt, ##__VA_ARGS__)\n#define ata_port_notice(ap, fmt, ...)\t\t\t\t\\\n\tata_port_printk(ap, KERN_NOTICE, fmt, ##__VA_ARGS__)\n#define ata_port_info(ap, fmt, ...)\t\t\t\t\\\n\tata_port_printk(ap, KERN_INFO, fmt, ##__VA_ARGS__)\n#define ata_port_dbg(ap, fmt, ...)\t\t\t\t\\\n\tata_port_printk(ap, KERN_DEBUG, fmt, ##__VA_ARGS__)\n\n#define ata_link_err(link, fmt, ...)\t\t\t\t\\\n\tata_link_printk(link, KERN_ERR, fmt, ##__VA_ARGS__)\n#define ata_link_warn(link, fmt, ...)\t\t\t\t\\\n\tata_link_printk(link, KERN_WARNING, fmt, ##__VA_ARGS__)\n#define ata_link_notice(link, fmt, ...)\t\t\t\t\\\n\tata_link_printk(link, KERN_NOTICE, fmt, ##__VA_ARGS__)\n#define ata_link_info(link, fmt, ...)\t\t\t\t\\\n\tata_link_printk(link, KERN_INFO, fmt, ##__VA_ARGS__)\n#define ata_link_dbg(link, fmt, ...)\t\t\t\t\\\n\tata_link_printk(link, KERN_DEBUG, fmt, ##__VA_ARGS__)\n\n#define ata_dev_err(dev, fmt, ...)\t\t\t\t\\\n\tata_dev_printk(dev, KERN_ERR, fmt, ##__VA_ARGS__)\n#define ata_dev_warn(dev, fmt, ...)\t\t\t\t\\\n\tata_dev_printk(dev, KERN_WARNING, fmt, ##__VA_ARGS__)\n#define ata_dev_notice(dev, fmt, ...)\t\t\t\t\\\n\tata_dev_printk(dev, KERN_NOTICE, fmt, ##__VA_ARGS__)\n#define ata_dev_info(dev, fmt, ...)\t\t\t\t\\\n\tata_dev_printk(dev, KERN_INFO, fmt, ##__VA_ARGS__)\n#define ata_dev_dbg(dev, fmt, ...)\t\t\t\t\\\n\tata_dev_printk(dev, KERN_DEBUG, fmt, ##__VA_ARGS__)\n\nvoid ata_print_version(const struct device *dev, const char *version);\n\n/*\n * ata_eh_info helpers\n */\nextern __printf(2, 3)\nvoid __ata_ehi_push_desc(struct ata_eh_info *ehi, const char *fmt, ...);\nextern __printf(2, 3)\nvoid ata_ehi_push_desc(struct ata_eh_info *ehi, const char *fmt, ...);\nextern void ata_ehi_clear_desc(struct ata_eh_info *ehi);\n\nstatic inline void ata_ehi_hotplugged(struct ata_eh_info *ehi)\n{\n\tehi->probe_mask |= (1 << ATA_MAX_DEVICES) - 1;\n\tehi->flags |= ATA_EHI_HOTPLUGGED;\n\tehi->action |= ATA_EH_RESET | ATA_EH_ENABLE_LINK;\n\tehi->err_mask |= AC_ERR_ATA_BUS;\n}\n\n/*\n * port description helpers\n */\nextern __printf(2, 3)\nvoid ata_port_desc(struct ata_port *ap, const char *fmt, ...);\n#ifdef CONFIG_PCI\nextern void ata_port_pbar_desc(struct ata_port *ap, int bar, ssize_t offset,\n\t\t\t       const char *name);\n#endif\n\nstatic inline bool ata_tag_internal(unsigned int tag)\n{\n\treturn tag == ATA_TAG_INTERNAL;\n}\n\nstatic inline bool ata_tag_valid(unsigned int tag)\n{\n\treturn tag < ATA_MAX_QUEUE || ata_tag_internal(tag);\n}\n\n#define __ata_qc_for_each(ap, qc, tag, max_tag, fn)\t\t\\\n\tfor ((tag) = 0; (tag) < (max_tag) &&\t\t\t\\\n\t     ({ qc = fn((ap), (tag)); 1; }); (tag)++)\t\t\\\n\n/*\n * Internal use only, iterate commands ignoring error handling and\n * status of 'qc'.\n */\n#define ata_qc_for_each_raw(ap, qc, tag)\t\t\t\t\t\\\n\t__ata_qc_for_each(ap, qc, tag, ATA_MAX_QUEUE, __ata_qc_from_tag)\n\n/*\n * Iterate all potential commands that can be queued\n */\n#define ata_qc_for_each(ap, qc, tag)\t\t\t\t\t\\\n\t__ata_qc_for_each(ap, qc, tag, ATA_MAX_QUEUE, ata_qc_from_tag)\n\n/*\n * Like ata_qc_for_each, but with the internal tag included\n */\n#define ata_qc_for_each_with_internal(ap, qc, tag)\t\t\t\\\n\t__ata_qc_for_each(ap, qc, tag, ATA_MAX_QUEUE + 1, ata_qc_from_tag)\n\n/*\n * device helpers\n */\nstatic inline unsigned int ata_class_enabled(unsigned int class)\n{\n\treturn class == ATA_DEV_ATA || class == ATA_DEV_ATAPI ||\n\t\tclass == ATA_DEV_PMP || class == ATA_DEV_SEMB ||\n\t\tclass == ATA_DEV_ZAC;\n}\n\nstatic inline unsigned int ata_class_disabled(unsigned int class)\n{\n\treturn class == ATA_DEV_ATA_UNSUP || class == ATA_DEV_ATAPI_UNSUP ||\n\t\tclass == ATA_DEV_PMP_UNSUP || class == ATA_DEV_SEMB_UNSUP ||\n\t\tclass == ATA_DEV_ZAC_UNSUP;\n}\n\nstatic inline unsigned int ata_class_absent(unsigned int class)\n{\n\treturn !ata_class_enabled(class) && !ata_class_disabled(class);\n}\n\nstatic inline unsigned int ata_dev_enabled(const struct ata_device *dev)\n{\n\treturn ata_class_enabled(dev->class);\n}\n\nstatic inline unsigned int ata_dev_disabled(const struct ata_device *dev)\n{\n\treturn ata_class_disabled(dev->class);\n}\n\nstatic inline unsigned int ata_dev_absent(const struct ata_device *dev)\n{\n\treturn ata_class_absent(dev->class);\n}\n\n/*\n * link helpers\n */\nstatic inline int ata_link_max_devices(const struct ata_link *link)\n{\n\tif (ata_is_host_link(link) && link->ap->flags & ATA_FLAG_SLAVE_POSS)\n\t\treturn 2;\n\treturn 1;\n}\n\nstatic inline int ata_link_active(struct ata_link *link)\n{\n\treturn ata_tag_valid(link->active_tag) || link->sactive;\n}\n\n/*\n * Iterators\n *\n * ATA_LITER_* constants are used to select link iteration mode and\n * ATA_DITER_* device iteration mode.\n *\n * For a custom iteration directly using ata_{link|dev}_next(), if\n * @link or @dev, respectively, is NULL, the first element is\n * returned.  @dev and @link can be any valid device or link and the\n * next element according to the iteration mode will be returned.\n * After the last element, NULL is returned.\n */\nenum ata_link_iter_mode {\n\tATA_LITER_EDGE,\t\t/* if present, PMP links only; otherwise,\n\t\t\t\t * host link.  no slave link */\n\tATA_LITER_HOST_FIRST,\t/* host link followed by PMP or slave links */\n\tATA_LITER_PMP_FIRST,\t/* PMP links followed by host link,\n\t\t\t\t * slave link still comes after host link */\n};\n\nenum ata_dev_iter_mode {\n\tATA_DITER_ENABLED,\n\tATA_DITER_ENABLED_REVERSE,\n\tATA_DITER_ALL,\n\tATA_DITER_ALL_REVERSE,\n};\n\nextern struct ata_link *ata_link_next(struct ata_link *link,\n\t\t\t\t      struct ata_port *ap,\n\t\t\t\t      enum ata_link_iter_mode mode);\n\nextern struct ata_device *ata_dev_next(struct ata_device *dev,\n\t\t\t\t       struct ata_link *link,\n\t\t\t\t       enum ata_dev_iter_mode mode);\n\n/*\n * Shortcut notation for iterations\n *\n * ata_for_each_link() iterates over each link of @ap according to\n * @mode.  @link points to the current link in the loop.  @link is\n * NULL after loop termination.  ata_for_each_dev() works the same way\n * except that it iterates over each device of @link.\n *\n * Note that the mode prefixes ATA_{L|D}ITER_ shouldn't need to be\n * specified when using the following shorthand notations.  Only the\n * mode itself (EDGE, HOST_FIRST, ENABLED, etc...) should be\n * specified.  This not only increases brevity but also makes it\n * impossible to use ATA_LITER_* for device iteration or vice-versa.\n */\n#define ata_for_each_link(link, ap, mode) \\\n\tfor ((link) = ata_link_next(NULL, (ap), ATA_LITER_##mode); (link); \\\n\t     (link) = ata_link_next((link), (ap), ATA_LITER_##mode))\n\n#define ata_for_each_dev(dev, link, mode) \\\n\tfor ((dev) = ata_dev_next(NULL, (link), ATA_DITER_##mode); (dev); \\\n\t     (dev) = ata_dev_next((dev), (link), ATA_DITER_##mode))\n\n/**\n *\tata_ncq_enabled - Test whether NCQ is enabled\n *\t@dev: ATA device to test for\n *\n *\tLOCKING:\n *\tspin_lock_irqsave(host lock)\n *\n *\tRETURNS:\n *\t1 if NCQ is enabled for @dev, 0 otherwise.\n */\nstatic inline int ata_ncq_enabled(struct ata_device *dev)\n{\n\tif (!IS_ENABLED(CONFIG_SATA_HOST))\n\t\treturn 0;\n\treturn (dev->flags & (ATA_DFLAG_PIO | ATA_DFLAG_NCQ_OFF |\n\t\t\t      ATA_DFLAG_NCQ)) == ATA_DFLAG_NCQ;\n}\n\nstatic inline bool ata_fpdma_dsm_supported(struct ata_device *dev)\n{\n\treturn (dev->flags & ATA_DFLAG_NCQ_SEND_RECV) &&\n\t\t(dev->ncq_send_recv_cmds[ATA_LOG_NCQ_SEND_RECV_DSM_OFFSET] &\n\t\t ATA_LOG_NCQ_SEND_RECV_DSM_TRIM);\n}\n\nstatic inline bool ata_fpdma_read_log_supported(struct ata_device *dev)\n{\n\treturn (dev->flags & ATA_DFLAG_NCQ_SEND_RECV) &&\n\t\t(dev->ncq_send_recv_cmds[ATA_LOG_NCQ_SEND_RECV_RD_LOG_OFFSET] &\n\t\t ATA_LOG_NCQ_SEND_RECV_RD_LOG_SUPPORTED);\n}\n\nstatic inline bool ata_fpdma_zac_mgmt_in_supported(struct ata_device *dev)\n{\n\treturn (dev->flags & ATA_DFLAG_NCQ_SEND_RECV) &&\n\t\t(dev->ncq_send_recv_cmds[ATA_LOG_NCQ_SEND_RECV_ZAC_MGMT_OFFSET] &\n\t\tATA_LOG_NCQ_SEND_RECV_ZAC_MGMT_IN_SUPPORTED);\n}\n\nstatic inline bool ata_fpdma_zac_mgmt_out_supported(struct ata_device *dev)\n{\n\treturn (dev->ncq_non_data_cmds[ATA_LOG_NCQ_NON_DATA_ZAC_MGMT_OFFSET] &\n\t\tATA_LOG_NCQ_NON_DATA_ZAC_MGMT_OUT);\n}\n\nstatic inline void ata_qc_set_polling(struct ata_queued_cmd *qc)\n{\n\tqc->tf.ctl |= ATA_NIEN;\n}\n\nstatic inline struct ata_queued_cmd *__ata_qc_from_tag(struct ata_port *ap,\n\t\t\t\t\t\t       unsigned int tag)\n{\n\tif (ata_tag_valid(tag))\n\t\treturn &ap->qcmd[tag];\n\treturn NULL;\n}\n\nstatic inline struct ata_queued_cmd *ata_qc_from_tag(struct ata_port *ap,\n\t\t\t\t\t\t     unsigned int tag)\n{\n\tstruct ata_queued_cmd *qc = __ata_qc_from_tag(ap, tag);\n\n\tif (unlikely(!qc) || !ap->ops->error_handler)\n\t\treturn qc;\n\n\tif ((qc->flags & (ATA_QCFLAG_ACTIVE |\n\t\t\t  ATA_QCFLAG_FAILED)) == ATA_QCFLAG_ACTIVE)\n\t\treturn qc;\n\n\treturn NULL;\n}\n\nstatic inline unsigned int ata_qc_raw_nbytes(struct ata_queued_cmd *qc)\n{\n\treturn qc->nbytes - min(qc->extrabytes, qc->nbytes);\n}\n\nstatic inline void ata_tf_init(struct ata_device *dev, struct ata_taskfile *tf)\n{\n\tmemset(tf, 0, sizeof(*tf));\n\n#ifdef CONFIG_ATA_SFF\n\ttf->ctl = dev->link->ap->ctl;\n#else\n\ttf->ctl = ATA_DEVCTL_OBS;\n#endif\n\tif (dev->devno == 0)\n\t\ttf->device = ATA_DEVICE_OBS;\n\telse\n\t\ttf->device = ATA_DEVICE_OBS | ATA_DEV1;\n}\n\nstatic inline void ata_qc_reinit(struct ata_queued_cmd *qc)\n{\n\tqc->dma_dir = DMA_NONE;\n\tqc->sg = NULL;\n\tqc->flags = 0;\n\tqc->cursg = NULL;\n\tqc->cursg_ofs = 0;\n\tqc->nbytes = qc->extrabytes = qc->curbytes = 0;\n\tqc->n_elem = 0;\n\tqc->err_mask = 0;\n\tqc->sect_size = ATA_SECT_SIZE;\n\n\tata_tf_init(qc->dev, &qc->tf);\n\n\t/* init result_tf such that it indicates normal completion */\n\tqc->result_tf.command = ATA_DRDY;\n\tqc->result_tf.feature = 0;\n}\n\nstatic inline int ata_try_flush_cache(const struct ata_device *dev)\n{\n\treturn ata_id_wcache_enabled(dev->id) ||\n\t       ata_id_has_flush(dev->id) ||\n\t       ata_id_has_flush_ext(dev->id);\n}\n\nstatic inline unsigned int ac_err_mask(u8 status)\n{\n\tif (status & (ATA_BUSY | ATA_DRQ))\n\t\treturn AC_ERR_HSM;\n\tif (status & (ATA_ERR | ATA_DF))\n\t\treturn AC_ERR_DEV;\n\treturn 0;\n}\n\nstatic inline unsigned int __ac_err_mask(u8 status)\n{\n\tunsigned int mask = ac_err_mask(status);\n\tif (mask == 0)\n\t\treturn AC_ERR_OTHER;\n\treturn mask;\n}\n\nstatic inline struct ata_port *ata_shost_to_port(struct Scsi_Host *host)\n{\n\treturn *(struct ata_port **)&host->hostdata[0];\n}\n\nstatic inline int ata_check_ready(u8 status)\n{\n\tif (!(status & ATA_BUSY))\n\t\treturn 1;\n\n\t/* 0xff indicates either no device or device not ready */\n\tif (status == 0xff)\n\t\treturn -ENODEV;\n\n\treturn 0;\n}\n\nstatic inline unsigned long ata_deadline(unsigned long from_jiffies,\n\t\t\t\t\t unsigned long timeout_msecs)\n{\n\treturn from_jiffies + msecs_to_jiffies(timeout_msecs);\n}\n\n/* Don't open code these in drivers as there are traps. Firstly the range may\n   change in future hardware and specs, secondly 0xFF means 'no DMA' but is\n   > UDMA_0. Dyma ddreigiau */\n\nstatic inline int ata_using_mwdma(struct ata_device *adev)\n{\n\tif (adev->dma_mode >= XFER_MW_DMA_0 && adev->dma_mode <= XFER_MW_DMA_4)\n\t\treturn 1;\n\treturn 0;\n}\n\nstatic inline int ata_using_udma(struct ata_device *adev)\n{\n\tif (adev->dma_mode >= XFER_UDMA_0 && adev->dma_mode <= XFER_UDMA_7)\n\t\treturn 1;\n\treturn 0;\n}\n\nstatic inline int ata_dma_enabled(struct ata_device *adev)\n{\n\treturn (adev->dma_mode == 0xFF ? 0 : 1);\n}\n\n/**************************************************************************\n * PATA timings - drivers/ata/libata-pata-timings.c\n */\nextern const struct ata_timing *ata_timing_find_mode(u8 xfer_mode);\nextern int ata_timing_compute(struct ata_device *, unsigned short,\n\t\t\t      struct ata_timing *, int, int);\nextern void ata_timing_merge(const struct ata_timing *,\n\t\t\t     const struct ata_timing *, struct ata_timing *,\n\t\t\t     unsigned int);\n\n/**************************************************************************\n * PMP - drivers/ata/libata-pmp.c\n */\n#ifdef CONFIG_SATA_PMP\n\nextern const struct ata_port_operations sata_pmp_port_ops;\n\nextern int sata_pmp_qc_defer_cmd_switch(struct ata_queued_cmd *qc);\nextern void sata_pmp_error_handler(struct ata_port *ap);\n\n#else /* CONFIG_SATA_PMP */\n\n#define sata_pmp_port_ops\t\tsata_port_ops\n#define sata_pmp_qc_defer_cmd_switch\tata_std_qc_defer\n#define sata_pmp_error_handler\t\tata_std_error_handler\n\n#endif /* CONFIG_SATA_PMP */\n\n\n/**************************************************************************\n * SFF - drivers/ata/libata-sff.c\n */\n#ifdef CONFIG_ATA_SFF\n\nextern const struct ata_port_operations ata_sff_port_ops;\nextern const struct ata_port_operations ata_bmdma32_port_ops;\n\n/* PIO only, sg_tablesize and dma_boundary limits can be removed */\n#define ATA_PIO_SHT(drv_name)\t\t\t\t\t\\\n\tATA_BASE_SHT(drv_name),\t\t\t\t\t\\\n\t.sg_tablesize\t\t= LIBATA_MAX_PRD,\t\t\\\n\t.dma_boundary\t\t= ATA_DMA_BOUNDARY\n\nextern void ata_sff_dev_select(struct ata_port *ap, unsigned int device);\nextern u8 ata_sff_check_status(struct ata_port *ap);\nextern void ata_sff_pause(struct ata_port *ap);\nextern void ata_sff_dma_pause(struct ata_port *ap);\nextern int ata_sff_busy_sleep(struct ata_port *ap,\n\t\t\t      unsigned long timeout_pat, unsigned long timeout);\nextern int ata_sff_wait_ready(struct ata_link *link, unsigned long deadline);\nextern void ata_sff_tf_load(struct ata_port *ap, const struct ata_taskfile *tf);\nextern void ata_sff_tf_read(struct ata_port *ap, struct ata_taskfile *tf);\nextern void ata_sff_exec_command(struct ata_port *ap,\n\t\t\t\t const struct ata_taskfile *tf);\nextern unsigned int ata_sff_data_xfer(struct ata_queued_cmd *qc,\n\t\t\tunsigned char *buf, unsigned int buflen, int rw);\nextern unsigned int ata_sff_data_xfer32(struct ata_queued_cmd *qc,\n\t\t\tunsigned char *buf, unsigned int buflen, int rw);\nextern void ata_sff_irq_on(struct ata_port *ap);\nextern void ata_sff_irq_clear(struct ata_port *ap);\nextern int ata_sff_hsm_move(struct ata_port *ap, struct ata_queued_cmd *qc,\n\t\t\t    u8 status, int in_wq);\nextern void ata_sff_queue_work(struct work_struct *work);\nextern void ata_sff_queue_delayed_work(struct delayed_work *dwork,\n\t\tunsigned long delay);\nextern void ata_sff_queue_pio_task(struct ata_link *link, unsigned long delay);\nextern unsigned int ata_sff_qc_issue(struct ata_queued_cmd *qc);\nextern bool ata_sff_qc_fill_rtf(struct ata_queued_cmd *qc);\nextern unsigned int ata_sff_port_intr(struct ata_port *ap,\n\t\t\t\t      struct ata_queued_cmd *qc);\nextern irqreturn_t ata_sff_interrupt(int irq, void *dev_instance);\nextern void ata_sff_lost_interrupt(struct ata_port *ap);\nextern void ata_sff_freeze(struct ata_port *ap);\nextern void ata_sff_thaw(struct ata_port *ap);\nextern int ata_sff_prereset(struct ata_link *link, unsigned long deadline);\nextern unsigned int ata_sff_dev_classify(struct ata_device *dev, int present,\n\t\t\t\t\t  u8 *r_err);\nextern int ata_sff_wait_after_reset(struct ata_link *link, unsigned int devmask,\n\t\t\t\t    unsigned long deadline);\nextern int ata_sff_softreset(struct ata_link *link, unsigned int *classes,\n\t\t\t     unsigned long deadline);\nextern int sata_sff_hardreset(struct ata_link *link, unsigned int *class,\n\t\t\t       unsigned long deadline);\nextern void ata_sff_postreset(struct ata_link *link, unsigned int *classes);\nextern void ata_sff_drain_fifo(struct ata_queued_cmd *qc);\nextern void ata_sff_error_handler(struct ata_port *ap);\nextern void ata_sff_std_ports(struct ata_ioports *ioaddr);\n#ifdef CONFIG_PCI\nextern int ata_pci_sff_init_host(struct ata_host *host);\nextern int ata_pci_sff_prepare_host(struct pci_dev *pdev,\n\t\t\t\t    const struct ata_port_info * const * ppi,\n\t\t\t\t    struct ata_host **r_host);\nextern int ata_pci_sff_activate_host(struct ata_host *host,\n\t\t\t\t     irq_handler_t irq_handler,\n\t\t\t\t     struct scsi_host_template *sht);\nextern int ata_pci_sff_init_one(struct pci_dev *pdev,\n\t\tconst struct ata_port_info * const * ppi,\n\t\tstruct scsi_host_template *sht, void *host_priv, int hflags);\n#endif /* CONFIG_PCI */\n\n#ifdef CONFIG_ATA_BMDMA\n\nextern const struct ata_port_operations ata_bmdma_port_ops;\n\n#define ATA_BMDMA_SHT(drv_name)\t\t\t\t\t\\\n\tATA_BASE_SHT(drv_name),\t\t\t\t\t\\\n\t.sg_tablesize\t\t= LIBATA_MAX_PRD,\t\t\\\n\t.dma_boundary\t\t= ATA_DMA_BOUNDARY\n\nextern enum ata_completion_errors ata_bmdma_qc_prep(struct ata_queued_cmd *qc);\nextern unsigned int ata_bmdma_qc_issue(struct ata_queued_cmd *qc);\nextern enum ata_completion_errors ata_bmdma_dumb_qc_prep(struct ata_queued_cmd *qc);\nextern unsigned int ata_bmdma_port_intr(struct ata_port *ap,\n\t\t\t\t      struct ata_queued_cmd *qc);\nextern irqreturn_t ata_bmdma_interrupt(int irq, void *dev_instance);\nextern void ata_bmdma_error_handler(struct ata_port *ap);\nextern void ata_bmdma_post_internal_cmd(struct ata_queued_cmd *qc);\nextern void ata_bmdma_irq_clear(struct ata_port *ap);\nextern void ata_bmdma_setup(struct ata_queued_cmd *qc);\nextern void ata_bmdma_start(struct ata_queued_cmd *qc);\nextern void ata_bmdma_stop(struct ata_queued_cmd *qc);\nextern u8 ata_bmdma_status(struct ata_port *ap);\nextern int ata_bmdma_port_start(struct ata_port *ap);\nextern int ata_bmdma_port_start32(struct ata_port *ap);\n\n#ifdef CONFIG_PCI\nextern int ata_pci_bmdma_clear_simplex(struct pci_dev *pdev);\nextern void ata_pci_bmdma_init(struct ata_host *host);\nextern int ata_pci_bmdma_prepare_host(struct pci_dev *pdev,\n\t\t\t\t      const struct ata_port_info * const * ppi,\n\t\t\t\t      struct ata_host **r_host);\nextern int ata_pci_bmdma_init_one(struct pci_dev *pdev,\n\t\t\t\t  const struct ata_port_info * const * ppi,\n\t\t\t\t  struct scsi_host_template *sht,\n\t\t\t\t  void *host_priv, int hflags);\n#endif /* CONFIG_PCI */\n#endif /* CONFIG_ATA_BMDMA */\n\n/**\n *\tata_sff_busy_wait - Wait for a port status register\n *\t@ap: Port to wait for.\n *\t@bits: bits that must be clear\n *\t@max: number of 10uS waits to perform\n *\n *\tWaits up to max*10 microseconds for the selected bits in the port's\n *\tstatus register to be cleared.\n *\tReturns final value of status register.\n *\n *\tLOCKING:\n *\tInherited from caller.\n */\nstatic inline u8 ata_sff_busy_wait(struct ata_port *ap, unsigned int bits,\n\t\t\t\t   unsigned int max)\n{\n\tu8 status;\n\n\tdo {\n\t\tudelay(10);\n\t\tstatus = ap->ops->sff_check_status(ap);\n\t\tmax--;\n\t} while (status != 0xff && (status & bits) && (max > 0));\n\n\treturn status;\n}\n\n/**\n *\tata_wait_idle - Wait for a port to be idle.\n *\t@ap: Port to wait for.\n *\n *\tWaits up to 10ms for port's BUSY and DRQ signals to clear.\n *\tReturns final value of status register.\n *\n *\tLOCKING:\n *\tInherited from caller.\n */\nstatic inline u8 ata_wait_idle(struct ata_port *ap)\n{\n\tu8 status = ata_sff_busy_wait(ap, ATA_BUSY | ATA_DRQ, 1000);\n\n#ifdef ATA_DEBUG\n\tif (status != 0xff && (status & (ATA_BUSY | ATA_DRQ)))\n\t\tata_port_printk(ap, KERN_DEBUG, \"abnormal Status 0x%X\\n\",\n\t\t\t\tstatus);\n#endif\n\n\treturn status;\n}\n#endif /* CONFIG_ATA_SFF */\n\n#endif /* __LINUX_LIBATA_H__ */\n"}}, "reports": [{"events": [{"location": {"col": 2, "file": 0, "line": 1256}, "message": "Value stored to 'tmp' is never read"}, {"location": {"col": 2, "file": 0, "line": 1256}, "message": "Value stored to 'tmp' is never read"}], "macros": [], "notes": [], "path": "/src/drivers/ata/libahci.c", "reportHash": "11818b58865f02ecbaae5a5cb236671d", "checkerName": "clang-analyzer-deadcode.DeadStores", "reviewStatus": null, "severity": "UNSPECIFIED"}, {"events": [{"location": {"col": 6, "file": 0, "line": 1965}, "message": "Assuming 'irq_stat' is not equal to 0"}, {"location": {"col": 2, "file": 0, "line": 1965}, "message": "Taking false branch"}, {"location": {"col": 7, "file": 0, "line": 1972}, "message": "Calling 'ahci_handle_port_intr'"}, {"location": {"col": 14, "file": 0, "line": 1926}, "message": "Assuming 'i' is < field 'n_ports'"}, {"location": {"col": 2, "file": 0, "line": 1926}, "message": "Loop condition is true.  Entering loop body"}, {"location": {"col": 7, "file": 0, "line": 1929}, "message": "Assuming the condition is false"}, {"location": {"col": 3, "file": 0, "line": 1929}, "message": "Taking false branch"}, {"location": {"col": 7, "file": 0, "line": 1933}, "message": "Assuming 'ap' is non-null"}, {"location": {"col": 3, "file": 0, "line": 1933}, "message": "Taking true branch"}, {"location": {"col": 4, "file": 0, "line": 1934}, "message": "Calling 'ahci_port_intr'"}, {"location": {"col": 2, "file": 0, "line": 1899}, "message": "Calling 'ahci_handle_port_interrupt'"}, {"location": {"col": 19, "file": 0, "line": 1813}, "message": "Assuming the condition is true"}, {"location": {"col": 2, "file": 0, "line": 1818}, "message": "Taking false branch"}, {"location": {"col": 6, "file": 0, "line": 1821}, "message": "Assuming the condition is false"}, {"location": {"col": 2, "file": 0, "line": 1821}, "message": "Taking false branch"}, {"location": {"col": 6, "file": 0, "line": 1826}, "message": "Assuming the condition is false"}, {"location": {"col": 40, "file": 1, "line": 78}, "message": "expanded from macro 'unlikely'"}, {"location": {"col": 2, "file": 0, "line": 1826}, "message": "Taking true branch"}, {"location": {"col": 3, "file": 0, "line": 1827}, "message": "Calling 'ahci_error_intr'"}, {"location": {"col": 2, "file": 0, "line": 1705}, "message": "'serror' declared without an initial value"}, {"location": {"col": 6, "file": 0, "line": 1708}, "message": "Assuming field 'fbs_enabled' is false"}, {"location": {"col": 2, "file": 0, "line": 1708}, "message": "Taking false branch"}, {"location": {"col": 3, "file": 0, "line": 1719}, "message": "Loop condition is false. Execution continues on line 1723"}, {"location": {"col": 2, "file": 2, "line": 1675}, "message": "expanded from macro 'ata_for_each_link'"}, {"location": {"col": 7, "file": 0, "line": 1723}, "message": "'link' is null"}, {"location": {"col": 2, "file": 0, "line": 1723}, "message": "Taking true branch"}, {"location": {"col": 2, "file": 0, "line": 1734}, "message": "Calling 'ahci_scr_read'"}, {"location": {"col": 6, "file": 0, "line": 603}, "message": "Assuming 'offset' is 0"}, {"location": {"col": 2, "file": 0, "line": 603}, "message": "Taking false branch"}, {"location": {"col": 2, "file": 0, "line": 607}, "message": "Returning without writing to '*val'"}, {"location": {"col": 2, "file": 0, "line": 1734}, "message": "Returning from 'ahci_scr_read'"}, {"location": {"col": 2, "file": 0, "line": 1735}, "message": "3rd function call argument is an uninitialized value"}, {"location": {"col": 2, "file": 0, "line": 1735}, "message": "3rd function call argument is an uninitialized value"}], "macros": [], "notes": [], "path": "/src/drivers/ata/libahci.c", "reportHash": "6d47002138fc2c7fe57ba443eb0d9e7a", "checkerName": "clang-analyzer-core.CallAndMessage", "reviewStatus": null, "severity": "UNSPECIFIED"}]};
      window.onload = function() {
        if (!browserCompatible) {
          setNonCompatibleBrowserMessage();
        } else {
          BugViewer.init(data.files, data.reports);
          BugViewer.create();
          BugViewer.initByUrl();
        }
      };
    </script>
  </head>
  <body>
  <div class="container">
    <div id="content">
      <div id="side-bar">
        <div class="header">
          <a href="index.html" class="button">&#8249; Return to List</a>
        </div>
        <div id="report-nav">
          <div class="header">Reports</div>
        </div>
      </div>
      <div id="editor-wrapper">
        <div class="header">
          <div id="file">
            <span class="label">File:</span>
            <span id="file-path"></span>
          </div>
          <div id="checker">
            <span class="label">Checker name:</span>
            <span id="checker-name"></span>
          </div>
          <div id="review-status-wrapper">
            <span class="label">Review status:</span>
            <span id="review-status"></span>
          </div>
        </div>
        <div id="editor"></div>
      </div>
    </div>
  </div>
  </body>
</html>
